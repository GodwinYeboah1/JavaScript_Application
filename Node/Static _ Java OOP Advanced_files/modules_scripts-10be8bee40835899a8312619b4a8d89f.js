function triggerFormChange(){switch($(this).attr("id")){case"edit-chapter-name":break;default:hasFormChanged=!0}}function checkBeforeUnload(e){if($(".module-edit").length>0)return hasFormChanged&&(e.returnValue=hasFormChanged),e.returnValue}function uploadFile(e){for(var t=e.attr("action"),i=$("#upload_file"),n=new FormData,r=0;r<i[0].files.length;r++)n.append("upload[file][]",i[0].files[r]);return n.append("upload[user_id]",$('input[name="upload[user_id]"]').val()),n.append("upload[course_id]",$('input[name="upload[course_id]"]').val()),n.append("upload[chapter_id]",$('input[name="upload[chapter_id]"]').val()),n.append("upload[chapter_module_id]",$('input[name="module_id"]').val()),$(e).find(".actions .fa-spinner").removeClass("hidden"),$(e).find(".actions .btn").val("UPLOADING!!"),$.ajax({url:t,method:"POST",contentType:!1,cache:!1,processData:!1,data:n,success:function(e){1==e.success&&$("div.uploads-table").find(".table tbody").append(e.partial),$(".actions .btn").removeClass("disabled_btn"),$(".actions .fa-spinner").addClass("hidden"),$(".actions .btn").val("CREATE UPLOAD"),$("#uploaded_file_list").html(""),i.val(""),$(".upload_name").text("No file chosen")}}),!1}function renderError(e){"object"==typeof e&&(e=JSON.stringify(e)),e="Error: "+e,console.error(e),$("#main_content").prepend($("<div />",{"class":"errors",html:e}))}function confirmDeleteChapter(){var e=$(this).closest(".modal").find("input[name='chapter_id']").val();$.ajax({url:"/chapters/"+e,method:"DELETE",contentType:"application/json",success:function(e){location.href=e.refs.redirect.url},error:renderError})}function confirmDeleteModule(){var e=$(this).closest(".modal").find("input[name='module_id']").attr("data-module"),t=$(this).closest(".modal").find("input[name='chapter_id']").attr("data-chapter"),i=$(this).closest(".modal").find("input[name='track_id']").attr("data-track");$.ajax({url:"/modules/"+i+"/"+t+"/"+e,method:"DELETE",contentType:"application/json",success:function(e){location.href=e.refs.redirect.url},error:renderError})}function createNewChapter(){var e=$(this);e.text("SAVING...").addClass("disabled_btn");var t={data:{course_id:$("ul#chapter_list").data("course-id"),title:e.siblings("input[type='text']").val()}};$.ajax({url:"/chapters",method:"POST",contentType:"application/json",data:JSON.stringify(t),success:function(t){console.log("Success handler",t),e.text("SAVE").removeClass("disabled_btn"),location.href=t.refs.edit},error:renderError})}function updateChapterName(){var e=$(this);e.text("SAVING...").addClass("disabled_btn");var t={data:{title:e.siblings("input[type='text']").val()}},i=e.closest(".modal-content").find("input[name='chapter_id']").val();$.ajax({url:"/chapters/"+i,method:"PATCH",data:JSON.stringify(t),contentType:"application/json",success:function(){location.reload(),e.text("SAVE").removeClass("disabled_btn")},error:renderError})}function handleDrop(e){var t=$(e.target),i="",n={data:{}},r=t.children("li").toArray();(t.hasClass("module-list")||t.hasClass("horizontal_chapter_list_view"))&&(i="/chapters/"+t.data("chapter-id"),"chapter",n.data.modules_order=r.map(function(e){return $(e).data("module-id")}).join(", ")),setTimeout(function(){$(e.target).children("li").css("top","")},10),$.ajax({url:i,method:"PATCH",contentType:"application/json",data:JSON.stringify(n),success:function(e){console.log("handleDrop success handler: ",e)},error:renderError})}function handleAddAssignmentTask(e){e.preventDefault();var t=$("#new-task").val();""!=t?($("ol.tasks").append($("<li />",{html:[$("<span/>",{"class":"drag_icon glyphicon glyphicon-th"}),$("<span/>",{"class":"to_do_task",text:t}),$("<a/>",{"class":"pull-right remove-assignment",href:"#",html:[$("<span/>",{"class":"glyphicon glyphicon-trash"})]})]})),$("#new-task").val("")):$("#new-task").focus()}function selectModuleByListItem(){$(this).data("module-id")}function handleEditModuleSubmit(e){e.preventDefault();var t=$("#description").redactor("core.object");t.source.$textarea.hasClass("open")&&t.source.hide();$('input[name="module_id"]').val();var i=removePrismHighlighting($("#description"));$('input[name="title"]').val(),!1!==i&&$(i).redactor("code.get"),$("section.module-info").data("module-type"),$("input#is_admin_module").prop("checked")}function removePrismHighlighting(e){var t=$(e).clone();return $("div.toolbar").remove(),$(t).empty(),_.each(e[0].children,function(e){var i=$(e).clone(),n=$(i).data("language");if("PRE"==i.prop("tagName")){$(r).find("div.toolbar").remove();var r=$(i),o=$(r).text().search("copy")>0?$(r).text().replace("copy",""):$(r).text();n==undefined&&(n=i.find("code").attr("class")),$(r).removeClass(),$(r).text(o),$(r).attr("data-language",n),$(t).append(r)}else{var s=i.children("pre");s.length>0&&(i=removePrismHighlighting($(s).parent())),$(t).append(i)}}),$(t).redactor(),$(t).html()}function changePrism_to_Rainbow(){var e=0==$("#description").length?$(".module_content").find(".module_description")[0]:$("#description");setTimeout(function(){$(e).html(removePrismHighlighting($(e)));var t=$("pre").find(".from-rainbow");t.each(function(e){t[e].length&&$(t[e]).contents().unwrap()}),$(e).find(".lesson_assignment_select").length&&$(e).find(".lesson_assignment_select").selectpicker(),Rainbow.addClass("from-rainbow"),Rainbow.color(),setTimeout(function(){is_rainbow=!0,$("#programs_content").removeClass("hidden"),search_module&&search_key_word(sessionStorage.getItem("search"),"#5F9EA0")},500)},500)}function getModuleMetadata(e){switch(e.module_type){case"lesson":return getLessonMetadata(e.description);case"quiz":return getQuiztMetadata();case"assignment":return getAssignmentMetadata();case"admin_module":return getLessonMetadata(e.description)}}function getLessonMetadata(e){var t={};return t.with_video=Boolean(e.match(/player.vimeo.com/)),t}function getQuiztMetadata(){var e={questions:[]};return $("ol.questions li.question").each(function(t,i){var n={question:$(i).find("span.question").text(),choices:[]};$(i).find("ol.choices li.choice").each(function(e,t){var i={content:$(t).find("span.option").text()};$(t).find("input").is(":checked")&&(i.is_answer=!0),n.choices.push(i)}),e.questions.push(n)}),e}function getAssignmentMetadata(){var e={};return $("li.module-setting").each(function(t,i){var n,r,o=$(i).find("input, select, textarea")[0];o&&(r=$(o).attr("id"),n="checkbox"===$(o).attr("type")?$(o).is(":checked"):$(o).val(),e[r]=n)}),$("div.module-list").each(function(t,i){var n=$(i).attr("id"),r=$(i).find("li");e[n]=[],r.each(function(t,i){e[n].push($(i).find(".to_do_task").text())})}),e}function addChoiceToQuestion(e){e.preventDefault();var t=$(this),i=t.parent().data("questionIndex"),n=$('ol.choices[data-question-index="'+i+'"]'),r=n.find("li").length,o=t.siblings('input[name="new-choice"]'),s=$("<li/>",{"class":"choice",html:[$("<span/>",{"class":"drag_icon glyphicon glyphicon-th ui-sortable-handle"}),$("<input/>",{type:"radio",id:"choice_"+i+"_"+r,name:"choice_"+i}),$("<label/>",{"for":"choice_"+i+"_"+r,html:[$("<span/>",{"class":"radio_marker",html:[$("<span/>",{"class":"marker"})]})]}),$("<span/>",{"class":"option",contenteditable:!0,text:o.val()}),$("<a />",{"class":"remove-choice",type:"button",href:"#",html:$("<div/>",{"class":"glyphicon glyphicon-trash"})})]});""!=t.siblings("input[type='text']").val()&&(n.append(s),o.val(""))}function addQuestionToQuiz(e){e.preventDefault();var t=$(this).siblings('input[name="new-question"]'),i=$("li.question").length,n=$("<li/>",{"class":"question",html:[$("<h4 />",{html:[$("<span/>",{"class":"drag_icon glyphicon glyphicon-th ui-sortable-handle"}),$("<span/>",{"class":"question",contenteditable:!0,text:t.val()}),$("<a />",{"class":"remove-question",href:"#",html:$("<div/>",{"class":"glyphicon glyphicon-trash"})})]}),$("<ol />",{"class":"choices list-unstyled","data-question-index":i}),$("<div />",{"class":"add-new-choice","data-question-index":i,html:[$("<input/>",{type:"text",name:"new-choice",placeholder:"New choice"}),$("<input/>",{type:"submit","class":"btn-sm btn btn-primary",value:"Add choice"})]})]});""!=$(this).siblings("input[type='text']").val()?($("ol.questions").append(n),t.val("")):$(this).siblings("input[type='text']").focus()}function invokeCorrectSubmitButton(e){13===e.keyCode&&(e.preventDefault(),console.log(),$(this).siblings('input[type="submit"]').trigger("click"))}function removeQuestionFromQuiz(){$(this).closest("li").remove()}function removeChoiceFromQuestion(e){e.preventDefault(),$(this).closest("li").remove()}function removeAssignmentTask(e){e.preventDefault(),$(this).closest("li").remove()}function show_copy_to_clipboard(e){if(is_rainbow){var t=$(e.target),i=$("<div>",{id:"copy-toolbar-container"}),n=$("<span>",{id:"copy-toolbar",text:"copy"});t.position().top;i.append(n),t.addClass("active_pre"),i.css({cursor:"pointer",position:"absolute",top:"5px",right:"5px","background-position ":" left top",padding:"0px 3px",background:" #f5f2f0",background:"rgba(224,224,224,0.2)","box-shadow":"0 2px 0 0 rgba(0,0,0,0.2)",color:"#bbb","border-radius":".5em","font-size":".8em"}),t.append(i)}}function remove_copy_to_clipboard(e){var t=$(e.target);$("#copy-toolbar-container").remove(),t.removeClass("active_pre")}function change_solution_to_rainbow(){$(".solution-content");crawlCodeBlocksAndApplyPrismHighlighting()}function show_elaborate_textarea(e){e.closest(".survey_question").find(".elaborate_survey_container").slideDown(function(){$(this).find("textarea").focus()})}function save_survey_answer(e){var t={question_id:e.parents(".survey_question").attr("data-question-id"),question_answer:e.val()};"textarea"==e[0].type&&(t={question_id:e.parents(".survey_question").attr("data-question-id"),comment:e.val()}),$.ajax({url:"/submit_chapter_survey/"+$("#survey_track_id").val()+"/"+$("#survey_chapter_id").val(),method:"POST",data:JSON.stringify(t),contentType:"application/json",success:function(){}})}function search_key_word(e,t){var i=$(".module_content"),n=new RegExp(e+"(?![^<>]*>)","gi"),r=i.html().replace(n,function(e){return'<span style="background-color: '+t+';">'+e+"</span>"});i.html(r),sessionStorage.removeItem("search")}function create_solution(e){$.post(e.attr("action"),e.serialize(),function(t){!0===t.status?($("#solutions_table").find("tbody").append(t.html),e[0].reset()):alert(t.message)},"json")}function delete_solution(e){var t=$(".current").parent();$.post("/delete_solution",{authenticity_token:AUTH_TOKEN,solution_id:e.closest("tr").attr("data-solution-id"),chapter_id:t.data("chapter-id")},function(){e.closest("tr").fadeOut(300,function(){$(this).remove()})},"json")}function showing_edit_module_title(){var e=$(this),t=null;t="MODULE TITLE"==e.siblings(".module_title").text()||"LINK TITLE"==e.siblings(".module_title").text()?"":e.siblings(".module_title").text(),e.removeClass("color_red").addClass("hidden").siblings().removeClass("color_red").siblings(".module_title").addClass("hidden").siblings(".module_title_input").removeClass("hidden").val(t).focus()}function update_module_title(e){var t=null;""==(e=$(this)).val()?e.parent().hasClass("edit_module_container")?t="MODULE TITLE":e.parent().hasClass("link_title_container")&&(t="LINK TITLE"):t=e.val(),e.addClass("hidden").siblings(".edit_module_title").removeClass("hidden").siblings(".module_title").removeClass("hidden").text(t)}function initialize_module_redactor(){$("#description").redactor({imageUpload:"/upload.php",imageManagerJson:"/images/images.json",imageResizable:!0,imagePosition:!0,toolbarFixed:!0,linkSize:1e6,fileUpload:"/upload.php",fileManagerJson:"/files/files.json",buttons:["format","bold","italic","underline","lists","image","video","file","table","link","align"],plugins:["codemirror","table","imagemanager","video","filemanager","alignment","fontcolor","custom_save"],codemirror:{lineNumbers:!0,lineWrapping:!0,theme:"monokai",indentUnit:4},callbacks:{change:function(){$(".preview_module_btn").attr("disabled","disabled")},blur:function(){if(!1===$(".active_pre").hasClass("rainbow"))$(".active_pre").find("span:not(.from-rainbow)").contents().unwrap();else{var e=$(".active_pre").find(".from-rainbow");$(".active_pre").removeClass("rainbow"),e.length&&e.contents().unwrap()}Rainbow.addClass("from-rainbow"),Rainbow.color()},focus:function(){$(".preview_module_btn").attr("disabled",!0)},init:function(){$("#description").addClass("redactor-styles")},visual:function(){$("pre.rainbow").each(function(){var e=$(this).find(".from-rainbow");$(this).removeClass("rainbow"),e.length&&e.contents().unwrap(),Rainbow.addClass("from-rainbow"),Rainbow.color()})},source:function(){var e=this.code.get(),t=$("<div></div>");return t.html(e),t.find("pre span").contents().unwrap(),t.html()}}})}function show_module_form(e){var t="true"==$("li .current").attr("data-first_module"),i=$("li .current").attr("data-chapter-id");if("new"!==e)var n=$(this).find("span").data("module-id");$.ajax({url:"/modules/modal",method:"POST",data:{chapter_id:i,module_id:n,is_first_module:t},success:function(e){$(".manage_module_modal").find(".modal_body").html(e.result)}})}function saving_edited_module(e){e.preventDefault();var t=$(this),i=$("li .current").attr("data-module-id"),n="true"==$("li .current").attr("data-first_module");if(t.find(".module_title_input").each(function(){""==$(this).val()?$(this).siblings().addClass("color_red"):$(this).siblings().removeClass("color_red")}),t.find(".program_type_checkbox:checked").length>=1?t.find(".program_type_checkbox").siblings(".checkbox_marker").removeClass("border_red").siblings(".checkbox_label").removeClass("color_red"):t.find(".program_type_checkbox").siblings(".checkbox_marker").addClass("border_red").siblings(".checkbox_label").addClass("color_red"),0!=t.find(".color_red").length||0!=t.find(".border_red").length)return!1;var r=$(".tab_list .current"),o=t.find("input[name='module_options']:checked").attr("data-option-value"),s=t.find(".edit_module_container h4").text(),a=t.find(".link_title_container h5").text(),l=(i=$('input[name="module_id"]').val(),[]),c=$(".current").parent();t.find(".program_type_checkbox").each(function(){$(this)[0].checked&&l.push($(this).val())}),r.find(".tab_details h4").text(a),$("#description > h1:first-child").text(s),$("li.current").find(".tab_details h4").text(a),r.removeClass().addClass(o+" completed_tab current").attr("data-module-type",o),t.closest(".modal").modal("hide");var d={data:{content:$("#description").redactor("code.get"),content_title:s,title:a,program_types:l.join()},chapter_id:c.data("chapter-id")};n?(d.data.module_type=o,d.first_module=n,$(".module-info, .uploads, #assignment-solutions").remove(),$(".loading_container").removeClass("hidden"),$(".switch_horizontal_tab_view").addClass("hidden"),$(".preview_module_btn").addClass("hidden"),$(".module_title_input").val(""),$.ajax({url:"/modules/"+i,method:"PATCH",data:JSON.stringify(d),contentType:"application/json",success:function(){window.location.reload()},error:function(e){console.warn(e)}})):$.ajax({url:"/modules/"+i,method:"PATCH",data:JSON.stringify(d),contentType:"application/json",success:function(e){$("#breadcrumbs .module_title").text(e.result.data.title)},error:function(e){console.warn(e)}})}function duplicate_module(){var e=$(this),t=e.closest(".current").clone(),i="Copy - "+e.closest(".current").find(".tab_details h4").text();t.removeClass("current").find(".tab_details h4").text(i),e.closest(".horizontal_chapter_list_view").length&&$(".scroll_right_module").show();var n={module_id:e.data("module-id"),chapter_id:e.data("chapter-id"),title:i};$(".loading_container").removeClass("hidden"),$.ajax({url:"/modules/duplicate",method:"POST",data:JSON.stringify(n),contentType:"application/json",success:function(e){window.location.href=e.result.url,console.log(e)},error:function(e){console.warn(e)}})}function handleSaveModule(e){$(".preview_module_btn").attr("disabled",!1),e.preventDefault();$(".module_modal_form");var t=$(".current").parent(),i=$(".current h4"),n=$(".current:first").data("program-type"),r="/modules/content/"+$('input[name="module_id"]').val(),o=$("section.module-info").data("module-type"),s=$("textarea.open"),a={chapter_id:t.data("chapter-id"),module_type:o,title:$("#description h1").text(),link_title:i[i.length-1].textContent,description:$("#description").redactor("code.get"),program_type:n.join()};a.metadata=getModuleMetadata(a),0==s.length&&($(".re-custom_save").attr("disabled","disabled"),$(".re-custom_save").text("Saving..."),$.ajax({url:r,method:"PATCH",data:JSON.stringify(a),contentType:"application/json",success:function(){$("#alert_modal").modal("show"),$(".info_container").find(".updated_at").text("Updated just now"),$(".info_container").find(".updated_at").attr("data-original-title","Updated less than a minute ago"),$('[data-toggle="tooltip"]').tooltip(),$(".re-custom_save").removeAttr("disabled","disabled"),$(".re-custom_save").text("Save Module Changes"),$("#alert_modal").find(".failed_to_save_content").addClass("hidden"),$("#alert_modal").find(".save_successfully_content").removeClass("hidden")},error:function(){$(".re-custom_save").text("Saving Failed.."),$("#alert_modal").modal("show"),$(".re-custom_save").removeAttr("disabled","disabled"),$(".re-custom_save").text("Save Module Changes"),$("#alert_modal").find(".save_successfully_content").addClass("hidden"),$("#alert_modal").find(".failed_to_save_content").removeClass("hidden")}}))}function generateModuleType(e){switch(e){case"lesson":return 0;case"quiz":return 1;case"assignment":return 2;default:return 0}}function handleNewModuleCancel(){console.log("Logic to cancel creation...")}function init_language_settings(){if($(".module-edit").length){var e=$(this),t=$(".language_rainbow_dropup"),i=e.offset().top,n=e.offset().left;e.hasClass("active_pre")?t.removeClass("hidden"):t.removeClass("hidden open"),t.css({top:i+1,left:n+e.outerWidth()-36}),e.addClass("active_pre").siblings("pre").removeClass("active_pre"),t.children(".selected_rainbow_option").attr("class","selected_rainbow_option "+e.attr("data-language")+"_rainbow_option")}}function copy_to_clipboard(e){var t=$("<textarea>"),i=$(e.target).parents("pre").text();i=i.substring(0,i.length-4);var n=!1;$("body").append(t),t.val(i).select(),n=document.execCommand("copy"),t.remove(),n&&($("#copy-toolbar").text("copied!"),setTimeout(function(){$("#copy-toolbar").text("copy")},1500))}function manage_language_settings(e){e.preventDefault();var t=$(this),i=t.children("a").attr("data-option-language"),n=$(".active_pre");$(".selected_rainbow_option").attr("class","selected_rainbow_option "+t.children("a").attr("class")),$(".popover").popover("destroy"),$(n).removeClass(),$(n).attr("data-language",i),$(n).addClass("active_pre language-"+i),$(n).find("span:not(.from-rainbow)").contents().unwrap();var r=$(".active_pre").find(".from-rainbow");r.length&&r.contents().unwrap(),Rainbow.addClass("from-rainbow"),Rainbow.color()}function horizontal_tab_view(){var e=$(this),t=$(".horizontal_chapter_list_view");e.removeClass("switch_horizontal_tab_view").addClass("switch_vertical_tab_view"),t.html($("#chapter_list > li.active .tab_list").html()),$("#sidebar, .hidden_chapter_title, .glyphicon-menu-hamburger").fadeOut(),$(".hidden_chapter_title").css("visibility","hidden"),$(".horizontal_chapter_view_container, #full_view_chapter_title").fadeIn(),$("#full_view_chapter_title h1").text($("#chapter_list li.active .chapter-title").text()),$("#main_content").addClass("full_view"),$(".horizontal_chapter_view_container .add_new_module ").removeClass("hidden"),t.sortable({items:"li:not(.dropdown-menu li)",axis:"x",cursor:"move",stop:handleDrop,start:function(e,t){$(t.item[0]).find(".dropdown").removeClass("open").children(".dropdown-toggle").attr("aria-expanded",!1)}}),t.disableSelection();var i=0;t.children("li:lt("+t.children("li.current").index()+")").each(function(){i+=Number($(this).outerWidth())}),$(".horizontal_chapter_list_view li.current").is(":first-child")?$(".scroll_left_module").hide():$(".scroll_left_module").show(),$(".horizontal_chapter_list_view li.current").is(":last-child")?$(".scroll_right_module").hide():$(".scroll_right_module").show(),t.outerWidth()<"827"&&$(".scroll_right_module, .scroll_left_module").hide(),t.scrollLeft(i),document.cookie="course_editor_view=horizontal_view; path=/"}function vertical_tab_view(){$(this).addClass("switch_horizontal_tab_view").removeClass("switch_vertical_tab_view"),$("#chapter_list > li.active .tab_list").html($(".horizontal_chapter_list_view").html()),$("#sidebar, .hidden_chapter_title, .glyphicon-menu-hamburger").fadeIn(),$(".hidden_chapter_title").css("visibility","visible"),$(".horizontal_chapter_view_container, #full_view_chapter_title").fadeOut(),$("#main_content").removeClass("full_view"),$(".dropdown-menu").attr("style",""),document.cookie="course_editor_view=vertical_view; path=/"}function navigate_module_ui_adjustment(){var e=$(this),t=$(".horizontal_chapter_list_view"),i=t[0].scrollWidth-t[0].clientWidth;e.hasClass("scroll_right_module")?t.stop().animate({scrollLeft:"+=200"},300):t.stop().animate({scrollLeft:"-=200"},300),setTimeout(function(){e.hasClass("scroll_right_module")?(t.scrollLeft()>0&&$(".scroll_left_module").show(),t.scrollLeft()==i&&$(".scroll_right_module").hide()):(0==t.scrollLeft()&&$(".scroll_left_module").hide(),$(".scroll_right_module").show())},300)}function move_next_prev_chapter(){var e=$(this);if($("#chapter_list li.active li.current").removeClass("current"),"next"==e.attr("data-move-direction")){var t=$("#chapter_list").data("track-id"),i=$("li.active").next().find("ul.tab_list").data("chapter-id"),n=$("li.active").next().find(".chapter_title").data("chapter-module");n===undefined&&i===undefined||(window.location.href="/modules/edit/"+t+"/"+i+"/"+n)}else{var r=$("#chapter_list").data("track-id"),o=$("li.active").prev().find("ul.tab_list").data("chapter-id"),s=$("li.active").prev().find(".chapter_title").data("chapter-module");s===undefined&&o===undefined||(window.location.href="/modules/edit/"+r+"/"+o+"/"+s)}$(".nano").nanoScroller({scrollTo:$("#chapter_list").find("li.active")}),e.siblings("h1").text($("#chapter_list li.active a.chapter_title h3 span").text());var a=$(".horizontal_chapter_list_view");a.html($("#chapter_list li.active .tab_list").html()),0==a[0].scrollWidth-a[0].clientWidth?$(".scroll_left_module, .scroll_right_module").hide():$(".scroll_right_module").show()}function saving_new_module(e){var t=$(".tab_list .current, .horizontal_chapter_list_view .current").index();if(e.find(".module_title_input").each(function(){""==$(this).val()?$(this).siblings().addClass("color_red"):$(this).siblings().removeClass("color_red")}),e.find(".program_type_checkbox:checked").length>=1?e.find(".program_type_checkbox").siblings(".checkbox_marker").removeClass("border_red").siblings(".checkbox_label").removeClass("color_red"):e.find(".program_type_checkbox").siblings(".checkbox_marker").addClass("border_red").siblings(".checkbox_label").addClass("color_red"),0!=e.find(".color_red").length)return!1;$(".module-info, .uploads, #assignment-solutions").remove();var i=e.find("input[name='module_options']:checked").attr("data-option-value"),n=[];e.find(".program_type_checkbox").each(function(){$(this)[0].checked&&n.push($(this).val())}),$("#chapter_list li.active .tab_list li.completed_tab:eq("+t+"), .horizontal_chapter_list_view li.completed_tab:eq("+t+")").removeClass("current"),e.find(".btn-group .active input").trigger("click"),e.closest(".modal").modal("hide"),$(".loading_container").removeClass("hidden"),$(".switch_horizontal_tab_view").addClass("hidden"),$(".preview_module_btn").addClass("hidden"),console.log(e),$(".module_title_input").val("");var r=$(".module_modal_form").find('input[name="chapter_id"]').val(),o=$(".module_title_container"),s={chapter_id:r,program_type:n.join(),module_type:i,description:"<h1>"+o.find(".edit_module_container .module_title").text()+"</h1>",title:o.find(".edit_module_container .module_title").text(),link_title:o.find(".link_title_container .module_title").text(),metadata:!1};$.ajax({url:"/modules",method:"POST",data:JSON.stringify(s),contentType:"application/json",success:function(e){window.location.href=e.result.url,console.log(e)},error:function(e){console.warn(e)}})}function show_confirm_modal(){var e=$(".action_confirm_modal"),t=$(this).find("span").text(),i=$(this).attr("data-action");e.find(".modal_body .action_name").text(i),e.find(".modal_body .chapter_title").text(t),e.find(".modal_body .action_btn").text("copy"==i?"COPY MODULE":"MOVE MODULE").addClass("copy"==i?"confirm_copy_to_btn":"confirm_move_to_btn"),e.find(".modal_header h4").text("copy"==i?"COPY MODULE":"MOVE MODULE"),e.find('input[name="chapter_id"]').attr("data-chapter",$(this).find("span").attr("data-chapter-id"))}function process_module(e,t){$(".loading_container").removeClass("hidden");var i=e.parents(".modal-content"),n={module_id:i.find('input[name="module_id"]').attr("data-module"),chapter_id:i.find('input[name="chapter_id"]').attr("data-chapter"),track_id:i.find('input[name="track_id"]').attr("data-track"),current_chapter_id:i.find('input[name="current_chapter_id"]').attr("data-current-chapter"),process_action:t},r="copy"==t?"/modules/duplicate":"/process_module";setTimeout(function(){$.post(r,n,function(e){1==e.success?window.location.href=e.url:window.location.reload()})},800)}function remove_chapter_upload(){var e=$(this);$.post("/uploads/delete",{id:e.data().id},function(t){console.log(t),t&&e.parents("tr").remove()})}!function(e){"use strict";function t(e,i){return new t.prototype.init(e,i)}Function.prototype.bind||(Function.prototype.bind=function(e){var t=this;return function(){return t.apply(e)}});var i=0;e.fn.redactor=function(i){var n=[],r=Array.prototype.slice.call(arguments,1);return"string"==typeof i?this.each(function(){var t,o=e.data(this,"redactor");if("-1"!==i.search(/\./)?void 0!==o[(t=i.split("."))[0]]&&(t=o[t[0]][t[1]]):t=o[i],void 0!==o&&e.isFunction(t)){var s=t.apply(o,r);void 0!==s&&s!==o&&n.push(s)}else e.error('No such method "'+i+'" for Redactor')}):this.each(function(){e.data(this,"redactor",{}),e.data(this,"redactor",t(this,i))}),0===n.length?this:1===n.length?n[0]:n},e.Redactor=t,e.Redactor.VERSION="2.8.1",e.Redactor.modules=["air","autosave","block","buffer","build","button","caret","clean","code","core","detect","dropdown","events","file","focus","image","indent","inline","insert","keydown","keyup","lang","line","link","linkify","list","marker","modal","observe","offset","paragraphize","paste","placeholder","progress","selection","shortcuts","storage","toolbar","upload","uploads3","utils","browser"],e.Redactor.settings={},e.Redactor.opts={animation:!1,lang:"en",direction:"ltr",spellcheck:!0,overrideStyles:!0,scrollTarget:document,focus:!1,focusEnd:!1,clickToEdit:!1,structure:!1,tabindex:!1,minHeight:!1,maxHeight:!1,maxWidth:!1,plugins:!1,callbacks:{},placeholder:!1,linkify:!0,enterKey:!0,pastePlainText:!1,pasteImages:!0,pasteLinks:!0,pasteBlockTags:["pre","h1","h2","h3","h4","h5","h6","table","tbody","thead","tfoot","th","tr","td","ul","ol","li","blockquote","p","figure","figcaption"],pasteInlineTags:["br","strong","ins","code","del","span","samp","kbd","sup","sub","mark","var","cite","small","b","u","em","i"],preClass:!1,preSpaces:4,tabAsSpaces:!1,tabKey:!0,autosave:!1,autosaveName:!1,autosaveFields:!1,imageUpload:null,imageUploadParam:"file",imageUploadFields:!1,imageUploadForms:!1,imageTag:"figure",imageEditable:!0,imageCaption:!0,imagePosition:!1,imageResizable:!1,imageFloatMargin:"10px",dragImageUpload:!0,multipleImageUpload:!0,clipboardImageUpload:!0,fileUpload:null,fileUploadParam:"file",fileUploadFields:!1,fileUploadForms:!1,dragFileUpload:!0,s3:!1,linkNewTab:!1,linkTooltip:!0,linkNofollow:!1,linkSize:30,pasteLinkTarget:!1,videoContainerClass:"video-container",toolbar:!0,toolbarFixed:!0,toolbarFixedTarget:document,toolbarFixedTopOffset:0,toolbarExternal:!1,toolbarOverflow:!1,air:!1,airWidth:!1,formatting:["p","blockquote","pre","h1","h2","h3","h4","h5","h6"],formattingAdd:!1,buttons:["format","bold","italic","deleted","lists","image","file","link","horizontalrule"],buttonsTextLabeled:!1,buttonsHide:[],buttonsHideOnMobile:[],script:!0,removeNewlines:!1,removeComments:!0,replaceTags:{b:"strong",i:"em",strike:"del"},keepStyleAttr:[],shortcuts:{"ctrl+shift+m, meta+shift+m":{func:"inline.removeFormat"},"ctrl+b, meta+b":{func:"inline.format",params:["bold"]},"ctrl+i, meta+i":{func:"inline.format",params:["italic"]},"ctrl+h, meta+h":{func:"inline.format",params:["superscript"]},"ctrl+l, meta+l":{func:"inline.format",params:["subscript"]},"ctrl+k, meta+k":{func:"link.show"},"ctrl+shift+7":{func:"list.toggle",params:["orderedlist"]},"ctrl+shift+8":{func:"list.toggle",params:["unorderedlist"]}},shortcutsAdd:!1,activeButtons:["deleted","italic","bold"],activeButtonsStates:{b:"bold",strong:"bold",i:"italic",em:"italic",del:"deleted",strike:"deleted"},langs:{en:{format:"Format",image:"Image",file:"File",link:"Link",bold:"Bold",italic:"Italic",deleted:"Strikethrough",underline:"Underline","bold-abbr":"B","italic-abbr":"I","deleted-abbr":"S","underline-abbr":"U",lists:"Lists","link-insert":"Insert link","link-edit":"Edit link","link-in-new-tab":"Open link in new tab",unlink:"Unlink",cancel:"Cancel",close:"Close",insert:"Insert",save:"Save","delete":"Delete",text:"Text",edit:"Edit",title:"Title",paragraph:"Normal text",quote:"Quote",code:"Code",heading1:"Heading 1",heading2:"Heading 2",heading3:"Heading 3",heading4:"Heading 4",heading5:"Heading 5",heading6:"Heading 6",filename:"Name",optional:"optional",unorderedlist:"Unordered List",orderedlist:"Ordered List",outdent:"Outdent",indent:"Indent",horizontalrule:"Line","upload-label":"Drop file here or ",caption:"Caption",bulletslist:"Bullets",numberslist:"Numbers","image-position":"Position",none:"None",left:"Left",right:"Right",center:"Center","accessibility-help-label":"Rich text editor"}},type:"textarea",inline:!1,inlineTags:["a","span","strong","strike","b","u","em","i","code","del","ins","samp","kbd","sup","sub","mark","var","cite","small"],blockTags:["pre","ul","ol","li","p","h1","h2","h3","h4","h5","h6","dl","dt","dd","div","td","blockquote","output","figcaption","figure","address","section","header","footer","aside","article","iframe"],paragraphize:!0,paragraphizeBlocks:["table","div","pre","form","ul","ol","h1","h2","h3","h4","h5","h6","dl","blockquote","figcaption","address","section","header","footer","aside","article","object","style","script","iframe","select","input","textarea","button","option","map","area","math","hr","fieldset","legend","hgroup","nav","figure","details","menu","summary","p"],emptyHtml:"<p>&#x200b;</p>",invisibleSpace:"&#x200b;",emptyHtmlRendered:e("").html("\u200b").html(),imageTypes:["image/png","image/jpeg","image/gif"],userAgent:navigator.userAgent.toLowerCase(),observe:{dropdowns:[]},regexps:{linkyoutube:/https?:\/\/(?:[0-9A-Z-]+\.)?(?:youtu\.be\/|youtube\.com\S*[^\w\-\s])([\w\-]{11})(?=[^\w\-]|$)(?![?=&+%\w.\-]*(?:['"][^<>]*>|<\/a>))[?=&+%\w.-]*/gi,linkvimeo:/https?:\/\/(www\.)?vimeo.com\/(\d+)($|\/)/,linkimage:/((https?|www)[^\s]+\.)(jpe?g|png|gif)(\?[^\s-]+)?/gi,url:/(https?:\/\/(?:www\.|(?!www))[^\s\.]+\.[^\s]{2,}|www\.[^\s]+\.[^\s]{2,})/gi}},t.fn=e.Redactor.prototype={keyCode:{BACKSPACE:8,DELETE:46,UP:38,DOWN:40,ENTER:13,SPACE:32,ESC:27,TAB:9,CTRL:17,META:91,SHIFT:16,ALT:18,RIGHT:39,LEFT:37,LEFT_WIN:91},init:function(t,n){if(this.$element=e(t),this.uuid=i++,this.sBuffer=[],this.sRebuffer=[],this.loadOptions(n),this.loadModules(),this.opts.clickToEdit&&!this.$element.hasClass("redactor-click-to-edit"))return this.loadToEdit(n);this.$element.hasClass("redactor-click-to-edit")&&this.$element.removeClass("redactor-click-to-edit"),this.reIsBlock=new RegExp("^("+this.opts.blockTags.join("|").toUpperCase()+")$","i"),this.reIsInline=new RegExp("^("+this.opts.inlineTags.join("|").toUpperCase()+")$","i"),this.opts.dragImageUpload=null!==this.opts.imageUpload&&this.opts.dragImageUpload,this.opts.dragFileUpload=null!==this.opts.fileUpload&&this.opts.dragFileUpload,this.formatting={},this.lang.load(),e.extend(this.opts.shortcuts,this.opts.shortcutsAdd),this.$editor=this.$element,this.detectType(),this.core.callback("start"),this.core.callback("startToEdit"),this.start=!0,this.build.start()},detectType:function(){this.build.isInline()||this.opts.inline?this.opts.type="inline":this.build.isTag("DIV")?this.opts.type="div":this.build.isTag("PRE")&&(this.opts.type="pre")},loadToEdit:function(t){this.$element.on("click.redactor-click-to-edit",e.proxy(function(){this.initToEdit(t)},this)),this.$element.addClass("redactor-click-to-edit")},initToEdit:function(t){e.extend(t.callbacks,{startToEdit:function(){this.insert.node(this.marker.get(),!1)},initToEdit:function(){
this.selection.restore(),this.clickToCancelStorage=this.code.get(),e(this.opts.clickToCancel).off(".redactor-click-to-edit"),e(this.opts.clickToCancel).show().on("click.redactor-click-to-edit",e.proxy(function(i){i.preventDefault(),this.core.destroy(),this.events.syncFire=!1,this.$element.html(this.clickToCancelStorage),this.core.callback("cancel",this.clickToCancelStorage),this.events.syncFire=!0,this.clickToCancelStorage="",e(this.opts.clickToCancel).hide(),e(this.opts.clickToSave).hide(),this.$element.on("click.redactor-click-to-edit",e.proxy(function(){this.initToEdit(t)},this)),this.$element.addClass("redactor-click-to-edit")},this)),e(this.opts.clickToSave).off(".redactor-click-to-edit"),e(this.opts.clickToSave).show().on("click.redactor-click-to-edit",e.proxy(function(i){i.preventDefault(),this.core.destroy(),this.core.callback("save",this.code.get()),e(this.opts.clickToCancel).hide(),e(this.opts.clickToSave).hide(),this.$element.on("click.redactor-click-to-edit",e.proxy(function(){this.initToEdit(t)},this)),this.$element.addClass("redactor-click-to-edit")},this))}}),this.$element.redactor(t),this.$element.off(".redactor-click-to-edit")},loadOptions:function(t){var i={};void 0!==e.Redactor.settings.namespace?this.$element.hasClass(e.Redactor.settings.namespace)&&(i=e.Redactor.settings):i=e.Redactor.settings,this.opts=e.extend({},e.Redactor.opts,this.$element.data(),t),this.opts=e.extend({},this.opts,i)},getModuleMethods:function(e){return Object.getOwnPropertyNames(e).filter(function(t){return"function"==typeof e[t]})},loadModules:function(){for(var t=e.Redactor.modules.length,i=0;i<t;i++)this.bindModuleMethods(e.Redactor.modules[i])},bindModuleMethods:function(e){if(void 0!==this[e]){this[e]=this[e]();for(var t=this.getModuleMethods(this[e]),i=t.length,n=0;n<i;n++)this[e][t[n]]=this[e][t[n]].bind(this)}},air:function(){return{enabled:!1,collapsed:function(){this.opts.air&&this.selection.get().collapseToStart()},collapsedEnd:function(){this.opts.air&&this.selection.get().collapseToEnd()},build:function(){this.detect.isMobile()||(this.button.hideButtons(),this.button.hideButtonsOnMobile(),0!==this.opts.buttons.length&&(this.$air=this.air.createContainer(),!1!==this.opts.airWidth&&this.$air.css("width",this.opts.airWidth),this.air.append(),this.button.$toolbar=this.$air,this.button.setFormatting(),this.button.load(this.$air),this.core.editor().on("mouseup.redactor",this,e.proxy(function(e){""!==this.selection.text()&&this.air.show(e)},this))))},append:function(){this.$air.appendTo("body")},createContainer:function(){return e("<ul>").addClass("redactor-air").attr({id:"redactor-air-"+this.uuid,role:"toolbar"}).hide()},show:function(t){this.selection.saveInstant(),e(".redactor-air").hide();var i=0,n=this.$air.innerWidth();e(window).width()<t.clientX+n&&(i=200),this.$air.css({left:t.clientX-i+"px",top:t.clientY+10+e(document).scrollTop()+"px"}).show(),this.air.enabled=!0,this.air.bindHide()},bindHide:function(){e(document).on("mousedown.redactor-air."+this.uuid,e.proxy(function(t){var i=e(t.target).closest(".redactor-dropdown").length;0===e(t.target).closest(this.$air).length&&0===i&&!1!==this.air.hide(t)&&this.marker.remove()},this)).on("keydown.redactor-air."+this.uuid,e.proxy(function(t){var i=t.which;if((this.utils.isRedactorParent(t.target)||e(t.target).hasClass("redactor-in"))&&0===e(t.target).closest("#redactor-modal").length){if(i===this.keyCode.ESC)this.selection.get().collapseToStart();else if(i===this.keyCode.BACKSPACE||i===this.keyCode.DELETE){var n=this.selection.get();this.selection.range(n).deleteContents()}else i===this.keyCode.ENTER&&this.selection.get().collapseToEnd();this.air.enabled?this.air.hide(t):this.selection.get().collapseToStart()}},this))},hide:function(t){if(t.ctrlKey||t.metaKey||t.shiftKey&&t.altKey)return!1;this.button.setInactiveAll(),this.$air.fadeOut(100),this.air.enabled=!1,e(document).off("mousedown.redactor-air."+this.uuid),e(document).off("keydown.redactor-air."+this.uuid)}}},autosave:function(){return{enabled:!1,html:!1,init:function(){this.opts.autosave&&(this.autosave.enabled=!0,this.autosave.name=this.opts.autosaveName?this.opts.autosaveName:this.$textarea.attr("name"))},is:function(){return this.autosave.enabled},send:function(){if(this.opts.autosave&&(this.autosave.source=this.code.get(),this.autosave.html!==this.autosave.source)){var t={};t.name=this.autosave.name,t[this.autosave.name]=this.autosave.source,t=this.autosave.getHiddenFields(t),e.ajax({url:this.opts.autosave,type:"post",data:t}).done(this.autosave.success)}},getHiddenFields:function(t){return!1===this.opts.autosaveFields||"object"!=typeof this.opts.autosaveFields?t:(e.each(this.opts.autosaveFields,e.proxy(function(i,n){null!==n&&0===n.toString().indexOf("#")&&(n=e(n).val()),t[i]=n},this)),t)},success:function(e){var t;try{t=JSON.parse(e)}catch(i){t=e}var i=void 0===t.error?"autosave":"autosaveError";this.core.callback(i,this.autosave.name,t),this.autosave.html=this.autosave.source},disable:function(){this.autosave.enabled=!1,clearInterval(this.autosaveTimeout)}}},block:function(){return{format:function(t,i,n,r){if(t="quote"===t?"blockquote":t,this.block.tags=["p","blockquote","pre","h1","h2","h3","h4","h5","h6","div","figure"],-1!==e.inArray(t,this.block.tags))return"p"===t&&void 0===i&&(i="class"),this.placeholder.hide(),this.buffer.set(),this.utils.isCollapsed()?this.block.formatCollapsed(t,i,n,r):this.block.formatUncollapsed(t,i,n,r)},formatCollapsed:function(t,i,n,r){this.selection.save();var o=this.selection.block(),s=o.tagName.toLowerCase();if(-1!==e.inArray(s,this.block.tags)){var a,l=!1;if(s===t&&void 0===i&&(t="p",l=!0),l&&(this.block.removeAllClass(),this.block.removeAllAttr()),"blockquote"===s&&this.utils.isEndOfElement(o)){this.marker.remove(),(a=document.createElement("p")).innerHTML=this.opts.invisibleSpace,e(o).after(a),this.caret.start(a);var c=e(o).children().last();0!==c.length&&"BR"===c[0].tagName&&c.remove()}else a=this.utils.replaceToTag(o,t);if("object"==typeof i)for(var d in r=n,i)a=this.block.setAttr(a,d,i[d],r);else a=this.block.setAttr(a,i,n,r);return"pre"===t&&1===a.length&&e(a).html(e.trim(e(a).html())),this.selection.restore(),this.block.removeInlineTags(a),a}this.selection.restore()},formatUncollapsed:function(t,i,n,r){this.selection.save();var o=[],s=this.selection.blocks();s[0]&&(e(s[0]).hasClass("redactor-in")||e(s[0]).hasClass("redactor-box"))&&(s=this.core.editor().find(this.opts.blockTags.join(", ")));for(var a=s.length,l=0;l<a;l++){var c=s[l].tagName.toLowerCase();if(-1!==e.inArray(c,this.block.tags)&&"figure"!==c){var d=this.utils.replaceToTag(s[l],t);if("object"==typeof i)for(var u in r=n,i)d=this.block.setAttr(d,u,i[u],r);else d=this.block.setAttr(d,i,n,r);o.push(d),this.block.removeInlineTags(d)}}if(this.selection.restore(),"pre"===t&&0!==o.length){var h=o[0];e.each(o,function(t,i){0!==t&&(e(h).append("\n"+e.trim(i.html())),e(i).remove())}),(o=[]).push(h)}return o},removeInlineTags:function(t){t=t[0]||t;var i=this.opts.inlineTags,n=["PRE","H1","H2","H3","H4","H5","H6"];if(-1!==e.inArray(t.tagName,n)){if("PRE"!==t.tagName){var r=i.indexOf("a");i.splice(r,1)}e(t).find(i.join(",")).not(".redactor-selection-marker").contents().unwrap()}},setAttr:function(e,t,i,n){if(void 0===t)return e;var r=void 0===n?"replace":n;return"class"===t?this.block[r+"Class"](i,e):"remove"===r?this.block[r+"Attr"](t,e):"removeAll"===r?this.block[r+"Attr"](t,e):this.block[r+"Attr"](t,i,e)},getBlocks:function(t){if(t=void 0===t?this.selection.blocks():t,e(t).hasClass("redactor-box")){var i=[],n=this.core.editor().children();return e.each(n,e.proxy(function(e,t){this.utils.isBlock(t)&&i.push(t)},this)),i}return t},replaceClass:function(t,i){return e(this.block.getBlocks(i)).removeAttr("class").addClass(t)[0]},toggleClass:function(t,i){return e(this.block.getBlocks(i)).toggleClass(t)[0]},addClass:function(t,i){return e(this.block.getBlocks(i)).addClass(t)[0]},removeClass:function(t,i){return e(this.block.getBlocks(i)).removeClass(t)[0]},removeAllClass:function(t){return e(this.block.getBlocks(t)).removeAttr("class")[0]},replaceAttr:function(t,i,n){return n=this.block.removeAttr(t,n),e(n).attr(t,i)[0]},toggleAttr:function(t,i,n){n=this.block.getBlocks(n);var r=this,o=[];return e.each(n,function(n,s){e(s).attr(t)?o.push(r.block.removeAttr(t,s)):o.push(r.block.addAttr(t,i,s))}),o},addAttr:function(t,i,n){return e(this.block.getBlocks(n)).attr(t,i)[0]},removeAttr:function(t,i){return e(this.block.getBlocks(i)).removeAttr(t)[0]},removeAllAttr:function(t){t=this.block.getBlocks(t);var i=[];return e.each(t,function(t,n){void 0===n.attributes&&i.push(n);for(var r=e(n),o=n.attributes.length,s=0;s<o;s++)r.removeAttr(n.attributes[s].name);i.push(r[0])}),i}}},buffer:function(){return{set:function(e){void 0===e&&this.buffer.clear(),void 0===e||"undo"===e?this.buffer.setUndo():this.buffer.setRedo()},setUndo:function(){var e=this.selection.saveInstant(),t=this.sBuffer[this.sBuffer.length-1],i=this.core.editor().html();(void 0===t||t[0]!==i)&&this.sBuffer.push([i,e])},setRedo:function(){var e=this.selection.saveInstant();this.sRebuffer.push([this.core.editor().html(),e])},add:function(){this.sBuffer.push([this.core.editor().html(),0])},undo:function(){if(0!==this.sBuffer.length){var e=this.sBuffer.pop();this.buffer.set("redo"),this.core.editor().html(e[0]),this.selection.restoreInstant(e[1]),this.observe.load()}},redo:function(){if(0!==this.sRebuffer.length){var e=this.sRebuffer.pop();this.buffer.set("undo"),this.core.editor().html(e[0]),this.selection.restoreInstant(e[1]),this.observe.load()}},clear:function(){this.sRebuffer=[]}}},build:function(){return{start:function(){"inline"===this.opts.type?this.opts.type="inline":"div"===this.opts.type?""===e.trim(this.$editor.html())&&this.$editor.html(this.opts.emptyHtml):"textarea"===this.opts.type&&this.build.startTextarea(),this.build.setIn(),this.build.setId(),this.build.enableEditor(),this.build.setOptions(),this.build.callEditor()},createContainerBox:function(){this.$box=e('<div class="redactor-box" role="application" />')},setIn:function(){this.core.editor().addClass("redactor-in")},setId:function(){var e="textarea"===this.opts.type?"redactor-uuid-"+this.uuid:this.$element.attr("id");this.core.editor().attr("id",void 0===e?"redactor-uuid-"+this.uuid:e)},getName:function(){var e=this.$element.attr("name");return void 0===e?"content-"+this.uuid:e},loadFromTextarea:function(){this.$editor=e("<div />"),this.$textarea=this.$element,this.$element.attr("name",this.build.getName()),this.$box.insertAfter(this.$element).append(this.$editor).append(this.$element),this.$editor.addClass("redactor-layer"),this.opts.overrideStyles&&this.$editor.addClass("redactor-styles"),this.$element.hide(),this.$box.prepend('<span class="redactor-voice-label" id="redactor-voice-'+this.uuid+'" aria-hidden="false">'+this.lang.get("accessibility-help-label")+"</span>"),this.$editor.attr({"aria-labelledby":"redactor-voice-"+this.uuid,role:"presentation"})},startTextarea:function(){this.build.createContainerBox(),this.build.loadFromTextarea(),this.code.start(this.core.textarea().val()),this.core.textarea().val(this.clean.onSync(this.$editor.html()))},isTag:function(e){return this.$element[0].tagName===e},isInline:function(){return!this.build.isTag("TEXTAREA")&&!this.build.isTag("DIV")&&!this.build.isTag("PRE")},enableEditor:function(){this.core.editor().attr({contenteditable:!0})},setOptions:function(){"inline"===this.opts.type&&(this.opts.enterKey=!1),"inline"!==this.opts.type&&"pre"!==this.opts.type||(this.opts.toolbarMobile=!1,this.opts.toolbar=!1,this.opts.air=!1,this.opts.linkify=!1),this.core.editor().attr("spellcheck",this.opts.spellcheck),this.opts.structure&&this.core.editor().addClass("redactor-structure"),"textarea"===this.opts.type&&(this.core.box().attr("dir",this.opts.direction),this.core.editor().attr("dir",this.opts.direction),this.opts.tabindex&&this.core.editor().attr("tabindex",this.opts.tabindex),this.opts.minHeight?this.core.editor().css("min-height",this.opts.minHeight):this.core.editor().css("min-height","40px"),this.opts.maxHeight&&this.core.editor().css("max-height",this.opts.maxHeight),this.opts.maxWidth&&this.core.editor().css({"max-width":this.opts.maxWidth,margin:"auto"}))},callEditor:function(){this.build.disableBrowsersEditing(),this.events.init(),this.build.setHelpers(),(this.opts.toolbar||this.opts.air)&&(this.toolbarsButtons=this.button.init()),this.opts.air?this.air.build():this.opts.toolbar&&this.toolbar.build(),this.detect.isMobile()&&this.opts.toolbarMobile&&this.opts.air&&(this.opts.toolbar=!0,this.toolbar.build()),(this.opts.air||this.opts.toolbar)&&(this.core.editor().on("mouseup.redactor-observe."+this.uuid+" keyup.redactor-observe."+this.uuid+" focus.redactor-observe."+this.uuid+" touchstart.redactor-observe."+this.uuid,e.proxy(this.observe.toolbar,this)),this.core.element().on("blur.callback.redactor",e.proxy(function(){this.button.setInactiveAll()},this))),this.modal.templates(),this.build.plugins(),this.autosave.init(),this.code.html=this.code.cleaned(this.core.editor().html()),this.core.callback("init"),this.core.callback("initToEdit"),this.storage.observe(),this.start=!1},setHelpers:function(){this.opts.linkify&&this.linkify.format(),this.placeholder.init(),this.opts.focus?setTimeout(this.focus.start,100):this.opts.focusEnd&&setTimeout(this.focus.end,100)},disableBrowsersEditing:function(){try{document.execCommand("enableObjectResizing",!1,!1),document.execCommand("enableInlineTableEditing",!1,!1),document.execCommand("AutoUrlDetect",!1,!1)}catch(e){}},plugins:function(){this.opts.plugins&&e.each(this.opts.plugins,e.proxy(function(i,n){var r="undefined"!=typeof RedactorPlugins&&void 0!==RedactorPlugins[n]?RedactorPlugins:t.fn;if(e.isFunction(r[n])){this[n]=r[n]();for(var o=this.getModuleMethods(this[n]),s=o.length,a=0;a<s;a++)this[n][o[a]]=this[n][o[a]].bind(this);if(void 0!==this[n].langs){var l={};void 0!==this[n].langs[this.opts.lang]?l=this[n].langs[this.opts.lang]:void 0===this[n].langs[this.opts.lang]&&void 0!==this[n].langs.en&&(l=this[n].langs.en);var c=this;e.each(l,function(e,t){void 0===c.opts.curLang[e]&&(c.opts.curLang[e]=t)})}e.isFunction(this[n].init)&&this[n].init()}},this))}}},button:function(){return{toolbar:function(){return void 0!==this.button.$toolbar&&this.button.$toolbar?this.button.$toolbar:this.$toolbar},init:function(){return{format:{title:this.lang.get("format"),icon:!0,dropdown:{p:{title:this.lang.get("paragraph"),func:"block.format"},blockquote:{title:this.lang.get("quote"),func:"block.format"},pre:{title:this.lang.get("code"),func:"block.format"},h1:{title:this.lang.get("heading1"),func:"block.format"},h2:{title:this.lang.get("heading2"),func:"block.format"},h3:{title:this.lang.get("heading3"),func:"block.format"},h4:{title:this.lang.get("heading4"),func:"block.format"},h5:{title:this.lang.get("heading5"),func:"block.format"},h6:{title:this.lang.get("heading6"),func:"block.format"}}},bold:{title:this.lang.get("bold-abbr"),icon:!0,label:this.lang.get("bold"),func:"inline.format"},italic:{title:this.lang.get("italic-abbr"),icon:!0,label:this.lang.get("italic"),func:"inline.format"},deleted:{title:this.lang.get("deleted-abbr"),icon:!0,label:this.lang.get("deleted"),func:"inline.format"},underline:{title:this.lang.get("underline-abbr"),icon:!0,label:this.lang.get("underline"),func:"inline.format"},lists:{title:this.lang.get("lists"),icon:!0,dropdown:{unorderedlist:{title:"&bull; "+this.lang.get("unorderedlist"),func:"list.toggle"},orderedlist:{title:"1. "+this.lang.get("orderedlist"),func:"list.toggle"},outdent:{title:"< "+this.lang.get("outdent"),func:"indent.decrease",observe:{element:"li",out:{attr:{"class":"redactor-dropdown-link-inactive","aria-disabled":!0}}}},indent:{title:"> "+this.lang.get("indent"),func:"indent.increase",observe:{element:"li",out:{attr:{"class":"redactor-dropdown-link-inactive","aria-disabled":!0}}}}}},ul:{title:"&bull; "+this.lang.get("bulletslist"),icon:!0,func:"list.toggle"},ol:{title:"1. "+this.lang.get("numberslist"),icon:!0,func:"list.toggle"},outdent:{title:this.lang.get("outdent"),icon:!0,func:"indent.decrease"},indent:{title:this.lang.get("indent"),icon:!0,func:"indent.increase"},image:{title:this.lang.get("image"),icon:!0,func:"image.show"},file:{title:this.lang.get("file"),icon:!0,func:"file.show"},link:{title:this.lang.get("link"),icon:!0,dropdown:{link:{title:this.lang.get("link-insert"),func:"link.show",observe:{element:"a","in":{title:this.lang.get("link-edit")},out:{title:this.lang.get("link-insert")}}},unlink:{title:this.lang.get("unlink"),func:"link.unlink",observe:{element:"a",out:{attr:{"class":"redactor-dropdown-link-inactive","aria-disabled":!0}}}}}},horizontalrule:{title:this.lang.get("horizontalrule"),icon:!0,func:"line.insert"}}},setFormatting:function(){e.each(this.toolbarsButtons.format.dropdown,e.proxy(function(t){-1===e.inArray(t,this.opts.formatting)&&delete this.toolbarsButtons.format.dropdown[t]},this))},hideButtons:function(){0!==this.opts.buttonsHide.length&&this.button.hideButtonsSlicer(this.opts.buttonsHide)},hideButtonsOnMobile:function(){this.detect.isMobile()&&0!==this.opts.buttonsHideOnMobile.length&&this.button.hideButtonsSlicer(this.opts.buttonsHideOnMobile)},hideButtonsSlicer:function(t){e.each(t,e.proxy(function(e,t){var i=this.opts.buttons.indexOf(t);-1!==i&&this.opts.buttons.splice(i,1)},this))},load:function(t){this.button.buttons=[],e.each(this.opts.buttons,e.proxy(function(i,n){!this.toolbarsButtons[n]||"file"===n&&!this.file.is()||"image"===n&&!this.image.is()||t.append(e("<li>").append(this.button.build(n,this.toolbarsButtons[n])))},this))},buildButtonTooltip:function(t,i){if(!this.opts.air&&!this.detect.isMobile()){var n=e("<span>");n.addClass("re-button-tooltip"),n.html(i),t.append(n),t.on("mouseover",function(){e(this).hasClass("redactor-button-disabled")||(n.show(),n.css("margin-left",-n.innerWidth()/2))}).on("mouseout",function(){n.hide()})}},build:function(t,i){if(!1!==this.opts.toolbar){var n=void 0!==i.label?i.label:i.title,r=e('<a href="javascript:void(null);" alt="'+n+'" rel="'+t+'" />');if(r.addClass("re-button re-"+t),r.attr({role:"button","aria-label":n,tabindex:"-1"}),void 0===i.icon||this.opts.buttonsTextLabeled)r.html(i.title);else{var o=e("<i>");o.addClass("re-icon-"+t),r.append(o),r.addClass("re-button-icon"),this.button.buildButtonTooltip(r,n)}if((i.func||i.command||i.dropdown)&&this.button.setEvent(r,t,i),i.dropdown){r.addClass("redactor-toolbar-link-dropdown").attr("aria-haspopup",!0);var s=e('<ul class="redactor-dropdown redactor-dropdown-'+this.uuid+" redactor-dropdown-box-"+t+'" style="display: none;">');r.data("dropdown",s),this.dropdown.build(t,s,i.dropdown)}return this.button.buttons.push(r),r}},getButtons:function(){return this.button.toolbar().find("a.re-button")},getButtonsKeys:function(){return this.button.buttons},setEvent:function(t,i,n){t.on("mousedown",e.proxy(function(e){if(e.preventDefault(),t.hasClass("redactor-button-disabled"))return!1;var r="func",o=n.func;return n.command?(r="command",o=n.command):n.dropdown&&(r="dropdown",o=!1),this.button.toggle(e,i,r,o),!1},this))},toggle:function(e,t,i,n,r){!this.detect.isIe()&&this.detect.isDesktop()||(this.utils.freezeScroll(),e.returnValue=!1),"command"===i?this.inline.format(n):"dropdown"===i?this.dropdown.show(e,t):this.button.clickCallback(e,n,t,r),"dropdown"!==i&&this.dropdown.hideAll(!1),this.opts.air&&"dropdown"!==i&&this.air.hide(e),!this.detect.isIe()&&this.detect.isDesktop()||this.utils.unfreezeScroll()},clickCallback:function(t,i,n,r){var o;if(r=void 0===r?n:r,e.isFunction(i))i.call(this,n);else if("-1"!==i.search(/\./)){if(void 0===this[(o=i.split("."))[0]])return;"object"==typeof r?this[o[0]][o[1]].apply(this,r):this[o[0]][o[1]].call(this,r)}else"object"==typeof r?this[i].apply(this,r):this[i].call(this,r);this.observe.buttons(t,n)},all:function(){return this.button.buttons},get:function(e){if(!1!==this.opts.toolbar)return this.button.toolbar().find("a.re-"+e)},set:function(e,t){if(!1!==this.opts.toolbar){var i=this.button.toolbar().find("a.re-"+e);return i.html(t).attr("aria-label",t),i}},add:function(t,i){if(!0!==this.button.isAdded(t))return e();var n=this.button.build(t,{title:i});return this.button.toolbar().append(e("<li>").append(n)),n},addFirst:function(t,i){if(!0!==this.button.isAdded(t))return e();var n=this.button.build(t,{title:i});return this.button.toolbar().prepend(e("<li>").append(n)),n},addAfter:function(t,i,n){if(!0!==this.button.isAdded(i))return e();var r=this.button.build(i,{title:n}),o=this.button.get(t);return 0!==o.length?o.parent().after(e("<li>").append(r)):this.button.toolbar().append(e("<li>").append(r)),r},addBefore:function(t,i,n){if(!0!==this.button.isAdded(i))return e();var r=this.button.build(i,{title:n}),o=this.button.get(t);return 0!==o.length?o.parent().before(e("<li>").append(r)):this.button.toolbar().append(e("<li>").append(r)),r},isAdded:function(e){var t=this.opts.buttonsHideOnMobile.indexOf(e);return!(!1===this.opts.toolbar||-1!==t&&this.detect.isMobile())},setIcon:function(e,t){this.opts.buttonsTextLabeled||(e.html(t).addClass("re-button-icon"),this.button.buildButtonTooltip(e,e.attr("alt")))},changeIcon:function(e,t){var i=this.button.get(e);0!==i.length&&i.find("i").removeAttr("class").addClass("re-icon-"+t)},addCallback:function(t,i){if(void 0!==t&&!1!==this.opts.toolbar){var n="dropdown"===i?"dropdown":"func",r=t.attr("rel");t.on("mousedown",e.proxy(function(e){if(t.hasClass("redactor-button-disabled"))return!1;this.button.toggle(e,r,n,i)},this))}},addDropdown:function(t,i){if(!1!==this.opts.toolbar){t.addClass("redactor-toolbar-link-dropdown").attr("aria-haspopup",!0);var n=t.attr("rel");this.button.addCallback(t,"dropdown");var r=e('<div class="redactor-dropdown redactor-dropdown-'+this.uuid+" redactor-dropdown-box-"+n+'" style="display: none;">');return t.data("dropdown",r),i&&this.dropdown.build(n,r,i),r}},setActive:function(e){this.button.get(e).addClass("redactor-act")},setInactive:function(e){this.button.get(e).removeClass("redactor-act")},setInactiveAll:function(e){var t=this.button.toolbar().find("a.re-button");void 0!==e&&(t=t.not(".re-"+e)),t.removeClass("redactor-act")},disable:function(e){this.button.get(e).addClass("redactor-button-disabled")},enable:function(e){this.button.get(e).removeClass("redactor-button-disabled")},disableAll:function(e){var t=this.button.toolbar().find("a.re-button");void 0!==e&&(t=t.not(".re-"+e)),t.addClass("redactor-button-disabled")},enableAll:function(){this.button.toolbar().find("a.re-button").removeClass("redactor-button-disabled")},remove:function(e){this.button.get(e).remove()}}},caret:function(){return{set:function(e,t,i){var n=this.core.editor().scrollTop();this.core.editor().focus(),this.core.editor().scrollTop(n),i=void 0===i?0:1,e=e[0]||e,t=t[0]||t;var r=this.selection.get(),o=this.selection.range(r);try{o.setStart(e,0),o.setEnd(t,i)}catch(e){}this.selection.update(r,o)},prepare:function(e){return this.detect.isFirefox()&&void 0!==this.start&&this.core.editor().focus(),e[0]||e},start:function(t){var i,n;if(t=this.caret.prepare(t)){if("BR"===t.tagName)return this.caret.before(t);var r=e(t).children().first(),o=this.utils.isInlineTag(t.tagName);""===t.innerHTML||o?this.caret.setStartEmptyOrInline(t,o):r&&0!==r.length&&this.utils.isInlineTag(r[0].tagName)&&""===r.text()?this.caret.setStartEmptyOrInline(r[0],!0):((i=window.getSelection()).removeAllRanges(),(n=document.createRange()).selectNodeContents(t),n.collapse(!0),i.addRange(n))}},setStartEmptyOrInline:function(t,i){var n=window.getSelection(),r=document.createRange(),o=document.createTextNode("\u200b");r.setStart(t,0),r.insertNode(o),r.setStartAfter(o),r.collapse(!0),n.removeAllRanges(),n.addRange(r),i||this.core.editor().on("keydown.redactor-remove-textnode",function(){e(o).remove(),e(this).off("keydown.redactor-remove-textnode")})},end:function(t){var i,n;if(t=this.caret.prepare(t)){if("BR"!==t.tagName&&""===t.innerHTML)return this.caret.start(t);if("BR"===t.tagName){var r=document.createElement("span");return r.className="redactor-invisible-space",r.innerHTML="&#x200b;",e(t).after(r),(i=window.getSelection()).removeAllRanges(),(n=document.createRange()).setStartBefore(r),n.setEndBefore(r),i.addRange(n),void e(r).replaceWith(function(){return e(this).contents()})}if(t.lastChild&&1===t.lastChild.nodeType)return this.caret.after(t.lastChild);if((i=window.getSelection()).getRangeAt||i.rangeCount)try{(n=i.getRangeAt(0)).selectNodeContents(t),n.collapse(!1),i.removeAllRanges(),i.addRange(n)}catch(e){}}},after:function(t){var i,n;if(t=this.caret.prepare(t)){if("BR"===t.tagName)return this.caret.end(t);if(this.utils.isBlockTag(t.tagName)){var r=this.caret.next(t);void 0===r?this.caret.end(t):("TABLE"===r.tagName?r=e(r).find("th, td").first()[0]:"UL"!==r.tagName&&"OL"!==r.tagName||(r=e(r).find("li").first()[0]),this.caret.start(r))}else{var o=document.createTextNode("\u200b");(i=window.getSelection()).removeAllRanges(),(n=document.createRange()).setStartAfter(t),n.insertNode(o),n.setStartAfter(o),n.collapse(!0),i.addRange(n)}}},before:function(t){var i,n;if(t=this.caret.prepare(t))if(this.utils.isBlockTag(t.tagName)){var r=this.caret.prev(t);void 0===r?this.caret.start(t):("TABLE"===r.tagName?r=e(r).find("th, td").last()[0]:"UL"!==r.tagName&&"OL"!==r.tagName||(r=e(r).find("li").last()[0]),this.caret.end(r))}else(i=window.getSelection()).removeAllRanges(),(n=document.createRange()).setStartBefore(t),n.collapse(!0),i.addRange(n)},next:function(t){var i=e(t).next();return i.hasClass("redactor-script-tag, redactor-selection-marker")?i.next()[0]:i[0]},prev:function(t){var i=e(t).prev();return i.hasClass("redactor-script-tag, redactor-selection-marker")?i.prev()[0]:i[0]},offset:function(e){return this.offset.get(e)}}},clean:function(){return{onSet:function(t){t=this.clean.savePreCode(t),t=this.clean.saveFormTags(t),this.opts.script&&(t=t.replace(/<script(.*?[^>]?)>([\w\W]*?)<\/script>/gi,'<pre class="redactor-script-tag" $1>$2</pre>')),t=(t=(t=(t=(t=t.replace(/\$/g,"&#36;")).replace(/&amp;/g,"&")).replace(/<a href="(.*?[^>]?)\xae(.*?[^>]?)">/gi,'<a href="$1&reg$2">')).replace(/<span id="selection-marker-1"(.*?[^>]?)>\u200b<\/span>/gi,"###marker1###")).replace(/<span id="selection-marker-2"(.*?[^>]?)>\u200b<\/span>/gi,"###marker2###");var i=this,n=e("<div/>").html(e.parseHTML(t,document,!0)),r=this.opts.replaceTags;if(r){var o=Object.keys(this.opts.replaceTags);n.find(o.join(",")).each(function(e,t){i.utils.replaceToTag(t,r[t.tagName.toLowerCase()])})}n.find("span, a").attr("data-redactor-span",!0),n.find(this.opts.inlineTags.join(",")).each(function(){var t=e(this);t.attr("style")&&t.attr("data-redactor-style-cache",t.attr("style"))}),t=n.html();var s=["font","html","head","link","body","meta","applet"];return this.opts.script||s.push("script"),t=this.clean.stripTags(t,s),this.opts.removeComments&&(t=t.replace(/<!--[\s\S]*?-->/gi,"")),-1!==(t=(t=(t=this.paragraphize.load(t)).replace("###marker1###",'<span id="selection-marker-1" class="redactor-selection-marker">\u200b</span>')).replace("###marker2###",'<span id="selection-marker-2" class="redactor-selection-marker">\u200b</span>')).search(/^(||\s||<br\s?\/?>||&nbsp;)$/i)?this.opts.emptyHtml:t},onGet:function(e){return this.clean.onSync(e)},onSync:function(t){if(-1!==(t=(t=t.replace(/\u200B/g,"")).replace(/&#x200b;/gi,"")).search(/^<p>(||\s||<br\s?\/?>||&nbsp;)<\/p>$/i))return"";t=(t=(t=(t=t.replace(/<span(.*?)id="redactor-image-box"(.*?[^>])>([\w\W]*?)<img(.*?)><\/span>/gi,"$3<img$4>")).replace(/<span(.*?)id="redactor-image-resizer"(.*?[^>])>(.*?)<\/span>/gi,"")).replace(/<span(.*?)id="redactor-image-editter"(.*?[^>])>(.*?)<\/span>/gi,"")).replace(/<img(.*?)style="(.*?)opacity: 0\.5;(.*?)"(.*?)>/gi,'<img$1style="$2$3"$4>');var i=e("<div/>").html(e.parseHTML(t,document,!0));i.find('*[style=""]').removeAttr("style"),i.find('*[class=""]').removeAttr("class"),i.find('*[rel=""]').removeAttr("rel"),i.find('*[data-image=""]').removeAttr("data-image"),i.find('*[alt=""]').removeAttr("alt"),i.find('*[title=""]').removeAttr("title"),i.find("*[data-redactor-style-cache]").removeAttr("data-redactor-style-cache"),i.find(".redactor-invisible-space, .redactor-unlink").each(function(){e(this).contents().unwrap()}),i.find("span, a").removeAttr("data-redactor-span data-redactor-style-cache").each(function(){0===this.attributes.length&&e(this).contents().unwrap()}),i.find("img").removeAttr("rel"),i.find(".redactor-selection-marker, #redactor-insert-marker").remove(),t=i.html(),this.opts.script&&(t=t.replace(/<pre class="redactor-script-tag"(.*?[^>]?)>([\w\W]*?)<\/pre>/gi,"<script$1>$2</script>")),t=(t=(t=(t=(t=this.clean.restoreFormTags(t)).replace(new RegExp("<br\\s?/?></h","gi"),"</h")).replace(new RegExp("<br\\s?/?></li>","gi"),"</li>")).replace(new RegExp("</li><br\\s?/?>","gi"),"</li>")).replace(/<pre>/gi,"<pre>\n"),this.opts.preClass&&(t=t.replace(/<pre>/gi,'<pre class="'+this.opts.preClass+'">')),this.opts.linkNofollow&&(t=(t=t.replace(/<a(.*?)rel="nofollow"(.*?[^>])>/gi,"<a$1$2>")).replace(/<a(.*?[^>])>/gi,'<a$1 rel="nofollow">'));var n={"\u2122":"&trade;","\xa9":"&copy;","\u2026":"&hellip;","\u2014":"&mdash;","\u2010":"&dash;"};return e.each(n,function(e,i){t=t.replace(new RegExp(e,"g"),i)}),t=(t=t.replace(/&amp;/g,"&")).replace(/\n{2,}/g,"\n"),this.opts.removeNewlines&&(t=t.replace(/\r?\n/g,"")),t},onPaste:function(t,i,n){return!0!==n&&(t=(t=(t=(t=(t=(t=(t=(t=(t=t.replace(/<b\sid="internal-source-marker(.*?)">([\w\W]*?)<\/b>/gi,"$2")).replace(/<b(.*?)id="docs-internal-guid(.*?)">([\w\W]*?)<\/b>/gi,"$3")).replace(/<span[^>]*(font-style: italic; font-weight: bold|font-weight: bold; font-style: italic)[^>]*>([\w\W]*?)<\/span>/gi,"<b><i>$2</i></b>")).replace(/<span[^>]*(font-style: italic; font-weight: 700|font-weight: 700; font-style: italic)[^>]*>([\w\W]*?)<\/span>/gi,"<b><i>$2</i></b>")).replace(/<span[^>]*font-style: italic[^>]*>([\w\W]*?)<\/span>/gi,"<i>$1</i>")).replace(/<span[^>]*font-weight: bold[^>]*>([\w\W]*?)<\/span>/gi,"<b>$1</b>")).replace(/<span[^>]*font-weight: 700[^>]*>([\w\W]*?)<\/span>/gi,"<b>$1</b>")).replace(/<o:p[^>]*>/gi,"")).replace(/<\/o:p>/gi,""),this.clean.isHtmlMsWord(t)&&(t=this.clean.cleanMsWord(t))),t=e.trim(t),i.pre?this.opts.preSpaces&&(t=t.replace(/\t/g,new Array(this.opts.preSpaces+1).join(" "))):(t=this.clean.replaceBrToNl(t),t=this.clean.removeTagsInsidePre(t)),!0!==n&&(t=this.clean.removeEmptyInlineTags(t),!1===i.encode&&(t=t.replace(/&/g,"&amp;"),t=this.clean.convertTags(t,i),t=this.clean.getPlainText(t),t=this.clean.reconvertTags(t,i))),i.text&&(t=this.clean.replaceNbspToSpaces(t),t=this.clean.getPlainText(t)),i.lists&&(t=t.replace("\n","<br>")),i.encode&&(t=this.clean.encodeHtml(t)),i.paragraphize&&(t=(t=t.replace(/ \n/g," ")).replace(/\n /g," "),t=(t=this.paragraphize.load(t)).replace(/<p><\/p>/g,"")),(t=t.replace(/<li><p>/g,"<li>")).replace(/<\/p><\/li>/g,"</li>")},getCurrentType:function(e,t){var i=this.selection.blocks(),n={text:!1,encode:!1,paragraphize:!0,line:this.clean.isHtmlLine(e),blocks:this.clean.isHtmlBlocked(e),pre:!1,lists:!1,block:!0,inline:!0,links:!0,images:!0};return 1===i.length&&this.utils.isCurrentOrParent(["h1","h2","h3","h4","h5","h6","a","figcaption"])?(n.text=!0,n.paragraphize=!1,n.inline=!1,n.images=!1,n.links=!1,n.line=!0):"inline"===this.opts.type||!1===this.opts.enterKey?(n.paragraphize=!1,n.block=!1,n.line=!0):1===i.length&&this.utils.isCurrentOrParent(["li"])?(n.lists=!0,n.block=!1,n.paragraphize=!1,n.images=!1):1===i.length&&this.utils.isCurrentOrParent(["th","td","blockquote"])?(n.block=!1,n.paragraphize=!1):("pre"===this.opts.type||1===i.length&&this.utils.isCurrentOrParent("pre"))&&(n.inline=!1,n.block=!1,n.encode=!0,n.pre=!0,n.paragraphize=!1,n.images=!1,n.links=!1),!0===n.line&&(n.paragraphize=!1),!0===t&&(n.text=!1),n},isHtmlBlocked:function(e){var t=e.match(new RegExp("</("+this.opts.blockTags.join("|").toUpperCase()+")>","gi")),i=e.match(new RegExp("<hr(.*?[^>])>","gi"));return null!==t||null!==i},isHtmlLine:function(e){if(this.clean.isHtmlBlocked(e))return!1;var t=e.match(/<br\s?\/?>/gi),i=e.match(/\n/gi);return!t&&!i},isHtmlMsWord:function(e){return e.match(/class="?Mso|style="[^"]*\bmso-|style='[^'']*\bmso-|w:WordDocument/i)},removeEmptyInlineTags:function(t){var i=this.opts.inlineTags,n=e("<div/>").html(e.parseHTML(t,document,!0)),r=this,o=n.find("span"),s=n.find(i.join(","));return s.removeAttr("style"),s.each(function(){var t=e(this).html();0===this.attributes.length&&r.utils.isEmpty(t)&&e(this).replaceWith(function(){return e(this).contents()})}),o.each(function(){e(this).html(),0===this.attributes.length&&e(this).replaceWith(function(){return e(this).contents()})}),
t=(t=(t=(t=n.html()).replace("<!--?php","<?php")).replace("<!--?","<?")).replace("?-->","?>"),n.remove(),t},cleanMsWord:function(t){t=(t=(t=(t=t.replace(/<!--[\s\S]*?-->/g,"")).replace(/<o:p>[\s\S]*?<\/o:p>/gi,"")).replace(/\n/g," ")).replace(/<br\s?\/?>|<\/p>|<\/div>|<\/li>|<\/td>/gi,"\n\n");var i=e("<div/>").html(t),n=!1,r=1,o=[];return i.find("p[style]").each(function(){var t=e(this).attr("style").match(/mso\-list\:l([0-9]+)\slevel([0-9]+)/);if(t){var s=parseInt(t[1]),a=parseInt(t[2]),l=e(this).html().match(/^[\w]+\./)?"ol":"ul",c=e("<li/>").html(e(this).html());if(c.html(c.html().replace(/^([\w\.]+)</,"<")),c.find("span:first").remove(),1==a&&-1==e.inArray(s,o)){var d=e("<"+l+"/>").attr({"data-level":a,"data-list":s}).html(c);e(this).replaceWith(d),n=s,o.push(s)}else{if(a>r){for(var u=p=i.find('[data-level="'+r+'"][data-list="'+n+'"]'),h=r;h<a;h++)(d=e("<"+l+"/>")).appendTo(u.find("li").last()),u=d;u.attr({"data-level":a,"data-list":s}).html(c)}else{var p=i.find('[data-level="'+a+'"][data-list="'+s+'"]').last();p.append(c)}r=a,n=s,e(this).remove()}}}),i.find("[data-level][data-list]").removeAttr("data-level data-list"),i.html()},replaceNbspToSpaces:function(e){return e.replace("&nbsp;"," ")},replaceBrToNl:function(e){return e.replace(/<br\s?\/?>/gi,"\n")},replaceNlToBr:function(e){return e.replace(/\n/g,"<br />")},convertTags:function(t,i){var n=e("<div>").html(t);n.find("iframe").remove();var r=n.find("a");if(r.removeAttr("style"),!1!==this.opts.pasteLinkTarget&&r.attr("target",this.opts.pasteLinkTarget),i.links&&this.opts.pasteLinks&&n.find("a").each(function(e,t){if(t.href){for(var i,n='##%a href="'+t.href+'"',r=0,o=t.attributes.length;r<o;r++)"href"!==(i=t.attributes.item(r)).name&&(n+=" "+i.name+'="'+i.value+'"');t.outerHTML=n+"%##"+t.innerHTML+"##%/a%##"}}),t=n.html(),i.images&&this.opts.pasteImages&&(t=t.replace(/<img(.*?)src="(.*?)"(.*?[^>])>/gi,'##%img$1src="$2"$3%##')),this.opts.pastePlainText)return t;for(var o,s=i.lists?["ul","ol","li"]:this.opts.pasteBlockTags,a=(o=i.block||i.lists?i.inline?s.concat(this.opts.pasteInlineTags):s:i.inline?this.opts.pasteInlineTags:[]).length,l=0;l<a;l++)t=t.replace(new RegExp("</"+o[l]+">","gi"),"###/"+o[l]+"###"),t="td"===o[l]||"th"===o[l]?t.replace(new RegExp("<"+o[l]+'(.*?[^>])((colspan|rowspan)="(.*?[^>])")?(.*?[^>])>',"gi"),"###"+o[l]+" $2###"):this.utils.isInlineTag(o[l])?(t=(t=t.replace(new RegExp("<"+o[l]+'([^>]*)class="([^>]*)"[^>]*>',"gi"),"###"+o[l]+' class="$2"###')).replace(new RegExp("<"+o[l]+'([^>]*)data-redactor-style-cache="([^>]*)"[^>]*>',"gi"),"###"+o[l]+' cache="$2"###')).replace(new RegExp("<"+o[l]+"[^>]*>","gi"),"###"+o[l]+"###"):t.replace(new RegExp("<"+o[l]+"[^>]*>","gi"),"###"+o[l]+"###");return t},reconvertTags:function(e,t){if((t.links&&this.opts.pasteLinks||t.images&&this.opts.pasteImages)&&(e=(e=e.replace(new RegExp("##%","gi"),"<")).replace(new RegExp("%##","gi"),">")),this.opts.pastePlainText)return e;for(var i,n=t.lists?["ul","ol","li"]:this.opts.pasteBlockTags,r=(i=t.block||t.lists?t.inline?n.concat(this.opts.pasteInlineTags):n:t.inline?this.opts.pasteInlineTags:[]).length,o=0;o<r;o++)e=e.replace(new RegExp("###/"+i[o]+"###","gi"),"</"+i[o]+">");for(o=0;o<r;o++)e=e.replace(new RegExp("###"+i[o]+"###","gi"),"<"+i[o]+">");for(o=0;o<r;o++)if("td"===i[o]||"th"===i[o])e=e.replace(new RegExp("###"+i[o]+"s?(.*?[^#])###","gi"),"<"+i[o]+"$1>");else if(this.utils.isInlineTag(i[o])){var s="span"===i[o]?' data-redactor-span="true"':"";e=(e=e.replace(new RegExp("###"+i[o]+' cache="(.*?[^#])"###',"gi"),"<"+i[o]+' style="$1"'+s+' data-redactor-style-cache="$1">')).replace(new RegExp("###"+i[o]+"s?(.*?[^#])###","gi"),"<"+i[o]+"$1>")}return e},cleanPre:function(t){t=void 0===t?e(this.selection.block()).closest("pre",this.core.editor()[0]):t,e(t).find("br").replaceWith(function(){return document.createTextNode("\n")}),e(t).find("p").replaceWith(function(){return e(this).contents()})},removeTagsInsidePre:function(t){var i=e("<div />").append(t);return i.find("pre").replaceWith(function(){var t=e(this).html();return t=(t=t.replace(/<br\s?\/?>|<\/p>|<\/div>|<\/li>|<\/td>/gi,"\n")).replace(/(<([^>]+)>)/gi,""),e("<pre />").append(t)}),t=i.html(),i.remove(),t},getPlainText:function(t){t=(t=(t=(t=(t=(t=t.replace(/<!--[\s\S]*?-->/gi,"")).replace(/<style[\s\S]*?style>/gi,"")).replace(/<p><\/p>/g,"")).replace(/<\/div>|<\/li>|<\/td>/gi,"\n")).replace(/<\/p>/gi,"\n\n")).replace(/<\/H[1-6]>/gi,"\n\n");var i=document.createElement("div");return i.innerHTML=t,t=i.textContent||i.innerText,e.trim(t)},savePreCode:function(e){return e=this.clean.savePreFormatting(e),e=this.clean.saveCodeFormatting(e),this.clean.restoreSelectionMarkers(e)},savePreFormatting:function(t){var i=t.match(/<pre(.*?)>([\w\W]*?)<\/pre>/gi);return null===i?t:(e.each(i,e.proxy(function(e,i){var n,r,o,s=[],a=!1;i.match(/<pre(.*?)>(([\n\r\s]+)?)<code(.*?)>/i)?(a=!0,n=(s=i.match(/<pre(.*?)>(([\n\r\s]+)?)<code(.*?)>([\w\W]*?)<\/code>(([\n\r\s]+)?)<\/pre>/i))[5],r=s[1],o=s[4]):(n=(s=i.match(/<pre(.*?)>([\w\W]*?)<\/pre>/i))[2],r=s[1]),n=(n=n.replace(/<br\s?\/?>/g,"\n")).replace(/&nbsp;/g," "),this.opts.preSpaces&&(n=n.replace(/\t/g,new Array(this.opts.preSpaces+1).join(" "))),n=(n=this.clean.encodeEntities(n)).replace(/\$/g,"&#36;"),t=a?t.replace(i,"<pre"+r+"><code"+o+">"+n+"</code></pre>"):t.replace(i,"<pre"+r+">"+n+"</pre>")},this)),t)},saveCodeFormatting:function(t){var i=t.match(/<code(.*?)>([\w\W]*?)<\/code>/gi);return null===i?t:(e.each(i,e.proxy(function(e,i){var n=i.match(/<code(.*?)>([\w\W]*?)<\/code>/i);n[2]=n[2].replace(/&nbsp;/g," "),n[2]=this.clean.encodeEntities(n[2]),n[2]=n[2].replace(/\$/g,"&#36;"),t=t.replace(i,"<code"+n[1]+">"+n[2]+"</code>")},this)),t)},restoreSelectionMarkers:function(e){return e.replace(/&lt;span id=&quot;selection-marker-([0-9])&quot; class=&quot;redactor-selection-marker&quot;&gt;\u200b&lt;\/span&gt;/g,'<span id="selection-marker-$1" class="redactor-selection-marker">\u200b</span>')},saveFormTags:function(e){return e.replace(/<form(.*?)>([\w\W]*?)<\/form>/gi,'<section$1 rel="redactor-form-tag">$2</section>')},restoreFormTags:function(e){return e.replace(/<section(.*?) rel="redactor-form-tag"(.*?)>([\w\W]*?)<\/section>/gi,"<form$1$2>$3</form>")},encodeHtml:function(e){return e=(e=(e=(e=e.replace(/\u201d/g,'"')).replace(/\u201c/g,'"')).replace(/\u2018/g,"'")).replace(/\u2019/g,"'"),this.clean.encodeEntities(e)},encodeEntities:function(e){return(e=String(e).replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"')).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},stripTags:function(e,t){if(void 0===t)return e.replace(/(<([^>]+)>)/gi,"");var i=/<\/?([a-z][a-z0-9]*)\b[^>]*>/gi;return e.replace(i,function(e,i){return-1===t.indexOf(i.toLowerCase())?e:""})},removeMarkers:function(e){return e.replace(/<span(.*?[^>]?)class="redactor-selection-marker"(.*?[^>]?)>([\w\W]*?)<\/span>/gi,"")},removeSpaces:function(t){return(t=(t=(t=(t=(t=(t=(t=(t=e.trim(t)).replace(/\n/g,"")).replace(/[\t]*/g,"")).replace(/\n\s*\n/g,"\n")).replace(/^[\s\n]*/g," ")).replace(/[\s\n]*$/g," ")).replace(/>\s{2,}</g,"> <")).replace(/\n\n/g,"\n")).replace(/\u200B/g,"")},removeSpacesHard:function(t){return(t=(t=(t=(t=(t=(t=(t=(t=e.trim(t)).replace(/\n/g,"")).replace(/[\t]*/g,"")).replace(/\n\s*\n/g,"\n")).replace(/^[\s\n]*/g,"")).replace(/[\s\n]*$/g,"")).replace(/>\s{2,}</g,"><")).replace(/\n\n/g,"\n")).replace(/\u200B/g,"")},normalizeCurrentHeading:function(){var e=this.selection.block();this.utils.isCurrentOrParentHeader()&&e&&e.normalize()}}},code:function(){return{syncFire:!0,html:!1,start:function(t){t=(t=e.trim(t)).replace(/^(<span id="selection-marker-1" class="redactor-selection-marker">\u200b<\/span>)/,""),"textarea"===this.opts.type?t=this.clean.onSet(t):"div"===this.opts.type&&""===t&&(t=this.opts.emptyHtml),t=t.replace(/<p><span id="selection-marker-1" class="redactor-selection-marker">\u200b<\/span><\/p>/,""),this.events.stopDetectChanges(),this.core.editor().html(t),this.observe.load(),this.events.startDetectChanges()},set:function(t,i){t=e.trim(t),(i=i||{}).start&&(this.start=i.start),"textarea"===this.opts.type?t=this.clean.onSet(t):"div"===this.opts.type&&""===t&&(t=this.opts.emptyHtml),this.core.editor().html(t),"textarea"===this.opts.type&&this.code.sync(),this.placeholder.enable()},get:function(){if("textarea"===this.opts.type)return this.core.textarea().val();var e=this.core.editor().html();return this.clean.onGet(e)},sync:function(){if(this.code.syncFire){var t=this.core.editor().html(),i=this.code.cleaned(t);if(!this.code.isSync(i)){if(this.code.html=i,"textarea"!==this.opts.type)return this.core.callback("sync",t),void this.core.callback("change",t);"textarea"===this.opts.type&&setTimeout(e.proxy(function(){this.code.startSync(t)},this),10)}}},startSync:function(e){e=this.core.callback("syncBefore",e),e=this.clean.onSync(e),this.core.textarea().val(e),this.core.callback("sync",e),!1===this.start&&this.core.callback("change",e),this.start=!1},isSync:function(e){var t=!1!==this.code.html&&this.code.html;return!1!==t&&t===e},cleaned:function(e){return e=e.replace(/\u200B/g,""),this.clean.removeMarkers(e)}}},core:function(){return{id:function(){return this.$editor.attr("id")},element:function(){return this.$element},editor:function(){return void 0===this.$editor?e():this.$editor},textarea:function(){return this.$textarea},box:function(){return"textarea"===this.opts.type?this.$box:this.$element},toolbar:function(){return!!this.$toolbar&&this.$toolbar},air:function(){return!!this.$air&&this.$air},object:function(){return e.extend({},this)},structure:function(){this.core.editor().toggleClass("redactor-structure")},addEvent:function(e){this.core.event=e},getEvent:function(){return this.core.event},callback:function(t,i,n){var r=!1,o=e._data(this.core.element()[0],"events");if(void 0!==o&&void 0!==o[t])for(var s=o[t].length,a=0;a<s;a++)if("callback.redactor"===o[t][a].namespace){var l=o[t][a].handler,c=void 0===n?[i]:[i,n];r=void 0===c?l.call(this,i):l.call(this,i,c)}if(r)return r;if(void 0===this.opts.callbacks[t])return void 0===n?i:n;var d=this.opts.callbacks[t];return e.isFunction(d)?void 0===n?d.call(this,i):d.call(this,i,n):void 0===n?i:n},destroy:function(){this.opts.destroyed=!0,this.core.callback("destroy"),this.placeholder.destroy(),this.progress.destroy(),e("#redactor-voice-"+this.uuid).remove(),this.core.editor().removeClass("redactor-in redactor-styles redactor-structure redactor-layer-img-edit"),this.core.editor().off("keydown.redactor-remove-textnode"),this.core.editor().off(".redactor-observe."+this.uuid),this.$element.off(".redactor").removeData("redactor"),this.core.editor().off(".redactor"),e(document).off(".redactor-dropdown"),e(document).off(".redactor-air."+this.uuid),e(document).off("mousedown.redactor-blur."+this.uuid),e(document).off("mousedown.redactor."+this.uuid),e(document).off("touchstart.redactor."+this.uuid+" click.redactor."+this.uuid),e(window).off(".redactor-toolbar."+this.uuid),e(window).off("touchmove.redactor."+this.uuid),e("body").off("scroll.redactor."+this.uuid),e(this.opts.toolbarFixedTarget).off("scroll.redactor."+this.uuid);var t=this;!1!==this.opts.plugins&&e.each(this.opts.plugins,function(i,n){e(window).off(".redactor-plugin-"+n),e(document).off(".redactor-plugin-"+n),e("body").off(".redactor-plugin-"+n),t.core.editor().off(".redactor-plugin-"+n)}),this.$element.off("click.redactor-click-to-edit"),this.$element.removeClass("redactor-click-to-edit"),this.core.editor().removeClass("redactor-layer"),this.core.editor().removeAttr("contenteditable");var i=this.code.get();this.opts.toolbar&&this.$toolbar&&this.$toolbar.find("a").each(function(){var t=e(this);t.data("dropdown")&&(t.data("dropdown").remove(),t.data("dropdown",{}))}),"textarea"===this.opts.type&&(this.$box.after(this.$element),this.$box.remove(),this.$element.val(i).show()),this.opts.air&&this.$air.remove(),this.opts.toolbar&&this.$toolbar&&this.$toolbar.remove(),this.$modalBox&&this.$modalBox.remove(),this.$modalOverlay&&this.$modalOverlay.remove(),e(".redactor-link-tooltip").remove(),clearInterval(this.autosaveTimeout)}}},detect:function(){return{isWebkit:function(){return/webkit/.test(this.opts.userAgent)},isFirefox:function(){return this.opts.userAgent.indexOf("firefox")>-1},isIe:function(e){return document.documentMode||/Edge/.test(navigator.userAgent)?"edge":((t=RegExp("msie"+(isNaN(e)?"":"\\s"+e),"i").test(navigator.userAgent))||(t=!!navigator.userAgent.match(/Trident.*rv[ :]*11\./)),t);var t},isMobile:function(){return/(iPhone|iPod|BlackBerry|Android)/.test(navigator.userAgent)},isDesktop:function(){return!/(iPhone|iPod|iPad|BlackBerry|Android)/.test(navigator.userAgent)},isIpad:function(){return/iPad/.test(navigator.userAgent)}}},dropdown:function(){return{active:!1,button:!1,key:!1,position:[],getDropdown:function(){return this.dropdown.active},build:function(t,i,n){n=this.dropdown.buildFormatting(t,n),e.each(n,e.proxy(function(e,n){var r=this.dropdown.buildItem(e,n);this.observe.addDropdown(r,e,n),i.attr("rel",t).append(r)},this))},buildFormatting:function(t,i){return"format"!==t||!1===this.opts.formattingAdd?i:(e.each(this.opts.formattingAdd,e.proxy(function(e,t){var n=this.utils.isBlockTag(t.args[0])?"block":"inline";i[e]={func:"block"===n?"block.format":"inline.format",args:t.args,title:t.title}},this)),i)},buildItem:function(t,i){var n=e("<li />");if(void 0!==i.classname&&n.addClass(i.classname),-1!==t.search(/^divider/i))return n.addClass("redactor-dropdown-divider"),n;var r=e('<a href="#" class="redactor-dropdown-'+t+'" role="button" />'),o=e("<span />").html(i.title);return r.append(o),r.on("mousedown",e.proxy(function(e){e.preventDefault(),this.dropdown.buildClick(e,t,i)},this)),n.append(r),n},buildClick:function(t,i,n){if(!e(t.target).hasClass("redactor-dropdown-link-inactive")){var r=this.dropdown.buildCommand(n);void 0!==n.args?this.button.toggle(t,i,r.type,r.callback,n.args):this.button.toggle(t,i,r.type,r.callback)}},buildCommand:function(e){var t={type:"func"};return t.callback=e.func,e.command?(t.type="command",t.callback=e.command):e.dropdown&&(t.type="dropdown",t.callback=e.dropdown),t},show:function(t,i){this.detect.isDesktop()&&this.core.editor().focus(),this.dropdown.hideAll(!1,i),this.dropdown.key=i,this.dropdown.button=this.button.get(this.dropdown.key),this.dropdown.button.hasClass("dropact")?this.dropdown.hide():(this.dropdown.active=this.dropdown.button.data("dropdown").appendTo(document.body),this.core.callback("dropdownShow",{dropdown:this.dropdown.active,key:this.dropdown.key,button:this.dropdown.button}),this.button.setActive(this.dropdown.key),this.dropdown.button.addClass("dropact"),this.dropdown.getButtonPosition(),this.button.toolbar().hasClass("toolbar-fixed-box")&&this.detect.isDesktop()?this.dropdown.showIsFixedToolbar():this.dropdown.showIsUnFixedToolbar(),this.detect.isDesktop()&&!this.detect.isFirefox()&&(this.dropdown.active.on("mouseover.redactor-dropdown",e.proxy(this.utils.disableBodyScroll,this)),this.dropdown.active.on("mouseout.redactor-dropdown mousedown.redactor-dropdown",e.proxy(this.utils.enableBodyScroll,this))),t.stopPropagation())},showIsFixedToolbar:function(){var t=this.dropdown.button.position().top+this.dropdown.button.innerHeight()+this.opts.toolbarFixedTopOffset,i="fixed";this.opts.toolbarFixedTarget!==document&&(t=this.dropdown.button.innerHeight()+this.$toolbar.offset().top+this.opts.toolbarFixedTopOffset,i="absolute"),this.dropdown.active.css({position:i,left:this.dropdown.position.left+"px",top:t+"px"}).show(),this.dropdown.active.redactorAnimation("slideDown",{duration:.2},e.proxy(function(){this.dropdown.enableCallback(),this.dropdown.enableEvents()},this))},showIsUnFixedToolbar:function(){this.dropdown.active.css({position:"absolute",left:this.dropdown.position.left+"px",top:this.dropdown.button.innerHeight()+this.dropdown.position.top+"px"}).show(),this.dropdown.active.redactorAnimation(this.opts.animation?"slideDown":"show",{duration:.2},e.proxy(function(){this.dropdown.enableCallback(),this.dropdown.enableEvents()},this))},enableEvents:function(){e(document).on("mousedown.redactor-dropdown",e.proxy(this.dropdown.hideAll,this)),this.core.editor().on("touchstart.redactor-dropdown",e.proxy(this.dropdown.hideAll,this)),e(document).on("keyup.redactor-dropdown",e.proxy(this.dropdown.closeHandler,this))},enableCallback:function(){this.core.callback("dropdownShown",{dropdown:this.dropdown.active,key:this.dropdown.key,button:this.dropdown.button})},getButtonPosition:function(){this.dropdown.position=this.dropdown.button.offset();var t=this.dropdown.active.width();this.dropdown.position.left+t>e(document).width()&&(this.dropdown.position.left=Math.max(0,this.dropdown.position.left-t+parseInt(this.dropdown.button.innerWidth())))},closeHandler:function(e){e.which===this.keyCode.ESC&&(this.dropdown.hideAll(e),this.core.editor().focus())},hideAll:function(t,i){if(this.detect.isDesktop()&&this.utils.enableBodyScroll(),!1===t||0===e(t.target).closest(".redactor-dropdown").length){var n=void 0===i?this.button.toolbar().find("a.dropact"):this.button.toolbar().find("a.dropact").not(".re-"+i),r=void 0===i?e(".redactor-dropdown-"+this.uuid):e(".redactor-dropdown-"+this.uuid).not(".redactor-dropdown-box-"+i);0!==r.length&&(e(document).off(".redactor-dropdown"),this.core.editor().off(".redactor-dropdown"),e.each(r,e.proxy(function(t,i){var n=e(i);this.core.callback("dropdownHide",n),n.hide(),n.off("mouseover mouseout").off(".redactor-dropdown")},this)),n.removeClass("redactor-act dropact"))}},hide:function(){!1!==this.dropdown.active&&(this.detect.isDesktop()&&this.utils.enableBodyScroll(),this.dropdown.active.redactorAnimation(this.opts.animation?"slideUp":"hide",{duration:.2},e.proxy(function(){e(document).off(".redactor-dropdown"),this.core.editor().off(".redactor-dropdown"),this.dropdown.hideOut()},this)))},hideOut:function(){this.core.callback("dropdownHide",this.dropdown.active),this.dropdown.button.removeClass("redactor-act dropact"),this.dropdown.active.off("mouseover mouseout").off(".redactor-dropdown"),this.dropdown.button=!1,this.dropdown.key=!1,this.dropdown.active=!1}}},events:function(){return{focused:!1,blured:!0,dropImage:!1,stopChanges:!1,stopDetectChanges:function(){this.events.stopChanges=!0},startDetectChanges:function(){var e=this;setTimeout(function(){e.events.stopChanges=!1},1)},dragover:function(t){t.preventDefault(),t.stopPropagation(),"IMG"===t.target.tagName&&e(t.target).addClass("redactor-image-dragover")},dragleave:function(){this.core.editor().find("img").removeClass("redactor-image-dragover")},drop:function(e){return e=e.originalEvent||e,this.core.editor().find("img").removeClass("redactor-image-dragover"),"inline"===this.opts.type||"pre"===this.opts.type?(e.preventDefault(),!1):void 0===window.FormData||!e.dataTransfer||(0===e.dataTransfer.files.length?this.events.onDrop(e):(this.events.onDropUpload(e),void this.core.callback("drop",e)))},click:function(e){var t=this.core.getEvent(),i="click"!==t&&"arrow"!==t&&"click";this.core.addEvent(i),this.utils.disableSelectAll(),this.core.callback("click",e)},focus:function(e){if(!this.rtePaste&&(this.events.isCallback("focus")&&this.core.callback("focus",e),this.events.focused=!0,this.events.blured=!1,!1===this.selection.current())){var t=this.selection.get(),i=this.selection.range(t);i.setStart(this.core.editor()[0],0),i.setEnd(this.core.editor()[0],0),this.selection.update(t,i)}},blur:function(t){this.start||this.rtePaste||0===e(t.target).closest("#"+this.core.id()+", .redactor-toolbar, .redactor-dropdown, #redactor-modal-box").length&&(!this.events.blured&&this.events.isCallback("blur")&&this.core.callback("blur",t),this.events.focused=!1,this.events.blured=!0)},touchImageEditing:function(){var t=-1;this.events.imageEditing=!1,e(window).on("touchmove.redactor."+this.uuid,e.proxy(function(){this.events.imageEditing=!0,-1!==t&&clearTimeout(t),t=setTimeout(e.proxy(function(){this.events.imageEditing=!1},this),500)},this))},init:function(){this.core.editor().on("dragover.redactor dragenter.redactor",e.proxy(this.events.dragover,this)),this.core.editor().on("dragleave.redactor",e.proxy(this.events.dragleave,this)),this.core.editor().on("drop.redactor",e.proxy(this.events.drop,this)),this.core.editor().on("click.redactor",e.proxy(this.events.click,this)),this.core.editor().on("paste.redactor",e.proxy(this.paste.init,this)),this.core.editor().on("keydown.redactor",e.proxy(this.keydown.init,this)),this.core.editor().on("keyup.redactor",e.proxy(this.keyup.init,this)),this.core.editor().on("focus.redactor",e.proxy(this.events.focus,this)),e(document).on("mousedown.redactor-blur."+this.uuid,e.proxy(this.events.blur,this)),this.events.touchImageEditing(),this.events.createObserver(),this.events.setupObserver()},createObserver:function(){var t=this;this.events.observer=new MutationObserver(function(i){i.forEach(e.proxy(t.events.iterateObserver,t))})},iterateObserver:function(e){var t=!1;(("textarea"===this.opts.type||"div"===this.opts.type)&&!this.detect.isFirefox()&&e.target===this.core.editor()[0]||"class"===e.attributeName&&e.target===this.core.editor()[0])&&(t=!0),t||(this.observe.load(),this.events.changeHandler())},setupObserver:function(){this.events.observer.observe(this.core.editor()[0],{attributes:!0,subtree:!0,childList:!0,characterData:!0,characterDataOldValue:!0})},changeHandler:function(){this.events.stopChanges||(this.code.sync(),this.autosave.is()&&(clearTimeout(this.autosaveTimeout),this.autosaveTimeout=setTimeout(e.proxy(this.autosave.send,this),300)))},onDropUpload:function(e){if(e.preventDefault(),e.stopPropagation(),(this.opts.dragImageUpload||this.opts.dragFileUpload)&&(null!==this.opts.imageUpload||null!==this.opts.fileUpload)){"IMG"===e.target.tagName&&(this.events.dropImage=e.target);for(var t=e.dataTransfer.files,i=t.length,n=0;n<i;n++)this.upload.directUpload(t[n],e)}},onDrop:function(e){this.core.callback("drop",e)},isCallback:function(t){return void 0!==this.opts.callbacks[t]&&e.isFunction(this.opts.callbacks[t])},stopDetect:function(){this.events.stopDetectChanges()},startDetect:function(){this.events.startDetectChanges()}}},file:function(){return{is:function(){return!(!this.opts.fileUpload||!this.opts.fileUpload&&!this.opts.s3)},show:function(){this.modal.load("file",this.lang.get("file"),700),this.upload.init("#redactor-modal-file-upload",this.opts.fileUpload,this.file.insert),e("#redactor-filename").val(this.selection.get().toString()),this.modal.show()},insert:function(t,i,n){if(void 0!==t.error)return this.modal.close(),void this.core.callback("fileUploadError",t);this.file.release(n,i),this.buffer.set(),this.air.collapsed();var r=this.file.text(t),o=e("<a />").attr("href",t.url).text(r),s=void 0===t.id?"":t.id,a=void 0===t.s3?"file":"s3";o.attr("data-"+a,s),o=e(this.insert.node(o)),this.caret.after(o),this.storage.add({type:a,node:o[0],url:t.url,id:s}),null!==i&&this.core.callback("fileUpload",o,t)},release:function(e,t){t?(this.marker.remove(),this.insert.nodeToPoint(e,this.marker.get()),this.selection.restore()):this.modal.close()},text:function(t){var i=e("#redactor-filename").val();return void 0===i||""===i?t.name:i}}},focus:function(){return{start:function(){if(this.core.editor().focus(),"inline"!==this.opts.type){var e=this.focus.first();!1!==e&&this.caret.start(e)}},end:function(){this.core.editor().focus();var e=this.opts.inline?this.core.editor():this.focus.last();if(0!==e.length){var t=this.focus.lastChild(e);if(this.detect.isWebkit()||!1===t){var i=this.selection.get(),n=this.selection.range(i);null!==n?(n.selectNodeContents(e[0]),n.collapse(!1),this.selection.update(i,n)):this.caret.end(e)}else this.caret.end(t)}},first:function(){var e=this.core.editor().children().first();return(0!==e.length||0!==e[0].length&&"BR"!==e[0].tagName&&"HR"!==e[0].tagName&&3!==e[0].nodeType)&&("UL"===e[0].tagName||"OL"===e[0].tagName?e.find("li").first():e)},last:function(){return this.core.editor().children().last()},lastChild:function(e){var t=e[0].lastChild;return!(null===t||!this.utils.isInlineTag(t.tagName))&&t},is:function(){return this.core.editor()[0]===document.activeElement}}},image:function(){return{is:function(){return!(!this.opts.imageUpload||!this.opts.imageUpload&&!this.opts.s3)},show:function(){this.modal.load("image",this.lang.get("image"),700),this.upload.init("#redactor-modal-image-droparea",this.opts.imageUpload,this.image.insert),this.modal.show()},insert:function(t,i,n){var r;if(void 0!==t.error)return this.modal.close(),this.events.dropImage=!1,void this.core.callback("imageUploadError",t,n);if(!1!==this.events.dropImage)return r=e(this.events.dropImage),this.core.callback("imageDelete",r[0].src,r),r.attr("src",t.url),this.events.dropImage=!1,void this.core.callback("imageUpload",r,t);this.placeholder.hide();var o=e("<"+this.opts.imageTag+">");(r=e("<img>")).attr("src",t.url);var s=void 0===t.id?"":t.id,a=void 0===t.s3?"image":"s3";r.attr("data-"+a,s),o.append(r);var l=this.utils.isTag(this.selection.current(),"pre");if(i){this.air.collapsed(),this.marker.remove();var c=this.insert.nodeToPoint(n,this.marker.get()),d=e(c).next();this.selection.restore(),this.buffer.set(),void 0!==d&&0!==d.length&&"IMG"===d[0].tagName?(this.core.callback("imageDelete",d[0].src,d),d.closest("figure, p",this.core.editor()[0]).replaceWith(o),this.caret.after(o)):(l?e(l).after(o):this.insert.node(o),this.caret.after(o))}else this.modal.close(),this.buffer.set(),this.air.collapsed(),l?e(l).after(o):this.insert.node(o),this.caret.after(o);this.events.dropImage=!1,this.storage.add({type:a,node:r[0],url:t.url,id:s});var u=r[0].nextSibling,h=o.next(),p=e(u).text().replace(/\u200B/g,""),f=h.text().replace(/\u200B/g,"");""===p&&e(u).remove(),1===h.length&&"FIGURE"===h[0].tagName&&""===f&&h.remove(),null!==i?this.core.callback("imageUpload",r,t):this.core.callback("imageInserted",r,t)},setEditable:function(t){if(t.on("dragstart",function(e){e.preventDefault()}),this.opts.imageResizable){var i=e.proxy(function(){this.observe.image=t,this.image.resizer=this.image.loadEditableControls(t),e(document).on("mousedown.redactor-image-resize-hide."+this.uuid,e.proxy(this.image.hideResize,this)),this.image.resizer&&this.image.resizer.on("mousedown.redactor touchstart.redactor",e.proxy(function(e){this.image.setResizable(e,t)},this))},this);t.off("mousedown.redactor").on("mousedown.redactor",e.proxy(this.image.hideResize,this)),t.off("click.redactor touchstart.redactor").on("click.redactor touchstart.redactor",i)}else t.off("click.redactor touchstart.redactor").on("click.redactor touchstart.redactor",e.proxy(function(){setTimeout(e.proxy(function(){this.image.showEdit(t)},this),200)},this))},setResizable:function(e,t){e.preventDefault(),this.image.resizeHandle={x:e.pageX,y:e.pageY,el:t,ratio:t.width()/t.height(),h:t.height()},(e=e.originalEvent||e).targetTouches&&(this.image.resizeHandle.x=e.targetTouches[0].pageX,this.image.resizeHandle.y=e.targetTouches[0].pageY),this.image.startResize()},startResize:function(){e(document).on("mousemove.redactor-image-resize touchmove.redactor-image-resize",e.proxy(this.image.moveResize,this)),e(document).on("mouseup.redactor-image-resize touchend.redactor-image-resize",e.proxy(this.image.stopResize,this))},moveResize:function(e){e.preventDefault(),e=e.originalEvent||e;var t=this.image.resizeHandle.h;e.targetTouches?t+=e.targetTouches[0].pageY-this.image.resizeHandle.y:t+=e.pageY-this.image.resizeHandle.y;var i=Math.round(t*this.image.resizeHandle.ratio);t<50||i<100||(this.image.resizeHandle.el.attr({width:i,height:t}),this.image.resizeHandle.el.width(i),this.image.resizeHandle.el.height(t),this.code.sync())},stopResize:function(){this.handle=!1,e(document).off(".redactor-image-resize"),this.image.hideResize()},hideResize:function(t){if(!t||0===e(t.target).closest("#redactor-image-box",this.$editor[0]).length){t&&"IMG"==t.target.tagName&&e(t.target);var i=this.$editor.find("#redactor-image-box");0!==i.length&&(e("#redactor-image-editter").remove(),e("#redactor-image-resizer").remove(),i.find("img").css({marginTop:i[0].style.marginTop,marginBottom:i[0].style.marginBottom,marginLeft:i[0].style.marginLeft,marginRight:i[0].style.marginRight}),i.css("margin",""),i.find("img").css("opacity",""),i.replaceWith(function(){return e(this).contents()}),e(document).off("mousedown.redactor-image-resize-hide."+this.uuid),void 0!==this.image.resizeHandle&&this.image.resizeHandle.el.attr("rel",this.image.resizeHandle.el.attr("style")))}},loadResizableControls:function(t,i){if(this.opts.imageResizable&&!this.detect.isMobile()){var n=e('<span id="redactor-image-resizer" data-redactor="verified"></span>');return this.detect.isDesktop()||n.css({width:"15px",height:"15px"}),n.attr("contenteditable",!1),i.append(n),i.append(t),n}return i.append(t),!1},loadEditableControls:function(t){if(0===e("#redactor-image-box").length){var i=e('<span id="redactor-image-box" data-redactor="verified">');if(i.css("float",t.css("float")).attr("contenteditable",!1),"auto"!=t[0].style.margin?(i.css({marginTop:t[0].style.marginTop,marginBottom:t[0].style.marginBottom,marginLeft:t[0].style.marginLeft,marginRight:t[0].style.marginRight}),t.css("margin","")):i.css({display:"block",margin:"auto"}),t.css("opacity",".5").after(i),this.opts.imageEditable){this.image.editter=e('<span id="redactor-image-editter" data-redactor="verified">'+this.lang.get("edit")+"</span>"),this.image.editter.attr("contenteditable",!1),this.image.editter.on("click",e.proxy(function(){this.image.showEdit(t)},this)),i.append(this.image.editter);var n=this.image.editter.innerWidth();this.image.editter.css("margin-left","-"+n/2+"px")}return this.image.loadResizableControls(t,i)}},showEdit:function(t){if(!this.events.imageEditing){this.observe.image=t;var i=t.closest("a",this.$editor[0]),n=t.closest("figure",this.$editor[0]),r=0!==n.length?n:t;if(this.modal.load("image-edit",this.lang.get("edit"),705),this.image.buttonDelete=this.modal.getDeleteButton().text(this.lang.get("delete")),this.image.buttonSave=this.modal.getActionButton().text(this.lang.get("save")),this.image.buttonDelete.on("click",e.proxy(this.image.remove,this)),this.image.buttonSave.on("click",e.proxy(this.image.update,this)),!1===this.opts.imageCaption)e("#redactor-image-caption").val("").hide().prev().hide();else{var o=t.closest(this.opts.imageTag,this.$editor[0]).find("figcaption");0!==o&&e("#redactor-image-caption").val(o.text()).show()}if(this.opts.imagePosition){var s=(0!==n.length?"center"===r.css("text-align"):"block"==r.css("display")&&"none"==r.css("float"))?"center":r.css("float");e("#redactor-image-align").val(s)}else e(".redactor-image-position-option").hide();e("#redactor-image-preview").html(e('<img src="'+t.attr("src")+'" style="max-width: 100%;">')),e("#redactor-image-title").val(t.attr("alt")),0!==i.length&&(e("#redactor-image-link").val(i.attr("href")),"_blank"===i.attr("target")&&e("#redactor-image-link-blank").prop("checked",!0)),e(".redactor-link-tooltip").remove(),this.modal.show(),this.detect.isDesktop()&&e("#redactor-image-title").focus()}},update:function(){var t=this.observe.image,i=t.closest("a",this.core.editor()[0]),n=e("#redactor-image-title").val().replace(/(<([^>]+)>)/gi,"");t.attr("alt",n).attr("title",n),this.image.setFloating(t);var r=e.trim(e("#redactor-image-link").val()).replace(/(<([^>]+)>)/gi,"");if(""!==r){var o="((xn--)?[a-z0-9]+(-[a-z0-9]+)*\\.)+[a-z]{2,}",s=new RegExp("^(http|ftp|https)://"+o,"i"),a=new RegExp("^"+o,"i");-1===r.search(s)&&0===r.search(a)&&this.opts.linkProtocol&&(r=this.opts.linkProtocol+"://"+r);var l=!!e("#redactor-image-link-blank").prop("checked");if(0===i.length){var c=e('<a href="'+r+'" id="redactor-img-tmp">'+this.utils.getOuterHtml(t)+"</a>");l&&c.attr("target","_blank"),t=t.replaceWith(c),(i=this.core.editor().find("#redactor-img-tmp")).removeAttr("id")}else i.attr("href",r),l?i.attr("target","_blank"):i.removeAttr("target")}else 0!==i.length&&i.replaceWith(this.utils.getOuterHtml(t));this.image.addCaption(t,i),this.modal.close(),this.buffer.set()},setFloating:function(t){var i=t.closest("figure",this.$editor[0]),n=0!==i.length?i:t,r="",o="",s="",a="";switch(e("#redactor-image-align").val()){case"left":r="left",s="0 "+this.opts.imageFloatMargin+" "+this.opts.imageFloatMargin+" 0";break;case"right":r="right",s="0 0 "+this.opts.imageFloatMargin+" "+this.opts.imageFloatMargin;break;case"center":0!==i.length?a="center":(o="block",s="auto")}n.css({"float":r,display:o,margin:s,"text-align":a}),n.attr("rel",t.attr("style"))},addCaption:function(t,i){var n=e("#redactor-image-caption").val(),r=0!==i.length?i:t,o=r.next();0!==o.length&&"FIGCAPTION"===o[0].tagName||(o=!1),""!==n?!1===o?(o=e("<figcaption />").text(n),
r.after(o)):o.text(n):!1!==o&&o.remove()},remove:function(t,i){i=void 0===i?e(this.observe.image):i,"boolean"!=typeof t&&this.buffer.set(),this.events.stopDetectChanges();var n,r,o=i.closest("a",this.core.editor()[0]),s=i.closest(this.opts.imageTag,this.core.editor()[0]);if(i.parent(),!1===this.core.callback("imageDelete",t,i[0]))return t&&t.preventDefault(),!1;0!==e("#redactor-image-box").length&&e("#redactor-image-box").parent(),0!==s.length?(r=s.prev(),n=s.next(),s.remove()):0!==o.length?(o.parent(),o.remove()):i.remove(),e("#redactor-image-box").remove(),!1!==t&&(n&&0!==n.length?this.caret.start(n):r&&0!==r.length&&this.caret.end(r)),"boolean"!=typeof t&&this.modal.close(),this.utils.restoreScroll(),this.observe.image=!1,this.events.startDetectChanges(),this.placeholder.enable(),this.code.sync()}}},indent:function(){return{increase:function(){if(this.list.get()){var t=e(this.selection.current()).closest("li"),i=t.closest("ul, ol",this.core.editor()[0]),n=t.closest("li").prev();if(0!==n.length&&"LI"===n[0].tagName)if(this.buffer.set(),this.utils.isCollapsed()){var r=i[0].tagName,o=e("<"+r+" />");this.selection.save();var s=n.find("ol").first();1===s.length?s.append(t):(r=i[0].tagName,(o=e("<"+r+" />")).append(t),n.append(o)),this.selection.restore()}else document.execCommand("indent"),this.selection.save(),this.indent.removeEmpty(),this.indent.normalize(),this.selection.restore()}},decrease:function(){if(this.list.get()){e(this.selection.current()).closest("li").closest("ul, ol",this.core.editor()[0]),this.buffer.set(),document.execCommand("outdent");var t=e(this.selection.current()).closest("li",this.core.editor()[0]);if(this.utils.isCollapsed()&&this.indent.repositionItem(t),0===t.length){document.execCommand("formatblock",!1,"p");var i=(t=e(this.selection.current())).next();0!==i.length&&"BR"===i[0].tagName&&i.remove()}this.selection.save(),this.indent.removeEmpty(),this.indent.normalize(),this.selection.restore()}},repositionItem:function(e){var t=e.next();0===t.length||"UL"===t[0].tagName&&"OL"===t[0].tagName||e.append(t);var i=e.prev();0!==i.length&&"LI"!==i[0].tagName&&(this.selection.save(),e.parents("li",this.core.editor()[0]).after(e),this.selection.restore())},normalize:function(){this.core.editor().find("li").each(e.proxy(function(t,i){var n=e(i);n.find(this.opts.inlineTags.join(",")).each(function(){e(this).removeAttr("style")});var r=n.parent();if(0===r.length||"LI"!==r[0].tagName){var o=n.next();0===o.length||"UL"!==o[0].tagName&&"OL"!==o[0].tagName||n.append(o)}else r.after(n)},this))},removeEmpty:function(){var t=this.core.editor().find("ul, ol"),i=this.core.editor().find("li");i.each(e.proxy(function(e,t){this.indent.removeItemEmpty(t)},this)),t.each(e.proxy(function(e,t){this.indent.removeItemEmpty(t)},this)),i.each(e.proxy(function(e,t){this.indent.removeItemEmpty(t)},this))},removeItemEmpty:function(t){var i=t.innerHTML.replace(/[\t\s\n]/g,"");""===(i=i.replace(/<span><\/span>/g,""))&&e(t).remove()}}},inline:function(){return{format:function(e,t,i,n){if(!this.utils.isCurrentOrParent(["PRE","CODE"])){var r=this.inline.getParams(t,i,n);e=this.inline.arrangeTag(e),this.placeholder.hide(),this.buffer.set(),this.utils.isCollapsed()?this.inline.formatCollapsed(e,r):this.inline.formatUncollapsed(e,r)}},formatCollapsed:function(t,i){var n,r=this.selection.inline();if(r){var o=r.tagName.toLowerCase();if(o===t)this.utils.isEmpty(r.innerHTML)?(this.caret.after(r),e(r).remove()):(s=this.inline.insertBreakpoint(r,o),this.caret.after(s));else if(0===e(r).closest(t).length)n=this.inline.insertInline(t),n=this.inline.setParams(n,i);else{var s=this.inline.insertBreakpoint(r,o);this.caret.after(s)}}else n=this.inline.insertInline(t),n=this.inline.setParams(n,i)},formatUncollapsed:function(t,i){this.selection.save();var n=this.inline.getClearedNodes();this.inline.setNodesStriked(n,t,i),this.selection.restore(),document.execCommand("strikethrough"),this.selection.saveInstant();var r=this;this.core.editor().find("strike").each(function(){var n=r.utils.replaceToTag(this,t);r.inline.setParams(n[0],i);var o=n.find(t),s=n.parent(),a=s.parent();if(0!==a.length&&a[0].tagName.toLowerCase()===t&&a.html()==s[0].outerHTML)return n.replaceWith(function(){return e(this).contents()}),void a.replaceWith(function(){return e(this).contents()});0!==o.length&&r.inline.cleanInsideOrParent(o,i),s.html()==n[0].outerHTML&&r.inline.cleanInsideOrParent(s,i),r.detect.isFirefox()&&r.core.editor().find(t+":empty").remove()}),this.selection.restoreInstant()},cleanInsideOrParent:function(e,t){if(t)for(var i in t.data)this.inline.removeSpecificAttr(e,i,t.data[i])},getClearedNodes:function(){for(var t=this.selection.nodes(),i=[],n=t.length,r=0,o=0;o<n;o++)if(e(t[o]).hasClass("redactor-selection-marker")){r=o+2;break}for(o=0;o<n;o++)o>=r&&!this.utils.isBlockTag(t[o].tagName)&&i.push(t[o]);return i},isConvertableAttr:function(t,i,n){var r=e(t).attr(i);if(r)if("style"===i){for(var o=(n=e.trim(n).replace(/;$/,"")).split(";"),s=0,a=0;a<o.length;a++){var l=o[a].split(":"),c=e.trim(l[0]),d=e.trim(l[1]);if(-1!==c.search(/color/)){var u=e(t).css(c);!u||u!==d&&this.utils.rgb2hex(u)!==d||s++}else e(t).css(c)===d&&s++}if(s===o.length)return 1}else if(r===n)return 1;return 0},isConvertable:function(e,t,i,n){if(t===i){if(!n)return!0;var r=0;for(var o in n.data)r+=this.inline.isConvertableAttr(e,o,n.data[o]);if(r===Object.keys(n.data).length)return!0}return!1},setNodesStriked:function(t,i,n){for(var r=0;r<t.length;r++){var o=t[r].tagName?t[r].tagName.toLowerCase():void 0,s=t[r].parentNode,a=s&&s.tagName?s.tagName.toLowerCase():void 0,l=this.inline.isConvertable(s,a,i,n);l&&e(s).replaceWith(function(){return e("<strike>").append(e(this).contents())}).attr("data-redactor-inline-converted"),(l=this.inline.isConvertable(t[r],o,i,n))&&e(t[r]).replaceWith(function(){return e("<strike>").append(e(this).contents())})}},insertBreakpoint:function(t,i){var n=document.createElement("span");n.id="redactor-inline-breakpoint",n=this.insert.node(n);var r=this.utils.isEndOfElement(t),o=this.utils.getOuterHtml(t),s=r?"":"<"+i+">";o=o.replace(/<span id="redactor-inline-breakpoint"><\/span>/i,"</"+i+">"+s);var a=e(o);return e(t).replaceWith(a),""!==s&&this.utils.cloneAttributes(t,a.last()),a.first()},insertInline:function(e){var t=document.createElement(e);return this.insert.node(t),this.caret.start(t),t},arrangeTag:function(e){var t=["b","bold","i","italic","underline","strikethrough","deleted","superscript","subscript"],i=["strong","strong","em","em","u","del","del","sup","sub"];e=e.toLowerCase();for(var n=0;n<t.length;n++)e===t[n]&&(e=i[n]);return e},getStyleParams:function(e){for(var t={},i=e.trim().replace(/;$/,"").split(";"),n=0;n<i.length;n++){var r=i[n].split(":");r&&(t[r[0].trim()]=r[1].trim())}return t},getParams:function(e,t,i){var n=!1,r="toggle";return"object"==typeof e?(n=e,r=void 0!==t?t:r):void 0!==e&&void 0!==t&&((n={})[e]=t,r=void 0!==i?i:r),!!n&&{func:r,data:n}},setParams:function(t,i){if(i)for(var n in i.data){var r=e(t);"style"===n?(t=this.inline[i.func+"Style"](i.data[n],t),r.attr("data-redactor-style-cache",r.attr("style"))):t="class"===n?this.inline[i.func+"Class"](i.data[n],t):"remove"===i.func?this.inline[i.func+"Attr"](n,t):this.inline[i.func+"Attr"](n,i.data[n],t),"style"===n&&"SPAN"===t.tagName&&r.attr("data-redactor-span",!0)}return t},eachInline:function(e,t){var i,n=void 0===e?this.selection.inlines():[e];if(n)for(var r=0;r<n.length;r++)i=t(n[r])[0];return i},replaceClass:function(t,i){return this.inline.eachInline(i,function(i){return e(i).removeAttr("class").addClass(t)})},toggleClass:function(t,i){return this.inline.eachInline(i,function(i){return e(i).toggleClass(t)})},addClass:function(t,i){return this.inline.eachInline(i,function(i){return e(i).addClass(t)})},removeClass:function(t,i){return this.inline.eachInline(i,function(i){return e(i).removeClass(t)})},removeAllClass:function(t){return this.inline.eachInline(t,function(t){return e(t).removeAttr("class")})},replaceAttr:function(t,i,n){return this.inline.eachInline(n,function(i){return e(i).removeAttr(t).attr(t.value)})},toggleAttr:function(t,i,n){return this.inline.eachInline(n,function(i){return e(i).attr(t)?e(i).removeAttr(t):e(i).attr(t.value)})},addAttr:function(t,i,n){return this.inline.eachInline(n,function(n){return e(n).attr(t,i)})},removeAttr:function(t,i){return this.inline.eachInline(i,function(i){var n=e(i);return n.removeAttr(t),"style"===t&&n.removeAttr("data-redactor-style-cache"),n})},removeAllAttr:function(t){return this.inline.eachInline(t,function(t){for(var i=e(t),n=t.attributes.length,r=0;r<n;r++)i.removeAttr(t.attributes[r].name);return i})},removeSpecificAttr:function(t,i,n){var r=e(t);if("style"===i){var o=n.split(":")[0].trim();r.css(o,""),this.utils.removeEmptyAttr(t,"style")&&r.removeAttr("data-redactor-style-cache")}else r.removeAttr(i)[0]},hasParentStyle:function(e){var t=e.parent();return 1===t.length&&t[0].tagName===e[0].tagName&&t.html()===e[0].outerHTML&&t},addParentStyle:function(t){var i=this.inline.hasParentStyle(t);if(i){var n=this.inline.getStyleParams(t.attr("style"));i.css(n),i.attr("data-redactor-style-cache",i.attr("style")),t.replaceWith(function(){return e(this).contents()})}else t.attr("data-redactor-style-cache",t.attr("style"));return t},replaceStyle:function(t,i){t=this.inline.getStyleParams(t);var n=this;return this.inline.eachInline(i,function(i){var r=e(i);r.removeAttr("style").css(t);var o=r.attr("style");return o&&r.attr("style",o.replace(/"/g,"'")),n.inline.addParentStyle(r)})},toggleStyle:function(t,i){t=this.inline.getStyleParams(t);var n=this;return this.inline.eachInline(i,function(i){var r=e(i);for(var o in t){var s=t[o],a=r.css(o);(a=n.utils.isRgb(a)?n.utils.rgb2hex(a):a.replace(/"/g,""))===(s=n.utils.isRgb(s)?n.utils.rgb2hex(s):s.replace(/"/g,""))?r.css(o,""):r.css(o,s)}var l=r.attr("style");return l&&r.attr("style",l.replace(/"/g,"'")),n.utils.removeEmptyAttr(i,"style")?r.removeAttr("data-redactor-style-cache"):r=n.inline.addParentStyle(r),r})},addStyle:function(t,i){t=this.inline.getStyleParams(t);var n=this;return this.inline.eachInline(i,function(i){var r=e(i);r.css(t);var o=r.attr("style");return o&&r.attr("style",o.replace(/"/g,"'")),n.inline.addParentStyle(r)})},removeStyle:function(t,i){t=this.inline.getStyleParams(t);var n=this;return this.inline.eachInline(i,function(i){var r=e(i);for(var o in t)r.css(o,"");return n.utils.removeEmptyAttr(i,"style")?r.removeAttr("data-redactor-style-cache"):r.attr("data-redactor-style-cache",r.attr("style")),r})},removeAllStyle:function(t){return this.inline.eachInline(t,function(t){return e(t).removeAttr("style").removeAttr("data-redactor-style-cache")})},removeStyleRule:function(t){var i=this.selection.parent(),n=this.selection.inlines();this.buffer.set(),i&&"SPAN"===i.tagName&&this.inline.removeStyleRuleAttr(e(i),t);for(var r=0;r<n.length;r++){var o=n[r],s=e(o);-1==e.inArray(o.tagName.toLowerCase(),this.opts.inlineTags)||s.hasClass("redactor-selection-marker")||this.inline.removeStyleRuleAttr(s,t)}},removeStyleRuleAttr:function(e,t){e.css(t,""),this.utils.removeEmptyAttr(e,"style")?e.removeAttr("data-redactor-style-cache"):e.attr("data-redactor-style-cache",e.attr("style"))},update:function(e,t,i,n){e=this.inline.arrangeTag(e);var r=this.inline.getParams(t,i,n),o=this.selection.inlines(),s=[];if(o)for(var a=0;a<o.length;a++){var l=o[a];"*"!==e&&l.tagName.toLowerCase()!==e||s.push(this.inline.setParams(l,r))}return s},removeFormat:function(){this.selection.save();for(var t=this.inline.getClearedNodes(),i=0;i<t.length;i++)1===t[i].nodeType&&e(t[i]).replaceWith(function(){return e(this).contents()});this.selection.restore()}}},insert:function(){return{set:function(e){this.placeholder.hide(),this.code.set(e),this.focus.end(),this.placeholder.enable()},html:function(t,i){this.placeholder.hide(),this.core.editor().focus();var n=this.selection.block(),r=this.selection.inline();void 0===i&&(i=this.clean.getCurrentType(t,!0),t=this.clean.onPaste(t,i,!0)),t=e.parseHTML(t);var o=e(t).last(),s=this.selection.get(),a=this.selection.range(s);if(a.deleteContents(),this.selection.update(s,a),i.lists){var l=e(t);if(0!==l.length&&("UL"===l[0].tagName||"OL"===l[0].tagName))return void this.insert.appendLists(n,l)}if(i.blocks&&n)if(this.utils.isSelectAll())this.core.editor().html(t),this.focus.end();else{var c=this.utils.breakBlockTag();!1===c?this.insert.placeHtml(t):(e(t).children().last().append(this.marker.get()),"start"===c.type?c.$block.before(t):c.$block.after(t),this.selection.restore(),this.core.editor().find("p").each(function(){""===e.trim(this.innerHTML)&&e(this).remove()}))}else{if(r){var d=e("<div/>").html(t);d.find(r.tagName.toLowerCase()).each(function(){e(this).contents().unwrap()}),t=d.html()}if(this.utils.isSelectAll()){var u=e(this.opts.emptyHtml);this.core.editor().html("").append(u),u.html(t),this.caret.end(u)}else this.insert.placeHtml(t)}this.utils.disableSelectAll(),i.pre&&this.clean.cleanPre(),this.caret.end(o),this.linkify.format()},text:function(t){t=t.toString(),t=e.trim(t);var i=document.createElement("div");if(i.innerHTML=t,void 0!==(t=i.textContent||i.innerText)){this.placeholder.hide(),this.core.editor().focus();var n=this.selection.blocks();if(t=t.replace(/\n/g," "),this.utils.isSelectAll()){var r=e(this.opts.emptyHtml);this.core.editor().html("").append(r),r.html(t),this.caret.end(r)}else{var o=this.selection.get(),s=document.createTextNode(t);if(o.getRangeAt&&o.rangeCount){var a=o.getRangeAt(0);a.deleteContents(),a.insertNode(s),a.setStartAfter(s),a.collapse(!0),this.selection.update(o,a)}n.length>1&&(e(s).wrap("<p>"),this.caret.after(s))}this.utils.disableSelectAll(),this.linkify.format(),this.clean.normalizeCurrentHeading()}},raw:function(e){this.placeholder.hide(),this.core.editor().focus();var t=this.selection.get(),i=this.selection.range(t);i.deleteContents();var n=document.createElement("div");n.innerHTML=e;for(var r,o,s=document.createDocumentFragment();r=n.firstChild;)o=s.appendChild(r);i.insertNode(s),o&&((i=i.cloneRange()).setStartAfter(o),i.collapse(!0),t.removeAllRanges(),t.addRange(i))},node:function(t,i){this.placeholder.hide(),void 0!==this.start&&this.core.editor().focus(),t=t[0]||t;var n=this.selection.block(),r=this.utils.isBlockTag(t.tagName),o=!0;if(this.utils.isSelectAll())r?this.core.editor().html(t):this.core.editor().html(e("<p>").html(t)),this.code.sync();else if(r&&n){var s=this.utils.breakBlockTag();!1===s?this.insert.placeNode(t,i):("start"===s.type?s.$block.before(t):s.$block.after(t),this.core.editor().find("p:empty").remove())}else o=this.insert.placeNode(t,i);return this.utils.disableSelectAll(),o&&this.caret.end(t),t},appendLists:function(t,i){var n,r=e(t),o=this.utils.isEmpty(t.innerHTML);if(o||this.utils.isEndOfElement(t))n=r,i.find("li").each(function(){n.after(this),n=e(this)}),o&&r.remove();else if(this.utils.isStartOfElement(t))i.find("li").each(function(){r.before(this),n=e(this)});else{var s=this.selection.extractEndOfNode(t);r.after(e("<li>").append(s)),r.append(i),n=i}this.marker.remove(),n&&this.caret.end(n),this.linkify.format()},placeHtml:function(t){var i=document.createElement("span");i.id="redactor-insert-marker",i=this.insert.node(i),e(i).before(t),this.selection.restore(),this.caret.after(i),e(i).remove()},placeNode:function(e,t){var i=this.selection.get(),n=this.selection.range(i);if(null==n)return!1;!1!==t&&n.deleteContents(),n.insertNode(e),n.collapse(!1),this.selection.update(i,n)},nodeToPoint:function(t,i){if(this.placeholder.hide(),i=i[0]||i,this.utils.isEmpty())return i=this.utils.isBlock(i)?i:e("<p />").append(i),this.core.editor().html(i),i;var n,r=t.clientX,o=t.clientY;if(document.caretPositionFromPoint){var s=document.caretPositionFromPoint(r,o);(n=document.getSelection().getRangeAt(0)).setStart(s.offsetNode,s.offset),n.collapse(!0),n.insertNode(i)}else if(document.caretRangeFromPoint)(n=document.caretRangeFromPoint(r,o)).insertNode(i);else if(void 0!==document.body.createTextRange){(n=document.body.createTextRange()).moveToPoint(r,o);var a=n.duplicate();a.moveToPoint(r,o),n.setEndPoint("EndToEnd",a),n.select()}return i},nodeToCaretPositionFromPoint:function(e,t){this.insert.nodeToPoint(e,t)},marker:function(){this.marker.insert()}}},keydown:function(){return{init:function(t){if(!this.rtePaste){var i=t.which,n=i>=37&&i<=40;if(this.keydown.ctrl=t.ctrlKey||t.metaKey,this.keydown.parent=this.selection.parent(),this.keydown.current=this.selection.current(),this.keydown.block=this.selection.block(),this.keydown.pre=this.utils.isTag(this.keydown.current,"pre"),this.keydown.blockquote=this.utils.isTag(this.keydown.current,"blockquote"),this.keydown.figcaption=this.utils.isTag(this.keydown.current,"figcaption"),this.keydown.figure=this.utils.isTag(this.keydown.current,"figure"),!1===this.core.callback("keydown",t))return t.preventDefault(),!1;if(this.shortcuts.init(t,i),this.keydown.checkEvents(n,i),this.keydown.setupBuffer(t,i),this.utils.isSelectAll()&&(i===this.keyCode.ENTER||i===this.keyCode.BACKSPACE||i===this.keyCode.DELETE))return t.preventDefault(),this.code.set(this.opts.emptyHtml),void this.events.changeHandler();if(this.keydown.addArrowsEvent(n),this.keydown.setupSelectAll(t,i),this.opts.enterKey||i!==this.keyCode.ENTER){if(this.opts.enterKey&&i===this.keyCode.DOWN&&this.keydown.onArrowDown(),this.opts.enterKey&&i===this.keyCode.UP&&this.keydown.onArrowUp(),("textarea"===this.opts.type||"div"===this.opts.type)&&this.keydown.current&&3===this.keydown.current.nodeType&&e(this.keydown.parent).hasClass("redactor-in")&&this.keydown.wrapToParagraph(),!this.keyup.lastShiftKey&&i===this.keyCode.SPACE&&(t.ctrlKey||t.shiftKey))return t.preventDefault(),this.keydown.onShiftSpace();if(i===this.keyCode.ENTER&&(t.ctrlKey||t.shiftKey))return t.preventDefault(),this.keydown.onShiftEnter(t);if(i===this.keyCode.ENTER&&!t.shiftKey&&!t.ctrlKey&&!t.metaKey)return this.keydown.onEnter(t);if(i===this.keyCode.TAB||t.metaKey&&221===i||t.metaKey&&219===i)return this.keydown.onTab(t,i);if(this.detect.isFirefox()&&i===this.keyCode.BACKSPACE&&this.keydown.block&&"P"===this.keydown.block.tagName&&this.utils.isStartOfElement(this.keydown.block)&&0!==(r=e(this.keydown.block).prev()).length)return t.preventDefault(),r.append(this.marker.get()),r.append(e(this.keydown.block).html()),e(this.keydown.block).remove(),void this.selection.restore();if(i===this.keyCode.BACKSPACE||i===this.keyCode.DELETE){if(this.observe.image&&void 0!==this.observe.image&&0!==e("#redactor-image-box").length){t.preventDefault();var r=this.observe.image.closest("figure, p").prev();return this.image.remove(!1),this.observe.image=!1,void(r&&0!==r.length?this.caret.end(r):this.core.editor().focus())}this.keydown.onBackspaceAndDeleteBefore()}if(i===this.keyCode.DELETE){var o=e(this.keydown.block).next();if(this.utils.isEndOfElement(this.keydown.block)&&0!==o.length&&"FIGURE"===o[0].tagName)return o.remove(),!1;if(this.keydown.block&&"LI"===this.keydown.block.tagName&&this.keydown.block){var s=e(this.keydown.block).parents("ul, ol").last(),a=s.next();if(this.utils.isRedactorParent(s)&&this.utils.isEndOfElement(s)&&0!==a.length&&("UL"===a[0].tagName||"OL"===a[0].tagName))return t.preventDefault(),s.append(a.contents()),a.remove(),!1}if(this.utils.isEndOfElement(this.keydown.block)&&0!==o.length&&"PRE"===o[0].tagName)return e(this.keydown.block).append(o.text()),o.remove(),!1}if(i===this.keyCode.DELETE&&0!==e("#redactor-image-box").length&&this.image.remove(),i===this.keyCode.BACKSPACE){if(this.detect.isFirefox()&&this.line.removeOnBackspace(t),this.list.combineAfterAndBefore(this.keydown.block))return void t.preventDefault();var l=this.selection.block();if(l&&"LI"===l.tagName&&this.utils.isCollapsed()&&this.utils.isStartOfElement())return this.indent.decrease(),void t.preventDefault();this.keydown.removeInvisibleSpace(),this.keydown.removeEmptyListInTable(t)}i!==this.keyCode.BACKSPACE&&i!==this.keyCode.DELETE||this.keydown.onBackspaceAndDeleteAfter(t)}else{t.preventDefault();var c=this.selection.get(),d=this.selection.range(c);d.collapsed||d.deleteContents()}}},onShiftSpace:function(){return this.buffer.set(),this.insert.raw("&nbsp;"),!1},onShiftEnter:function(e){return this.buffer.set(),this.keydown.pre?this.keydown.insertNewLine(e):this.insert.raw("<br>")},onBackspaceAndDeleteBefore:function(){this.utils.saveScroll()},onBackspaceAndDeleteAfter:function(t){setTimeout(e.proxy(function(){this.code.syncFire=!1,this.keydown.removeEmptyLists();var e="";0!==this.opts.keepStyleAttr.length&&(e=","+this.opts.keepStyleAttr.join(",")),this.core.editor().find("*[style]").not("img, figure, iframe, #redactor-image-box, #redactor-image-editter, [data-redactor-style-cache], [data-redactor-span]"+e).removeAttr("style"),this.keydown.formatEmpty(t),this.code.syncFire=!0},this),1)},onEnter:function(t){if(!1===this.core.callback("enter",t))return t.preventDefault(),!1;if(this.keydown.blockquote&&!0===this.keydown.exitFromBlockquote(t))return!1;if(this.keydown.pre)return this.keydown.insertNewLine(t);if(this.keydown.blockquote||this.keydown.figcaption)return this.keydown.insertBreakLine(t);if(this.keydown.figure)setTimeout(e.proxy(function(){this.keydown.replaceToParagraph("FIGURE")},this),1);else if(this.keydown.block){if(setTimeout(e.proxy(function(){this.keydown.replaceToParagraph("DIV")},this),1),"LI"===this.keydown.block.tagName){var i=this.selection.current(),n=e(i).closest("li",this.$editor[0]),r=n.parents("ul,ol",this.$editor[0]).last();if(0!==n.length&&this.utils.isEmpty(n.html())&&0===r.next().length&&this.utils.isEmpty(r.find("li").last().html())){r.find("li").last().remove();var o=e(this.opts.emptyHtml);return r.after(o),this.caret.start(o),!1}}}else if(!this.keydown.block)return this.keydown.insertParagraph(t);this.detect.isFirefox()&&this.utils.isInline(this.keydown.parent)?this.keydown.insertBreakLine(t):setTimeout(e.proxy(function(){var t=this.selection.inline();if(t&&this.utils.isEmpty(t.innerHTML)){var i=this.selection.block();e(t).remove();var n=document.createRange();n.setStart(i,0);var r=document.createTextNode("\u200b");n.insertNode(r),n.setStartAfter(r),n.collapse(!0);var o=window.getSelection();o.removeAllRanges(),o.addRange(n)}},this),1)},checkEvents:function(e,t){e||"click"!==this.core.getEvent()&&"arrow"!==this.core.getEvent()||(this.core.addEvent(!1),this.keydown.checkKeyEvents(t)&&this.buffer.set())},checkKeyEvents:function(t){var i=this.keyCode,n=[i.BACKSPACE,i.DELETE,i.ENTER,i.ESC,i.TAB,i.CTRL,i.META,i.ALT,i.SHIFT];return-1===e.inArray(t,n)},addArrowsEvent:function(e){e&&("click"!==this.core.getEvent()&&"arrow"!==this.core.getEvent()?this.core.addEvent("arrow"):this.core.addEvent(!1))},setupBuffer:function(e,t){return this.keydown.ctrl&&90===t&&!e.shiftKey&&!e.altKey&&this.sBuffer.length?(e.preventDefault(),void this.buffer.undo()):this.keydown.ctrl&&90===t&&e.shiftKey&&!e.altKey&&0!==this.sRebuffer.length?(e.preventDefault(),void this.buffer.redo()):void(this.keydown.ctrl||t!==this.keyCode.SPACE&&t!==this.keyCode.BACKSPACE&&t!==this.keyCode.DELETE&&(t!==this.keyCode.ENTER||e.ctrlKey||e.shiftKey)||this.buffer.set())},exitFromBlockquote:function(t){if(this.utils.isEndOfElement(this.keydown.blockquote)&&-1!==this.clean.removeSpacesHard(e(this.keydown.blockquote).html()).search(/(<br\s?\/?>){1}$/i)){t.preventDefault(),e(this.keydown.blockquote).children().last().filter("br").remove(),e(this.keydown.blockquote).children().last().filter("span").remove();var i=e(this.opts.emptyHtml);return e(this.keydown.blockquote).after(i),this.caret.start(i),!0}},onArrowDown:function(){for(var e=[this.keydown.blockquote,this.keydown.pre,this.keydown.figcaption],t=0;t<e.length;t++)if(e[t])return this.keydown.insertAfterLastElement(e[t]),!1},onArrowUp:function(){for(var e=[this.keydown.blockquote,this.keydown.pre,this.keydown.figcaption],t=0;t<e.length;t++)if(e[t])return this.keydown.insertBeforeFirstElement(e[t]),!1},insertAfterLastElement:function(t){if(this.utils.isEndOfElement(t)){var i=this.core.editor().contents().last();if(0===("FIGCAPTION"===t.tagName?e(this.keydown.block).parent().next():e(this.keydown.block).next()).length)if(0!==i.length||i[0]===t){var n=e(this.opts.emptyHtml);"FIGCAPTION"===t.tagName?e(t).parent().after(n):e(t).after(n),this.caret.start(n)}else this.caret.start(i)}},insertBeforeFirstElement:function(t){if(this.utils.isStartOfElement()&&!(this.core.editor().contents().length>1&&this.core.editor().contents().first()[0]!==t)){var i=e(this.opts.emptyHtml);e(t).before(i),this.caret.start(i)}},onTab:function(e,t){if(!this.opts.tabKey)return!0;var i=this.keydown.block&&"LI"===this.keydown.block.tagName;if(this.utils.isEmpty(this.code.get())||!i&&!this.keydown.pre&&!1===this.opts.tabAsSpaces)return!0;e.preventDefault(),this.buffer.set();var n,r=i&&this.utils.isStartOfElement(this.keydown.block);return this.keydown.pre&&!e.shiftKey?(n=this.opts.preSpaces?document.createTextNode(Array(this.opts.preSpaces+1).join("\xa0")):document.createTextNode("\t"),this.insert.node(n)):!1===this.opts.tabAsSpaces||r?e.metaKey&&219===t?this.indent.decrease():e.metaKey&&221===t?this.indent.increase():e.shiftKey?this.indent.decrease():this.indent.increase():(n=document.createTextNode(Array(this.opts.tabAsSpaces+1).join("\xa0")),this.insert.node(n)),!1},setupSelectAll:function(e,t){this.keydown.ctrl&&65===t?this.utils.enableSelectAll():t===this.keyCode.LEFT_WIN||this.keydown.ctrl||this.utils.disableSelectAll()},insertNewLine:function(e){e.preventDefault();var t=document.createTextNode("\n"),i=this.selection.get(),n=this.selection.range(i);return n.deleteContents(),n.insertNode(t),this.caret.after(t),!1},insertParagraph:function(e){e.preventDefault();var t=document.createElement("p");t.innerHTML="<br>";var i=this.selection.get(),n=this.selection.range(i);return n.deleteContents(),n.insertNode(t),this.caret.start(t),!1},insertBreakLine:function(e){return this.keydown.insertBreakLineProcessing(e)},insertDblBreakLine:function(e){return this.keydown.insertBreakLineProcessing(e,!0)},insertBreakLineProcessing:function(e,t){e.stopPropagation();var i=document.createElement("br");if(this.insert.node(i),!0===t){var n=document.createElement("br");this.insert.node(n),this.caret.after(n)}else this.caret.after(i);return!1},wrapToParagraph:function(){var t=e(this.keydown.current),i=e("<p>").append(t.clone());t.replaceWith(i);var n=e(i).next();void 0!==n[0]&&"BR"===n[0].tagName&&n.remove(),this.caret.end(i)},replaceToParagraph:function(t){var i=this.selection.block(),n=e(i).prev(),r=i.innerHTML.replace(/<br\s?\/?>/gi,"");if(i.tagName===t&&this.utils.isEmpty(r)&&!e(i).hasClass("redactor-in"))return o=document.createElement("p"),e(i).replaceWith(o),this.keydown.setCaretToParagraph(o),!1;if("P"===i.tagName)return e(i).removeAttr("class").removeAttr("style"),this.detect.isIe()&&this.utils.isEmpty(r)&&this.utils.isInline(this.keydown.parent)&&e(i).on("input",e.proxy(function(){var t=this.selection.parent();if(this.utils.isInline(t)){var n=e(t).html();e(i).html(n),this.caret.end(i)}e(i).off("keyup")},this)),!1;if(n.hasClass(this.opts.videoContainerClass)){n.removeAttr("class");var o=document.createElement("p");return n.replaceWith(o),this.keydown.setCaretToParagraph(o),!1}},setCaretToParagraph:function(e){var t=document.createRange();t.setStart(e,0);var i=document.createTextNode("\u200b");t.insertNode(i),t.setStartAfter(i),t.collapse(!0);var n=window.getSelection();n.removeAllRanges(),n.addRange(t)},removeInvisibleSpace:function(){var t=e(this.keydown.current);0===t.text().search(/^\u200B$/g)&&t.remove()},removeEmptyListInTable:function(t){var i=e(this.keydown.current),n=e(this.keydown.parent),r=i.closest("td",this.$editor[0]);if(0!==r.length&&i.closest("li",this.$editor[0])&&1===n.children("li").length){if(!this.utils.isEmpty(i.text()))return;t.preventDefault(),i.remove(),n.remove(),this.caret.start(r)}},removeEmptyLists:function(){var t=function(){""===e.trim(this.innerHTML).replace(/\/t\/n/g,"")&&e(this).remove()};this.core.editor().find("li").each(t),this.core.editor().find("ul, ol").each(t)},formatEmpty:function(t){var i=e.trim(this.core.editor().html());if(this.utils.isEmpty(i))return t.preventDefault(),"inline"===this.opts.type||"pre"===this.opts.type?(this.core.editor().html(this.marker.html()),this.selection.restore()):(this.core.editor().html(this.opts.emptyHtml),this.focus.start()),!1}}},keyup:function(){return{init:function(t){if(!this.rtePaste){var i=t.which;if(this.keyup.block=this.selection.block(),this.keyup.current=this.selection.current(),this.keyup.parent=this.selection.parent(),this.keyup.lastShiftKey=t.shiftKey,!1===this.core.callback("keyup",t))return t.preventDefault(),!1;if(i===this.keyCode.ENTER&&this.keyup.block&&"FIGURE"===this.keyup.block.tagName){var n=e(this.keyup.block).prev();if(0!==n.length&&"FIGURE"===n[0].tagName){var r=this.utils.replaceToTag(n,"p");return void this.caret.start(r)}}if(i===this.keyCode.BACKSPACE||i===this.keyCode.DELETE){if(this.utils.isSelectAll())return this.focus.start(),void this.toolbar.setUnfixed();if(this.keyup.block&&this.keydown.block&&"FIGURE"===this.keyup.block.tagName&&this.utils.isStartOfElement(this.keydown.block)){t.preventDefault(),this.selection.save(),e(this.keyup.block).find("figcaption").remove(),e(this.keyup.block).find("img").first().remove(),this.utils.replaceToTag(this.keyup.block,"p");var o=this.marker.find();return e("html, body").animate({scrollTop:o.position().top+20},500),void this.selection.restore()}if(this.keyup.block&&"P"===this.keyup.block.tagName){var s=e(this.keyup.block).find("img").length;""===e(this.keyup.block).text().replace(/\u200B/g,"")&&0!==s&&this.utils.replaceToTag(this.keyup.block,"figure")}this.keyup.block&&"FIGURE"===this.keyup.block.tagName&&0===e(this.keyup.block).find("img").length&&(this.selection.save(),this.utils.replaceToTag(this.keyup.block,"p"),this.selection.restore())}this.linkify.isKey(i)&&this.linkify.format()}}}},lang:function(){return{load:function(){this.opts.curLang=this.opts.langs[this.opts.lang]},get:function(e){return void 0!==this.opts.curLang[e]?this.opts.curLang[e]:""}}},line:function(){return{insert:function(){this.buffer.set(),this.insert.html(this.line.getLineHtml());var e=this.core.editor().find("#redactor-hr-tmp-id");return e.removeAttr("id"),this.core.callback("insertedLine",e),e},getLineHtml:function(){var e='<hr id="redactor-hr-tmp-id" />';return!this.detect.isFirefox()&&this.utils.isEmpty()&&(e+="<p>"+this.opts.emptyHtml+"</p>"),e},removeOnBackspace:function(t){if(this.utils.isCollapsed()){var i=e(this.selection.block());if(0!==i.length&&this.utils.isStartOfElement(i)){var n=i.prev();n&&0!==n.length&&"HR"===n[0].tagName&&(t.preventDefault(),n.remove())}}}}},link:function(){return{get:function(){return e(this.selection.inlines("a"))},is:function(){var t=this.selection.nodes(),i=e(this.selection.current()).closest("a",this.core.editor()[0]);return!(0===i.length||t.length>1)&&i},unlink:function(e){void 0!==e&&e.preventDefault&&e.preventDefault(),this.buffer.set();var t=this.selection.inlines("a");if(0!==t.length){var i=this.link.replaceLinksToText(t);this.observe.closeAllTooltip(),this.core.callback("deletedLink",i)}},insert:function(t,i){var n=this.link.is();if(!0!==i&&!1===(t=this.link.buildLinkFromObject(n,t)))return!1;if(this.buffer.set(),t=this.core.callback("beforeInsertingLink",t),!1===n){n=e("<a />"),n=this.link.update(n,t);var r=(n=e(this.insert.node(n))).parent();!1===this.utils.isRedactorParent(r)&&n.wrap("<p>"),r.hasClass("redactor-unlink")&&r.replaceWith(function(){return e(this).contents()}),this.caret.after(n),this.core.callback("insertedLink",n)}else n=this.link.update(n,t),this.caret.after(n);return n},update:function(e,t){return e.text(t.text),e.attr("href",t.url),this.link.target(e,t.target),e},target:function(e,t){return t?e.attr("target","_blank"):e.removeAttr("target")},show:function(t){void 0!==t&&t.preventDefault&&t.preventDefault(),this.observe.closeAllTooltip();var i=this.link.is();this.link.buildModal(i);var n=this.link.buildLinkFromElement(i);n.url=this.link.removeSelfHostFromUrl(n.url),this.opts.linkNewTab&&!i&&(n.target=!0),this.link.setModalValues(n),this.modal.show(),this.detect.isDesktop()&&e("#redactor-link-url").focus()},setModalValues:function(t){e("#redactor-link-blank").prop("checked",t.target),e("#redactor-link-url").val(t.url),e("#redactor-link-url-text").val(t.text)},buildModal:function(t){this.modal.load("link",this.lang.get(!1===t?"link-insert":"link-edit"),600),this.modal.getActionButton().text(this.lang.get(!1===t?"insert":"save")).on("click",e.proxy(this.link.callback,this))},callback:function(){var e=this.link.buildLinkFromModal();if(!1===e)return!1;this.modal.close(),this.link.insert(e,!0)},cleanUrl:function(t){
return void 0===t?"":e.trim(t.replace(/[^\W\w\D\d+&\'@#/%?=~_|!:,.;\(\)]/gi,""))},cleanText:function(t){return void 0===t?"":e.trim(t.replace(/(<([^>]+)>)/gi,""))},getText:function(e){return""===e.text&&""!==e.url?this.link.truncateUrl(e.url.replace(/<|>/g,"")):e.text},isUrl:function(e){var t="((xn--)?[\\W\\w\\D\\d]+(-[\\W\\w\\D\\d]+)*\\.)+[\\W\\w]{2,}",i=new RegExp("^(http|ftp|https)://"+t,"i"),n=new RegExp("^"+t,"i"),r=new RegExp(".(html|php)$","i"),o=new RegExp("^/","i"),s=new RegExp("^tel:(.*?)","i");return-1===e.search(i)&&-1!==e.search(n)&&-1===e.search(r)&&"/"!==e.substring(0,1)&&(e="http://"+e),(-1!==e.search(i)||-1!==e.search(r)||-1!==e.search(o)||-1!==e.search(s))&&e},isMailto:function(e){return-1!==e.search("@")&&!1===/(http|ftp|https):\/\//i.test(e)},isEmpty:function(e){return""===e.url||""===e.text&&""===e.url},truncateUrl:function(e){return e.length>this.opts.linkSize?e.substring(0,this.opts.linkSize)+"...":e},parse:function(e){return this.link.isMailto(e.url)?e.url="mailto:"+e.url.replace("mailto:",""):0!==e.url.search("#")&&(e.url=this.link.isUrl(e.url)),!this.link.isEmpty(e)&&!1!==e.url&&e},buildLinkFromModal:function(){var t={};return t.url=this.link.cleanUrl(e("#redactor-link-url").val()),t.text=this.link.cleanText(e("#redactor-link-url-text").val()),t.text=this.link.getText(t),t.target=!!e("#redactor-link-blank").prop("checked"),this.link.parse(t)},buildLinkFromObject:function(e,t){return t.url=this.link.cleanUrl(t.url),t.text=void 0===t.text&&this.selection.is()?this.selection.text():this.link.cleanText(t.text),t.text=this.link.getText(t),t.target=!1===e?t.target:this.link.buildTarget(e),this.link.parse(t)},buildLinkFromElement:function(e){var t={url:"",text:this.selection.is()?this.selection.text():"",target:!1};return!1!==e&&(t.url=e.attr("href"),t.text=e.text(),t.target=this.link.buildTarget(e)),t},buildTarget:function(e){return void 0!==e.attr("target")&&"_blank"===e.attr("target")},removeSelfHostFromUrl:function(e){var t=self.location.href.replace("#","").replace(/\/$/i,"");return e.replace(/^\/\#/,"#").replace(t,"").replace("mailto:","")},replaceLinksToText:function(t){var i,n=e.each(t,function(t,n){var r=e(n),o=e('<span class="redactor-unlink" />').append(r.contents());return r.replaceWith(o),0===t&&(i=o),r});return 1===t.length&&this.selection.isCollapsed()&&this.caret.after(i),n}}},linkify:function(){return{isKey:function(e){return e===this.keyCode.ENTER||e===this.keyCode.SPACE},isLink:function(e){return e.nodeValue.match(this.opts.regexps.linkyoutube)||e.nodeValue.match(this.opts.regexps.linkvimeo)||e.nodeValue.match(this.opts.regexps.linkimage)||e.nodeValue.match(this.opts.regexps.url)},isFiltered:function(t,i){return 3===i.nodeType&&""!==e.trim(i.nodeValue)&&!e(i).parent().is("pre")&&this.linkify.isLink(i)},handler:function(t,i){var n=e(i),r=n.text(),o=r;o=o.match(this.opts.regexps.linkyoutube)||o.match(this.opts.regexps.linkvimeo)?this.linkify.convertVideoLinks(o):o.match(this.opts.regexps.linkimage)?this.linkify.convertImages(o):this.linkify.convertLinks(o),n.before(r.replace(r,o)).remove()},format:function(){if(this.opts.linkify&&!this.utils.isCurrentOrParent("pre")){this.core.editor().find(":not(iframe,img,a,pre,code,.redactor-unlink)").addBack().contents().filter(e.proxy(this.linkify.isFiltered,this)).each(e.proxy(this.linkify.handler,this));var t=this.core.editor().find(".redactor-linkify-object").each(e.proxy(function(t,i){var n=e(i);return n.removeClass("redactor-linkify-object"),""===n.attr("class")&&n.removeAttr("class"),"DIV"===i.tagName?this.linkify.breakBlockTag(n,"video"):"IMG"===i.tagName?this.linkify.breakBlockTag(n,"image"):"A"===i.tagName&&this.core.callback("insertedLink",n),n},this));setTimeout(e.proxy(function(){this.code.sync(),this.core.callback("linkify",t)},this),100)}},breakBlockTag:function(t,i){var n=this.utils.breakBlockTag();if(!1!==n){var r=t;"image"===i&&(r=e("<figure />").append(t)),"start"===n.type?n.$block.before(r):n.$block.after(r),"image"===i&&this.caret.after(r)}},convertVideoLinks:function(e){var t='<div class="'+this.opts.videoContainerClass+' redactor-linkify-object"><iframe class="redactor-linkify-object" width="500" height="281" src="',i='" frameborder="0" allowfullscreen></iframe></div>';return e.match(this.opts.regexps.linkyoutube)&&(e=e.replace(this.opts.regexps.linkyoutube,t+"//www.youtube.com/embed/$1"+i)),e.match(this.opts.regexps.linkvimeo)&&(e=e.replace(this.opts.regexps.linkvimeo,t+"//player.vimeo.com/video/$2"+i)),e},convertImages:function(e){var t=e.match(this.opts.regexps.linkimage);return t?e.replace(e,'<img src="'+t+'" class="redactor-linkify-object" />'):e},convertLinks:function(t){var i=t.match(this.opts.regexps.url);if(!i)return t;for(var n=(i=e.grep(i,function(t,n){return e.inArray(t,i)===n})).length,r=0;r<n;r++){var o=i[r],s=o,a=null!==o.match(/(https?|ftp):\/\//i)?"":"http://";s.length>this.opts.linkSize&&(s=s.substring(0,this.opts.linkSize)+"..."),-1===s.search("%")&&(s=decodeURIComponent(s));var l="\\b";-1!==e.inArray(o.slice(-1),["/","&","="])&&(l="");var c=new RegExp("("+o.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")+l+")","g"),d="";!1!==this.opts.pasteLinkTarget&&(d=' target="'+this.opts.pasteLinkTarget+'"'),t=t.replace(c,'<a href="'+a+e.trim(o)+'"'+d+' class="redactor-linkify-object">'+e.trim(s)+"</a>")}return t}}},list:function(){return{toggle:function(t){if(!this.utils.inBlocks(["table","td","th","tr"])){var i="orderedlist"===t||"ol"===t?"OL":"UL";t="OL"===i?"orderedlist":"unorderedlist";var n=e(this.selection.current()).parentsUntil(".redactor-in","ul, ol").first();if(this.placeholder.hide(),this.buffer.set(),0!==n.length&&n[0].tagName===i&&this.utils.isRedactorParent(n))return this.selection.save(),n.find("ul, ol").each(function(){var t=e(this).closest("li");e(this).find("li").each(function(){e(t).after(this)})}),n.find("ul, ol").remove(),n.find("li").each(function(){return e(this).replaceWith(function(){return e("<p />").append(e(this).contents())})}),n.replaceWith(function(){return e(this).contents()}),void this.selection.restore();this.selection.save(),0!==n.length&&n[0].tagName!==i?n.each(e.proxy(function(e,t){this.utils.replaceToTag(t,i)},this)):document.execCommand("insert"+t),this.selection.restore();var r=this.list.get();if(r){r.find("span").replaceWith(function(){return e(this).contents()}),r.find(this.opts.inlineTags.join(",")).each(function(){e(this).removeAttr("style")});var o=r.parent();this.utils.isRedactorParent(o)&&"LI"!==o[0].tagName&&this.utils.isBlock(o)&&(this.selection.save(),o.replaceWith(o.contents()),this.selection.restore())}else this.selection.block()||document.execCommand("formatblock",!1,"p")}},get:function(){var t=this.selection.current(),i=e(t).closest("ul, ol",this.core.editor()[0]);return 0!==i.length&&i},combineAfterAndBefore:function(t){var i=e(t).prev(),n=e(t).next(),r=t&&"P"===t.tagName&&("<br>"===t.innerHTML||""===t.innerHTML),o=1===i.closest("ol, ul",this.core.editor()[0]).length&&1===n.closest("ol, ul",this.core.editor()[0]).length;return!(!r||!o||(i.children("li").last().append(this.marker.get()),i.append(n.contents()),this.selection.restore(),0))}}},marker:function(){return{get:function(e){e=void 0===e?1:e;var t=document.createElement("span");return t.id="selection-marker-"+e,t.className="redactor-selection-marker",t.innerHTML=this.opts.invisibleSpace,t},html:function(e){return this.utils.getOuterHtml(this.marker.get(e))},find:function(e){return e=void 0===e?1:e,this.core.editor().find("span#selection-marker-"+e)},insert:function(){var e=this.selection.get(),t=this.selection.range(e);this.marker.insertNode(t,this.marker.get(1),!0),t&&!1===t.collapsed&&this.marker.insertNode(t,this.marker.get(2),!1)},remove:function(){this.core.editor().find(".redactor-selection-marker").each(this.marker.iterateRemove)},insertNode:function(t,i,n){var r=this.selection.parent();if(null!==t&&0!==e(r).closest(".redactor-in").length){t=t.cloneRange();try{t.collapse(n),t.insertNode(i)}catch(e){this.focus.start()}}},iterateRemove:function(t,i){var n=e(i),r=n.text().replace(/\u200B/g,"");n.parent()[0],""===r?n.remove():n.replaceWith(function(){return e(this).contents()})}}},modal:function(){return{callbacks:{},templates:function(){this.opts.modal={"image-edit":String()+'<div class="redactor-modal-tab redactor-group" data-title="General"><div id="redactor-image-preview" class="redactor-modal-tab-side"></div><div class="redactor-modal-tab-area"><section><label>'+this.lang.get("title")+'</label><input type="text" id="redactor-image-title" /></section><section><label>'+this.lang.get("caption")+'</label><input type="text" id="redactor-image-caption" aria-label="'+this.lang.get("caption")+'" /></section><section><label>'+this.lang.get("link")+'</label><input type="text" id="redactor-image-link" aria-label="'+this.lang.get("link")+'" /></section><section><label class="redactor-image-position-option">'+this.lang.get("image-position")+'</label><select class="redactor-image-position-option" id="redactor-image-align" aria-label="'+this.lang.get("image-position")+'"><option value="none">'+this.lang.get("none")+'</option><option value="left">'+this.lang.get("left")+'</option><option value="center">'+this.lang.get("center")+'</option><option value="right">'+this.lang.get("right")+'</option></select></section><section><label class="checkbox"><input type="checkbox" id="redactor-image-link-blank" aria-label="'+this.lang.get("link-in-new-tab")+'"> '+this.lang.get("link-in-new-tab")+'</label></section><section><button id="redactor-modal-button-action">'+this.lang.get("insert")+'</button><button id="redactor-modal-button-cancel">'+this.lang.get("cancel")+'</button><button id="redactor-modal-button-delete" class="redactor-modal-button-offset">'+this.lang.get("delete")+"</button></section></div></div>",image:String()+'<div class="redactor-modal-tab" data-title="Upload"><section><div id="redactor-modal-image-droparea"></div></section></div>',file:String()+'<div class="redactor-modal-tab" data-title="Upload"><section><label>'+this.lang.get("filename")+' <span class="desc">('+this.lang.get("optional")+')</span></label><input type="text" id="redactor-filename" aria-label="'+this.lang.get("filename")+'" /><br><br></section><section><div id="redactor-modal-file-upload"></div></section></div>',link:String()+'<div class="redactor-modal-tab" data-title="General"><section><label>URL</label><input type="url" id="redactor-link-url" aria-label="URL" /></section><section><label>'+this.lang.get("text")+'</label><input type="text" id="redactor-link-url-text" aria-label="'+this.lang.get("text")+'" /></section><section><label class="checkbox"><input type="checkbox" id="redactor-link-blank"> '+this.lang.get("link-in-new-tab")+'</label></section><section><button id="redactor-modal-button-action">'+this.lang.get("insert")+'</button><button id="redactor-modal-button-cancel">'+this.lang.get("cancel")+"</button></section></div>"},e.extend(this.opts,this.opts.modal)},addCallback:function(e,t){this.modal.callbacks[e]=t},addTemplate:function(e,t){this.opts.modal[e]=t},getTemplate:function(e){return this.opts.modal[e]},getModal:function(){return this.$modalBody},getActionButton:function(){return this.$modalBody.find("#redactor-modal-button-action")},getCancelButton:function(){return this.$modalBody.find("#redactor-modal-button-cancel")},getDeleteButton:function(){return this.$modalBody.find("#redactor-modal-button-delete")},load:function(e,t,i){void 0!==this.$modalBox&&this.$modalBox.hasClass("open")||(this.modal.templateName=e,this.modal.width=i,this.modal.build(),this.modal.enableEvents(),this.modal.setTitle(t),this.modal.setDraggable(),this.modal.setContent(),void 0!==this.modal.callbacks[e]&&this.modal.callbacks[e].call(this))},show:function(){this.detect.isDesktop()||document.activeElement.blur(),this.selection.save(),this.modal.buildTabber(),this.detect.isMobile()&&(this.modal.width="96%"),setTimeout(e.proxy(this.modal.buildWidth,this),0),e(window).on("resize.redactor-modal",e.proxy(this.modal.buildWidth,this)),this.$modalOverlay.redactorAnimation("fadeIn",{duration:.25}),this.$modalBox.addClass("open").show(),this.$modal.redactorAnimation("fadeIn",{timing:"cubic-bezier(0.175, 0.885, 0.320, 1.105)"},e.proxy(function(){this.utils.saveScroll(),this.utils.disableBodyScroll(),this.core.callback("modalOpened",this.modal.templateName,this.$modal),e(document).off("focusin.modal"),this.$modal.find("input[type=text],input[type=url],input[type=email]").on("keydown.redactor-modal",e.proxy(this.modal.setEnter,this))},this))},buildWidth:function(){var t=e(window).height(),i=e(window).width(),n="number"==typeof this.modal.width;!n&&this.modal.width.match(/%$/)?this.$modal.css({width:this.modal.width,"margin-bottom":"16px"}):parseInt(this.modal.width)>i?this.$modal.css({width:"96%","margin-bottom":"2%"}):(n&&(this.modal.width+="px"),this.$modal.css({width:this.modal.width,"margin-bottom":"16px"}));var r=this.$modal.outerHeight(),o=t/2-r/2+"px";this.detect.isMobile()?o="2%":r>t&&(o="16px"),this.$modal.css("margin-top",o)},buildTabber:function(){this.modal.tabs=this.$modal.find(".redactor-modal-tab"),this.modal.tabs.length<2||(this.modal.$tabsBox=e('<div id="redactor-modal-tabber" />'),e.each(this.modal.tabs,e.proxy(function(t,i){var n=e('<a href="#" rel="'+t+'" />').text(e(i).attr("data-title"));n.on("click",e.proxy(this.modal.showTab,this)),0===t&&n.addClass("active"),this.modal.$tabsBox.append(n)},this)),this.$modalBody.prepend(this.modal.$tabsBox))},showTab:function(t){t.preventDefault();var i=e(t.target),n=i.attr("rel");return this.modal.tabs.hide(),this.modal.tabs.eq(n).show(),e("#redactor-modal-tabber").find("a").removeClass("active"),i.addClass("active"),!1},setTitle:function(e){this.$modalHeader.html(e)},setContent:function(){this.$modalBody.html(this.modal.getTemplate(this.modal.templateName)),this.modal.getCancelButton().on("mousedown",e.proxy(this.modal.close,this))},setDraggable:function(){void 0!==e.fn.draggable&&(this.$modal.draggable({handle:this.$modalHeader}),this.$modalHeader.css("cursor","move"))},setEnter:function(e){13===e.which&&(e.preventDefault(),this.modal.getActionButton().click())},build:function(){this.modal.buildOverlay(),this.$modalBox=e('<div id="redactor-modal-box"/>').hide(),this.$modal=e('<div id="redactor-modal" role="dialog" />'),this.$modalHeader=e('<div id="redactor-modal-header" />'),this.$modalClose=e('<button type="button" id="redactor-modal-close" aria-label="'+this.lang.get("close")+'" />').html("&times;"),this.$modalBody=e('<div id="redactor-modal-body" />'),this.$modal.append(this.$modalHeader),this.$modal.append(this.$modalBody),this.$modal.append(this.$modalClose),this.$modalBox.append(this.$modal),this.$modalBox.appendTo(document.body)},buildOverlay:function(){this.$modalOverlay=e('<div id="redactor-modal-overlay">').hide(),e("body").prepend(this.$modalOverlay)},enableEvents:function(){this.$modalClose.on("mousedown.redactor-modal",e.proxy(this.modal.close,this)),e(document).on("keyup.redactor-modal",e.proxy(this.modal.closeHandler,this)),this.core.editor().on("keyup.redactor-modal",e.proxy(this.modal.closeHandler,this)),this.$modalBox.on("click.redactor-modal",e.proxy(this.modal.close,this))},disableEvents:function(){this.$modalClose.off("mousedown.redactor-modal"),e(document).off("keyup.redactor-modal"),this.core.editor().off("keyup.redactor-modal"),this.$modalBox.off("click\xa7.redactor-modal"),e(window).off("resize.redactor-modal")},closeHandler:function(e){e.which===this.keyCode.ESC&&this.modal.close(!1)},close:function(t){if(t){if("redactor-modal-button-cancel"!==e(t.target).attr("id")&&t.target!==this.$modalClose[0]&&t.target!==this.$modalBox[0])return;t.preventDefault()}this.$modalBox&&(this.selection.restore(),this.modal.disableEvents(),this.utils.enableBodyScroll(),this.utils.restoreScroll(),this.$modalOverlay.redactorAnimation("fadeOut",{duration:.4},e.proxy(function(){this.$modalOverlay.remove()},this)),this.$modal.redactorAnimation("fadeOut",{duration:.3,timing:"cubic-bezier(0.175, 0.885, 0.320, 1.175)"},e.proxy(function(){void 0!==this.$modalBox&&(this.$modalBox.remove(),this.$modalBox=void 0),this.core.callback("modalClosed",this.modal.templateName)},this)))}}},observe:function(){return{load:function(){void 0===this.opts.destroyed&&(this.observe.links(),this.observe.images())},isCurrent:function(t,i){return void 0===i&&(i=e(this.selection.current())),i.is(t)||i.parents(t).length>0},toolbar:function(){this.observe.buttons(),this.observe.dropdowns()},buttons:function(t,i){var n=this.selection.current(),r=this.selection.parent();!1!==t?this.button.setInactiveAll():this.button.setInactiveAll(i),!1!==t||"html"===i?this.utils.isRedactorParent(n)&&("none"!==this.core.editor().css("display")&&(this.utils.isCurrentOrParentHeader()||this.utils.isCurrentOrParent(["table","pre","blockquote","li"])?this.button.disable("horizontalrule"):this.button.enable("horizontalrule")),e.each(this.opts.activeButtonsStates,e.proxy(function(t,i){var o=e(r).closest(t,this.$editor[0]),s=e(n).closest(t,this.$editor[0]);(0===o.length||this.utils.isRedactorParent(o))&&this.utils.isRedactorParent(s)&&(0===o.length&&0===s.closest(t,this.$editor[0]).length||this.button.setActive(i))},this))):-1!==e.inArray(i,this.opts.activeButtons)&&this.button.toggleActive(i)},dropdowns:function(){var t=e("<div />").html(this.selection.html()).find("a").length,i=e(this.selection.current()),n=this.utils.isRedactorParent(i);e.each(this.opts.observe.dropdowns,e.proxy(function(e,r){var o=r.observe,s=o.element,a=r.item,l=void 0!==o["in"]&&o["in"],c=void 0!==o.out&&o.out;i.closest(s).length>0&&n||"a"===s&&0!==t?this.observe.setDropdownProperties(a,l,c):this.observe.setDropdownProperties(a,c,l)},this))},setDropdownProperties:function(e,t,i){i&&void 0!==i.attr&&this.observe.setDropdownAttr(e,i.attr,!0),void 0!==t.attr&&this.observe.setDropdownAttr(e,t.attr),void 0!==t.title&&e.find("span").text(t.title)},setDropdownAttr:function(t,i,n){e.each(i,function(e,i){"class"===e?n?t.removeClass(i):t.addClass(i):n?t.removeAttr(e):t.attr(e,i)})},addDropdown:function(e,t,i){void 0!==i.observe&&(i.item=e,this.opts.observe.dropdowns.push(i))},images:function(){this.opts.imageEditable&&(this.core.editor().addClass("redactor-layer-img-edit"),this.core.editor().find("img").each(e.proxy(function(t,i){var n=e(i);n.closest("a",this.$editor[0]).on("click",function(e){e.preventDefault()}),this.image.setEditable(n)},this)))},links:function(){this.opts.linkTooltip&&this.core.editor().find("a").each(e.proxy(function(t,i){var n=e(i);!0!==n.data("cached")&&(n.data("cached",!0),n.on("touchstart.redactor."+this.uuid+" click.redactor."+this.uuid,e.proxy(this.observe.showTooltip,this)))},this))},getTooltipPosition:function(e){return e.offset()},showTooltip:function(t){var i=e(t.target);if("IMG"!==i[0].tagName&&("A"!==i[0].tagName&&(i=i.closest("a",this.$editor[0])),"A"===i[0].tagName)){var n=i,r=this.observe.getTooltipPosition(n),o=e('<span class="redactor-link-tooltip"></span>'),s=n.attr("href");void 0===s&&(s=""),s.length>24&&(s=s.substring(0,24)+"...");var a=e('<a href="'+n.attr("href")+'" target="_blank" />').html(s).addClass("redactor-link-tooltip-action"),l=e('<a href="#" />').html(this.lang.get("edit")).on("click",e.proxy(this.link.show,this)).addClass("redactor-link-tooltip-action"),c=e('<a href="#" />').html(this.lang.get("unlink")).on("click",e.proxy(this.link.unlink,this)).addClass("redactor-link-tooltip-action");o.append(a).append(" | ").append(l).append(" | ").append(c);var d=parseInt(n.css("line-height"),10),u=Math.ceil((t.pageY-r.top)/d),h=r.top+u*d;o.css({top:h+"px",left:r.left+"px"}),e(".redactor-link-tooltip").remove(),e("body").append(o),this.core.editor().on("touchstart.redactor."+this.uuid+" click.redactor."+this.uuid,e.proxy(this.observe.closeTooltip,this)),e(document).on("touchstart.redactor."+this.uuid+" click.redactor."+this.uuid,e.proxy(this.observe.closeTooltip,this))}},closeAllTooltip:function(){e(".redactor-link-tooltip").remove()},closeTooltip:function(t){var i=(t=t.originalEvent||t).target,n=e(i).closest("a",this.$editor[0]);0!==n.length&&"A"===n[0].tagName&&"A"!==i.tagName||"A"===i.tagName&&this.utils.isRedactorParent(i)||e(i).hasClass("redactor-link-tooltip-action")||(this.observe.closeAllTooltip(),this.core.editor().off("touchstart.redactor."+this.uuid+" click.redactor."+this.uuid,e.proxy(this.observe.closeTooltip,this)),e(document).off("touchstart.redactor."+this.uuid+" click.redactor."+this.uuid,e.proxy(this.observe.closeTooltip,this)))}}},offset:function(){return{get:function(t){var i=this.offset.clone(t);if(!1===i)return 0;var n=document.createElement("div");return n.appendChild(i.cloneContents()),n.innerHTML=n.innerHTML.replace(/<img(.*?[^>])>$/gi,"i"),e.trim(e(n).text()).replace(/[\t\n\r\n]/g,"").replace(/\u200B/g,"").length},clone:function(e){var t=this.selection.get(),i=this.selection.range(t);if(null===i&&void 0===e)return!1;if(!1===(e=void 0===e?this.$editor:e))return!1;e=e[0]||e;var n=i.cloneRange();return n.selectNodeContents(e),n.setEnd(i.endContainer,i.endOffset),n},set:function(e,t){t=void 0===t?e:t,this.focus.is()||this.focus.start();for(var i,n=this.selection.get(),r=this.selection.range(n),o=0,s=document.createTreeWalker(this.$editor[0],NodeFilter.SHOW_TEXT,null,null);null!==(i=s.nextNode());)if((o+=i.nodeValue.length)>e&&(r.setStart(i,i.nodeValue.length+e-o),e=1/0),o>=t){r.setEnd(i,i.nodeValue.length+t-o);break}r.collapse(!1),this.selection.update(n,r)}}},paragraphize:function(){return{load:function(t){return!1===this.opts.paragraphize||"inline"===this.opts.type||"pre"===this.opts.type?t:""===t||"<p></p>"===t?this.opts.emptyHtml:(t+="\n",this.paragraphize.safes=[],this.paragraphize.z=0,t=(t=(t=t.replace(/(<br\s?\/?>){1,}\n?<\/blockquote>/gi,"</blockquote>")).replace(/<\/pre>/gi,"</pre>\n\n")).replace(/<p>\s<br><\/p>/gi,"<p></p>"),t=(t=this.paragraphize.getSafes(t)).replace("<br>","\n"),t=this.paragraphize.convert(t),t=this.paragraphize.clear(t),t=(t=this.paragraphize.restoreSafes(t)).replace(new RegExp("<br\\s?/?>\n?<("+this.opts.paragraphizeBlocks.join("|")+")(.*?[^>])>","gi"),"<p><br /></p>\n<$1$2>"),e.trim(t))},getSafes:function(t){var i=e("<div />").append(t);return i.find("blockquote p").replaceWith(function(){return e(this).append("<br />").contents()}),i.find(this.opts.paragraphizeBlocks.join(", ")).each(e.proxy(function(t,i){return this.paragraphize.z++,this.paragraphize.safes[this.paragraphize.z]=i.outerHTML,e(i).replaceWith("\n#####replace"+this.paragraphize.z+"#####\n\n")},this)),i.find("span.redactor-selection-marker").each(e.proxy(function(t,i){return this.paragraphize.z++,this.paragraphize.safes[this.paragraphize.z]=i.outerHTML,e(i).replaceWith("\n#####replace"+this.paragraphize.z+"#####\n\n")},this)),i.html()},restoreSafes:function(t){return e.each(this.paragraphize.safes,function(e,i){i=void 0!==i?i.replace(/\$/g,"&#36;"):i,t=t.replace("#####replace"+e+"#####",i)}),t},convert:function(t){var i=/\s+/g;t=(t=(t=(t=t.replace(/\r\n/g,"xparagraphmarkerz")).replace(/\n/g,"xparagraphmarkerz")).replace(/\r/g,"xparagraphmarkerz")).replace(i," ");var n=/xparagraphmarkerzxparagraphmarkerz/gi,r=/xparagraphmarkerz/gi;return(t=(t=(t=(t=(t=(t=(t=(t=(t=(t="<p>"+(t=(t=(t=e.trim(t)).replace(n,"</p><p>")).replace(r,"<br>"))+"</p>").replace("<p></p>","")).replace("\r\n\r\n","")).replace(/<\/p><p>/g,"</p>\r\n\r\n<p>")).replace(new RegExp("<br\\s?/?></p>","g"),"</p>")).replace(new RegExp("<p><br\\s?/?>","g"),"<p>")).replace(new RegExp("<p><br\\s?/?>","g"),"<p>")).replace(new RegExp("<br\\s?/?></p>","g"),"</p>")).replace(/<p>&nbsp;<\/p>/gi,"")).replace(/<p>\s?<br>&nbsp;<\/p>/gi,"")).replace(/<p>\s?<br>/gi,"<p>")},clear:function(e){return(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=e.replace(/<p>(.*?)#####replace(.*?)#####\s?<\/p>/gi,"<p>$1</p>#####replace$2#####")).replace(/(<br\s?\/?>){2,}<\/p>/gi,"</p>")).replace(new RegExp("</blockquote></p>","gi"),"</blockquote>")).replace(new RegExp("<p></blockquote>","gi"),"</blockquote>")).replace(new RegExp("<p><blockquote>","gi"),"<blockquote>")).replace(new RegExp("<blockquote></p>","gi"),"<blockquote>")).replace(new RegExp("<p><p ","gi"),"<p ")).replace(new RegExp("<p><p>","gi"),"<p>")).replace(new RegExp("</p></p>","gi"),"</p>")).replace(new RegExp("<p>\\s?</p>","gi"),"")).replace(new RegExp("\n</p>","gi"),"</p>")).replace(new RegExp("<p>\t?\t?\n?<p>","gi"),"<p>")).replace(new RegExp("<p>\t*</p>","gi"),"")}}},paste:function(){return{init:function(t){this.rtePaste=!0;var i=!("pre"!==this.opts.type&&!this.utils.isCurrentOrParent("pre"));this.detect.isDesktop()&&!this.paste.pre&&this.opts.clipboardImageUpload&&this.opts.imageUpload&&this.paste.detectClipboardUpload(t)?this.detect.isIe()&&setTimeout(e.proxy(this.paste.clipboardUpload,this),100):(this.utils.saveScroll(),this.selection.save(),this.paste.createPasteBox(i),e(window).on("scroll.redactor-freeze",e.proxy(function(){e(window).scrollTop(this.saveBodyScroll)},this)),setTimeout(e.proxy(function(){var t=this.paste.getPasteBoxCode(i);this.buffer.set(),this.selection.restore(),this.utils.restoreScroll();var n=this.clean.getCurrentType(t);t=this.clean.onPaste(t,n);var r=this.core.callback("paste",t);t=void 0===r?t:r,this.paste.insert(t,n),this.rtePaste=!1,i&&this.clean.cleanPre(),e(window).off("scroll.redactor-freeze")},this),1))},getPasteBoxCode:function(e){var t=e?this.$pasteBox.val():this.$pasteBox.html();return this.$pasteBox.remove(),t},createPasteBox:function(t){var i={position:"fixed",width:"1px",top:0,left:"-9999px"};this.$pasteBox=t?e("<textarea>").css(i):e("<div>").attr("contenteditable","true").css(i),this.paste.appendPasteBox(),this.$pasteBox.focus()},appendPasteBox:function(){if(this.detect.isIe())this.core.box().append(this.$pasteBox);else{var t=e(".modal-body:visible");t.length>0?t.append(this.$pasteBox):e("body").prepend(this.$pasteBox)}},detectClipboardUpload:function(t){var i=(t=t.originalEvent||t).clipboardData;if(this.detect.isIe()||this.detect.isFirefox())return!1;if(-1!==i.types.indexOf("public.tiff"))return t.preventDefault(),!1;if(i.items&&i.items.length){var n=i.items[0].getAsFile();if(null===n)return!1;var r=new FileReader;return r.readAsDataURL(n),r.onload=e.proxy(this.paste.insertFromClipboard,this),!0}},clipboardUpload:function(){var t=this.$editor.find("img");e.each(t,e.proxy(function(t,i){if(-1!==i.src.search(/^data\:image/i)){var n=window.FormData?new FormData:null;if(window.FormData){this.upload.direct=!0,this.upload.type="image",this.upload.url=this.opts.imageUpload,this.upload.callback=e.proxy(function(t){if(this.detect.isIe())e(i).wrap(e("<figure />"));else{var n=e(i).parent();this.utils.replaceToTag(n,"figure")}i.src=t.url,this.core.callback("imageUpload",e(i),t)},this);var r=this.utils.dataURItoBlob(i.src);n.append("clipboard",1),n.append(this.opts.imageUploadParam,r),this.progress.show(),this.upload.send(n,!1),this.code.sync(),this.rtePaste=!1}}},this))},insertFromClipboard:function(e){var t=window.FormData?new FormData:null;if(window.FormData){this.upload.direct=!0,this.upload.type="image",this.upload.url=this.opts.imageUpload,this.upload.callback=this.image.insert;var i=this.utils.dataURItoBlob(e.target.result);t.append("clipboard",1),t.append(this.opts.imageUploadParam,i),this.progress.show(),this.upload.send(t,e),this.rtePaste=!1}},insert:function(t,i){i.pre?this.insert.raw(t):i.text?this.insert.text(t):this.insert.html(t,i),this.detect.isFirefox()&&this.opts.clipboardImageUpload&&setTimeout(e.proxy(this.paste.clipboardUpload,this),100)}}},placeholder:function(){return{enable:function(){setTimeout(e.proxy(function(){return this.placeholder.isEditorEmpty()?this.placeholder.show():this.placeholder.hide()},this),5)},show:function(){this.core.editor().addClass("redactor-placeholder")},update:function(e){this.opts.placeholder=e,this.core.editor().attr("placeholder",e)},hide:function(){this.core.editor().removeClass("redactor-placeholder")},is:function(){return this.core.editor().hasClass("redactor-placeholder")},init:function(){this.placeholder.enabled()&&(this.utils.isEditorRelative()||this.utils.setEditorRelative(),this.placeholder.build(),this.placeholder.buildPosition(),this.placeholder.enable(),this.placeholder.enableEvents())},enabled:function(){return this.opts.placeholder?this.core.element().attr("placeholder",this.opts.placeholder):this.placeholder.isAttr()},enableEvents:function(){this.core.editor().on("keydown.redactor-placeholder."+this.uuid,e.proxy(this.placeholder.enable,this))},disableEvents:function(){this.core.editor().off(".redactor-placeholder."+this.uuid)},build:function(){this.core.editor().attr("placeholder",this.core.element().attr("placeholder"))},buildPosition:function(){var t=e("<style />");t.addClass("redactor-placeholder-style-tag"),t.html("#"+this.core.id()+".redactor-placeholder::after "+this.placeholder.getPosition()),e("head").append(t)},getPosition:function(){return"{ top: "+this.core.editor().css("padding-top")+"; left: "+this.core.editor().css("padding-left")+"; }"},isEditorEmpty:function(){var t=e.trim(this.core.editor().html()).replace(/[\t\n]/g,""),i=["","<p>\u200b</p>","<p>\u200b<br></p>",this.opts.emptyHtmlRendered];return-1!==e.inArray(t,i)},isAttr:function(){return void 0!==this.core.element().attr("placeholder")&&""!==this.core.element().attr("placeholder")},destroy:function(){this.core.editor().removeAttr("placeholder"),this.placeholder.hide(),this.placeholder.disableEvents(),e(".redactor-placeholder-style-tag").remove()}}},progress:function(){return{$box:null,$bar:null,target:document.body,show:function(){this.progress.is()?this.progress.$box.show():(this.progress.build(),this.progress.$box.redactorAnimation("fadeIn"))},hide:function(){this.progress.is()&&this.progress.$box.redactorAnimation("fadeOut",{duration:.35},e.proxy(this.progress.destroy,this))},update:function(e){this.progress.show(),this.progress.$bar.css("width",e+"%")},is:function(){return null!==this.progress.$box},build:function(){this.progress.$bar=e("<span />"),this.progress.$box=e('<div id="redactor-progress" />'),this.progress.$box.append(this.progress.$bar),e(this.progress.target).append(this.progress.$box)},destroy:function(){this.progress.is()&&this.progress.$box.remove(),this.progress.$box=null,this.progress.$bar=null}}},selection:function(){return{get:function(){return window.getSelection?window.getSelection():document.selection&&"Control"!==document.selection.type?document.selection:null},range:function(e){return void 0===e&&(e=this.selection.get()),e.getRangeAt&&e.rangeCount?e.getRangeAt(0):null},is:function(){return!this.selection.isCollapsed()},isRedactor:function(){var t=this.selection.range();if(null!==t){var i=t.startContainer.parentNode;if(e(i).hasClass("redactor-in")||0!==e(i).parents(".redactor-in").length)return!0}return!1},isCollapsed:function(){var e=this.selection.get();return null!==e&&e.isCollapsed},update:function(e,t){null!==t&&(e.removeAllRanges(),e.addRange(t))},current:function(){var e=this.selection.get();return null!==e&&e.anchorNode},parent:function(){var e=this.selection.current();return null!==e&&e.parentNode},block:function(t){for(t=t||this.selection.current();t;){if(this.utils.isBlockTag(t.tagName))return!e(t).hasClass("redactor-in")&&t;t=t.parentNode}return!1},inline:function(t){for(t=t||this.selection.current();t;){if(this.utils.isInlineTag(t.tagName))return!e(t).hasClass("redactor-in")&&t;t=t.parentNode}return!1},element:function(t){for(t||(t=this.selection.current());t;){if(1===t.nodeType)return!e(t).hasClass("redactor-in")&&t;t=t.parentNode}return!1},prev:function(){return null!==this.selection.current()&&this.selection.current().previousSibling},next:function(){return null!==this.selection.current()&&this.selection.current().nextSibling},blocks:function(t){var i=[],n=this.selection.nodes(t);e.each(n,e.proxy(function(e,t){this.utils.isBlock(t)&&i.push(t)},this));var r=this.selection.block();return 0===i.length&&!1===r?[]:0===i.length&&!1!==r?[r]:i},inlines:function(t){var i=[],n=this.selection.nodes(t);e.each(n,e.proxy(function(e,t){this.utils.isInline(t)&&i.push(t)},this));var r=this.selection.inline();return 0===i.length&&!1===r?[]:0===i.length&&!1!==r?[r]:i},nodes:function(t){var i=void 0===t?[]:e.isArray(t)?t:[t],n=this.selection.get(),r=this.selection.range(n),o=[],s=[];if(this.utils.isCollapsed())o=[this.selection.current()];else{var a=r.startContainer,l=r.endContainer;if(a===l)return[this.selection.parent()];for(;a&&a!==l;)o.push(a=this.selection.nextNode(a));for(a=r.startContainer;a&&a!==r.commonAncestorContainer;)o.unshift(a),a=a.parentNode}return e.each(o,function(t,n){if(n){var r=1===n.nodeType&&n.tagName.toLowerCase();if(e(n).hasClass("redactor-script-tag")||e(n).hasClass("redactor-selection-marker"))return;if(r&&0!==i.length&&-1===e.inArray(r,i))return
;s.push(n)}}),0===s.length?[]:s},nextNode:function(e){if(e.hasChildNodes())return e.firstChild;for(;e&&!e.nextSibling;)e=e.parentNode;return e?e.nextSibling:null},save:function(){this.marker.insert(),this.savedSel=this.core.editor().html()},restore:function(e){var t=this.marker.find(1),i=this.marker.find(2);this.detect.isFirefox()&&this.core.editor().focus(),0!==t.length&&0!==i.length?this.caret.set(t,i):0!==t.length?this.caret.start(t):this.core.editor().focus(),!1!==e&&(this.marker.remove(),this.savedSel=!1)},saveInstant:function(){var e=this.core.editor()[0],t=e.ownerDocument.defaultView.getSelection();if(t.getRangeAt&&t.rangeCount){var i=t.getRangeAt(0),n=i.cloneRange();n.selectNodeContents(e),n.setEnd(i.startContainer,i.startOffset);var r=n.toString().length;return this.saved={start:r,end:r+i.toString().length,node:i.startContainer},this.saved}},restoreInstant:function(e){if(void 0!==e||this.saved){this.saved=void 0!==e?e:this.saved;var t=this.core.editor().find(this.saved.node);if(0===t.length||0!==t.text().trim().replace(/\u200B/g,"").length){var i=this.core.editor()[0],n=i.ownerDocument,r=n.defaultView,o=0,s=n.createRange();s.setStart(i,0),s.collapse(!0);for(var a,l=[i],c=!1,d=!1;!d&&(a=l.pop());)if(3==a.nodeType){var u=o+a.length;!c&&this.saved.start>=o&&this.saved.start<=u&&(s.setStart(a,this.saved.start-o),c=!0),c&&this.saved.end>=o&&this.saved.end<=u&&(s.setEnd(a,this.saved.end-o),d=!0),o=u}else for(var h=a.childNodes.length;h--;)l.push(a.childNodes[h]);var p=r.getSelection();p.removeAllRanges(),p.addRange(s)}else try{(s=document.createRange()).setStart(t[0],0),(p=window.getSelection()).removeAllRanges(),p.addRange(s)}catch(e){}}},node:function(t){e(t).prepend(this.marker.get(1)),e(t).append(this.marker.get(2)),this.selection.restore()},all:function(){this.core.editor().focus();var e=this.selection.get(),t=this.selection.range(e);t.selectNodeContents(this.core.editor()[0]),this.selection.update(e,t)},remove:function(){this.selection.get().removeAllRanges()},replace:function(e){this.insert.html(e)},text:function(){return this.selection.get().toString()},html:function(){var e="",t=this.selection.get();if(t.rangeCount){for(var i=document.createElement("div"),n=t.rangeCount,r=0;r<n;++r)i.appendChild(t.getRangeAt(r).cloneContents());e=this.clean.onGet(i.innerHTML)}return e},extractEndOfNode:function(e){var t=this.selection.get(),i=this.selection.range(t),n=i.cloneRange();return n.selectNodeContents(e),n.setStart(i.endContainer,i.endOffset),n.extractContents()},removeMarkers:function(){this.marker.remove()},marker:function(e){return this.marker.get(e)},markerHtml:function(e){return this.marker.html(e)}}},shortcuts:function(){return{hotkeysSpecialKeys:{8:"backspace",9:"tab",10:"return",13:"return",16:"shift",17:"ctrl",18:"alt",19:"pause",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"insert",46:"del",59:";",61:"=",96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9",106:"*",107:"+",109:"-",110:".",111:"/",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",144:"numlock",145:"scroll",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},hotkeysShiftNums:{"`":"~",1:"!",2:"@",3:"#",4:"$",5:"%",6:"^",7:"&",8:"*",9:"(",0:")","-":"_","=":"+",";":": ","'":'"',",":"<",".":">","/":"?","\\":"|"},init:function(t,i){if(!1===this.opts.shortcuts)return!t.ctrlKey&&!t.metaKey||66!==i&&73!==i||t.preventDefault(),!1;e.each(this.opts.shortcuts,e.proxy(function(e,i){this.shortcuts.build(t,e,i)},this))},build:function(t,i,n){for(var r=e.proxy(function(){this.shortcuts.buildHandler(n)},this),o=i.split(","),s=o.length,a=0;a<s;a++)"string"==typeof o[a]&&this.shortcuts.handler(t,e.trim(o[a]),r)},buildHandler:function(e){var t;"-1"!==e.func.search(/\./)?void 0!==this[(t=e.func.split("."))[0]]&&this[t[0]][t[1]].apply(this,e.params):this[e.func].apply(this,e.params)},handler:function(t,i,n){i=i.toLowerCase().split(" ");var r=this.shortcuts.hotkeysSpecialKeys[t.keyCode],o=String.fromCharCode(t.which).toLowerCase(),s="",a={};e.each(["alt","ctrl","meta","shift"],function(e,i){t[i+"Key"]&&r!==i&&(s+=i+"+")}),r&&(a[s+r]=!0),o&&(a[s+o]=!0,a[s+this.shortcuts.hotkeysShiftNums[o]]=!0,"shift+"===s&&(a[this.shortcuts.hotkeysShiftNums[o]]=!0));for(var l=i.length,c=0;c<l;c++)if(a[i[c]])return t.preventDefault(),n.apply(this,arguments)}}},storage:function(){return{data:[],add:function(e){e.status=!0,e.url=decodeURI(e.url),this.storage.data[e.url]=e},status:function(e,t){this.storage.data[decodeURI(e)].status=t},observe:function(){var t=this;this.core.editor().find("[data-image]").each(function(i,n){t.storage.add({type:"image",node:n,url:n.src,id:e(n).attr("data-image")})}),this.core.editor().find("[data-file]").each(function(i,n){t.storage.add({type:"file",node:n,url:n.href,id:e(n).attr("data-file")})}),this.core.editor().find("[data-s3]").each(function(i,n){var r="IMG"===n.tagName?n.src:n.href;t.storage.add({type:"s3",node:n,url:r,id:e(n).attr("data-s3")})})},changes:function(){for(var e in this.storage.data){var t=this.storage.data[e],i="IMG"===t.node.tagName?"src":"href";0===this.core.editor().find("[data-"+t.type+"]["+i+'="'+t.url+'"]').length?this.storage.status(t.url,!1):this.storage.status(t.url,!0)}return this.storage.data}}},toolbar:function(){return{build:function(){this.button.hideButtons(),this.button.hideButtonsOnMobile(),this.$toolbar=this.toolbar.createContainer(),this.toolbar.append(),this.button.$toolbar=this.$toolbar,this.button.setFormatting(),this.button.load(this.$toolbar),this.toolbar.setOverflow(),this.toolbar.setFixed()},createContainer:function(){return e("<ul>").addClass("redactor-toolbar").attr({id:"redactor-toolbar-"+this.uuid,role:"toolbar"})},append:function(){this.opts.toolbarExternal?(this.$toolbar.addClass("redactor-toolbar-external"),e(this.opts.toolbarExternal).html(this.$toolbar)):"textarea"===this.opts.type?this.$box.prepend(this.$toolbar):this.$element.before(this.$toolbar)},setOverflow:function(){this.opts.toolbarOverflow&&this.$toolbar.addClass("redactor-toolbar-overflow")},setFixed:function(){if(this.opts.toolbarFixed&&!this.opts.toolbarExternal){if(this.opts.toolbarFixedTarget!==document){var t=e(this.opts.toolbarFixedTarget);this.toolbar.toolbarOffsetTop=0===t.length?0:this.core.box().offset().top-t.offset().top}var i=0!==this.core.box().closest(".modal-body").length?1e3:0;setTimeout(e.proxy(function(){var t=this;this.toolbar.observeScroll(!1),this.detect.isDesktop()?e(this.opts.toolbarFixedTarget).on("scroll.redactor."+this.uuid,function(){t.core.editor().height()<100||t.placeholder.isEditorEmpty()||t.toolbar.observeScroll()}):e(this.opts.toolbarFixedTarget).on("scroll.redactor."+this.uuid,function(){t.core.editor().height()<100||t.placeholder.isEditorEmpty()||(t.core.toolbar().hide(),clearTimeout(e.data(this,"scrollCheck")),e.data(this,"scrollCheck",setTimeout(function(){t.core.toolbar().show(),t.toolbar.observeScroll()},250)))})},this),i)}},setUnfixed:function(){this.toolbar.observeScrollDisable()},getBoxTop:function(){return this.opts.toolbarFixedTarget===document?this.core.box().offset().top:this.toolbar.toolbarOffsetTop},observeScroll:function(t){var i=0;!1!==t&&(i=this.opts.toolbarFixedTarget===document?20:0);var n=e(this.opts.toolbarFixedTarget).scrollTop(),r=this.toolbar.getBoxTop();n!==r&&(n+this.opts.toolbarFixedTopOffset+i>r?this.toolbar.observeScrollEnable(n,r):this.toolbar.observeScrollDisable())},observeScrollResize:function(){this.$toolbar.css({width:this.core.box().innerWidth(),left:this.core.box().offset().left})},observeScrollEnable:function(t,i){if(void 0===this.fullscreen||!1!==this.fullscreen.isOpened){var n=i+this.core.box().outerHeight()-32,r=this.core.box().innerWidth(),o=this.detect.isDesktop()?"fixed":"absolute",s=this.detect.isDesktop()?this.opts.toolbarFixedTopOffset:e(this.opts.toolbarFixedTarget).scrollTop()-i+this.opts.toolbarFixedTopOffset,a=this.detect.isDesktop()?this.core.box().offset().left:0;this.opts.toolbarFixedTarget!==document&&(o="absolute",s=this.opts.toolbarFixedTopOffset+e(this.opts.toolbarFixedTarget).scrollTop()-i,a=0),this.$toolbar.addClass("toolbar-fixed-box"),this.$toolbar.css({position:o,width:r,top:s,left:a}),t>n&&e(".redactor-dropdown-"+this.uuid+":visible").hide(),this.toolbar.setDropdownsFixed(),this.$toolbar.css("visibility",t<n?"visible":"hidden"),e(window).on("resize.redactor-toolbar."+this.uuid,e.proxy(this.toolbar.observeScrollResize,this))}else this.toolbar.observeScrollDisable()},observeScrollDisable:function(){this.$toolbar.css({position:"relative",width:"auto",top:0,left:0,visibility:"visible"}),this.toolbar.unsetDropdownsFixed(),this.$toolbar.removeClass("toolbar-fixed-box"),e(window).off("resize.redactor-toolbar."+this.uuid)},setDropdownsFixed:function(){var e=this.opts.toolbarFixedTarget===document&&this.detect.isDesktop()?"fixed":"absolute";this.toolbar.setDropdownPosition(e)},unsetDropdownsFixed:function(){this.toolbar.setDropdownPosition("absolute")},setDropdownPosition:function(t){var i=this;e(".redactor-dropdown-"+this.uuid).each(function(){var n=e(this),r=i.button.get(n.attr("rel")),o="fixed"===t?i.opts.toolbarFixedTopOffset:r.offset().top;n.css({position:t,top:r.innerHeight()+o+"px"})})}}},upload:function(){return{init:function(t,i,n){this.upload.direct=!1,this.upload.callback=n,this.upload.url=i,this.upload.$el=e(t),this.upload.$droparea=e('<div id="redactor-droparea" />'),this.upload.$placeholdler=e('<div id="redactor-droparea-placeholder" />').text(this.lang.get("upload-label")),this.upload.$input=e('<input type="file" name="file" multiple />'),this.upload.$placeholdler.append(this.upload.$input),this.upload.$droparea.append(this.upload.$placeholdler),this.upload.$el.append(this.upload.$droparea),this.upload.$droparea.off("redactor.upload"),this.upload.$input.off("redactor.upload"),this.upload.$droparea.on("dragover.redactor.upload",e.proxy(this.upload.onDrag,this)),this.upload.$droparea.on("dragleave.redactor.upload",e.proxy(this.upload.onDragLeave,this)),this.upload.$input.on("change.redactor.upload",e.proxy(function(e){e=e.originalEvent||e;for(var t=this.upload.$input[0].files.length,i=0;i<t;i++){var n=t-1-i;this.upload.traverseFile(this.upload.$input[0].files[n],e)}},this)),this.upload.$droparea.on("drop.redactor.upload",e.proxy(function(e){e.preventDefault(),this.upload.$droparea.removeClass("drag-hover").addClass("drag-drop"),this.upload.onDrop(e)},this))},directUpload:function(e,t){this.upload.direct=!0,this.upload.traverseFile(e,t)},onDrop:function(e){var t=(e=e.originalEvent||e).dataTransfer.files;if(this.opts.multipleImageUpload)for(var i=t.length,n=0;n<i;n++)this.upload.traverseFile(t[n],e);else this.upload.traverseFile(t[0],e)},traverseFile:function(e,t){if(this.opts.s3)return this.upload.setConfig(e),void this.uploads3.send(e,t);var i=window.FormData?new FormData:null;if(window.FormData){this.upload.setConfig(e);var n="image"===this.upload.type?this.opts.imageUploadParam:this.opts.fileUploadParam;i.append(n,e)}this.progress.show(),!1!==this.core.callback("uploadStart",t,i)&&this.upload.send(i,t)},setConfig:function(e){this.upload.getType(e),this.upload.direct&&(this.upload.url="image"===this.upload.type?this.opts.imageUpload:this.opts.fileUpload,this.upload.callback="image"===this.upload.type?this.image.insert:this.file.insert)},getType:function(e){this.upload.type=-1===this.opts.imageTypes.indexOf(e.type)?"file":"image",null===this.opts.imageUpload&&null!==this.opts.fileUpload&&(this.upload.type="file")},getHiddenFields:function(t,i){return!1===t||"object"!=typeof t?i:(e.each(t,e.proxy(function(t,n){null!==n&&0===n.toString().indexOf("#")&&(n=e(n).val()),i.append(t,n)},this)),i)},send:function(t,i){"image"===this.upload.type?(t=this.utils.appendFields(this.opts.imageUploadFields,t),t=this.utils.appendForms(this.opts.imageUploadForms,t),t=this.upload.getHiddenFields(this.upload.imageFields,t)):(t=this.utils.appendFields(this.opts.fileUploadFields,t),t=this.utils.appendForms(this.opts.fileUploadForms,t),t=this.upload.getHiddenFields(this.upload.fileFields,t));var n=new XMLHttpRequest;n.open("POST",this.upload.url),n.setRequestHeader("X-Requested-With","XMLHttpRequest"),n.onreadystatechange=e.proxy(function(){if(4===n.readyState){var e,t=n.responseText;t=(t=t.replace(/^\[/,"")).replace(/\]$/,"");try{e="string"==typeof t?JSON.parse(t):t}catch(t){e={error:!0}}this.progress.hide(),this.upload.direct||this.upload.$droparea.removeClass("drag-drop"),this.upload.callback(e,this.upload.direct,i)}},this),!1!==this.core.callback("uploadBeforeSend",n)&&n.send(t)},onDrag:function(e){e.preventDefault(),this.upload.$droparea.addClass("drag-hover")},onDragLeave:function(e){e.preventDefault(),this.upload.$droparea.removeClass("drag-hover")},clearImageFields:function(){this.upload.imageFields={}},addImageFields:function(e,t){this.upload.imageFields[e]=t},removeImageFields:function(e){delete this.upload.imageFields[e]},clearFileFields:function(){this.upload.fileFields={}},addFileFields:function(e,t){this.upload.fileFields[e]=t},removeFileFields:function(e){delete this.upload.fileFields[e]}}},uploads3:function(){return{send:function(t,i){this.uploads3.executeOnSignedUrl(t,e.proxy(function(e){this.uploads3.sendToS3(t,e,i)},this))},executeOnSignedUrl:function(e,t){var i=new XMLHttpRequest,n=-1===this.opts.s3.search(/\?/)?"?":"&";i.open("GET",this.opts.s3+n+"name="+e.name+"&type="+e.type,!0),i.overrideMimeType&&i.overrideMimeType("text/plain; charset=x-user-defined");var r=this;i.onreadystatechange=function(){4===this.readyState&&200===this.status&&(r.progress.show(),t(decodeURIComponent(this.responseText)))},i.send()},createCORSRequest:function(e,t){var i=new XMLHttpRequest;return"withCredentials"in i?i.open(e,t,!0):"undefined"!=typeof XDomainRequest?(i=new XDomainRequest).open(e,t):i=null,i},sendToS3:function(t,i,n){var r=this.uploads3.createCORSRequest("PUT",i);r&&(r.onload=e.proxy(function(){var e;if(this.progress.hide(),200!==r.status)return e={error:!0},void this.upload.callback(e,this.upload.direct,r);var t=i.split("?");if(!t[0])return!1;if(this.upload.direct||this.upload.$droparea.removeClass("drag-drop"),e={url:t[0],id:t[0],s3:!0},"file"===this.upload.type){var o=t[0].split("/");e.name=o[o.length-1]}this.upload.callback(e,this.upload.direct,n)},this),r.onerror=function(){},r.upload.onprogress=function(){},r.setRequestHeader("Content-Type",t.type),r.setRequestHeader("x-amz-acl","public-read"),r.send(t))}}},utils:function(){return{isEmpty:function(t){return t=(t=(t=(t=(t=(t=(t=(t=(t=(t=void 0===t?this.core.editor().html():t).replace(/[\u200B-\u200D\uFEFF]/g,"")).replace(/&nbsp;/gi,"")).replace(/<\/?br\s?\/?>/g,"")).replace(/\s/g,"")).replace(/^<p>[^\W\w\D\d]*?<\/p>$/i,"")).replace(/<iframe(.*?[^>])>$/i,"iframe")).replace(/<source(.*?[^>])>$/i,"source")).replace(/<[^\/>][^>]*><\/[^>]+>/gi,"")).replace(/<[^\/>][^>]*><\/[^>]+>/gi,""),""===e.trim(t)},isElement:function(e){try{return e instanceof HTMLElement}catch(t){return"object"==typeof e&&1===e.nodeType&&"object"==typeof e.style&&"object"==typeof e.ownerDocument}},strpos:function(e,t,i){var n=e.indexOf(t,i);return n>=0&&n},dataURItoBlob:function(e){var t;t=e.split(",")[0].indexOf("base64")>=0?atob(e.split(",")[1]):unescape(e.split(",")[1]);for(var i=e.split(",")[0].split(":")[1].split(";")[0],n=new Uint8Array(t.length),r=0;r<t.length;r++)n[r]=t.charCodeAt(r);return new Blob([n],{type:i})},getOuterHtml:function(t){return e("<div>").append(e(t).eq(0).clone()).html()},cloneAttributes:function(t,i){t=t[0]||t,i=e(i);for(var n=t.attributes,r=n.length;r--;){var o=n[r];i.attr(o.name,o.value)}return i},breakBlockTag:function(){var t=this.selection.block();if(!t)return!1;var i=this.utils.isEmpty(t.innerHTML),n=t.tagName.toLowerCase();if("pre"===n||"li"===n||"td"===n||"th"===n)return!1;if(!i&&this.utils.isStartOfElement(t))return{$block:e(t),$next:e(t).next(),type:"start"};if(!i&&this.utils.isEndOfElement(t))return{$block:e(t),$next:e(t).next(),type:"end"};var r=this.selection.extractEndOfNode(t),o=e("<"+n+" />").append(r);return o=this.utils.cloneAttributes(t,o),e(t).after(o),{$block:e(t),$next:o,type:"break"}},inBlocks:function(t){t=e.isArray(t)?t:[t];for(var i=this.selection.blocks(),n=i.length,r=!1,o=0;o<n;o++)if(!1!==i[o]){var s=i[o].tagName.toLowerCase();-1!==e.inArray(s,t)&&(r=!0)}return r},inInlines:function(t){t=e.isArray(t)?t:[t];for(var i=this.selection.inlines(),n=i.length,r=!1,o=0;o<n;o++){var s=i[o].tagName.toLowerCase();-1!==e.inArray(s,t)&&(r=!0)}return r},isTag:function(t,i){var n=e(t).closest(i,this.core.editor()[0]);return 1===n.length&&n[0]},isBlock:function(e){return null!==e&&(e=e[0]||e)&&this.utils.isBlockTag(e.tagName)},isBlockTag:function(e){return void 0!==e&&this.reIsBlock.test(e)},isInline:function(e){return(e=e[0]||e)&&this.utils.isInlineTag(e.tagName)},isInlineTag:function(e){return void 0!==e&&this.reIsInline.test(e)},isRedactorParent:function(t){return!!t&&0!==e(t).parents(".redactor-in").length&&!e(t).hasClass("redactor-in")&&t},isCurrentOrParentHeader:function(){return this.utils.isCurrentOrParent(["H1","H2","H3","H4","H5","H6"])},isCurrentOrParent:function(t){var i=this.selection.parent(),n=this.selection.current();if(e.isArray(t)){var r=0;return e.each(t,e.proxy(function(e,t){this.utils.isCurrentOrParentOne(n,i,t)&&r++},this)),0!==r}return this.utils.isCurrentOrParentOne(n,i,t)},isCurrentOrParentOne:function(e,t,i){return i=i.toUpperCase(),t&&t.tagName===i?t:!(!e||e.tagName!==i)&&e},isEditorRelative:function(){var t=this.core.editor().css("position"),i=["absolute","fixed","relative"];return-1!==e.inArray(i,t)},setEditorRelative:function(){this.core.editor().addClass("redactor-relative")},getScrollTarget:function(){var t=e(this.opts.scrollTarget);return 0!==t.length?t:e(document)},freezeScroll:function(){this.freezeScrollTop=this.utils.getScrollTarget().scrollTop(),this.utils.getScrollTarget().scrollTop(this.freezeScrollTop)},unfreezeScroll:function(){void 0!==this.freezeScrollTop&&this.utils.getScrollTarget().scrollTop(this.freezeScrollTop)},saveScroll:function(){this.tmpScrollTop=this.utils.getScrollTarget().scrollTop()},restoreScroll:function(){void 0!==this.tmpScrollTop&&this.utils.getScrollTarget().scrollTop(this.tmpScrollTop)},isStartOfElement:function(e){return!(void 0===e&&!(e=this.selection.block()))&&0===this.offset.get(e)},isEndOfElement:function(t){if(void 0===t&&!(t=this.selection.block()))return!1;var i=e.trim(e(t).text()).replace(/[\t\n\r\n]/g,"").replace(/\u200B/g,"");return this.offset.get(t)===i.length},removeEmptyAttr:function(t,i){var n=e(t);return void 0===n.attr(i)||""===n.attr(i)&&(n.removeAttr(i),!0)},replaceToTag:function(t,i){var n;return e(t).replaceWith(function(){n=e("<"+i+" />").append(e(this).contents());for(var t=0;t<this.attributes.length;t++)n.attr(this.attributes[t].name,this.attributes[t].value);return n}),n},isSelectAll:function(){return this.selectAll},enableSelectAll:function(){this.selectAll=!0},disableSelectAll:function(){this.selectAll=!1},disableBodyScroll:function(){var t=e("html"),i=window.innerWidth;if(!i){var n=document.documentElement.getBoundingClientRect();i=n.right-Math.abs(n.left)}var r=document.body.clientWidth<i,o=this.utils.measureScrollbar();t.css("overflow","hidden"),r&&t.css("padding-right",o)},measureScrollbar:function(){var t=e("body"),i=document.createElement("div");i.className="redactor-scrollbar-measure",t.append(i);var n=i.offsetWidth-i.clientWidth;return t[0].removeChild(i),n},enableBodyScroll:function(){e("html").css({overflow:"","padding-right":""}),e("body").remove("redactor-scrollbar-measure")},appendFields:function(t,i){if(!t)return i;if("object"==typeof t)return e.each(t,function(t,n){null!==n&&0===n.toString().indexOf("#")&&(n=e(n).val()),i.append(t,n)}),i;var n=e(t);return 0===n.length?i:(n.each(function(){i.append(e(this).attr("name"),e(this).val())}),i)},appendForms:function(t,i){if(!t)return i;var n=e(t);if(0===n.length)return i;var r=n.serializeArray();return e.each(r,function(e,t){i.append(t.name,t.value)}),i},isRgb:function(e){return 0===e.search(/^rgb/i)},rgb2hex:function(e){return(e=e.match(/^rgba?[\s+]?\([\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?/i))&&4===e.length?"#"+("0"+parseInt(e[1],10).toString(16)).slice(-2)+("0"+parseInt(e[2],10).toString(16)).slice(-2)+("0"+parseInt(e[3],10).toString(16)).slice(-2):""},isCollapsed:function(){return this.selection.isCollapsed()},isMobile:function(){return this.detect.isMobile()},isDesktop:function(){return this.detect.isDesktop()},isPad:function(){return this.detect.isIpad()}}},browser:function(){return{webkit:function(){return this.detect.isWebkit()},ff:function(){return this.detect.isFirefox()},ie:function(){return this.detect.isIe()}}}},e(window).on("load.tools.redactor",function(){e('[data-tools="redactor"]').redactor()}),t.prototype.init.prototype=t.prototype}(jQuery),function(e){function t(t,i,n,r){var o={duration:.5,iterate:1,delay:0,prefix:"redactor-",timing:"linear"};this.animation=i,this.slide="slideDown"===this.animation||"slideUp"===this.animation,this.$element=e(t),this.prefixes=["","-moz-","-o-animation-","-webkit-"],this.queue=[],"function"==typeof n?(r=n,this.opts=o):this.opts=e.extend(o,n),this.slide&&this.$element.height(this.$element.height()),this.init(r)}e.fn.redactorAnimation=function(e,i,n){return this.each(function(){new t(this,e,i,n)})},t.prototype={init:function(e){this.queue.push(this.animation),this.clean(),"show"===this.animation?(this.opts.timing="linear",this.$element.removeClass("hide").show(),"function"==typeof e&&e(this)):"hide"===this.animation?(this.opts.timing="linear",this.$element.hide(),"function"==typeof e&&e(this)):this.animate(e)},animate:function(t){this.$element.addClass("redactor-animated").css("display","").removeClass("hide"),this.$element.addClass(this.opts.prefix+this.queue[0]),this.set(this.opts.duration+"s",this.opts.delay+"s",this.opts.iterate,this.opts.timing);var i=this.queue.length>1?null:t;this.complete("AnimationEnd",e.proxy(function(){this.$element.hasClass(this.opts.prefix+this.queue[0])&&(this.clean(),this.queue.shift(),this.queue.length&&this.animate(t))},this),i)},set:function(e,t,i,n){for(var r=this.prefixes.length;r--;)this.$element.css(this.prefixes[r]+"animation-duration",e),this.$element.css(this.prefixes[r]+"animation-delay",t),this.$element.css(this.prefixes[r]+"animation-iteration-count",i),this.$element.css(this.prefixes[r]+"animation-timing-function",n)},clean:function(){this.$element.removeClass("redactor-animated"),this.$element.removeClass(this.opts.prefix+this.queue[0]),this.set("","","","")},complete:function(t,i,n){this.$element.one(t.toLowerCase()+" webkit"+t+" o"+t+" MS"+t,e.proxy(function(){"function"==typeof i&&i(),"function"==typeof n&&n(this);var t=["fadeOut","slideUp","zoomOut","slideOutUp","slideOutRight","slideOutLeft"];-1!==e.inArray(this.animation,t)&&this.$element.css("display","none"),this.slide&&this.$element.css("height","")},this))}}}(jQuery),jQuery.Redactor.prototype.alignment=function(){return{langs:{en:{align:"Align","align-left":"Align Left","align-center":"Align Center","align-right":"Align Right","align-justify":"Align Justify"}},init:function(){var e=this,t={};t.left={title:e.lang.get("align-left"),func:e.alignment.setLeft},t.center={title:e.lang.get("align-center"),func:e.alignment.setCenter},t.right={title:e.lang.get("align-right"),func:e.alignment.setRight},t.justify={title:e.lang.get("align-justify"),func:e.alignment.setJustify};var i=this.button.add("alignment",this.lang.get("align"));this.button.setIcon(i,'<i class="re-icon-alignment"></i>'),this.button.addDropdown(i,t)},removeAlign:function(){this.block.removeClass("text-center"),this.block.removeClass("text-right")},setLeft:function(){this.buffer.set(),this.alignment.removeAlign()},setCenter:function(){this.buffer.set(),this.alignment.removeAlign(),this.block.addClass("text-center")},setRight:function(){this.buffer.set(),this.alignment.removeAlign(),this.block.addClass("text-right")},setJustify:function(){this.buffer.set(),this.alignment.removeAlign(),this.block.addClass("text-justify")}}},function(e){e.Redactor.prototype.filemanager=function(){return{langs:{en:{upload:"Upload",choose:"Choose"}},init:function(){this.opts.fileManagerJson&&this.modal.addCallback("file",this.filemanager.load)},load:function(){var t=e('<div  style="overflow: auto; height: 300px; display: none;" class="redactor-modal-tab" data-title="Choose">').hide();this.modal.getModal().append(t),e.ajax({dataType:"json",cache:!1,url:this.opts.fileManagerJson,success:e.proxy(function(i){var n=e('<ul id="redactor-modal-list">');e.each(i,e.proxy(function(t,i){var r=e('<a href="#" data-params="'+encodeURI(JSON.stringify(i))+'" class="redactor-file-manager-link">'+i.title+' <span style="font-size: 11px; color: #888;">'+i.name+'</span> <span style="position: absolute; right: 10px; font-size: 11px; color: #888;">('+i.size+")</span></a>"),o=e("<li />");r.on("click",e.proxy(this.filemanager.insert,this)),o.append(r),n.append(o)},this)),t.append(n)},this)})},insert:function(t){t.preventDefault();var i=e(t.target).closest(".redactor-file-manager-link"),n=e.parseJSON(decodeURI(i.attr("data-params")));this.file.insert(n,null)}}}}(jQuery),function(e){e.Redactor.prototype.imagemanager=function(){return{langs:{en:{upload:"Upload",choose:"Choose"}},init:function(){this.opts.imageManagerJson&&this.modal.addCallback("image",this.imagemanager.load)},load:function(){var t=e('<div style="overflow: auto; height: 300px; display: none;" class="redactor-modal-tab" data-title="Choose">');this.modal.getModal().append(t),e.ajax({dataType:"json",cache:!1,url:this.opts.imageManagerJson,success:e.proxy(function(i){e.each(i,e.proxy(function(i,n){"undefined"!=typeof n.title&&n.title;var r=e('<img src="'+n.thumb+'"  data-params="'+encodeURI(JSON.stringify(n))+'" style="width: 100px; height: 75px; cursor: pointer;" />');t.append(r),e(r).click(e.proxy(this.imagemanager.insert,this))},this))},this)})},insert:function(t){var i=e(t.target),n=e.parseJSON(decodeURI(i.attr("data-params")));this.image.insert(n,null)}}}}(jQuery),function(e){e.Redactor.prototype.table=function(){return{langs:{en:{table:"Table","insert-table":"Insert table","insert-row-above":"Insert row above","insert-row-below":"Insert row below","insert-column-left":"Insert column left","insert-column-right":"Insert column right","add-head":"Add head","delete-head":"Delete head","delete-column":"Delete column","delete-row":"Delete row","delete-table":"Delete table"}},init:function(){var e={};e.insert_table={title:this.lang.get("insert-table"),func:this.table.insert,observe:{element:"table","in":{attr:{"class":"redactor-dropdown-link-inactive","aria-disabled":!0}}}},e.insert_row_above={title:this.lang.get("insert-row-above"),func:this.table.addRowAbove,observe:{element:"table",out:{attr:{"class":"redactor-dropdown-link-inactive","aria-disabled":!0}}}},e.insert_row_below={title:this.lang.get("insert-row-below"),func:this.table.addRowBelow,observe:{element:"table",out:{attr:{"class":"redactor-dropdown-link-inactive","aria-disabled":!0}}}},e.insert_column_left={title:this.lang.get("insert-column-left"),func:this.table.addColumnLeft,observe:{element:"table",out:{attr:{"class":"redactor-dropdown-link-inactive","aria-disabled":!0}}}},e.insert_column_right={title:this.lang.get("insert-column-right"),func:this.table.addColumnRight,observe:{element:"table",out:{attr:{"class":"redactor-dropdown-link-inactive","aria-disabled":!0}}}},e.add_head={title:this.lang.get("add-head"),func:this.table.addHead,observe:{element:"table",out:{attr:{"class":"redactor-dropdown-link-inactive","aria-disabled":!0}}}},e.delete_head={title:this.lang.get("delete-head"),func:this.table.deleteHead,observe:{element:"table",out:{attr:{"class":"redactor-dropdown-link-inactive","aria-disabled":!0}}}},e.delete_column={title:this.lang.get("delete-column"),func:this.table.deleteColumn,observe:{element:"table",out:{attr:{"class":"redactor-dropdown-link-inactive","aria-disabled":!0}}}},e.delete_row={title:this.lang.get("delete-row"),func:this.table.deleteRow,observe:{element:"table",out:{attr:{"class":"redactor-dropdown-link-inactive","aria-disabled":!0}}}},e.delete_table={title:this.lang.get("delete-table"),func:this.table.deleteTable,observe:{element:"table",out:{attr:{"class":"redactor-dropdown-link-inactive","aria-disabled":!0}}}};var t=this.button.addBefore("link","table",this.lang.get("table"));this.button.setIcon(t,'<i class="re-icon-table"></i>'),this.button.addDropdown(t,e)},insert:function(){if(!this.table.getTable()){this.placeholder.hide();for(var t=2,i=3,n=e("<div>"),r=e("<table />"),o=0;o<t;o++){for(var s=e("<tr>"),a=0;a<i;a++){var l=e("<td>"+this.opts.invisibleSpace+"</td>");0===o&&0===a&&l.append(this.marker.get()),e(s).append(l)}r.append(s)}n.append(r);var c=n.html();this.buffer.set();var d=this.selection.current();0!==e(d).closest("li",this.core.editor()[0]).length?e(d).closest("ul, ol").first().after(c):(this.air.collapsed(),this.insert.html(c)),this.selection.restore(),this.core.callback("insertedTable",r)}},getTable:function(){var t=e(this.selection.current()).closest("table");return!!this.utils.isRedactorParent(t)&&(0!==t.length&&t)},restoreAfterDelete:function(e){this.selection.restore(),e.find("span.redactor-selection-marker").remove()},deleteTable:function(){var e=this.table.getTable();if(e){this.buffer.set();var t=e.next();this.opts.linebreaks||0===t.length?this.caret.after(e):this.caret.start(t),e.remove()}},deleteRow:function(){var t=this.table.getTable();if(t){var i=e(this.selection.current());this.buffer.set();var n=i.closest("tr"),r=n.prev().length?n.prev():n.next();if(r.length){var o=r.children("td, th").first();o.length&&o.prepend(this.marker.get())}n.remove(),this.table.restoreAfterDelete(t)}},deleteColumn:function(){var t=this.table.getTable();if(t){this.buffer.set();var i=e(this.selection.current()).closest("td, th")[0].cellIndex;t.find("tr").each(e.proxy(function(t,n){var r=e(n),o=i-1<0?i+1:i-1;0===t&&r.find("td, th").eq(o).prepend(this.marker.get()),r.find("td, th").eq(i).remove()},this)),this.table.restoreAfterDelete(t)}},addHead:function(){var t=this.table.getTable();if(t)if(this.buffer.set(),0===t.find("thead").length){var i=t.find("tr").first().clone();i.find("td").replaceWith(e.proxy(function(){return e("<th>").html(this.opts.invisibleSpace)},this)),$thead=e("<thead></thead>").append(i),t.prepend($thead)}else this.table.deleteHead()},deleteHead:function(){var e=this.table.getTable();if(e){var t=e.find("thead");0!==t.length&&(this.buffer.set(),t.remove())}},addRowAbove:function(){this.table.addRow("before")},addRowBelow:function(){this.table.addRow("after")},addColumnLeft:function(){this.table.addColumn("before")},addColumnRight:function(){this.table.addColumn("after")},addRow:function(t){if(this.table.getTable()){this.buffer.set();var i=e(this.selection.current()).closest("tr"),n=i.clone();n.find("th").replaceWith(function(){var t=e("<td>");return t[0].attributes=this.attributes,t.append(e(this).contents())}),n.find("td").html(this.opts.invisibleSpace),"after"===t?i.after(n):i.before(n)}},addColumn:function(t){var i=this.table.getTable();if(i){var n=0,r=e(this.selection.current());this.buffer.set();var o=r.closest("tr"),s=r.closest("td, th");o.find("td, th").each(e.proxy(function(t,i){e(i)[0]===s[0]&&(n=t)},this)),i.find("tr").each(e.proxy(function(i,r){var o=e(r).find("td, th").eq(n),s=o.clone();s.html(this.opts.invisibleSpace),"after"===t?o.after(s):o.before(s)},this))}}}}}(jQuery),function(e){e.Redactor.prototype.video=function(){return{reUrlYoutube:/https?:\/\/(?:[0-9A-Z-]+\.)?(?:youtu\.be\/|youtube\.com\S*[^\w\-\s])([\w\-]{11})(?=[^\w\-]|$)(?![?=&+%\w.-]*(?:['"][^<>]*>|<\/a>))[?=&+%\w.-]*/gi,reUrlVimeo:/https?:\/\/(www\.)?vimeo.com\/(\d+)($|\/)/,langs:{en:{video:"Video","video-html-code":"Video Embed Code or Youtube/Vimeo Link"}},getTemplate:function(){return String()+'<div class="modal-section" id="redactor-modal-video-insert"><section><label>'+this.lang.get("video-html-code")+'</label><textarea id="redactor-insert-video-area" style="height: 160px;"></textarea></section><section><button id="redactor-modal-button-action">Insert</button><button id="redactor-modal-button-cancel">Cancel</button></section></div>'},init:function(){var e=this.button.addAfter("image","video",this.lang.get("video"));this.button.setIcon(e,'<i class="re-icon-video"></i>'),this.button.addCallback(e,this.video.show)},show:function(){this.modal.addTemplate("video",this.video.getTemplate()),this.modal.load("video",this.lang.get("video"),700),this.modal.getActionButton().text(this.lang.get("insert")).on("click",this.video.insert),
this.modal.show(),this.detect.isDesktop()&&setTimeout(function(){e("#redactor-insert-video-area").focus()},1)},insert:function(){var t=e("#redactor-insert-video-area").val();if(!t.match(/<iframe|<video/gi)){t=this.clean.stripTags(t),this.opts.videoContainerClass="undefined"==typeof this.opts.videoContainerClass?"video-container":this.opts.videoContainerClass;var i='<div class="'+this.opts.videoContainerClass+'"><iframe style="width: 500px; height: 281px;" src="',n='" frameborder="0" allowfullscreen></iframe></div>';t.match(this.video.reUrlYoutube)?t=t.replace(this.video.reUrlYoutube,i+"//www.youtube.com/embed/$1"+n):t.match(this.video.reUrlVimeo)&&(t=t.replace(this.video.reUrlVimeo,i+"//player.vimeo.com/video/$2"+n))}this.modal.close(),this.placeholder.hide(),this.buffer.set(),this.air.collapsed(),this.insert.html(t)}}}}(jQuery),function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.CodeMirror=t()}(this,function(){"use strict";function e(e){return new RegExp("(^|\\s)"+e+"(?:$|\\s)\\s*")}function t(e){for(var t=e.childNodes.length;t>0;--t)e.removeChild(e.firstChild);return e}function i(e,i){return t(e).appendChild(i)}function n(e,t,i,n){var r=document.createElement(e);if(i&&(r.className=i),n&&(r.style.cssText=n),"string"==typeof t)r.appendChild(document.createTextNode(t));else if(t)for(var o=0;o<t.length;++o)r.appendChild(t[o]);return r}function r(e,t,i,r){var o=n(e,t,i,r);return o.setAttribute("role","presentation"),o}function o(e,t){if(3==t.nodeType&&(t=t.parentNode),e.contains)return e.contains(t);do{if(11==t.nodeType&&(t=t.host),t==e)return!0}while(t=t.parentNode)}function s(){var e;try{e=document.activeElement}catch(t){e=document.body||null}for(;e&&e.shadowRoot&&e.shadowRoot.activeElement;)e=e.shadowRoot.activeElement;return e}function a(t,i){var n=t.className;e(i).test(n)||(t.className+=(n?" ":"")+i)}function l(t,i){for(var n=t.split(" "),r=0;r<n.length;r++)n[r]&&!e(n[r]).test(i)&&(i+=" "+n[r]);return i}function c(e){var t=Array.prototype.slice.call(arguments,1);return function(){return e.apply(null,t)}}function d(e,t,i){for(var n in t||(t={}),e)!e.hasOwnProperty(n)||!1===i&&t.hasOwnProperty(n)||(t[n]=e[n]);return t}function u(e,t,i,n,r){null==t&&-1==(t=e.search(/[^\s\u00a0]/))&&(t=e.length);for(var o=n||0,s=r||0;;){var a=e.indexOf("\t",o);if(a<0||a>=t)return s+(t-o);s+=a-o,s+=i-s%i,o=a+1}}function h(e,t){for(var i=0;i<e.length;++i)if(e[i]==t)return i;return-1}function p(e,t,i){for(var n=0,r=0;;){var o=e.indexOf("\t",n);-1==o&&(o=e.length);var s=o-n;if(o==e.length||r+s>=t)return n+Math.min(s,t-r);if(r+=o-n,n=o+1,(r+=i-r%i)>=t)return n}}function f(e){for(;js.length<=e;)js.push(m(js)+" ");return js[e]}function m(e){return e[e.length-1]}function g(e,t){for(var i=[],n=0;n<e.length;n++)i[n]=t(e[n],n);return i}function v(e,t,i){for(var n=0,r=i(t);n<e.length&&i(e[n])<=r;)n++;e.splice(n,0,t)}function b(){}function y(e,t){var i;return Object.create?i=Object.create(e):(b.prototype=e,i=new b),t&&d(t,i),i}function w(e){return/\w/.test(e)||e>"\x80"&&(e.toUpperCase()!=e.toLowerCase()||qs.test(e))}function k(e,t){return t?!!(t.source.indexOf("\\w")>-1&&w(e))||t.test(e):w(e)}function x(e){for(var t in e)if(e.hasOwnProperty(t)&&e[t])return!1;return!0}function _(e){return e.charCodeAt(0)>=768&&Gs.test(e)}function C(e,t,i){for(;(i<0?t>0:t<e.length)&&_(e.charAt(t));)t+=i;return t}function T(e,t,i){for(;;){if(Math.abs(t-i)<=1)return e(t)?t:i;var n=Math.floor((t+i)/2);e(n)?i=n:t=n}}function S(e,t,i){var o=this;this.input=i,o.scrollbarFiller=n("div",null,"CodeMirror-scrollbar-filler"),o.scrollbarFiller.setAttribute("cm-not-content","true"),o.gutterFiller=n("div",null,"CodeMirror-gutter-filler"),o.gutterFiller.setAttribute("cm-not-content","true"),o.lineDiv=r("div",null,"CodeMirror-code"),o.selectionDiv=n("div",null,null,"position: relative; z-index: 1"),o.cursorDiv=n("div",null,"CodeMirror-cursors"),o.measure=n("div",null,"CodeMirror-measure"),o.lineMeasure=n("div",null,"CodeMirror-measure"),o.lineSpace=r("div",[o.measure,o.lineMeasure,o.selectionDiv,o.cursorDiv,o.lineDiv],null,"position: relative; outline: none");var s=r("div",[o.lineSpace],"CodeMirror-lines");o.mover=n("div",[s],null,"position: relative"),o.sizer=n("div",[o.mover],"CodeMirror-sizer"),o.sizerWidth=null,o.heightForcer=n("div",null,null,"position: absolute; height: "+Bs+"px; width: 1px;"),o.gutters=n("div",null,"CodeMirror-gutters"),o.lineGutter=null,o.scroller=n("div",[o.sizer,o.heightForcer,o.gutters],"CodeMirror-scroll"),o.scroller.setAttribute("tabIndex","-1"),o.wrapper=n("div",[o.scrollbarFiller,o.gutterFiller,o.scroller],"CodeMirror"),fs&&ms<8&&(o.gutters.style.zIndex=-1,o.scroller.style.paddingRight=0),gs||ds&&Ts||(o.scroller.draggable=!0),e&&(e.appendChild?e.appendChild(o.wrapper):e(o.wrapper)),o.viewFrom=o.viewTo=t.first,o.reportedViewFrom=o.reportedViewTo=t.first,o.view=[],o.renderedView=null,o.externalMeasured=null,o.viewOffset=0,o.lastWrapHeight=o.lastWrapWidth=0,o.updateLineNumbers=null,o.nativeBarWidth=o.barHeight=o.barWidth=0,o.scrollbarsClipped=!1,o.lineNumWidth=o.lineNumInnerWidth=o.lineNumChars=null,o.alignWidgets=!1,o.cachedCharWidth=o.cachedTextHeight=o.cachedPaddingH=null,o.maxLine=null,o.maxLineLength=0,o.maxLineChanged=!1,o.wheelDX=o.wheelDY=o.wheelStartX=o.wheelStartY=null,o.shift=!1,o.selForContextMenu=null,o.activeTouch=null,i.init(o)}function E(e,t){if((t-=e.first)<0||t>=e.size)throw new Error("There is no line "+(t+e.first)+" in the document.");for(var i=e;!i.lines;)for(var n=0;;++n){var r=i.children[n],o=r.chunkSize();if(t<o){i=r;break}t-=o}return i.lines[t]}function $(e,t,i){var n=[],r=t.line;return e.iter(t.line,i.line+1,function(e){var o=e.text;r==i.line&&(o=o.slice(0,i.ch)),r==t.line&&(o=o.slice(t.ch)),n.push(o),++r}),n}function A(e,t,i){var n=[];return e.iter(t,i,function(e){n.push(e.text)}),n}function L(e,t){var i=t-e.height;if(i)for(var n=e;n;n=n.parent)n.height+=i}function N(e){if(null==e.parent)return null;for(var t=e.parent,i=h(t.lines,e),n=t.parent;n;t=n,n=n.parent)for(var r=0;n.children[r]!=t;++r)i+=n.children[r].chunkSize();return i+t.first}function O(e,t){var i=e.first;e:do{for(var n=0;n<e.children.length;++n){var r=e.children[n],o=r.height;if(t<o){e=r;continue e}t-=o,i+=r.chunkSize()}return i}while(!e.lines);for(var s=0;s<e.lines.length;++s){var a=e.lines[s].height;if(t<a)break;t-=a}return i+s}function M(e,t){return t>=e.first&&t<e.first+e.size}function P(e,t){return String(e.lineNumberFormatter(t+e.firstLineNumber))}function I(e,t,i){if(void 0===i&&(i=null),!(this instanceof I))return new I(e,t,i);this.line=e,this.ch=t,this.sticky=i}function R(e,t){return e.line-t.line||e.ch-t.ch}function D(e,t){return e.sticky==t.sticky&&0==R(e,t)}function F(e){return I(e.line,e.ch)}function B(e,t){return R(e,t)<0?t:e}function H(e,t){return R(e,t)<0?e:t}function z(e,t){return Math.max(e.first,Math.min(t,e.first+e.size-1))}function W(e,t){if(t.line<e.first)return I(e.first,0);var i=e.first+e.size-1;return t.line>i?I(i,E(e,i).text.length):U(t,E(e,t.line).text.length)}function U(e,t){var i=e.ch;return null==i||i>t?I(e.line,t):i<0?I(e.line,0):e}function j(e,t){for(var i=[],n=0;n<t.length;n++)i[n]=W(e,t[n]);return i}function q(){Ks=!0}function G(){Vs=!0}function K(e,t,i){this.marker=e,this.from=t,this.to=i}function V(e,t){if(e)for(var i=0;i<e.length;++i){var n=e[i];if(n.marker==t)return n}}function Y(e,t){for(var i,n=0;n<e.length;++n)e[n]!=t&&(i||(i=[])).push(e[n]);return i}function X(e,t){e.markedSpans=e.markedSpans?e.markedSpans.concat([t]):[t],t.marker.attachLine(e)}function Q(e,t,i){var n;if(e)for(var r=0;r<e.length;++r){var o=e[r],s=o.marker;if(null==o.from||(s.inclusiveLeft?o.from<=t:o.from<t)||o.from==t&&"bookmark"==s.type&&(!i||!o.marker.insertLeft)){var a=null==o.to||(s.inclusiveRight?o.to>=t:o.to>t);(n||(n=[])).push(new K(s,o.from,a?null:o.to))}}return n}function Z(e,t,i){var n;if(e)for(var r=0;r<e.length;++r){var o=e[r],s=o.marker;if(null==o.to||(s.inclusiveRight?o.to>=t:o.to>t)||o.from==t&&"bookmark"==s.type&&(!i||o.marker.insertLeft)){var a=null==o.from||(s.inclusiveLeft?o.from<=t:o.from<t);(n||(n=[])).push(new K(s,a?null:o.from-t,null==o.to?null:o.to-t))}}return n}function J(e,t){if(t.full)return null;var i=M(e,t.from.line)&&E(e,t.from.line).markedSpans,n=M(e,t.to.line)&&E(e,t.to.line).markedSpans;if(!i&&!n)return null;var r=t.from.ch,o=t.to.ch,s=0==R(t.from,t.to),a=Q(i,r,s),l=Z(n,o,s),c=1==t.text.length,d=m(t.text).length+(c?r:0);if(a)for(var u=0;u<a.length;++u){var h=a[u];if(null==h.to){var p=V(l,h.marker);p?c&&(h.to=null==p.to?null:p.to+d):h.to=r}}if(l)for(var f=0;f<l.length;++f){var g=l[f];if(null!=g.to&&(g.to+=d),null==g.from)V(a,g.marker)||(g.from=d,c&&(a||(a=[])).push(g));else g.from+=d,c&&(a||(a=[])).push(g)}a&&(a=ee(a)),l&&l!=a&&(l=ee(l));var v=[a];if(!c){var b,y=t.text.length-2;if(y>0&&a)for(var w=0;w<a.length;++w)null==a[w].to&&(b||(b=[])).push(new K(a[w].marker,null,null));for(var k=0;k<y;++k)v.push(b);v.push(l)}return v}function ee(e){for(var t=0;t<e.length;++t){var i=e[t];null!=i.from&&i.from==i.to&&!1!==i.marker.clearWhenEmpty&&e.splice(t--,1)}return e.length?e:null}function te(e,t,i){var n=null;if(e.iter(t.line,i.line+1,function(e){if(e.markedSpans)for(var t=0;t<e.markedSpans.length;++t){var i=e.markedSpans[t].marker;!i.readOnly||n&&-1!=h(n,i)||(n||(n=[])).push(i)}}),!n)return null;for(var r=[{from:t,to:i}],o=0;o<n.length;++o)for(var s=n[o],a=s.find(0),l=0;l<r.length;++l){var c=r[l];if(!(R(c.to,a.from)<0||R(c.from,a.to)>0)){var d=[l,1],u=R(c.from,a.from),p=R(c.to,a.to);(u<0||!s.inclusiveLeft&&!u)&&d.push({from:c.from,to:a.from}),(p>0||!s.inclusiveRight&&!p)&&d.push({from:a.to,to:c.to}),r.splice.apply(r,d),l+=d.length-3}}return r}function ie(e){var t=e.markedSpans;if(t){for(var i=0;i<t.length;++i)t[i].marker.detachLine(e);e.markedSpans=null}}function ne(e,t){if(t){for(var i=0;i<t.length;++i)t[i].marker.attachLine(e);e.markedSpans=t}}function re(e){return e.inclusiveLeft?-1:0}function oe(e){return e.inclusiveRight?1:0}function se(e,t){var i=e.lines.length-t.lines.length;if(0!=i)return i;var n=e.find(),r=t.find(),o=R(n.from,r.from)||re(e)-re(t);if(o)return-o;var s=R(n.to,r.to)||oe(e)-oe(t);return s||t.id-e.id}function ae(e,t){var i,n=Vs&&e.markedSpans;if(n)for(var r=void 0,o=0;o<n.length;++o)(r=n[o]).marker.collapsed&&null==(t?r.from:r.to)&&(!i||se(i,r.marker)<0)&&(i=r.marker);return i}function le(e){return ae(e,!0)}function ce(e){return ae(e,!1)}function de(e,t,i,n,r){var o=E(e,t),s=Vs&&o.markedSpans;if(s)for(var a=0;a<s.length;++a){var l=s[a];if(l.marker.collapsed){var c=l.marker.find(0),d=R(c.from,i)||re(l.marker)-re(r),u=R(c.to,n)||oe(l.marker)-oe(r);if(!(d>=0&&u<=0||d<=0&&u>=0)&&(d<=0&&(l.marker.inclusiveRight&&r.inclusiveLeft?R(c.to,i)>=0:R(c.to,i)>0)||d>=0&&(l.marker.inclusiveRight&&r.inclusiveLeft?R(c.from,n)<=0:R(c.from,n)<0)))return!0}}}function ue(e){for(var t;t=le(e);)e=t.find(-1,!0).line;return e}function he(e){for(var t;t=ce(e);)e=t.find(1,!0).line;return e}function pe(e){for(var t,i;t=ce(e);)e=t.find(1,!0).line,(i||(i=[])).push(e);return i}function fe(e,t){var i=E(e,t),n=ue(i);return i==n?t:N(n)}function me(e,t){if(t>e.lastLine())return t;var i,n=E(e,t);if(!ge(e,n))return t;for(;i=ce(n);)n=i.find(1,!0).line;return N(n)+1}function ge(e,t){var i=Vs&&t.markedSpans;if(i)for(var n=void 0,r=0;r<i.length;++r)if((n=i[r]).marker.collapsed){if(null==n.from)return!0;if(!n.marker.widgetNode&&0==n.from&&n.marker.inclusiveLeft&&ve(e,t,n))return!0}}function ve(e,t,i){if(null==i.to){var n=i.marker.find(1,!0);return ve(e,n.line,V(n.line.markedSpans,i.marker))}if(i.marker.inclusiveRight&&i.to==t.text.length)return!0;for(var r=void 0,o=0;o<t.markedSpans.length;++o)if((r=t.markedSpans[o]).marker.collapsed&&!r.marker.widgetNode&&r.from==i.to&&(null==r.to||r.to!=i.from)&&(r.marker.inclusiveLeft||i.marker.inclusiveRight)&&ve(e,t,r))return!0}function be(e){for(var t=0,i=(e=ue(e)).parent,n=0;n<i.lines.length;++n){var r=i.lines[n];if(r==e)break;t+=r.height}for(var o=i.parent;o;o=(i=o).parent)for(var s=0;s<o.children.length;++s){var a=o.children[s];if(a==i)break;t+=a.height}return t}function ye(e){if(0==e.height)return 0;for(var t,i=e.text.length,n=e;t=le(n);){var r=t.find(0,!0);n=r.from.line,i+=r.from.ch-r.to.ch}for(n=e;t=ce(n);){var o=t.find(0,!0);i-=n.text.length-o.from.ch,i+=(n=o.to.line).text.length-o.to.ch}return i}function we(e){var t=e.display,i=e.doc;t.maxLine=E(i,i.first),t.maxLineLength=ye(t.maxLine),t.maxLineChanged=!0,i.iter(function(e){var i=ye(e);i>t.maxLineLength&&(t.maxLineLength=i,t.maxLine=e)})}function ke(e,t,i,n){if(!e)return n(t,i,"ltr");for(var r=!1,o=0;o<e.length;++o){var s=e[o];(s.from<i&&s.to>t||t==i&&s.to==t)&&(n(Math.max(s.from,t),Math.min(s.to,i),1==s.level?"rtl":"ltr"),r=!0)}r||n(t,i,"ltr")}function xe(e,t,i){var n;Ys=null;for(var r=0;r<e.length;++r){var o=e[r];if(o.from<t&&o.to>t)return r;o.to==t&&(o.from!=o.to&&"before"==i?n=r:Ys=r),o.from==t&&(o.from!=o.to&&"before"!=i?n=r:Ys=r)}return null!=n?n:Ys}function _e(e,t){var i=e.order;return null==i&&(i=e.order=Xs(e.text,t)),i}function Ce(e,t,i){var n=C(e.text,t+i,i);return n<0||n>e.text.length?null:n}function Te(e,t,i){var n=Ce(e,t.ch,i);return null==n?null:new I(t.line,n,i<0?"after":"before")}function Se(e,t,i,n,r){if(e){var o=_e(i,t.doc.direction);if(o){var s,a=r<0?m(o):o[0],l=r<0==(1==a.level)?"after":"before";if(a.level>0){var c=Qt(t,i);s=r<0?i.text.length-1:0;var d=Zt(t,c,s).top;s=T(function(e){return Zt(t,c,e).top==d},r<0==(1==a.level)?a.from:a.to-1,s),"before"==l&&(s=Ce(i,s,1))}else s=r<0?a.to:a.from;return new I(n,s,l)}}return new I(n,r<0?i.text.length:0,r<0?"before":"after")}function Ee(e,t,i,n){var r=_e(t,e.doc.direction);if(!r)return Te(t,i,n);i.ch>=t.text.length?(i.ch=t.text.length,i.sticky="before"):i.ch<=0&&(i.ch=0,i.sticky="after");var o=xe(r,i.ch,i.sticky),s=r[o];if("ltr"==e.doc.direction&&s.level%2==0&&(n>0?s.to>i.ch:s.from<i.ch))return Te(t,i,n);var a,l=function(e,i){return Ce(t,e instanceof I?e.ch:e,i)},c=function(i){return e.options.lineWrapping?(a=a||Qt(e,t),gi(e,t,a,i)):{begin:0,end:t.text.length}},d=c("before"==i.sticky?l(i,-1):i.ch);if("rtl"==e.doc.direction||1==s.level){var u=1==s.level==n<0,h=l(i,u?1:-1);if(null!=h&&(u?h<=s.to&&h<=d.end:h>=s.from&&h>=d.begin)){var p=u?"before":"after";return new I(i.line,h,p)}}var f=function(e,t,n){for(var o=function(e,t){return t?new I(i.line,l(e,1),"before"):new I(i.line,e,"after")};e>=0&&e<r.length;e+=t){var s=r[e],a=t>0==(1!=s.level),c=a?n.begin:l(n.end,-1);if(s.from<=c&&c<s.to)return o(c,a);if(c=a?s.from:l(s.to,-1),n.begin<=c&&c<n.end)return o(c,a)}},m=f(o+n,n,d);if(m)return m;var g=n>0?d.end:l(d.begin,-1);return null==g||n>0&&g==t.text.length||!(m=f(n>0?0:r.length-1,n,c(g)))?null:m}function $e(e,t){return e._handlers&&e._handlers[t]||Qs}function Ae(e,t,i){if(e.removeEventListener)e.removeEventListener(t,i,!1);else if(e.detachEvent)e.detachEvent("on"+t,i);else{var n=e._handlers,r=n&&n[t];if(r){var o=h(r,i);o>-1&&(n[t]=r.slice(0,o).concat(r.slice(o+1)))}}}function Le(e,t){var i=$e(e,t);if(i.length)for(var n=Array.prototype.slice.call(arguments,2),r=0;r<i.length;++r)i[r].apply(null,n)}function Ne(e,t,i){return"string"==typeof t&&(t={type:t,preventDefault:function(){this.defaultPrevented=!0}}),Le(e,i||t.type,e,t),De(t)||t.codemirrorIgnore}function Oe(e){var t=e._handlers&&e._handlers.cursorActivity;if(t)for(var i=e.curOp.cursorActivityHandlers||(e.curOp.cursorActivityHandlers=[]),n=0;n<t.length;++n)-1==h(i,t[n])&&i.push(t[n])}function Me(e,t){return $e(e,t).length>0}function Pe(e){e.prototype.on=function(e,t){Zs(this,e,t)},e.prototype.off=function(e,t){Ae(this,e,t)}}function Ie(e){e.preventDefault?e.preventDefault():e.returnValue=!1}function Re(e){e.stopPropagation?e.stopPropagation():e.cancelBubble=!0}function De(e){return null!=e.defaultPrevented?e.defaultPrevented:0==e.returnValue}function Fe(e){Ie(e),Re(e)}function Be(e){return e.target||e.srcElement}function He(e){var t=e.which;return null==t&&(1&e.button?t=1:2&e.button?t=3:4&e.button&&(t=2)),Ss&&e.ctrlKey&&1==t&&(t=3),t}function ze(e){if(null==Rs){var t=n("span","\u200b");i(e,n("span",[t,document.createTextNode("x")])),0!=e.firstChild.offsetHeight&&(Rs=t.offsetWidth<=1&&t.offsetHeight>2&&!(fs&&ms<8))}var r=Rs?n("span","\u200b"):n("span","\xa0",null,"display: inline-block; width: 1px; margin-right: -1px");return r.setAttribute("cm-text",""),r}function We(e){if(null!=Ds)return Ds;var n=i(e,document.createTextNode("A\u062eA")),r=Ls(n,0,1).getBoundingClientRect(),o=Ls(n,1,2).getBoundingClientRect();return t(e),!(!r||r.left==r.right)&&(Ds=o.right-r.right<3)}function Ue(e){if(null!=na)return na;var t=i(e,n("span","x")),r=t.getBoundingClientRect(),o=Ls(t,0,1).getBoundingClientRect();return na=Math.abs(r.left-o.left)>1}function je(e,t){arguments.length>2&&(t.dependencies=Array.prototype.slice.call(arguments,2)),ra[e]=t}function qe(e,t){oa[e]=t}function Ge(e){if("string"==typeof e&&oa.hasOwnProperty(e))e=oa[e];else if(e&&"string"==typeof e.name&&oa.hasOwnProperty(e.name)){var t=oa[e.name];"string"==typeof t&&(t={name:t}),(e=y(t,e)).name=t.name}else{if("string"==typeof e&&/^[\w\-]+\/[\w\-]+\+xml$/.test(e))return Ge("application/xml");if("string"==typeof e&&/^[\w\-]+\/[\w\-]+\+json$/.test(e))return Ge("application/json")}return"string"==typeof e?{name:e}:e||{name:"null"}}function Ke(e,t){t=Ge(t);var i=ra[t.name];if(!i)return Ke(e,"text/plain");var n=i(e,t);if(sa.hasOwnProperty(t.name)){var r=sa[t.name];for(var o in r)r.hasOwnProperty(o)&&(n.hasOwnProperty(o)&&(n["_"+o]=n[o]),n[o]=r[o])}if(n.name=t.name,t.helperType&&(n.helperType=t.helperType),t.modeProps)for(var s in t.modeProps)n[s]=t.modeProps[s];return n}function Ve(e,t){d(t,sa.hasOwnProperty(e)?sa[e]:sa[e]={})}function Ye(e,t){if(!0===t)return t;if(e.copyState)return e.copyState(t);var i={};for(var n in t){var r=t[n];r instanceof Array&&(r=r.concat([])),i[n]=r}return i}function Xe(e,t){for(var i;e.innerMode&&(i=e.innerMode(t))&&i.mode!=e;)t=i.state,e=i.mode;return i||{mode:e,state:t}}function Qe(e,t,i){return!e.startState||e.startState(t,i)}function Ze(e,t,i,n){var r=[e.state.modeGen],o={};st(e,t.text,e.doc.mode,i,function(e,t){return r.push(e,t)},o,n);for(var s=i.state,a=function(n){var s=e.state.overlays[n],a=1,l=0;i.state=!0,st(e,t.text,s.mode,i,function(e,t){for(var i=a;l<e;){var n=r[a];n>e&&r.splice(a,1,e,r[a+1],n),a+=2,l=Math.min(e,n)}if(t)if(s.opaque)r.splice(i,a-i,e,"overlay "+t),a=i+2;else for(;i<a;i+=2){var o=r[i+1];r[i+1]=(o?o+" ":"")+"overlay "+t}},o)},l=0;l<e.state.overlays.length;++l)a(l);return i.state=s,{styles:r,classes:o.bgClass||o.textClass?o:null}}function Je(e,t,i){if(!t.styles||t.styles[0]!=e.state.modeGen){var n=et(e,N(t)),r=t.text.length>e.options.maxHighlightLength&&Ye(e.doc.mode,n.state),o=Ze(e,t,n);r&&(n.state=r),t.stateAfter=n.save(!r),t.styles=o.styles,o.classes?t.styleClasses=o.classes:t.styleClasses&&(t.styleClasses=null),i===e.doc.highlightFrontier&&(e.doc.modeFrontier=Math.max(e.doc.modeFrontier,++e.doc.highlightFrontier))}return t.styles}function et(e,t,i){var n=e.doc,r=e.display;if(!n.mode.startState)return new ca(n,!0,t);var o=at(e,t,i),s=o>n.first&&E(n,o-1).stateAfter,a=s?ca.fromSaved(n,s,o):new ca(n,Qe(n.mode),o);return n.iter(o,t,function(i){tt(e,i.text,a);var n=a.line;i.stateAfter=n==t-1||n%5==0||n>=r.viewFrom&&n<r.viewTo?a.save():null,a.nextLine()}),i&&(n.modeFrontier=a.line),a}function tt(e,t,i,n){var r=e.doc.mode,o=new aa(t,e.options.tabSize,i);for(o.start=o.pos=n||0,""==t&&it(r,i.state);!o.eol();)nt(r,o,i.state),o.start=o.pos}function it(e,t){if(e.blankLine)return e.blankLine(t);if(e.innerMode){var i=Xe(e,t);return i.mode.blankLine?i.mode.blankLine(i.state):void 0}}function nt(e,t,i,n){for(var r=0;r<10;r++){n&&(n[0]=Xe(e,i).mode);var o=e.token(t,i);if(t.pos>t.start)return o}throw new Error("Mode "+e.name+" failed to advance stream.")}function rt(e,t,i,n){var r,o,s=e.doc,a=s.mode,l=E(s,(t=W(s,t)).line),c=et(e,t.line,i),d=new aa(l.text,e.options.tabSize,c);for(n&&(o=[]);(n||d.pos<t.ch)&&!d.eol();)d.start=d.pos,r=nt(a,d,c.state),n&&o.push(new da(d,r,Ye(s.mode,c.state)));return n?o:new da(d,r,c.state)}function ot(e,t){if(e)for(;;){var i=e.match(/(?:^|\s+)line-(background-)?(\S+)/);if(!i)break;e=e.slice(0,i.index)+e.slice(i.index+i[0].length);var n=i[1]?"bgClass":"textClass";null==t[n]?t[n]=i[2]:new RegExp("(?:^|s)"+i[2]+"(?:$|s)").test(t[n])||(t[n]+=" "+i[2])}return e}function st(e,t,i,n,r,o,s){var a=i.flattenSpans;null==a&&(a=e.options.flattenSpans);var l,c=0,d=null,u=new aa(t,e.options.tabSize,n),h=e.options.addModeClass&&[null];for(""==t&&ot(it(i,n.state),o);!u.eol();){if(u.pos>e.options.maxHighlightLength?(a=!1,s&&tt(e,t,n,u.pos),u.pos=t.length,l=null):l=ot(nt(i,u,n.state,h),o),h){var p=h[0].name;p&&(l="m-"+(l?p+" "+l:p))}if(!a||d!=l){for(;c<u.start;)r(c=Math.min(u.start,c+5e3),d);d=l}u.start=u.pos}for(;c<u.pos;){var f=Math.min(u.pos,c+5e3);r(f,d),c=f}}function at(e,t,i){for(var n,r,o=e.doc,s=i?-1:t-(e.doc.mode.innerMode?1e3:100),a=t;a>s;--a){if(a<=o.first)return o.first;var l=E(o,a-1),c=l.stateAfter;if(c&&(!i||a+(c instanceof la?c.lookAhead:0)<=o.modeFrontier))return a;var d=u(l.text,null,e.options.tabSize);(null==r||n>d)&&(r=a-1,n=d)}return r}function lt(e,t){if(e.modeFrontier=Math.min(e.modeFrontier,t),!(e.highlightFrontier<t-10)){for(var i=e.first,n=t-1;n>i;n--){var r=E(e,n).stateAfter;if(r&&(!(r instanceof la)||n+r.lookAhead<t)){i=n+1;break}}e.highlightFrontier=Math.min(e.highlightFrontier,i)}}function ct(e,t,i,n){e.text=t,e.stateAfter&&(e.stateAfter=null),e.styles&&(e.styles=null),null!=e.order&&(e.order=null),ie(e),ne(e,i);var r=n?n(e):1;r!=e.height&&L(e,r)}function dt(e){e.parent=null,ie(e)}function ut(e,t){if(!e||/^\s*$/.test(e))return null;var i=t.addModeClass?fa:pa;return i[e]||(i[e]=e.replace(/\S+/g,"cm-$&"))}function ht(e,t){var i=r("span",null,null,gs?"padding-right: .1px":null),n={pre:r("pre",[i],"CodeMirror-line"),content:i,col:0,pos:0,cm:e,trailingSpace:!1,splitSpaces:(fs||gs)&&e.getOption("lineWrapping")};t.measure={};for(var o=0;o<=(t.rest?t.rest.length:0);o++){var s=o?t.rest[o-1]:t.line,a=void 0;n.pos=0,n.addToken=ft,We(e.display.measure)&&(a=_e(s,e.doc.direction))&&(n.addToken=gt(n.addToken,a)),n.map=[],bt(s,n,Je(e,s,t!=e.display.externalMeasured&&N(s))),s.styleClasses&&(s.styleClasses.bgClass&&(n.bgClass=l(s.styleClasses.bgClass,n.bgClass||"")),s.styleClasses.textClass&&(n.textClass=l(s.styleClasses.textClass,n.textClass||""))),0==n.map.length&&n.map.push(0,0,n.content.appendChild(ze(e.display.measure))),0==o?(t.measure.map=n.map,t.measure.cache={}):((t.measure.maps||(t.measure.maps=[])).push(n.map),(t.measure.caches||(t.measure.caches=[])).push({}))}if(gs){var c=n.content.lastChild;(/\bcm-tab\b/.test(c.className)||c.querySelector&&c.querySelector(".cm-tab"))&&(n.content.className="cm-tab-wrap-hack")}return Le(e,"renderLine",e,t.line,n.pre),n.pre.className&&(n.textClass=l(n.pre.className,n.textClass||"")),n}function pt(e){var t=n("span","\u2022","cm-invalidchar");return t.title="\\u"+e.charCodeAt(0).toString(16),t.setAttribute("aria-label",t.title),t}function ft(e,t,i,r,o,s,a){if(t){var l,c=e.splitSpaces?mt(t,e.trailingSpace):t,d=e.cm.state.specialChars,u=!1;if(d.test(t)){l=document.createDocumentFragment();for(var h=0;;){d.lastIndex=h;var p=d.exec(t),m=p?p.index-h:t.length-h;if(m){var g=document.createTextNode(c.slice(h,h+m));fs&&ms<9?l.appendChild(n("span",[g])):l.appendChild(g),e.map.push(e.pos,e.pos+m,g),e.col+=m,e.pos+=m}if(!p)break;h+=m+1;var v=void 0;if("\t"==p[0]){var b=e.cm.options.tabSize,y=b-e.col%b;(v=l.appendChild(n("span",f(y),"cm-tab"))).setAttribute("role","presentation"),v.setAttribute("cm-text","\t"),e.col+=y}else"\r"==p[0]||"\n"==p[0]?((v=l.appendChild(n("span","\r"==p[0]?"\u240d":"\u2424","cm-invalidchar"))).setAttribute("cm-text",p[0]),e.col+=1):((v=e.cm.options.specialCharPlaceholder(p[0])).setAttribute("cm-text",p[0]),fs&&ms<9?l.appendChild(n("span",[v])):l.appendChild(v),e.col+=1);e.map.push(e.pos,e.pos+1,v),e.pos++}}else e.col+=t.length,l=document.createTextNode(c),e.map.push(e.pos,e.pos+t.length,l),fs&&ms<9&&(u=!0),e.pos+=t.length;if(e.trailingSpace=32==c.charCodeAt(t.length-1),i||r||o||u||a){var w=i||"";r&&(w+=r),o&&(w+=o);var k=n("span",[l],w,a);return s&&(k.title=s),e.content.appendChild(k)}e.content.appendChild(l)}}function mt(e,t){if(e.length>1&&!/  /.test(e))return e;for(var i=t,n="",r=0;r<e.length;r++){var o=e.charAt(r);" "!=o||!i||r!=e.length-1&&32!=e.charCodeAt(r+1)||(o="\xa0"),n+=o,i=" "==o}return n}function gt(e,t){return function(i,n,r,o,s,a,l){r=r?r+" cm-force-border":"cm-force-border";for(var c=i.pos,d=c+n.length;;){for(var u=void 0,h=0;h<t.length&&!((u=t[h]).to>c&&u.from<=c);h++);if(u.to>=d)return e(i,n,r,o,s,a,l);e(i,n.slice(0,u.to-c),r,o,null,a,l),o=null,n=n.slice(u.to-c),c=u.to}}}function vt(e,t,i,n){var r=!n&&i.widgetNode;r&&e.map.push(e.pos,e.pos+t,r),!n&&e.cm.display.input.needsContentAttribute&&(r||(r=e.content.appendChild(document.createElement("span"))),r.setAttribute("cm-marker",i.id)),r&&(e.cm.display.input.setUneditable(r),e.content.appendChild(r)),e.pos+=t,e.trailingSpace=!1}function bt(e,t,i){var n=e.markedSpans,r=e.text,o=0;if(n)for(var s,a,l,c,d,u,h,p=r.length,f=0,m=1,g="",v=0;;){if(v==f){l=c=d=u=a="",h=null,v=Infinity;for(var b=[],y=void 0,w=0;w<n.length;++w){var k=n[w],x=k.marker;"bookmark"==x.type&&k.from==f&&x.widgetNode?b.push(x):k.from<=f&&(null==k.to||k.to>f||x.collapsed&&k.to==f&&k.from==f)?(null!=k.to&&k.to!=f&&v>k.to&&(v=k.to,c=""),x.className&&(l+=" "+x.className),x.css&&(a=(a?a+";":"")+x.css),x.startStyle&&k.from==f&&(d+=" "+x.startStyle),x.endStyle&&k.to==v&&(y||(y=[])).push(x.endStyle,k.to),x.title&&!u&&(u=x.title),x.collapsed&&(!h||se(h.marker,x)<0)&&(h=k)):k.from>f&&v>k.from&&(v=k.from)}if(y)for(var _=0;_<y.length;_+=2)y[_+1]==v&&(c+=" "+y[_]);if(!h||h.from==f)for(var C=0;C<b.length;++C)vt(t,0,b[C]);if(h&&(h.from||0)==f){if(vt(t,(null==h.to?p+1:h.to)-f,h.marker,null==h.from),null==h.to)return;h.to==f&&(h=!1)}}if(f>=p)break;for(var T=Math.min(p,v);;){if(g){var S=f+g.length;if(!h){var E=S>T?g.slice(0,T-f):g;t.addToken(t,E,s?s+l:l,d,f+E.length==v?c:"",u,a)}if(S>=T){g=g.slice(T-f),f=T;break}f=S,d=""}g=r.slice(o,o=i[m++]),s=ut(i[m++],t.cm.options)}}else for(var $=1;$<i.length;$+=2)t.addToken(t,r.slice(o,o=i[$]),ut(i[$+1],t.cm.options))}function yt(e,t,i){this.line=t,this.rest=pe(t),this.size=this.rest?N(m(this.rest))-i+1:1,this.node=this.text=null,this.hidden=ge(e,t)}function wt(e,t,i){for(var n,r=[],o=t;o<i;o=n){var s=new yt(e.doc,E(e.doc,o),o);n=o+s.size,r.push(s)}return r}function kt(e){ma?ma.ops.push(e):e.ownsGroup=ma={ops:[e],delayedCallbacks:[]}}function xt(e){var t=e.delayedCallbacks,i=0;do{for(;i<t.length;i++)t[i].call(null);for(var n=0;n<e.ops.length;n++){var r=e.ops[n];if(r.cursorActivityHandlers)for(;r.cursorActivityCalled<r.cursorActivityHandlers.length;)r.cursorActivityHandlers[r.cursorActivityCalled++].call(null,r.cm)}}while(i<t.length)}function _t(e,t){var i=e.ownsGroup;if(i)try{xt(i)}finally{ma=null,t(i)}}function Ct(e,t){var i=$e(e,t);if(i.length){var n,r=Array.prototype.slice.call(arguments,2);ma?n=ma.delayedCallbacks:ga?n=ga:(n=ga=[],setTimeout(Tt,0));for(var o=function(e){n.push(function(){return i[e].apply(null,r)})},s=0;s<i.length;++s)o(s)}}function Tt(){var e=ga;ga=null;for(var t=0;t<e.length;++t)e[t]()}function St(e,t,i,n){for(var r=0;r<t.changes.length;r++){var o=t.changes[r];"text"==o?Lt(e,t):"gutter"==o?Ot(e,t,i,n):"class"==o?Nt(e,t):"widget"==o&&Mt(e,t,n)}t.changes=null}function Et(e){return e.node==e.text&&(e.node=n("div",null,null,"position: relative"),e.text.parentNode&&e.text.parentNode.replaceChild(e.node,e.text),e.node.appendChild(e.text),fs&&ms<8&&(e.node.style.zIndex=2)),e.node}function $t(e,t){var i=t.bgClass?t.bgClass+" "+(t.line.bgClass||""):t.line.bgClass;if(i&&(i+=" CodeMirror-linebackground"),t.background)i?t.background.className=i:(t.background.parentNode.removeChild(t.background),t.background=null);else if(i){var r=Et(t);t.background=r.insertBefore(n("div",null,i),r.firstChild),e.display.input.setUneditable(t.background)}}function At(e,t){var i=e.display.externalMeasured;return i&&i.line==t.line?(e.display.externalMeasured=null,t.measure=i.measure,i.built):ht(e,t)}function Lt(e,t){var i=t.text.className,n=At(e,t);t.text==t.node&&(t.node=n.pre),t.text.parentNode.replaceChild(n.pre,t.text),t.text=n.pre,n.bgClass!=t.bgClass||n.textClass!=t.textClass?(t.bgClass=n.bgClass,t.textClass=n.textClass,Nt(e,t)):i&&(t.text.className=i)}function Nt(e,t){$t(e,t),t.line.wrapClass?Et(t).className=t.line.wrapClass:t.node!=t.text&&(t.node.className="");var i=t.textClass?t.textClass+" "+(t.line.textClass||""):t.line.textClass;t.text.className=i||""}function Ot(e,t,i,r){if(t.gutter&&(t.node.removeChild(t.gutter),t.gutter=null),t.gutterBackground&&(t.node.removeChild(t.gutterBackground),t.gutterBackground=null),t.line.gutterClass){var o=Et(t);t.gutterBackground=n("div",null,"CodeMirror-gutter-background "+t.line.gutterClass,"left: "+(e.options.fixedGutter?r.fixedPos:-r.gutterTotalWidth)+"px; width: "+r.gutterTotalWidth+"px"),e.display.input.setUneditable(t.gutterBackground),o.insertBefore(t.gutterBackground,t.text)}var s=t.line.gutterMarkers;if(e.options.lineNumbers||s){var a=Et(t),l=t.gutter=n("div",null,"CodeMirror-gutter-wrapper","left: "+(e.options.fixedGutter?r.fixedPos:-r.gutterTotalWidth)+"px");if(e.display.input.setUneditable(l),a.insertBefore(l,t.text),t.line.gutterClass&&(l.className+=" "+t.line.gutterClass),!e.options.lineNumbers||s&&s["CodeMirror-linenumbers"]||(t.lineNumber=l.appendChild(n("div",P(e.options,i),"CodeMirror-linenumber CodeMirror-gutter-elt","left: "+r.gutterLeft["CodeMirror-linenumbers"]+"px; width: "+e.display.lineNumInnerWidth+"px"))),s)for(var c=0;c<e.options.gutters.length;++c){var d=e.options.gutters[c],u=s.hasOwnProperty(d)&&s[d];u&&l.appendChild(n("div",[u],"CodeMirror-gutter-elt","left: "+r.gutterLeft[d]+"px; width: "+r.gutterWidth[d]+"px"))}}}function Mt(e,t,i){t.alignable&&(t.alignable=null);for(var n=t.node.firstChild,r=void 0;n;n=r)r=n.nextSibling,"CodeMirror-linewidget"==n.className&&t.node.removeChild(n);It(e,t,i)}function Pt(e,t,i,n){var r=At(e,t);return t.text=t.node=r.pre,r.bgClass&&(t.bgClass=r.bgClass),r.textClass&&(t.textClass=r.textClass),Nt(e,t),Ot(e,t,i,n),It(e,t,n),t.node}function It(e,t,i){if(Rt(e,t.line,t,i,!0),t.rest)for(var n=0;n<t.rest.length;n++)Rt(e,t.rest[n],t,i,!1)}function Rt(e,t,i,r,o){if(t.widgets)for(var s=Et(i),a=0,l=t.widgets;a<l.length;++a){var c=l[a],d=n("div",[c.node],"CodeMirror-linewidget");c.handleMouseEvents||d.setAttribute("cm-ignore-events","true"),Dt(c,d,i,r),e.display.input.setUneditable(d),o&&c.above?s.insertBefore(d,i.gutter||i.text):s.appendChild(d),Ct(c,"redraw")}}function Dt(e,t,i,n){if(e.noHScroll){(i.alignable||(i.alignable=[])).push(t);var r=n.wrapperWidth;t.style.left=n.fixedPos+"px",e.coverGutter||(r-=n.gutterTotalWidth,t.style.paddingLeft=n.gutterTotalWidth+"px"),t.style.width=r+"px"}e.coverGutter&&(t.style.zIndex=5,t.style.position="relative",e.noHScroll||(t.style.marginLeft=-n.gutterTotalWidth+"px"))}function Ft(e){if(null!=e.height)return e.height;var t=e.doc.cm;if(!t)return 0;if(!o(document.body,e.node)){var r="position: relative;";e.coverGutter&&(r+="margin-left: -"+t.display.gutters.offsetWidth+"px;"),e.noHScroll&&(r+="width: "+t.display.wrapper.clientWidth+"px;"),i(t.display.measure,n("div",[e.node],null,r))}return e.height=e.node.parentNode.offsetHeight}function Bt(e,t){for(var i=Be(t);i!=e.wrapper;i=i.parentNode)if(!i||1==i.nodeType&&"true"==i.getAttribute("cm-ignore-events")||i.parentNode==e.sizer&&i!=e.mover)return!0}function Ht(e){return e.lineSpace.offsetTop}function zt(e){return e.mover.offsetHeight-e.lineSpace.offsetHeight}function Wt(e){if(e.cachedPaddingH)return e.cachedPaddingH;var t=i(e.measure,n("pre","x")),r=window.getComputedStyle?window.getComputedStyle(t):t.currentStyle,o={left:parseInt(r.paddingLeft),right:parseInt(r.paddingRight)};return isNaN(o.left)||isNaN(o.right)||(e.cachedPaddingH=o),o}function Ut(e){return Bs-e.display.nativeBarWidth}function jt(e){return e.display.scroller.clientWidth-Ut(e)-e.display.barWidth}function qt(e){return e.display.scroller.clientHeight-Ut(e)-e.display.barHeight}function Gt(e,t,i){var n=e.options.lineWrapping,r=n&&jt(e);if(!t.measure.heights||n&&t.measure.width!=r){var o=t.measure.heights=[];if(n){t.measure.width=r;for(var s=t.text.firstChild.getClientRects(),a=0;a<s.length-1;a++){var l=s[a],c=s[a+1];Math.abs(l.bottom-c.bottom)>2&&o.push((l.bottom+c.top)/2-i.top)}}o.push(i.bottom-i.top)}}function Kt(e,t,i){if(e.line==t)return{map:e.measure.map,cache:e.measure.cache};for(var n=0;n<e.rest.length;n++)if(e.rest[n]==t)return{map:e.measure.maps[n],cache:e.measure.caches[n]};for(var r=0;r<e.rest.length;r++)if(N(e.rest[r])>i)return{map:e.measure.maps[r],cache:e.measure.caches[r],before:!0}}function Vt(e,t){
var n=N(t=ue(t)),r=e.display.externalMeasured=new yt(e.doc,t,n);r.lineN=n;var o=r.built=ht(e,r);return r.text=o.pre,i(e.display.lineMeasure,o.pre),r}function Yt(e,t,i,n){return Zt(e,Qt(e,t),i,n)}function Xt(e,t){if(t>=e.display.viewFrom&&t<e.display.viewTo)return e.display.view[Ti(e,t)];var i=e.display.externalMeasured;return i&&t>=i.lineN&&t<i.lineN+i.size?i:void 0}function Qt(e,t){var i=N(t),n=Xt(e,i);n&&!n.text?n=null:n&&n.changes&&(St(e,n,i,wi(e)),e.curOp.forceUpdate=!0),n||(n=Vt(e,t));var r=Kt(n,t,i);return{line:t,view:n,rect:null,map:r.map,cache:r.cache,before:r.before,hasHeights:!1}}function Zt(e,t,i,n,r){t.before&&(i=-1);var o,s=i+(n||"");return t.cache.hasOwnProperty(s)?o=t.cache[s]:(t.rect||(t.rect=t.view.text.getBoundingClientRect()),t.hasHeights||(Gt(e,t.view,t.rect),t.hasHeights=!0),(o=ti(e,t,i,n)).bogus||(t.cache[s]=o)),{left:o.left,right:o.right,top:r?o.rtop:o.top,bottom:r?o.rbottom:o.bottom}}function Jt(e,t,i){for(var n,r,o,s,a,l,c=0;c<e.length;c+=3)if(a=e[c],l=e[c+1],t<a?(r=0,o=1,s="left"):t<l?o=(r=t-a)+1:(c==e.length-3||t==l&&e[c+3]>t)&&(r=(o=l-a)-1,t>=l&&(s="right")),null!=r){if(n=e[c+2],a==l&&i==(n.insertLeft?"left":"right")&&(s=i),"left"==i&&0==r)for(;c&&e[c-2]==e[c-3]&&e[c-1].insertLeft;)n=e[2+(c-=3)],s="left";if("right"==i&&r==l-a)for(;c<e.length-3&&e[c+3]==e[c+4]&&!e[c+5].insertLeft;)n=e[(c+=3)+2],s="right";break}return{node:n,start:r,end:o,collapse:s,coverStart:a,coverEnd:l}}function ei(e,t){var i=va;if("left"==t)for(var n=0;n<e.length&&(i=e[n]).left==i.right;n++);else for(var r=e.length-1;r>=0&&(i=e[r]).left==i.right;r--);return i}function ti(e,t,i,n){var r,o=Jt(t.map,i,n),s=o.node,a=o.start,l=o.end,c=o.collapse;if(3==s.nodeType){for(var d=0;d<4;d++){for(;a&&_(t.line.text.charAt(o.coverStart+a));)--a;for(;o.coverStart+l<o.coverEnd&&_(t.line.text.charAt(o.coverStart+l));)++l;if((r=fs&&ms<9&&0==a&&l==o.coverEnd-o.coverStart?s.parentNode.getBoundingClientRect():ei(Ls(s,a,l).getClientRects(),n)).left||r.right||0==a)break;l=a,a-=1,c="right"}fs&&ms<11&&(r=ii(e.display.measure,r))}else{var u;a>0&&(c=n="right"),r=e.options.lineWrapping&&(u=s.getClientRects()).length>1?u["right"==n?u.length-1:0]:s.getBoundingClientRect()}if(fs&&ms<9&&!a&&(!r||!r.left&&!r.right)){var h=s.parentNode.getClientRects()[0];r=h?{left:h.left,right:h.left+yi(e.display),top:h.top,bottom:h.bottom}:va}for(var p=r.top-t.rect.top,f=r.bottom-t.rect.top,m=(p+f)/2,g=t.view.measure.heights,v=0;v<g.length-1&&!(m<g[v]);v++);var b=v?g[v-1]:0,y=g[v],w={left:("right"==c?r.right:r.left)-t.rect.left,right:("left"==c?r.left:r.right)-t.rect.left,top:b,bottom:y};return r.left||r.right||(w.bogus=!0),e.options.singleCursorHeightPerLine||(w.rtop=p,w.rbottom=f),w}function ii(e,t){if(!window.screen||null==screen.logicalXDPI||screen.logicalXDPI==screen.deviceXDPI||!Ue(e))return t;var i=screen.logicalXDPI/screen.deviceXDPI,n=screen.logicalYDPI/screen.deviceYDPI;return{left:t.left*i,right:t.right*i,top:t.top*n,bottom:t.bottom*n}}function ni(e){if(e.measure&&(e.measure.cache={},e.measure.heights=null,e.rest))for(var t=0;t<e.rest.length;t++)e.measure.caches[t]={}}function ri(e){e.display.externalMeasure=null,t(e.display.lineMeasure);for(var i=0;i<e.display.view.length;i++)ni(e.display.view[i])}function oi(e){ri(e),e.display.cachedCharWidth=e.display.cachedTextHeight=e.display.cachedPaddingH=null,e.options.lineWrapping||(e.display.maxLineChanged=!0),e.display.lineNumChars=null}function si(){return bs&&Cs?-(document.body.getBoundingClientRect().left-parseInt(getComputedStyle(document.body).marginLeft)):window.pageXOffset||(document.documentElement||document.body).scrollLeft}function ai(){return bs&&Cs?-(document.body.getBoundingClientRect().top-parseInt(getComputedStyle(document.body).marginTop)):window.pageYOffset||(document.documentElement||document.body).scrollTop}function li(e,t,i,n,r){if(!r&&t.widgets)for(var o=0;o<t.widgets.length;++o)if(t.widgets[o].above){var s=Ft(t.widgets[o]);i.top+=s,i.bottom+=s}if("line"==n)return i;n||(n="local");var a=be(t);if("local"==n?a+=Ht(e.display):a-=e.display.viewOffset,"page"==n||"window"==n){var l=e.display.lineSpace.getBoundingClientRect();a+=l.top+("window"==n?0:ai());var c=l.left+("window"==n?0:si());i.left+=c,i.right+=c}return i.top+=a,i.bottom+=a,i}function ci(e,t,i){if("div"==i)return t;var n=t.left,r=t.top;if("page"==i)n-=si(),r-=ai();else if("local"==i||!i){var o=e.display.sizer.getBoundingClientRect();n+=o.left,r+=o.top}var s=e.display.lineSpace.getBoundingClientRect();return{left:n-s.left,top:r-s.top}}function di(e,t,i,n,r){return n||(n=E(e.doc,t.line)),li(e,n,Yt(e,n,t.ch,r),i)}function ui(e,t,i,n,r,o){function s(t,s){var a=Zt(e,r,t,s?"right":"left",o);return s?a.left=a.right:a.right=a.left,li(e,n,a,i)}function a(e,t,i){var n=l[t].level%2!=0;return s(i?e-1:e,n!=i)}n=n||E(e.doc,t.line),r||(r=Qt(e,n));var l=_e(n,e.doc.direction),c=t.ch,d=t.sticky;if(c>=n.text.length?(c=n.text.length,d="before"):c<=0&&(c=0,d="after"),!l)return s("before"==d?c-1:c,"before"==d);var u=xe(l,c,d),h=Ys,p=a(c,u,"before"==d);return null!=h&&(p.other=a(c,h,"before"!=d)),p}function hi(e,t){var i=0;t=W(e.doc,t),e.options.lineWrapping||(i=yi(e.display)*t.ch);var n=E(e.doc,t.line),r=be(n)+Ht(e.display);return{left:i,right:i,top:r,bottom:r+n.height}}function pi(e,t,i,n,r){var o=I(e,t,i);return o.xRel=r,n&&(o.outside=!0),o}function fi(e,t,i){var n=e.doc;if((i+=e.display.viewOffset)<0)return pi(n.first,0,null,!0,-1);var r=O(n,i),o=n.first+n.size-1;if(r>o)return pi(n.first+n.size-1,E(n,o).text.length,null,!0,1);t<0&&(t=0);for(var s=E(n,r);;){var a=vi(e,s,r,t,i),l=ce(s),c=l&&l.find(0,!0);if(!l||!(a.ch>c.from.ch||a.ch==c.from.ch&&a.xRel>0))return a;r=N(s=c.to.line)}}function mi(e,t,i,n){var r=function(n){return li(e,t,Zt(e,i,n),"line")},o=t.text.length,s=T(function(e){return r(e-1).bottom<=n},o,0);return{begin:s,end:o=T(function(e){return r(e).top>n},s,o)}}function gi(e,t,i,n){return mi(e,t,i,li(e,t,Zt(e,i,n),"line").top)}function vi(e,t,i,n,r){r-=be(t);var o,s=0,a=t.text.length,l=Qt(e,t);if(_e(t,e.doc.direction)){var c;if(e.options.lineWrapping)s=(c=mi(e,t,l,r)).begin,a=c.end;o=new I(i,Math.floor(s+(a-s)/2));var d,u,h=ui(e,o,"line",t,l).left,p=h<n?1:-1,f=h-n,m=Math.ceil((a-s)/4);e:do{d=f,u=o;for(var g=0;g<m;++g){var v=o;if(null==(o=Ee(e,t,o,p))||o.ch<s||a<=("before"==o.sticky?o.ch-1:o.ch)){o=v;break e}}if(f=ui(e,o,"line",t,l).left-n,m>1){var b=Math.abs(f-d)/m;m=Math.min(m,Math.ceil(Math.abs(f)/b)),p=f<0?1:-1}}while(0!=f&&(m>1||p<0!=f<0&&Math.abs(f)<=Math.abs(d)));if(Math.abs(f)>Math.abs(d)){if(f<0==d<0)throw new Error("Broke out of infinite loop in coordsCharInner");o=u}}else{var y=T(function(i){var o=li(e,t,Zt(e,l,i),"line");return o.top>r?(a=Math.min(i,a),!0):!(o.bottom<=r)&&(o.left>n||!(o.right<n)&&n-o.left<o.right-n)},s,a);o=new I(i,y=C(t.text,y,1),y==a?"before":"after")}var w=ui(e,o,"line",t,l);return(r<w.top||w.bottom<r)&&(o.outside=!0),o.xRel=n<w.left?-1:n>w.right?1:0,o}function bi(e){if(null!=e.cachedTextHeight)return e.cachedTextHeight;if(null==ha){ha=n("pre");for(var r=0;r<49;++r)ha.appendChild(document.createTextNode("x")),ha.appendChild(n("br"));ha.appendChild(document.createTextNode("x"))}i(e.measure,ha);var o=ha.offsetHeight/50;return o>3&&(e.cachedTextHeight=o),t(e.measure),o||1}function yi(e){if(null!=e.cachedCharWidth)return e.cachedCharWidth;var t=n("span","xxxxxxxxxx"),r=n("pre",[t]);i(e.measure,r);var o=t.getBoundingClientRect(),s=(o.right-o.left)/10;return s>2&&(e.cachedCharWidth=s),s||10}function wi(e){for(var t=e.display,i={},n={},r=t.gutters.clientLeft,o=t.gutters.firstChild,s=0;o;o=o.nextSibling,++s)i[e.options.gutters[s]]=o.offsetLeft+o.clientLeft+r,n[e.options.gutters[s]]=o.clientWidth;return{fixedPos:ki(t),gutterTotalWidth:t.gutters.offsetWidth,gutterLeft:i,gutterWidth:n,wrapperWidth:t.wrapper.clientWidth}}function ki(e){return e.scroller.getBoundingClientRect().left-e.sizer.getBoundingClientRect().left}function xi(e){var t=bi(e.display),i=e.options.lineWrapping,n=i&&Math.max(5,e.display.scroller.clientWidth/yi(e.display)-3);return function(r){if(ge(e.doc,r))return 0;var o=0;if(r.widgets)for(var s=0;s<r.widgets.length;s++)r.widgets[s].height&&(o+=r.widgets[s].height);return i?o+(Math.ceil(r.text.length/n)||1)*t:o+t}}function _i(e){var t=e.doc,i=xi(e);t.iter(function(e){var t=i(e);t!=e.height&&L(e,t)})}function Ci(e,t,i,n){var r=e.display;if(!i&&"true"==Be(t).getAttribute("cm-not-content"))return null;var o,s,a=r.lineSpace.getBoundingClientRect();try{o=t.clientX-a.left,s=t.clientY-a.top}catch(t){return null}var l,c=fi(e,o,s);if(n&&1==c.xRel&&(l=E(e.doc,c.line).text).length==c.ch){var d=u(l,l.length,e.options.tabSize)-l.length;c=I(c.line,Math.max(0,Math.round((o-Wt(e.display).left)/yi(e.display))-d))}return c}function Ti(e,t){if(t>=e.display.viewTo)return null;if((t-=e.display.viewFrom)<0)return null;for(var i=e.display.view,n=0;n<i.length;n++)if((t-=i[n].size)<0)return n}function Si(e){e.display.input.showSelection(e.display.input.prepareSelection())}function Ei(e,t){for(var i=e.doc,n={},r=n.cursors=document.createDocumentFragment(),o=n.selection=document.createDocumentFragment(),s=0;s<i.sel.ranges.length;s++)if(!1!==t||s!=i.sel.primIndex){var a=i.sel.ranges[s];if(!(a.from().line>=e.display.viewTo||a.to().line<e.display.viewFrom)){var l=a.empty();(l||e.options.showCursorWhenSelecting)&&$i(e,a.head,r),l||Ai(e,a,o)}}return n}function $i(e,t,i){var r=ui(e,t,"div",null,null,!e.options.singleCursorHeightPerLine),o=i.appendChild(n("div","\xa0","CodeMirror-cursor"));if(o.style.left=r.left+"px",o.style.top=r.top+"px",o.style.height=Math.max(0,r.bottom-r.top)*e.options.cursorHeight+"px",r.other){var s=i.appendChild(n("div","\xa0","CodeMirror-cursor CodeMirror-secondarycursor"));s.style.display="",s.style.left=r.other.left+"px",s.style.top=r.other.top+"px",s.style.height=.85*(r.other.bottom-r.other.top)+"px"}}function Ai(e,t,i){function r(e,t,i,r){t<0&&(t=0),t=Math.round(t),r=Math.round(r),l.appendChild(n("div",null,"CodeMirror-selected","position: absolute; left: "+e+"px;\n                             top: "+t+"px; width: "+(null==i?u-e:i)+"px;\n                             height: "+(r-t)+"px"))}function o(t,i,n){function o(i,n){return di(e,I(t,i),"div",c,n)}var s,l,c=E(a,t),h=c.text.length;return ke(_e(c,a.direction),i||0,null==n?h:n,function(e,t,a){var c,p,f,m=o(e,"left");if(e==t)c=m,p=f=m.left;else{if(c=o(t-1,"right"),"rtl"==a){var g=m;m=c,c=g}p=m.left,f=c.right}null==i&&0==e&&(p=d),c.top-m.top>3&&(r(p,m.top,null,m.bottom),p=d,m.bottom<c.top&&r(p,m.bottom,null,c.top)),null==n&&t==h&&(f=u),(!s||m.top<s.top||m.top==s.top&&m.left<s.left)&&(s=m),(!l||c.bottom>l.bottom||c.bottom==l.bottom&&c.right>l.right)&&(l=c),p<d+1&&(p=d),r(p,c.top,f-p,c.bottom)}),{start:s,end:l}}var s=e.display,a=e.doc,l=document.createDocumentFragment(),c=Wt(e.display),d=c.left,u=Math.max(s.sizerWidth,jt(e)-s.sizer.offsetLeft)-c.right,h=t.from(),p=t.to();if(h.line==p.line)o(h.line,h.ch,p.ch);else{var f=E(a,h.line),m=E(a,p.line),g=ue(f)==ue(m),v=o(h.line,h.ch,g?f.text.length+1:null).end,b=o(p.line,g?0:null,p.ch).start;g&&(v.top<b.top-2?(r(v.right,v.top,null,v.bottom),r(d,b.top,b.left,b.bottom)):r(v.right,v.top,b.left-v.right,v.bottom)),v.bottom<b.top&&r(d,v.bottom,null,b.top)}i.appendChild(l)}function Li(e){if(e.state.focused){var t=e.display;clearInterval(t.blinker);var i=!0;t.cursorDiv.style.visibility="",e.options.cursorBlinkRate>0?t.blinker=setInterval(function(){return t.cursorDiv.style.visibility=(i=!i)?"":"hidden"},e.options.cursorBlinkRate):e.options.cursorBlinkRate<0&&(t.cursorDiv.style.visibility="hidden")}}function Ni(e){e.state.focused||(e.display.input.focus(),Mi(e))}function Oi(e){e.state.delayingBlurEvent=!0,setTimeout(function(){e.state.delayingBlurEvent&&(e.state.delayingBlurEvent=!1,Pi(e))},100)}function Mi(e,t){e.state.delayingBlurEvent&&(e.state.delayingBlurEvent=!1),"nocursor"!=e.options.readOnly&&(e.state.focused||(Le(e,"focus",e,t),e.state.focused=!0,a(e.display.wrapper,"CodeMirror-focused"),e.curOp||e.display.selForContextMenu==e.doc.sel||(e.display.input.reset(),gs&&setTimeout(function(){return e.display.input.reset(!0)},20)),e.display.input.receivedFocus()),Li(e))}function Pi(e,t){e.state.delayingBlurEvent||(e.state.focused&&(Le(e,"blur",e,t),e.state.focused=!1,Ms(e.display.wrapper,"CodeMirror-focused")),clearInterval(e.display.blinker),setTimeout(function(){e.state.focused||(e.display.shift=!1)},150))}function Ii(e){for(var t=e.display,i=t.lineDiv.offsetTop,n=0;n<t.view.length;n++){var r=t.view[n],o=void 0;if(!r.hidden){if(fs&&ms<8){var s=r.node.offsetTop+r.node.offsetHeight;o=s-i,i=s}else{var a=r.node.getBoundingClientRect();o=a.bottom-a.top}var l=r.line.height-o;if(o<2&&(o=bi(t)),(l>.005||l<-.005)&&(L(r.line,o),Ri(r.line),r.rest))for(var c=0;c<r.rest.length;c++)Ri(r.rest[c])}}}function Ri(e){if(e.widgets)for(var t=0;t<e.widgets.length;++t)e.widgets[t].height=e.widgets[t].node.parentNode.offsetHeight}function Di(e,t,i){var n=i&&null!=i.top?Math.max(0,i.top):e.scroller.scrollTop;n=Math.floor(n-Ht(e));var r=i&&null!=i.bottom?i.bottom:n+e.wrapper.clientHeight,o=O(t,n),s=O(t,r);if(i&&i.ensure){var a=i.ensure.from.line,l=i.ensure.to.line;a<o?(o=a,s=O(t,be(E(t,a))+e.wrapper.clientHeight)):Math.min(l,t.lastLine())>=s&&(o=O(t,be(E(t,l))-e.wrapper.clientHeight),s=l)}return{from:o,to:Math.max(s,o+1)}}function Fi(e){var t=e.display,i=t.view;if(t.alignWidgets||t.gutters.firstChild&&e.options.fixedGutter){for(var n=ki(t)-t.scroller.scrollLeft+e.doc.scrollLeft,r=t.gutters.offsetWidth,o=n+"px",s=0;s<i.length;s++)if(!i[s].hidden){e.options.fixedGutter&&(i[s].gutter&&(i[s].gutter.style.left=o),i[s].gutterBackground&&(i[s].gutterBackground.style.left=o));var a=i[s].alignable;if(a)for(var l=0;l<a.length;l++)a[l].style.left=o}e.options.fixedGutter&&(t.gutters.style.left=n+r+"px")}}function Bi(e){if(!e.options.lineNumbers)return!1;var t=e.doc,i=P(e.options,t.first+t.size-1),r=e.display;if(i.length!=r.lineNumChars){var o=r.measure.appendChild(n("div",[n("div",i)],"CodeMirror-linenumber CodeMirror-gutter-elt")),s=o.firstChild.offsetWidth,a=o.offsetWidth-s;return r.lineGutter.style.width="",r.lineNumInnerWidth=Math.max(s,r.lineGutter.offsetWidth-a)+1,r.lineNumWidth=r.lineNumInnerWidth+a,r.lineNumChars=r.lineNumInnerWidth?i.length:-1,r.lineGutter.style.width=r.lineNumWidth+"px",Nn(e),!0}return!1}function Hi(e,t){if(!Ne(e,"scrollCursorIntoView")){var i=e.display,r=i.sizer.getBoundingClientRect(),o=null;if(t.top+r.top<0?o=!0:t.bottom+r.top>(window.innerHeight||document.documentElement.clientHeight)&&(o=!1),null!=o&&!xs){var s=n("div","\u200b",null,"position: absolute;\n                         top: "+(t.top-i.viewOffset-Ht(e.display))+"px;\n                         height: "+(t.bottom-t.top+Ut(e)+i.barHeight)+"px;\n                         left: "+t.left+"px; width: "+Math.max(2,t.right-t.left)+"px;");e.display.lineSpace.appendChild(s),s.scrollIntoView(o),e.display.lineSpace.removeChild(s)}}}function zi(e,t,i,n){var r;null==n&&(n=0),e.options.lineWrapping||t!=i||(i="before"==(t=t.ch?I(t.line,"before"==t.sticky?t.ch-1:t.ch,"after"):t).sticky?I(t.line,t.ch+1,"before"):t);for(var o=0;o<5;o++){var s=!1,a=ui(e,t),l=i&&i!=t?ui(e,i):a,c=Ui(e,r={left:Math.min(a.left,l.left),top:Math.min(a.top,l.top)-n,right:Math.max(a.left,l.left),bottom:Math.max(a.bottom,l.bottom)+n}),d=e.doc.scrollTop,u=e.doc.scrollLeft;if(null!=c.scrollTop&&(Xi(e,c.scrollTop),Math.abs(e.doc.scrollTop-d)>1&&(s=!0)),null!=c.scrollLeft&&(Zi(e,c.scrollLeft),Math.abs(e.doc.scrollLeft-u)>1&&(s=!0)),!s)break}return r}function Wi(e,t){var i=Ui(e,t);null!=i.scrollTop&&Xi(e,i.scrollTop),null!=i.scrollLeft&&Zi(e,i.scrollLeft)}function Ui(e,t){var i=e.display,n=bi(e.display);t.top<0&&(t.top=0);var r=e.curOp&&null!=e.curOp.scrollTop?e.curOp.scrollTop:i.scroller.scrollTop,o=qt(e),s={};t.bottom-t.top>o&&(t.bottom=t.top+o);var a=e.doc.height+zt(i),l=t.top<n,c=t.bottom>a-n;if(t.top<r)s.scrollTop=l?0:t.top;else if(t.bottom>r+o){var d=Math.min(t.top,(c?a:t.bottom)-o);d!=r&&(s.scrollTop=d)}var u=e.curOp&&null!=e.curOp.scrollLeft?e.curOp.scrollLeft:i.scroller.scrollLeft,h=jt(e)-(e.options.fixedGutter?i.gutters.offsetWidth:0),p=t.right-t.left>h;return p&&(t.right=t.left+h),t.left<10?s.scrollLeft=0:t.left<u?s.scrollLeft=Math.max(0,t.left-(p?0:10)):t.right>h+u-3&&(s.scrollLeft=t.right+(p?0:10)-h),s}function ji(e,t){null!=t&&(Vi(e),e.curOp.scrollTop=(null==e.curOp.scrollTop?e.doc.scrollTop:e.curOp.scrollTop)+t)}function qi(e){Vi(e);var t=e.getCursor();e.curOp.scrollToPos={from:t,to:t,margin:e.options.cursorScrollMargin}}function Gi(e,t,i){null==t&&null==i||Vi(e),null!=t&&(e.curOp.scrollLeft=t),null!=i&&(e.curOp.scrollTop=i)}function Ki(e,t){Vi(e),e.curOp.scrollToPos=t}function Vi(e){var t=e.curOp.scrollToPos;t&&(e.curOp.scrollToPos=null,Yi(e,hi(e,t.from),hi(e,t.to),t.margin))}function Yi(e,t,i,n){var r=Ui(e,{left:Math.min(t.left,i.left),top:Math.min(t.top,i.top)-n,right:Math.max(t.right,i.right),bottom:Math.max(t.bottom,i.bottom)+n});Gi(e,r.scrollLeft,r.scrollTop)}function Xi(e,t){Math.abs(e.doc.scrollTop-t)<2||(ds||An(e,{top:t}),Qi(e,t,!0),ds&&An(e),xn(e,100))}function Qi(e,t,i){t=Math.min(e.display.scroller.scrollHeight-e.display.scroller.clientHeight,t),(e.display.scroller.scrollTop!=t||i)&&(e.doc.scrollTop=t,e.display.scrollbars.setScrollTop(t),e.display.scroller.scrollTop!=t&&(e.display.scroller.scrollTop=t))}function Zi(e,t,i,n){t=Math.min(t,e.display.scroller.scrollWidth-e.display.scroller.clientWidth),(i?t==e.doc.scrollLeft:Math.abs(e.doc.scrollLeft-t)<2)&&!n||(e.doc.scrollLeft=t,Fi(e),e.display.scroller.scrollLeft!=t&&(e.display.scroller.scrollLeft=t),e.display.scrollbars.setScrollLeft(t))}function Ji(e){var t=e.display,i=t.gutters.offsetWidth,n=Math.round(e.doc.height+zt(e.display));return{clientHeight:t.scroller.clientHeight,viewHeight:t.wrapper.clientHeight,scrollWidth:t.scroller.scrollWidth,clientWidth:t.scroller.clientWidth,viewWidth:t.wrapper.clientWidth,barLeft:e.options.fixedGutter?i:0,docHeight:n,scrollHeight:n+Ut(e)+t.barHeight,nativeBarWidth:t.nativeBarWidth,gutterWidth:i}}function en(e,t){t||(t=Ji(e));var i=e.display.barWidth,n=e.display.barHeight;tn(e,t);for(var r=0;r<4&&i!=e.display.barWidth||n!=e.display.barHeight;r++)i!=e.display.barWidth&&e.options.lineWrapping&&Ii(e),tn(e,Ji(e)),i=e.display.barWidth,n=e.display.barHeight}function tn(e,t){var i=e.display,n=i.scrollbars.update(t);i.sizer.style.paddingRight=(i.barWidth=n.right)+"px",i.sizer.style.paddingBottom=(i.barHeight=n.bottom)+"px",i.heightForcer.style.borderBottom=n.bottom+"px solid transparent",n.right&&n.bottom?(i.scrollbarFiller.style.display="block",i.scrollbarFiller.style.height=n.bottom+"px",i.scrollbarFiller.style.width=n.right+"px"):i.scrollbarFiller.style.display="",n.bottom&&e.options.coverGutterNextToScrollbar&&e.options.fixedGutter?(i.gutterFiller.style.display="block",i.gutterFiller.style.height=n.bottom+"px",i.gutterFiller.style.width=t.gutterWidth+"px"):i.gutterFiller.style.display=""}function nn(e){e.display.scrollbars&&(e.display.scrollbars.clear(),e.display.scrollbars.addClass&&Ms(e.display.wrapper,e.display.scrollbars.addClass)),e.display.scrollbars=new wa[e.options.scrollbarStyle](function(t){e.display.wrapper.insertBefore(t,e.display.scrollbarFiller),Zs(t,"mousedown",function(){e.state.focused&&setTimeout(function(){return e.display.input.focus()},0)}),t.setAttribute("cm-not-content","true")},function(t,i){"horizontal"==i?Zi(e,t):Xi(e,t)},e),e.display.scrollbars.addClass&&a(e.display.wrapper,e.display.scrollbars.addClass)}function rn(e){e.curOp={cm:e,viewChanged:!1,startHeight:e.doc.height,forceUpdate:!1,updateInput:null,typing:!1,changeObjs:null,cursorActivityHandlers:null,cursorActivityCalled:0,selectionChanged:!1,updateMaxLine:!1,scrollLeft:null,scrollTop:null,scrollToPos:null,focus:!1,id:++ka},kt(e.curOp)}function on(e){_t(e.curOp,function(e){for(var t=0;t<e.ops.length;t++)e.ops[t].cm.curOp=null;sn(e)})}function sn(e){for(var t=e.ops,i=0;i<t.length;i++)an(t[i]);for(var n=0;n<t.length;n++)ln(t[n]);for(var r=0;r<t.length;r++)cn(t[r]);for(var o=0;o<t.length;o++)dn(t[o]);for(var s=0;s<t.length;s++)un(t[s])}function an(e){var t=e.cm,i=t.display;Cn(t),e.updateMaxLine&&we(t),e.mustUpdate=e.viewChanged||e.forceUpdate||null!=e.scrollTop||e.scrollToPos&&(e.scrollToPos.from.line<i.viewFrom||e.scrollToPos.to.line>=i.viewTo)||i.maxLineChanged&&t.options.lineWrapping,e.update=e.mustUpdate&&new xa(t,e.mustUpdate&&{top:e.scrollTop,ensure:e.scrollToPos},e.forceUpdate)}function ln(e){e.updatedDisplay=e.mustUpdate&&En(e.cm,e.update)}function cn(e){var t=e.cm,i=t.display;e.updatedDisplay&&Ii(t),e.barMeasure=Ji(t),i.maxLineChanged&&!t.options.lineWrapping&&(e.adjustWidthTo=Yt(t,i.maxLine,i.maxLine.text.length).left+3,t.display.sizerWidth=e.adjustWidthTo,e.barMeasure.scrollWidth=Math.max(i.scroller.clientWidth,i.sizer.offsetLeft+e.adjustWidthTo+Ut(t)+t.display.barWidth),e.maxScrollLeft=Math.max(0,i.sizer.offsetLeft+e.adjustWidthTo-jt(t))),(e.updatedDisplay||e.selectionChanged)&&(e.preparedSelection=i.input.prepareSelection(e.focus))}function dn(e){var t=e.cm;null!=e.adjustWidthTo&&(t.display.sizer.style.minWidth=e.adjustWidthTo+"px",e.maxScrollLeft<t.doc.scrollLeft&&Zi(t,Math.min(t.display.scroller.scrollLeft,e.maxScrollLeft),!0),t.display.maxLineChanged=!1);var i=e.focus&&e.focus==s()&&(!document.hasFocus||document.hasFocus());e.preparedSelection&&t.display.input.showSelection(e.preparedSelection,i),(e.updatedDisplay||e.startHeight!=t.doc.height)&&en(t,e.barMeasure),e.updatedDisplay&&On(t,e.barMeasure),e.selectionChanged&&Li(t),t.state.focused&&e.updateInput&&t.display.input.reset(e.typing),i&&Ni(e.cm)}function un(e){var t=e.cm,i=t.display,n=t.doc;(e.updatedDisplay&&$n(t,e.update),null==i.wheelStartX||null==e.scrollTop&&null==e.scrollLeft&&!e.scrollToPos||(i.wheelStartX=i.wheelStartY=null),null!=e.scrollTop&&Qi(t,e.scrollTop,e.forceScroll),null!=e.scrollLeft&&Zi(t,e.scrollLeft,!0,!0),e.scrollToPos)&&Hi(t,zi(t,W(n,e.scrollToPos.from),W(n,e.scrollToPos.to),e.scrollToPos.margin));var r=e.maybeHiddenMarkers,o=e.maybeUnhiddenMarkers;if(r)for(var s=0;s<r.length;++s)r[s].lines.length||Le(r[s],"hide");if(o)for(var a=0;a<o.length;++a)o[a].lines.length&&Le(o[a],"unhide");i.wrapper.offsetHeight&&(n.scrollTop=t.display.scroller.scrollTop),e.changeObjs&&Le(t,"changes",t,e.changeObjs),e.update&&e.update.finish()}function hn(e,t){if(e.curOp)return t();rn(e);try{return t()}finally{on(e)}}function pn(e,t){return function(){if(e.curOp)return t.apply(e,arguments);rn(e);try{return t.apply(e,arguments)}finally{on(e)}}}function fn(e){return function(){if(this.curOp)return e.apply(this,arguments);rn(this);try{return e.apply(this,arguments)}finally{on(this)}}}function mn(e){return function(){var t=this.cm;if(!t||t.curOp)return e.apply(this,arguments);rn(t);try{return e.apply(this,arguments)}finally{on(t)}}}function gn(e,t,i,n){null==t&&(t=e.doc.first),null==i&&(i=e.doc.first+e.doc.size),n||(n=0);var r=e.display;if(n&&i<r.viewTo&&(null==r.updateLineNumbers||r.updateLineNumbers>t)&&(r.updateLineNumbers=t),e.curOp.viewChanged=!0,t>=r.viewTo)Vs&&fe(e.doc,t)<r.viewTo&&bn(e);else if(i<=r.viewFrom)Vs&&me(e.doc,i+n)>r.viewFrom?bn(e):(r.viewFrom+=n,r.viewTo+=n);else if(t<=r.viewFrom&&i>=r.viewTo)bn(e);else if(t<=r.viewFrom){var o=yn(e,i,i+n,1);o?(r.view=r.view.slice(o.index),r.viewFrom=o.lineN,r.viewTo+=n):bn(e)}else if(i>=r.viewTo){var s=yn(e,t,t,-1);s?(r.view=r.view.slice(0,s.index),r.viewTo=s.lineN):bn(e)}else{var a=yn(e,t,t,-1),l=yn(e,i,i+n,1);a&&l?(r.view=r.view.slice(0,a.index).concat(wt(e,a.lineN,l.lineN)).concat(r.view.slice(l.index)),r.viewTo+=n):bn(e)}var c=r.externalMeasured;c&&(i<c.lineN?c.lineN+=n:t<c.lineN+c.size&&(r.externalMeasured=null))}function vn(e,t,i){e.curOp.viewChanged=!0;var n=e.display,r=e.display.externalMeasured;if(r&&t>=r.lineN&&t<r.lineN+r.size&&(n.externalMeasured=null),!(t<n.viewFrom||t>=n.viewTo)){var o=n.view[Ti(e,t)];if(null!=o.node){var s=o.changes||(o.changes=[]);-1==h(s,i)&&s.push(i)}}}function bn(e){e.display.viewFrom=e.display.viewTo=e.doc.first,e.display.view=[],e.display.viewOffset=0}function yn(e,t,i,n){var r,o=Ti(e,t),s=e.display.view;if(!Vs||i==e.doc.first+e.doc.size)return{index:o,lineN:i};for(var a=e.display.viewFrom,l=0;l<o;l++)a+=s[l].size;if(a!=t){if(n>0){if(o==s.length-1)return null;r=a+s[o].size-t,o++}else r=a-t;t+=r,i+=r}for(;fe(e.doc,i)!=i;){if(o==(n<0?0:s.length-1))return null;i+=n*s[o-(n<0?1:0)].size,o+=n}return{index:o,lineN:i}}function wn(e,t,i){var n=e.display;0==n.view.length||t>=n.viewTo||i<=n.viewFrom?(n.view=wt(e,t,i),n.viewFrom=t):(n.viewFrom>t?n.view=wt(e,t,n.viewFrom).concat(n.view):n.viewFrom<t&&(n.view=n.view.slice(Ti(e,t))),n.viewFrom=t,n.viewTo<i?n.view=n.view.concat(wt(e,n.viewTo,i)):n.viewTo>i&&(n.view=n.view.slice(0,Ti(e,i)))),n.viewTo=i}function kn(e){for(var t=e.display.view,i=0,n=0;n<t.length;n++){var r=t[n];r.hidden||r.node&&!r.changes||++i}return i}function xn(e,t){e.doc.highlightFrontier<e.display.viewTo&&e.state.highlight.set(t,c(_n,e))}function _n(e){var t=e.doc;if(!(t.highlightFrontier>=e.display.viewTo)){var i=+new Date+e.options.workTime,n=et(e,t.highlightFrontier),r=[];t.iter(n.line,Math.min(t.first+t.size,e.display.viewTo+500),function(o){if(n.line>=e.display.viewFrom){var s=o.styles,a=o.text.length>e.options.maxHighlightLength?Ye(t.mode,n.state):null,l=Ze(e,o,n,!0);a&&(n.state=a),o.styles=l.styles;var c=o.styleClasses,d=l.classes;d?o.styleClasses=d:c&&(o.styleClasses=null);for(var u=!s||s.length!=o.styles.length||c!=d&&(!c||!d||c.bgClass!=d.bgClass||c.textClass!=d.textClass),h=0;!u&&h<s.length;++h)u=s[h]!=o.styles[h];u&&r.push(n.line),o.stateAfter=n.save(),n.nextLine()}else o.text.length<=e.options.maxHighlightLength&&tt(e,o.text,n),o.stateAfter=n.line%5==0?n.save():null,n.nextLine();if(+new Date>i)return xn(e,e.options.workDelay),!0}),t.highlightFrontier=n.line,t.modeFrontier=Math.max(t.modeFrontier,n.line),r.length&&hn(e,function(){for(var t=0;t<r.length;t++)vn(e,r[t],"text")})}}function Cn(e){var t=e.display;!t.scrollbarsClipped&&t.scroller.offsetWidth&&(t.nativeBarWidth=t.scroller.offsetWidth-t.scroller.clientWidth,t.heightForcer.style.height=Ut(e)+"px",t.sizer.style.marginBottom=-t.nativeBarWidth+"px",t.sizer.style.borderRightWidth=Ut(e)+"px",t.scrollbarsClipped=!0)}function Tn(e){if(e.hasFocus())return null;var t=s();if(!t||!o(e.display.lineDiv,t))return null;var i={activeElt:t};if(window.getSelection){var n=window.getSelection();n.anchorNode&&n.extend&&o(e.display.lineDiv,n.anchorNode)&&(i.anchorNode=n.anchorNode,i.anchorOffset=n.anchorOffset,i.focusNode=n.focusNode,i.focusOffset=n.focusOffset)}return i}function Sn(e){if(e&&e.activeElt&&e.activeElt!=s()&&(e.activeElt.focus(),e.anchorNode&&o(document.body,e.anchorNode)&&o(document.body,e.focusNode))){var t=window.getSelection(),i=document.createRange();i.setEnd(e.anchorNode,e.anchorOffset),i.collapse(!1),t.removeAllRanges(),t.addRange(i),t.extend(e.focusNode,e.focusOffset)}}function En(e,i){var n=e.display,r=e.doc;if(i.editorIsHidden)return bn(e),!1;if(!i.force&&i.visible.from>=n.viewFrom&&i.visible.to<=n.viewTo&&(null==n.updateLineNumbers||n.updateLineNumbers>=n.viewTo)&&n.renderedView==n.view&&0==kn(e))return!1;Bi(e)&&(bn(e),i.dims=wi(e));var o=r.first+r.size,s=Math.max(i.visible.from-e.options.viewportMargin,r.first),a=Math.min(o,i.visible.to+e.options.viewportMargin);n.viewFrom<s&&s-n.viewFrom<20&&(s=Math.max(r.first,n.viewFrom)),n.viewTo>a&&n.viewTo-a<20&&(a=Math.min(o,n.viewTo)),Vs&&(s=fe(e.doc,s),a=me(e.doc,a));var l=s!=n.viewFrom||a!=n.viewTo||n.lastWrapHeight!=i.wrapperHeight||n.lastWrapWidth!=i.wrapperWidth;wn(e,s,a),n.viewOffset=be(E(e.doc,n.viewFrom)),e.display.mover.style.top=n.viewOffset+"px";var c=kn(e);if(!l&&0==c&&!i.force&&n.renderedView==n.view&&(null==n.updateLineNumbers||n.updateLineNumbers>=n.viewTo))return!1;var d=Tn(e);return c>4&&(n.lineDiv.style.display="none"),Ln(e,n.updateLineNumbers,i.dims),c>4&&(n.lineDiv.style.display=""),n.renderedView=n.view,Sn(d),t(n.cursorDiv),t(n.selectionDiv),n.gutters.style.height=n.sizer.style.minHeight=0,l&&(n.lastWrapHeight=i.wrapperHeight,n.lastWrapWidth=i.wrapperWidth,xn(e,400)),n.updateLineNumbers=null,!0}function $n(e,t){for(var i=t.viewport,n=!0;(n&&e.options.lineWrapping&&t.oldDisplayWidth!=jt(e)||(i&&null!=i.top&&(i={top:Math.min(e.doc.height+zt(e.display)-qt(e),i.top)}),t.visible=Di(e.display,e.doc,i),!(t.visible.from>=e.display.viewFrom&&t.visible.to<=e.display.viewTo)))&&En(e,t);n=!1){Ii(e);var r=Ji(e);Si(e),en(e,r),On(e,r),t.force=!1}t.signal(e,"update",e),e.display.viewFrom==e.display.reportedViewFrom&&e.display.viewTo==e.display.reportedViewTo||(t.signal(e,"viewportChange",e,e.display.viewFrom,e.display.viewTo),e.display.reportedViewFrom=e.display.viewFrom,e.display.reportedViewTo=e.display.viewTo)}function An(e,t){var i=new xa(e,t);if(En(e,i)){Ii(e),$n(e,i);var n=Ji(e);Si(e),en(e,n),On(e,n),i.finish()}}function Ln(e,i,n){function r(t){var i=t.nextSibling;return gs&&Ss&&e.display.currentWheelTarget==t?t.style.display="none":t.parentNode.removeChild(t),i}for(var o=e.display,s=e.options.lineNumbers,a=o.lineDiv,l=a.firstChild,c=o.view,d=o.viewFrom,u=0;u<c.length;u++){var p=c[u];if(p.hidden);else if(p.node&&p.node.parentNode==a){for(;l!=p.node;)l=r(l);var f=s&&null!=i&&i<=d&&p.lineNumber;p.changes&&(h(p.changes,"gutter")>-1&&(f=!1),St(e,p,d,n)),f&&(t(p.lineNumber),p.lineNumber.appendChild(document.createTextNode(P(e.options,d)))),l=p.node.nextSibling}else{var m=Pt(e,p,d,n);a.insertBefore(m,l)}d+=p.size}for(;l;)l=r(l)}function Nn(e){var t=e.display.gutters.offsetWidth;e.display.sizer.style.marginLeft=t+"px"}function On(e,t){e.display.sizer.style.minHeight=t.docHeight+"px",e.display.heightForcer.style.top=t.docHeight+"px",e.display.gutters.style.height=t.docHeight+e.display.barHeight+Ut(e)+"px"}function Mn(e){var i=e.display.gutters,r=e.options.gutters;t(i);for(var o=0;o<r.length;++o){var s=r[o],a=i.appendChild(n("div",null,"CodeMirror-gutter "+s));"CodeMirror-linenumbers"==s&&(e.display.lineGutter=a,a.style.width=(e.display.lineNumWidth||1)+"px")}i.style.display=o?"":"none",Nn(e)}function Pn(e){var t=h(e.gutters,"CodeMirror-linenumbers");-1==t&&e.lineNumbers?e.gutters=e.gutters.concat(["CodeMirror-linenumbers"]):t>-1&&!e.lineNumbers&&(e.gutters=e.gutters.slice(0),e.gutters.splice(t,1))}function In(e){var t=e.wheelDeltaX,i=e.wheelDeltaY;return null==t&&e.detail&&e.axis==e.HORIZONTAL_AXIS&&(t=e.detail),null==i&&e.detail&&e.axis==e.VERTICAL_AXIS?i=e.detail:null==i&&(i=e.wheelDelta),{x:t,y:i}}function Rn(e){var t=In(e);return t.x*=Ca,t.y*=Ca,t}function Dn(e,t){var i=In(t),n=i.x,r=i.y,o=e.display,s=o.scroller,a=s.scrollWidth>s.clientWidth,l=s.scrollHeight>s.clientHeight;if(n&&a||r&&l){if(r&&Ss&&gs)e:for(var c=t.target,d=o.view;c!=s;c=c.parentNode)for(var u=0;u<d.length;u++)if(d[u].node==c){e.display.currentWheelTarget=c;break e}if(n&&!ds&&!ys&&null!=Ca)return r&&l&&Xi(e,Math.max(0,s.scrollTop+r*Ca)),Zi(e,Math.max(0,s.scrollLeft+n*Ca)),(!r||r&&l)&&Ie(t),void(o.wheelStartX=null);if(r&&null!=Ca){var h=r*Ca,p=e.doc.scrollTop,f=p+o.wrapper.clientHeight;h<0?p=Math.max(0,p+h-50):f=Math.min(e.doc.height,f+h+50),An(e,{top:p,bottom:f})}_a<20&&(null==o.wheelStartX?(o.wheelStartX=s.scrollLeft,o.wheelStartY=s.scrollTop,o.wheelDX=n,o.wheelDY=r,setTimeout(function(){if(null!=o.wheelStartX){var e=s.scrollLeft-o.wheelStartX,t=s.scrollTop-o.wheelStartY,i=t&&o.wheelDY&&t/o.wheelDY||e&&o.wheelDX&&e/o.wheelDX;o.wheelStartX=o.wheelStartY=null,i&&(Ca=(Ca*_a+i)/(_a+1),++_a)}},200)):(o.wheelDX+=n,o.wheelDY+=r))}}function Fn(e,t){var i=e[t];e.sort(function(e,t){return R(e.from(),t.from())}),t=h(e,i);for(var n=1;n<e.length;n++){var r=e[n],o=e[n-1];if(R(o.to(),r.from())>=0){var s=H(o.from(),r.from()),a=B(o.to(),r.to()),l=o.empty()?r.from()==r.head:o.from()==o.head;n<=t&&--t,e.splice(--n,2,new Sa(l?a:s,l?s:a))}}return new Ta(e,t)}function Bn(e,t){return new Ta([new Sa(e,t||e)],0)}function Hn(e){return e.text?I(e.from.line+e.text.length-1,m(e.text).length+(1==e.text.length?e.from.ch:0)):e.to}function zn(e,t){if(R(e,t.from)<0)return e;if(R(e,t.to)<=0)return Hn(t);var i=e.line+t.text.length-(t.to.line-t.from.line)-1,n=e.ch;return e.line==t.to.line&&(n+=Hn(t).ch-t.to.ch),I(i,n)}function Wn(e,t){for(var i=[],n=0;n<e.sel.ranges.length;n++){var r=e.sel.ranges[n];i.push(new Sa(zn(r.anchor,t),zn(r.head,t)))}return Fn(i,e.sel.primIndex)}function Un(e,t,i){return e.line==t.line?I(i.line,e.ch-t.ch+i.ch):I(i.line+(e.line-t.line),e.ch)}function jn(e,t,i){for(var n=[],r=I(e.first,0),o=r,s=0;s<t.length;s++){var a=t[s],l=Un(a.from,r,o),c=Un(Hn(a),r,o);if(r=a.to,o=c,"around"==i){var d=e.sel.ranges[s],u=R(d.head,d.anchor)<0;n[s]=new Sa(u?c:l,u?l:c)}else n[s]=new Sa(l,l)}return new Ta(n,e.sel.primIndex)}function qn(e){e.doc.mode=Ke(e.options,e.doc.modeOption),Gn(e)}function Gn(e){e.doc.iter(function(e){e.stateAfter&&(e.stateAfter=null),e.styles&&(e.styles=null)}),e.doc.modeFrontier=e.doc.highlightFrontier=e.doc.first,
xn(e,100),e.state.modeGen++,e.curOp&&gn(e)}function Kn(e,t){return 0==t.from.ch&&0==t.to.ch&&""==m(t.text)&&(!e.cm||e.cm.options.wholeLineUpdateBefore)}function Vn(e,t,i,n){function r(e){return i?i[e]:null}function o(e,i,r){ct(e,i,r,n),Ct(e,"change",e,t)}function s(e,t){for(var i=[],o=e;o<t;++o)i.push(new ua(c[o],r(o),n));return i}var a=t.from,l=t.to,c=t.text,d=E(e,a.line),u=E(e,l.line),h=m(c),p=r(c.length-1),f=l.line-a.line;if(t.full)e.insert(0,s(0,c.length)),e.remove(c.length,e.size-c.length);else if(Kn(e,t)){var g=s(0,c.length-1);o(u,u.text,p),f&&e.remove(a.line,f),g.length&&e.insert(a.line,g)}else if(d==u)if(1==c.length)o(d,d.text.slice(0,a.ch)+h+d.text.slice(l.ch),p);else{var v=s(1,c.length-1);v.push(new ua(h+d.text.slice(l.ch),p,n)),o(d,d.text.slice(0,a.ch)+c[0],r(0)),e.insert(a.line+1,v)}else if(1==c.length)o(d,d.text.slice(0,a.ch)+c[0]+u.text.slice(l.ch),r(0)),e.remove(a.line+1,f);else{o(d,d.text.slice(0,a.ch)+c[0],r(0)),o(u,h+u.text.slice(l.ch),p);var b=s(1,c.length-1);f>1&&e.remove(a.line+1,f-1),e.insert(a.line+1,b)}Ct(e,"change",e,t)}function Yn(e,t,i){function n(e,r,o){if(e.linked)for(var s=0;s<e.linked.length;++s){var a=e.linked[s];if(a.doc!=r){var l=o&&a.sharedHist;i&&!l||(t(a.doc,l),n(a.doc,e,l))}}}n(e,null,!0)}function Xn(e,t){if(t.cm)throw new Error("This document is already in use.");e.doc=t,t.cm=e,_i(e),qn(e),Qn(e),e.options.lineWrapping||we(e),e.options.mode=t.modeOption,gn(e)}function Qn(e){("rtl"==e.doc.direction?a:Ms)(e.display.lineDiv,"CodeMirror-rtl")}function Zn(e){hn(e,function(){Qn(e),gn(e)})}function Jn(e){this.done=[],this.undone=[],this.undoDepth=Infinity,this.lastModTime=this.lastSelTime=0,this.lastOp=this.lastSelOp=null,this.lastOrigin=this.lastSelOrigin=null,this.generation=this.maxGeneration=e||1}function er(e,t){var i={from:F(t.from),to:Hn(t),text:$(e,t.from,t.to)};return ar(e,i,t.from.line,t.to.line+1),Yn(e,function(e){return ar(e,i,t.from.line,t.to.line+1)},!0),i}function tr(e){for(;e.length;){if(!m(e).ranges)break;e.pop()}}function ir(e,t){return t?(tr(e.done),m(e.done)):e.done.length&&!m(e.done).ranges?m(e.done):e.done.length>1&&!e.done[e.done.length-2].ranges?(e.done.pop(),m(e.done)):void 0}function nr(e,t,i,n){var r=e.history;r.undone.length=0;var o,s,a=+new Date;if((r.lastOp==n||r.lastOrigin==t.origin&&t.origin&&("+"==t.origin.charAt(0)&&e.cm&&r.lastModTime>a-e.cm.options.historyEventDelay||"*"==t.origin.charAt(0)))&&(o=ir(r,r.lastOp==n)))s=m(o.changes),0==R(t.from,t.to)&&0==R(t.from,s.to)?s.to=Hn(t):o.changes.push(er(e,t));else{var l=m(r.done);for(l&&l.ranges||sr(e.sel,r.done),o={changes:[er(e,t)],generation:r.generation},r.done.push(o);r.done.length>r.undoDepth;)r.done.shift(),r.done[0].ranges||r.done.shift()}r.done.push(i),r.generation=++r.maxGeneration,r.lastModTime=r.lastSelTime=a,r.lastOp=r.lastSelOp=n,r.lastOrigin=r.lastSelOrigin=t.origin,s||Le(e,"historyAdded")}function rr(e,t,i,n){var r=t.charAt(0);return"*"==r||"+"==r&&i.ranges.length==n.ranges.length&&i.somethingSelected()==n.somethingSelected()&&new Date-e.history.lastSelTime<=(e.cm?e.cm.options.historyEventDelay:500)}function or(e,t,i,n){var r=e.history,o=n&&n.origin;i==r.lastSelOp||o&&r.lastSelOrigin==o&&(r.lastModTime==r.lastSelTime&&r.lastOrigin==o||rr(e,o,m(r.done),t))?r.done[r.done.length-1]=t:sr(t,r.done),r.lastSelTime=+new Date,r.lastSelOrigin=o,r.lastSelOp=i,n&&!1!==n.clearRedo&&tr(r.undone)}function sr(e,t){var i=m(t);i&&i.ranges&&i.equals(e)||t.push(e)}function ar(e,t,i,n){var r=t["spans_"+e.id],o=0;e.iter(Math.max(e.first,i),Math.min(e.first+e.size,n),function(i){i.markedSpans&&((r||(r=t["spans_"+e.id]={}))[o]=i.markedSpans),++o})}function lr(e){if(!e)return null;for(var t,i=0;i<e.length;++i)e[i].marker.explicitlyCleared?t||(t=e.slice(0,i)):t&&t.push(e[i]);return t?t.length?t:null:e}function cr(e,t){var i=t["spans_"+e.id];if(!i)return null;for(var n=[],r=0;r<t.text.length;++r)n.push(lr(i[r]));return n}function dr(e,t){var i=cr(e,t),n=J(e,t);if(!i)return n;if(!n)return i;for(var r=0;r<i.length;++r){var o=i[r],s=n[r];if(o&&s)e:for(var a=0;a<s.length;++a){for(var l=s[a],c=0;c<o.length;++c)if(o[c].marker==l.marker)continue e;o.push(l)}else s&&(i[r]=s)}return i}function ur(e,t,i){for(var n=[],r=0;r<e.length;++r){var o=e[r];if(o.ranges)n.push(i?Ta.prototype.deepCopy.call(o):o);else{var s=o.changes,a=[];n.push({changes:a});for(var l=0;l<s.length;++l){var c=s[l],d=void 0;if(a.push({from:c.from,to:c.to,text:c.text}),t)for(var u in c)(d=u.match(/^spans_(\d+)$/))&&h(t,Number(d[1]))>-1&&(m(a)[u]=c[u],delete c[u])}}}return n}function hr(e,t,i,n){if(n){var r=e.anchor;if(i){var o=R(t,r)<0;o!=R(i,r)<0?(r=t,t=i):o!=R(t,i)<0&&(t=i)}return new Sa(r,t)}return new Sa(i||t,t)}function pr(e,t,i,n,r){null==r&&(r=e.cm&&(e.cm.display.shift||e.extend)),yr(e,new Ta([hr(e.sel.primary(),t,i,r)],0),n)}function fr(e,t,i){for(var n=[],r=e.cm&&(e.cm.display.shift||e.extend),o=0;o<e.sel.ranges.length;o++)n[o]=hr(e.sel.ranges[o],t[o],null,r);yr(e,Fn(n,e.sel.primIndex),i)}function mr(e,t,i,n){var r=e.sel.ranges.slice(0);r[t]=i,yr(e,Fn(r,e.sel.primIndex),n)}function gr(e,t,i,n){yr(e,Bn(t,i),n)}function vr(e,t,i){var n={ranges:t.ranges,update:function(t){var i=this;this.ranges=[];for(var n=0;n<t.length;n++)i.ranges[n]=new Sa(W(e,t[n].anchor),W(e,t[n].head))},origin:i&&i.origin};return Le(e,"beforeSelectionChange",e,n),e.cm&&Le(e.cm,"beforeSelectionChange",e.cm,n),n.ranges!=t.ranges?Fn(n.ranges,n.ranges.length-1):t}function br(e,t,i){var n=e.history.done,r=m(n);r&&r.ranges?(n[n.length-1]=t,wr(e,t,i)):yr(e,t,i)}function yr(e,t,i){wr(e,t,i),or(e,e.sel,e.cm?e.cm.curOp.id:NaN,i)}function wr(e,t,i){(Me(e,"beforeSelectionChange")||e.cm&&Me(e.cm,"beforeSelectionChange"))&&(t=vr(e,t,i)),kr(e,_r(e,t,i&&i.bias||(R(t.primary().head,e.sel.primary().head)<0?-1:1),!0)),i&&!1===i.scroll||!e.cm||qi(e.cm)}function kr(e,t){t.equals(e.sel)||(e.sel=t,e.cm&&(e.cm.curOp.updateInput=e.cm.curOp.selectionChanged=!0,Oe(e.cm)),Ct(e,"cursorActivity",e))}function xr(e){kr(e,_r(e,e.sel,null,!1))}function _r(e,t,i,n){for(var r,o=0;o<t.ranges.length;o++){var s=t.ranges[o],a=t.ranges.length==e.sel.ranges.length&&e.sel.ranges[o],l=Tr(e,s.anchor,a&&a.anchor,i,n),c=Tr(e,s.head,a&&a.head,i,n);(r||l!=s.anchor||c!=s.head)&&(r||(r=t.ranges.slice(0,o)),r[o]=new Sa(l,c))}return r?Fn(r,t.primIndex):t}function Cr(e,t,i,n,r){var o=E(e,t.line);if(o.markedSpans)for(var s=0;s<o.markedSpans.length;++s){var a=o.markedSpans[s],l=a.marker;if((null==a.from||(l.inclusiveLeft?a.from<=t.ch:a.from<t.ch))&&(null==a.to||(l.inclusiveRight?a.to>=t.ch:a.to>t.ch))){if(r&&(Le(l,"beforeCursorEnter"),l.explicitlyCleared)){if(o.markedSpans){--s;continue}break}if(!l.atomic)continue;if(i){var c=l.find(n<0?1:-1),d=void 0;if((n<0?l.inclusiveRight:l.inclusiveLeft)&&(c=Sr(e,c,-n,c&&c.line==t.line?o:null)),c&&c.line==t.line&&(d=R(c,i))&&(n<0?d<0:d>0))return Cr(e,c,t,n,r)}var u=l.find(n<0?-1:1);return(n<0?l.inclusiveLeft:l.inclusiveRight)&&(u=Sr(e,u,n,u.line==t.line?o:null)),u?Cr(e,u,t,n,r):null}}return t}function Tr(e,t,i,n,r){var o=n||1,s=Cr(e,t,i,o,r)||!r&&Cr(e,t,i,o,!0)||Cr(e,t,i,-o,r)||!r&&Cr(e,t,i,-o,!0);return s||(e.cantEdit=!0,I(e.first,0))}function Sr(e,t,i,n){return i<0&&0==t.ch?t.line>e.first?W(e,I(t.line-1)):null:i>0&&t.ch==(n||E(e,t.line)).text.length?t.line<e.first+e.size-1?I(t.line+1,0):null:new I(t.line,t.ch+i)}function Er(e){e.setSelection(I(e.firstLine(),0),I(e.lastLine()),zs)}function $r(e,t,i){var n={canceled:!1,from:t.from,to:t.to,text:t.text,origin:t.origin,cancel:function(){return n.canceled=!0}};return i&&(n.update=function(t,i,r,o){t&&(n.from=W(e,t)),i&&(n.to=W(e,i)),r&&(n.text=r),o!==undefined&&(n.origin=o)}),Le(e,"beforeChange",e,n),e.cm&&Le(e.cm,"beforeChange",e.cm,n),n.canceled?null:{from:n.from,to:n.to,text:n.text,origin:n.origin}}function Ar(e,t,i){if(e.cm){if(!e.cm.curOp)return pn(e.cm,Ar)(e,t,i);if(e.cm.state.suppressEdits)return}if(!(Me(e,"beforeChange")||e.cm&&Me(e.cm,"beforeChange"))||(t=$r(e,t,!0))){var n=Ks&&!i&&te(e,t.from,t.to);if(n)for(var r=n.length-1;r>=0;--r)Lr(e,{from:n[r].from,to:n[r].to,text:r?[""]:t.text});else Lr(e,t)}}function Lr(e,t){if(1!=t.text.length||""!=t.text[0]||0!=R(t.from,t.to)){var i=Wn(e,t);nr(e,t,i,e.cm?e.cm.curOp.id:NaN),Mr(e,t,i,J(e,t));var n=[];Yn(e,function(e,i){i||-1!=h(n,e.history)||(Fr(e.history,t),n.push(e.history)),Mr(e,t,null,J(e,t))})}}function Nr(e,t,i){if(!e.cm||!e.cm.state.suppressEdits||i){for(var n,r=e.history,o=e.sel,s="undo"==t?r.done:r.undone,a="undo"==t?r.undone:r.done,l=0;l<s.length&&(n=s[l],i?!n.ranges||n.equals(e.sel):n.ranges);l++);if(l!=s.length){for(r.lastOrigin=r.lastSelOrigin=null;(n=s.pop()).ranges;){if(sr(n,a),i&&!n.equals(e.sel))return void yr(e,n,{clearRedo:!1});o=n}var c=[];sr(o,a),a.push({changes:c,generation:r.generation}),r.generation=n.generation||++r.maxGeneration;for(var d=Me(e,"beforeChange")||e.cm&&Me(e.cm,"beforeChange"),u=function(i){var r=n.changes[i];if(r.origin=t,d&&!$r(e,r,!1))return s.length=0,{};c.push(er(e,r));var o=i?Wn(e,r):m(s);Mr(e,r,o,dr(e,r)),!i&&e.cm&&e.cm.scrollIntoView({from:r.from,to:Hn(r)});var a=[];Yn(e,function(e,t){t||-1!=h(a,e.history)||(Fr(e.history,r),a.push(e.history)),Mr(e,r,null,dr(e,r))})},p=n.changes.length-1;p>=0;--p){var f=u(p);if(f)return f.v}}}}function Or(e,t){if(0!=t&&(e.first+=t,e.sel=new Ta(g(e.sel.ranges,function(e){return new Sa(I(e.anchor.line+t,e.anchor.ch),I(e.head.line+t,e.head.ch))}),e.sel.primIndex),e.cm)){gn(e.cm,e.first,e.first-t,t);for(var i=e.cm.display,n=i.viewFrom;n<i.viewTo;n++)vn(e.cm,n,"gutter")}}function Mr(e,t,i,n){if(e.cm&&!e.cm.curOp)return pn(e.cm,Mr)(e,t,i,n);if(t.to.line<e.first)Or(e,t.text.length-1-(t.to.line-t.from.line));else if(!(t.from.line>e.lastLine())){if(t.from.line<e.first){var r=t.text.length-1-(e.first-t.from.line);Or(e,r),t={from:I(e.first,0),to:I(t.to.line+r,t.to.ch),text:[m(t.text)],origin:t.origin}}var o=e.lastLine();t.to.line>o&&(t={from:t.from,to:I(o,E(e,o).text.length),text:[t.text[0]],origin:t.origin}),t.removed=$(e,t.from,t.to),i||(i=Wn(e,t)),e.cm?Pr(e.cm,t,n):Vn(e,t,n),wr(e,i,zs)}}function Pr(e,t,i){var n=e.doc,r=e.display,o=t.from,s=t.to,a=!1,l=o.line;e.options.lineWrapping||(l=N(ue(E(n,o.line))),n.iter(l,s.line+1,function(e){if(e==r.maxLine)return a=!0,!0})),n.sel.contains(t.from,t.to)>-1&&Oe(e),Vn(n,t,i,xi(e)),e.options.lineWrapping||(n.iter(l,o.line+t.text.length,function(e){var t=ye(e);t>r.maxLineLength&&(r.maxLine=e,r.maxLineLength=t,r.maxLineChanged=!0,a=!1)}),a&&(e.curOp.updateMaxLine=!0)),lt(n,o.line),xn(e,400);var c=t.text.length-(s.line-o.line)-1;t.full?gn(e):o.line!=s.line||1!=t.text.length||Kn(e.doc,t)?gn(e,o.line,s.line+1,c):vn(e,o.line,"text");var d=Me(e,"changes"),u=Me(e,"change");if(u||d){var h={from:o,to:s,text:t.text,removed:t.removed,origin:t.origin};u&&Ct(e,"change",e,h),d&&(e.curOp.changeObjs||(e.curOp.changeObjs=[])).push(h)}e.display.selForContextMenu=null}function Ir(e,t,i,n,r){if(n||(n=i),R(n,i)<0){var o=n;n=i,i=o}"string"==typeof t&&(t=e.splitLines(t)),Ar(e,{from:i,to:n,text:t,origin:r})}function Rr(e,t,i,n){i<e.line?e.line+=n:t<e.line&&(e.line=t,e.ch=0)}function Dr(e,t,i,n){for(var r=0;r<e.length;++r){var o=e[r],s=!0;if(o.ranges){o.copied||((o=e[r]=o.deepCopy()).copied=!0);for(var a=0;a<o.ranges.length;a++)Rr(o.ranges[a].anchor,t,i,n),Rr(o.ranges[a].head,t,i,n)}else{for(var l=0;l<o.changes.length;++l){var c=o.changes[l];if(i<c.from.line)c.from=I(c.from.line+n,c.from.ch),c.to=I(c.to.line+n,c.to.ch);else if(t<=c.to.line){s=!1;break}}s||(e.splice(0,r+1),r=0)}}}function Fr(e,t){var i=t.from.line,n=t.to.line,r=t.text.length-(n-i)-1;Dr(e.done,i,n,r),Dr(e.undone,i,n,r)}function Br(e,t,i,n){var r=t,o=t;return"number"==typeof t?o=E(e,z(e,t)):r=N(t),null==r?null:(n(o,r)&&e.cm&&vn(e.cm,r,i),o)}function Hr(e){var t=this;this.lines=e,this.parent=null;for(var i=0,n=0;n<e.length;++n)e[n].parent=t,i+=e[n].height;this.height=i}function zr(e){var t=this;this.children=e;for(var i=0,n=0,r=0;r<e.length;++r){var o=e[r];i+=o.chunkSize(),n+=o.height,o.parent=t}this.size=i,this.height=n,this.parent=null}function Wr(e,t,i){be(t)<(e.curOp&&e.curOp.scrollTop||e.doc.scrollTop)&&ji(e,i)}function Ur(e,t,i,n){var r=new Ea(e,i,n),o=e.cm;return o&&r.noHScroll&&(o.display.alignWidgets=!0),Br(e,t,"widget",function(t){var i=t.widgets||(t.widgets=[]);if(null==r.insertAt?i.push(r):i.splice(Math.min(i.length-1,Math.max(0,r.insertAt)),0,r),r.line=t,o&&!ge(e,t)){var n=be(t)<e.scrollTop;L(t,t.height+Ft(r)),n&&ji(o,r.height),o.curOp.forceUpdate=!0}return!0}),Ct(o,"lineWidgetAdded",o,r,"number"==typeof t?t:N(t)),r}function jr(e,t,i,n,o){if(n&&n.shared)return qr(e,t,i,n,o);if(e.cm&&!e.cm.curOp)return pn(e.cm,jr)(e,t,i,n,o);var s=new Aa(e,o),a=R(t,i);if(n&&d(n,s,!1),a>0||0==a&&!1!==s.clearWhenEmpty)return s;if(s.replacedWith&&(s.collapsed=!0,s.widgetNode=r("span",[s.replacedWith],"CodeMirror-widget"),n.handleMouseEvents||s.widgetNode.setAttribute("cm-ignore-events","true"),n.insertLeft&&(s.widgetNode.insertLeft=!0)),s.collapsed){if(de(e,t.line,t,i,s)||t.line!=i.line&&de(e,i.line,t,i,s))throw new Error("Inserting collapsed marker partially overlapping an existing one");G()}s.addToHistory&&nr(e,{from:t,to:i,origin:"markText"},e.sel,NaN);var l,c=t.line,u=e.cm;if(e.iter(c,i.line+1,function(e){u&&s.collapsed&&!u.options.lineWrapping&&ue(e)==u.display.maxLine&&(l=!0),s.collapsed&&c!=t.line&&L(e,0),X(e,new K(s,c==t.line?t.ch:null,c==i.line?i.ch:null)),++c}),s.collapsed&&e.iter(t.line,i.line+1,function(t){ge(e,t)&&L(t,0)}),s.clearOnEnter&&Zs(s,"beforeCursorEnter",function(){return s.clear()}),s.readOnly&&(q(),(e.history.done.length||e.history.undone.length)&&e.clearHistory()),s.collapsed&&(s.id=++$a,s.atomic=!0),u){if(l&&(u.curOp.updateMaxLine=!0),s.collapsed)gn(u,t.line,i.line+1);else if(s.className||s.title||s.startStyle||s.endStyle||s.css)for(var h=t.line;h<=i.line;h++)vn(u,h,"text");s.atomic&&xr(u.doc),Ct(u,"markerAdded",u,s)}return s}function qr(e,t,i,n,r){(n=d(n)).shared=!1;var o=[jr(e,t,i,n,r)],s=o[0],a=n.widgetNode;return Yn(e,function(e){a&&(n.widgetNode=a.cloneNode(!0)),o.push(jr(e,W(e,t),W(e,i),n,r));for(var l=0;l<e.linked.length;++l)if(e.linked[l].isParent)return;s=m(o)}),new La(o,s)}function Gr(e){return e.findMarks(I(e.first,0),e.clipPos(I(e.lastLine())),function(e){return e.parent})}function Kr(e,t){for(var i=0;i<t.length;i++){var n=t[i],r=n.find(),o=e.clipPos(r.from),s=e.clipPos(r.to);if(R(o,s)){var a=jr(e,o,s,n.primary,n.primary.type);n.markers.push(a),a.parent=n}}}function Vr(e){for(var t=function(t){var i=e[t],n=[i.primary.doc];Yn(i.primary.doc,function(e){return n.push(e)});for(var r=0;r<i.markers.length;r++){var o=i.markers[r];-1==h(n,o.doc)&&(o.parent=null,i.markers.splice(r--,1))}},i=0;i<e.length;i++)t(i)}function Yr(e){var t=this;if(Zr(t),!Ne(t,e)&&!Bt(t.display,e)){Ie(e),fs&&(Ma=+new Date);var i=Ci(t,e,!0),n=e.dataTransfer.files;if(i&&!t.isReadOnly())if(n&&n.length&&window.FileReader&&window.File)for(var r=n.length,o=Array(r),s=0,a=function(e,n){if(!t.options.allowDropFileTypes||-1!=h(t.options.allowDropFileTypes,e.type)){var a=new FileReader;a.onload=pn(t,function(){var e=a.result;if(/[\x00-\x08\x0e-\x1f]{2}/.test(e)&&(e=""),o[n]=e,++s==r){var l={from:i=W(t.doc,i),to:i,text:t.doc.splitLines(o.join(t.doc.lineSeparator())),origin:"paste"};Ar(t.doc,l),br(t.doc,Bn(i,Hn(l)))}}),a.readAsText(e)}},l=0;l<r;++l)a(n[l],l);else{if(t.state.draggingText&&t.doc.sel.contains(i)>-1)return t.state.draggingText(e),void setTimeout(function(){return t.display.input.focus()},20);try{var c=e.dataTransfer.getData("Text");if(c){var d;if(t.state.draggingText&&!t.state.draggingText.copy&&(d=t.listSelections()),wr(t.doc,Bn(i,i)),d)for(var u=0;u<d.length;++u)Ir(t.doc,"",d[u].anchor,d[u].head,"drag");t.replaceSelection(c,"around","paste"),t.display.input.focus()}}catch(e){}}}}function Xr(e,t){if(fs&&(!e.state.draggingText||+new Date-Ma<100))Fe(t);else if(!Ne(e,t)&&!Bt(e.display,t)&&(t.dataTransfer.setData("Text",e.getSelection()),t.dataTransfer.effectAllowed="copyMove",t.dataTransfer.setDragImage&&!ws)){var i=n("img",null,null,"position: fixed; left: 0; top: 0;");i.src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==",ys&&(i.width=i.height=1,e.display.wrapper.appendChild(i),i._top=i.offsetTop),t.dataTransfer.setDragImage(i,0,0),ys&&i.parentNode.removeChild(i)}}function Qr(e,t){var r=Ci(e,t);if(r){var o=document.createDocumentFragment();$i(e,r,o),e.display.dragCursor||(e.display.dragCursor=n("div",null,"CodeMirror-cursors CodeMirror-dragcursors"),e.display.lineSpace.insertBefore(e.display.dragCursor,e.display.cursorDiv)),i(e.display.dragCursor,o)}}function Zr(e){e.display.dragCursor&&(e.display.lineSpace.removeChild(e.display.dragCursor),e.display.dragCursor=null)}function Jr(e){if(document.getElementsByClassName)for(var t=document.getElementsByClassName("CodeMirror"),i=0;i<t.length;i++){var n=t[i].CodeMirror;n&&e(n)}}function eo(){Pa||(to(),Pa=!0)}function to(){var e;Zs(window,"resize",function(){null==e&&(e=setTimeout(function(){e=null,Jr(io)},100))}),Zs(window,"blur",function(){return Jr(Pi)})}function io(e){var t=e.display;t.lastWrapHeight==t.wrapper.clientHeight&&t.lastWrapWidth==t.wrapper.clientWidth||(t.cachedCharWidth=t.cachedTextHeight=t.cachedPaddingH=null,t.scrollbarsClipped=!1,e.setSize())}function no(e){var t,i,n,r,o=e.split(/-(?!$)/);e=o[o.length-1];for(var s=0;s<o.length-1;s++){var a=o[s];if(/^(cmd|meta|m)$/i.test(a))r=!0;else if(/^a(lt)?$/i.test(a))t=!0;else if(/^(c|ctrl|control)$/i.test(a))i=!0;else{if(!/^s(hift)?$/i.test(a))throw new Error("Unrecognized modifier name: "+a);n=!0}}return t&&(e="Alt-"+e),i&&(e="Ctrl-"+e),r&&(e="Cmd-"+e),n&&(e="Shift-"+e),e}function ro(e){var t={};for(var i in e)if(e.hasOwnProperty(i)){var n=e[i];if(/^(name|fallthrough|(de|at)tach)$/.test(i))continue;if("..."==n){delete e[i];continue}for(var r=g(i.split(" "),no),o=0;o<r.length;o++){var s=void 0,a=void 0;o==r.length-1?(a=r.join(" "),s=n):(a=r.slice(0,o+1).join(" "),s="...");var l=t[a];if(l){if(l!=s)throw new Error("Inconsistent bindings for "+a)}else t[a]=s}delete e[i]}for(var c in t)e[c]=t[c];return e}function oo(e,t,i,n){var r=(t=co(t)).call?t.call(e,n):t[e];if(!1===r)return"nothing";if("..."===r)return"multi";if(null!=r&&i(r))return"handled";if(t.fallthrough){if("[object Array]"!=Object.prototype.toString.call(t.fallthrough))return oo(e,t.fallthrough,i,n);for(var o=0;o<t.fallthrough.length;o++){var s=oo(e,t.fallthrough[o],i,n);if(s)return s}}}function so(e){var t="string"==typeof e?e:Ia[e.keyCode];return"Ctrl"==t||"Alt"==t||"Shift"==t||"Mod"==t}function ao(e,t,i){var n=e;return t.altKey&&"Alt"!=n&&(e="Alt-"+e),(Ns?t.metaKey:t.ctrlKey)&&"Ctrl"!=n&&(e="Ctrl-"+e),(Ns?t.ctrlKey:t.metaKey)&&"Cmd"!=n&&(e="Cmd-"+e),!i&&t.shiftKey&&"Shift"!=n&&(e="Shift-"+e),e}function lo(e,t){if(ys&&34==e.keyCode&&e["char"])return!1;var i=Ia[e.keyCode];return null!=i&&!e.altGraphKey&&ao(i,e,t)}function co(e){return"string"==typeof e?Ba[e]:e}function uo(e,t){for(var i=e.doc.sel.ranges,n=[],r=0;r<i.length;r++){for(var o=t(i[r]);n.length&&R(o.from,m(n).to)<=0;){var s=n.pop();if(R(s.from,o.from)<0){o.from=s.from;break}}n.push(o)}hn(e,function(){for(var t=n.length-1;t>=0;t--)Ir(e.doc,"",n[t].from,n[t].to,"+delete");qi(e)})}function ho(e,t){var i=E(e.doc,t),n=ue(i);return n!=i&&(t=N(n)),Se(!0,e,n,t,1)}function po(e,t){var i=E(e.doc,t),n=he(i);return n!=i&&(t=N(n)),Se(!0,e,i,t,-1)}function fo(e,t){var i=ho(e,t.line),n=E(e.doc,i.line),r=_e(n,e.doc.direction);if(!r||0==r[0].level){var o=Math.max(0,n.text.search(/\S/)),s=t.line==i.line&&t.ch<=o&&t.ch;return I(i.line,s?0:o,i.sticky)}return i}function mo(e,t,i){if("string"==typeof t&&!(t=Wa[t]))return!1;e.display.input.ensurePolled();var n=e.display.shift,r=!1;try{e.isReadOnly()&&(e.state.suppressEdits=!0),i&&(e.display.shift=!1),r=t(e)!=Hs}finally{e.display.shift=n,e.state.suppressEdits=!1}return r}function go(e,t,i){for(var n=0;n<e.state.keyMaps.length;n++){var r=oo(t,e.state.keyMaps[n],i,e);if(r)return r}return e.options.extraKeys&&oo(t,e.options.extraKeys,i,e)||oo(t,e.options.keyMap,i,e)}function vo(e,t,i,n){var r=e.state.keySeq;if(r){if(so(t))return"handled";Ua.set(50,function(){e.state.keySeq==r&&(e.state.keySeq=null,e.display.input.reset())}),t=r+" "+t}var o=go(e,t,n);return"multi"==o&&(e.state.keySeq=t),"handled"==o&&Ct(e,"keyHandled",e,t,i),"handled"!=o&&"multi"!=o||(Ie(i),Li(e)),r&&!o&&/\'$/.test(t)?(Ie(i),!0):!!o}function bo(e,t){var i=lo(t,!0);return!!i&&(t.shiftKey&&!e.state.keySeq?vo(e,"Shift-"+i,t,function(t){return mo(e,t,!0)})||vo(e,i,t,function(t){if("string"==typeof t?/^go[A-Z]/.test(t):t.motion)return mo(e,t)}):vo(e,i,t,function(t){return mo(e,t)}))}function yo(e,t,i){return vo(e,"'"+i+"'",t,function(t){return mo(e,t,!0)})}function wo(e){var t=this;if(t.curOp.focus=s(),!Ne(t,e)){fs&&ms<11&&27==e.keyCode&&(e.returnValue=!1);var i=e.keyCode;t.display.shift=16==i||e.shiftKey;var n=bo(t,e);ys&&(ja=n?i:null,!n&&88==i&&!ia&&(Ss?e.metaKey:e.ctrlKey)&&t.replaceSelection("",null,"cut")),18!=i||/\bCodeMirror-crosshair\b/.test(t.display.lineDiv.className)||ko(t)}}function ko(e){function t(e){18!=e.keyCode&&e.altKey||(Ms(i,"CodeMirror-crosshair"),Ae(document,"keyup",t),Ae(document,"mouseover",t))}var i=e.display.lineDiv;a(i,"CodeMirror-crosshair"),Zs(document,"keyup",t),Zs(document,"mouseover",t)}function xo(e){16==e.keyCode&&(this.doc.sel.shift=!1),Ne(this,e)}function _o(e){var t=this;if(!(Bt(t.display,e)||Ne(t,e)||e.ctrlKey&&!e.altKey||Ss&&e.metaKey)){var i=e.keyCode,n=e.charCode;if(ys&&i==ja)return ja=null,void Ie(e);if(!ys||e.which&&!(e.which<10)||!bo(t,e)){var r=String.fromCharCode(null==n?i:n);"\b"!=r&&(yo(t,e,r)||t.display.input.onKeyPress(e))}}}function Co(e,t){var i=+new Date;return za&&za.compare(i,e,t)?(Ha=za=null,"triple"):Ha&&Ha.compare(i,e,t)?(za=new Ga(i,e,t),Ha=null,"double"):(Ha=new Ga(i,e,t),za=null,"single")}function To(e){var t=this,i=t.display;if(!(Ne(t,e)||i.activeTouch&&i.input.supportsTouch()))if(i.input.ensurePolled(),i.shift=e.shiftKey,Bt(i,e))gs||(i.scroller.draggable=!1,setTimeout(function(){return i.scroller.draggable=!0},100));else if(!Mo(t,e)){var n=Ci(t,e),r=He(e),o=n?Co(n,r):"single";window.focus(),1==r&&t.state.selectingText&&t.state.selectingText(e),n&&So(t,r,n,o,e)||(1==r?n?$o(t,n,o,e):Be(e)==i.scroller&&Ie(e):2==r?(n&&pr(t.doc,n),setTimeout(function(){return i.input.focus()},20)):3==r&&(Os?Po(t,e):Oi(t)))}}function So(e,t,i,n,r){var o="Click";return"double"==n?o="Double"+o:"triple"==n&&(o="Triple"+o),vo(e,ao(o=(1==t?"Left":2==t?"Middle":"Right")+o,r),r,function(t){if("string"==typeof t&&(t=Wa[t]),!t)return!1;var n=!1;try{e.isReadOnly()&&(e.state.suppressEdits=!0),n=t(e,i)!=Hs}finally{e.state.suppressEdits=!1}return n})}function Eo(e,t,i){var n=e.getOption("configureMouse"),r=n?n(e,t,i):{};if(null==r.unit){var o=Es?i.shiftKey&&i.metaKey:i.altKey;r.unit=o?"rectangle":"single"==t?"char":"double"==t?"word":"line"}return(null==r.extend||e.doc.extend)&&(r.extend=e.doc.extend||i.shiftKey),null==r.addNew&&(r.addNew=Ss?i.metaKey:i.ctrlKey),null==r.moveOnDrag&&(r.moveOnDrag=!(Ss?i.altKey:i.ctrlKey)),r}function $o(e,t,i,n){fs?setTimeout(c(Ni,e),0):e.curOp.focus=s();var r,o=Eo(e,i,n),a=e.doc.sel;e.options.dragDrop&&Js&&!e.isReadOnly()&&"single"==i&&(r=a.contains(t))>-1&&(R((r=a.ranges[r]).from(),t)<0||t.xRel>0)&&(R(r.to(),t)>0||t.xRel<0)?Ao(e,n,t,o):No(e,n,t,o)}function Ao(e,t,i,n){var r=e.display,o=!1,s=pn(e,function(t){gs&&(r.scroller.draggable=!1),e.state.draggingText=!1,Ae(document,"mouseup",s),Ae(document,"mousemove",a),Ae(r.scroller,"dragstart",l),Ae(r.scroller,"drop",s),o||(Ie(t),n.addNew||pr(e.doc,i,null,null,n.extend),gs||fs&&9==ms?setTimeout(function(){document.body.focus(),r.input.focus()},20):r.input.focus())}),a=function(e){o=o||Math.abs(t.clientX-e.clientX)+Math.abs(t.clientY-e.clientY)>=10},l=function(){return o=!0};gs&&(r.scroller.draggable=!0),e.state.draggingText=s,s.copy=!n.moveOnDrag,r.scroller.dragDrop&&r.scroller.dragDrop(),Zs(document,"mouseup",s),Zs(document,"mousemove",a),Zs(r.scroller,"dragstart",l),Zs(r.scroller,"drop",s),Oi(e),setTimeout(function(){return r.input.focus()},20)}function Lo(e,t,i){if("char"==i)return new Sa(t,t);if("word"==i)return e.findWordAt(t);if("line"==i)return new Sa(I(t.line,0),W(e.doc,I(t.line+1,0)));var n=i(e,t);return new Sa(n.from,n.to)}function No(e,t,i,n){function r(t){if(0!=R(v,t))if(v=t,"rectangle"==n.unit){for(var r=[],o=e.options.tabSize,s=u(E(c,i.line).text,i.ch,o),a=u(E(c,t.line).text,t.ch,o),l=Math.min(s,a),m=Math.max(s,a),g=Math.min(i.line,t.line),b=Math.min(e.lastLine(),Math.max(i.line,t.line));g<=b;g++){var y=E(c,g).text,w=p(y,l,o);l==m?r.push(new Sa(I(g,w),I(g,w))):y.length>w&&r.push(new Sa(I(g,w),I(g,p(y,m,o))))}r.length||r.push(new Sa(i,i)),yr(c,Fn(f.ranges.slice(0,h).concat(r),h),{origin:"*mouse",scroll:!1}),e.scrollIntoView(t)}else{var k,x=d,_=Lo(e,t,n.unit),C=x.anchor;R(_.anchor,C)>0?(k=_.head,C=H(x.from(),_.anchor)):(k=_.anchor,C=B(x.to(),_.head));var T=f.ranges.slice(0);T[h]=new Sa(W(c,C),k),yr(c,Fn(T,h),Ws)}}function o(t){var i=++y,a=Ci(e,t,!0,"rectangle"==n.unit);if(a)if(0!=R(a,v)){e.curOp.focus=s(),r(a);var d=Di(l,c);(a.line>=d.to||a.line<d.from)&&setTimeout(pn(e,function(){y==i&&o(t)}),150)}else{var u=t.clientY<b.top?-20:t.clientY>b.bottom?20:0;u&&setTimeout(pn(e,function(){y==i&&(l.scroller.scrollTop+=u,o(t))}),50)}}function a(t){e.state.selectingText=!1,y=Infinity,Ie(t),l.input.focus(),Ae(document,"mousemove",w),Ae(document,"mouseup",k),c.history.lastSelOrigin=null}var l=e.display,c=e.doc;Ie(t);var d,h,f=c.sel,m=f.ranges;if(n.addNew&&!n.extend?(h=c.sel.contains(i),d=h>-1?m[h]:new Sa(i,i)):(d=c.sel.primary(),h=c.sel.primIndex),"rectangle"==n.unit)n.addNew||(d=new Sa(i,i)),i=Ci(e,t,!0,!0),h=-1;else{var g=Lo(e,i,n.unit);d=n.extend?hr(d,g.anchor,g.head,n.extend):g}n.addNew?-1==h?(h=m.length,yr(c,Fn(m.concat([d]),h),{scroll:!1,origin:"*mouse"})):m.length>1&&m[h].empty()&&"char"==n.unit&&!n.extend?(yr(c,Fn(m.slice(0,h).concat(m.slice(h+1)),0),{scroll:!1,origin:"*mouse"}),f=c.sel):mr(c,h,d,Ws):(h=0,yr(c,new Ta([d],0),Ws),f=c.sel);var v=i,b=l.wrapper.getBoundingClientRect(),y=0,w=pn(e,function(e){He(e)?o(e):a(e)}),k=pn(e,a);e.state.selectingText=k,Zs(document,"mousemove",w),Zs(document,"mouseup",k)}function Oo(e,t,i,n){var r,o;try{r=t.clientX,o=t.clientY}catch(t){return!1}if(r>=Math.floor(e.display.gutters.getBoundingClientRect().right))return!1;n&&Ie(t);var s=e.display,a=s.lineDiv.getBoundingClientRect();if(o>a.bottom||!Me(e,i))return De(t);o-=a.top-s.viewOffset;for(var l=0;l<e.options.gutters.length;++l){var c=s.gutters.childNodes[l];if(c&&c.getBoundingClientRect().right>=r)return Le(e,i,e,O(e.doc,o),e.options.gutters[l],t),De(t)}}function Mo(e,t){return Oo(e,t,"gutterClick",!0)}function Po(e,t){Bt(e.display,t)||Io(e,t)||Ne(e,t,"contextmenu")||e.display.input.onContextMenu(t)}function Io(e,t){return!!Me(e,"gutterContextMenu")&&Oo(e,t,"gutterContextMenu",!1)}function Ro(e){e.display.wrapper.className=e.display.wrapper.className.replace(/\s*cm-s-\S+/g,"")+e.options.theme.replace(/(^|\s)\s*/g," cm-s-"),oi(e)}function Do(e){function t(t,n,r,o){e.defaults[t]=n,r&&(i[t]=o?function(e,t,i){i!=Ka&&r(e,t,i)}:r)}var i=e.optionHandlers;e.defineOption=t,e.Init=Ka,t("value","",function(e,t){return e.setValue(t)},!0),t("mode",null,function(e,t){e.doc.modeOption=t,qn(e)},!0),t("indentUnit",2,qn,!0),t("indentWithTabs",!1),t("smartIndent",!0),t("tabSize",4,function(e){Gn(e),oi(e),gn(e)},!0),t("lineSeparator",null,function(e,t){if(e.doc.lineSep=t,t){var i=[],n=e.doc.first;e.doc.iter(function(e){for(var r=0;;){var o=e.text.indexOf(t,r);if(-1==o)break;r=o+t.length,i.push(I(n,o))}n++});for(var r=i.length-1;r>=0;r--)Ir(e.doc,t,i[r],I(i[r].line,i[r].ch+t.length))}}),t("specialChars",/[\u0000-\u001f\u007f-\u009f\u00ad\u061c\u200b-\u200f\u2028\u2029\ufeff]/g,function(e,t,i){e.state.specialChars=new RegExp(t.source+(t.test("\t")?"":"|\t"),"g"),i!=Ka&&e.refresh()}),t("specialCharPlaceholder",pt,function(e){return e.refresh()},!0),t("electricChars",!0),t("inputStyle",Ts?"contenteditable":"textarea",function(){throw new Error("inputStyle can not (yet) be changed in a running editor")},!0),t("spellcheck",!1,function(e,t){return e.getInputField().spellcheck=t},!0),t("rtlMoveVisually",!$s),t("wholeLineUpdateBefore",!0),t("theme","default",function(e){Ro(e),Fo(e)},!0),t("keyMap","default",function(e,t,i){var n=co(t),r=i!=Ka&&co(i);r&&r.detach&&r.detach(e,n),n.attach&&n.attach(e,r||null)}),t("extraKeys",null),t("configureMouse",null),t("lineWrapping",!1,Ho,!0),t("gutters",[],function(e){Pn(e.options),Fo(e)},!0),t("fixedGutter",!0,function(e,t){e.display.gutters.style.left=t?ki(e.display)+"px":"0",e.refresh()},!0),t("coverGutterNextToScrollbar",!1,function(e){return en(e)},!0),t("scrollbarStyle","native",function(e){nn(e),en(e),e.display.scrollbars.setScrollTop(e.doc.scrollTop),e.display.scrollbars.setScrollLeft(e.doc.scrollLeft)},!0),t("lineNumbers",!1,function(e){Pn(e.options),Fo(e)},!0),t("firstLineNumber",1,Fo,!0),t("lineNumberFormatter",function(e){return e},Fo,!0),t("showCursorWhenSelecting",!1,Si,!0),t("resetSelectionOnContextMenu",!0),t("lineWiseCopyCut",!0),t("pasteLinesPerSelection",!0),t("readOnly",!1,function(e,t){"nocursor"==t&&(Pi(e),e.display.input.blur()),e.display.input.readOnlyChanged(t)}),t("disableInput",!1,function(e,t){t||e.display.input.reset()},!0),t("dragDrop",!0,Bo),t("allowDropFileTypes",null),t("cursorBlinkRate",530),t("cursorScrollMargin",0),t("cursorHeight",1,Si,!0),t("singleCursorHeightPerLine",!0,Si,!0),t("workTime",100),t("workDelay",100),t("flattenSpans",!0,Gn,!0),t("addModeClass",!1,Gn,!0),t("pollInterval",100),t("undoDepth",200,function(e,t){return e.doc.history.undoDepth=t}),t("historyEventDelay",1250),t("viewportMargin",10,function(e){return e.refresh()},!0),t("maxHighlightLength",1e4,Gn,!0),t("moveInputWithCursor",!0,function(e,t){t||e.display.input.resetPosition()}),t("tabindex",null,function(e,t){return e.display.input.getField().tabIndex=t||""}),t("autofocus",null),t("direction","ltr",function(e,t){return e.doc.setDirection(t)},!0)}function Fo(e){Mn(e),gn(e),Fi(e)}function Bo(e,t,i){if(!t!=!(i&&i!=Ka)){var n=e.display.dragFunctions,r=t?Zs:Ae;r(e.display.scroller,"dragstart",n.start),r(e.display.scroller,"dragenter",n.enter),r(e.display.scroller,"dragover",n.over),r(e.display.scroller,"dragleave",n.leave),r(e.display.scroller,"drop",n.drop)}}function Ho(e){e.options.lineWrapping?(a(e.display.wrapper,"CodeMirror-wrap"),e.display.sizer.style.minWidth="",e.display.sizerWidth=null):(Ms(e.display.wrapper,"CodeMirror-wrap"),we(e)),_i(e),gn(e),oi(e),setTimeout(function(){return en(e)},100)}function zo(e,t){var i=this;if(!(this instanceof zo))return new zo(e,t);this.options=t=t?d(t):{},d(Va,t,!1),Pn(t);var n=t.value;"string"==typeof n&&(n=new Oa(n,t.mode,null,t.lineSeparator,t.direction)),this.doc=n;var r=new zo.inputStyles[t.inputStyle](this),o=this.display=new S(e,n,r);for(var s in o.wrapper.CodeMirror=this,Mn(this),Ro(this),t.lineWrapping&&(this.display.wrapper.className+=" CodeMirror-wrap"),nn(this),this.state={keyMaps:[],overlays:[],modeGen:0,overwrite:!1,delayingBlurEvent:!1,focused:!1,suppressEdits:!1,pasteIncoming:!1,cutIncoming:!1,selectingText:!1,draggingText:!1,highlight:new Is,keySeq:null,specialChars:null},t.autofocus&&!Ts&&o.input.focus(),fs&&ms<11&&setTimeout(function(){return i.display.input.reset(!0)},20),Wo(this),eo(),rn(this),this.curOp.forceUpdate=!0,Xn(this,n),t.autofocus&&!Ts||this.hasFocus()?setTimeout(c(Mi,this),20):Pi(this),Ya)Ya.hasOwnProperty(s)&&Ya[s](i,t[s],Ka);Bi(this),t.finishInit&&t.finishInit(this);for(var a=0;a<Xa.length;++a)Xa[a](i);on(this),gs&&t.lineWrapping&&"optimizelegibility"==getComputedStyle(o.lineDiv).textRendering&&(o.lineDiv.style.textRendering="auto")}function Wo(e){function t(){r.activeTouch&&(o=setTimeout(function(){return r.activeTouch=null},1e3),(s=r.activeTouch).end=+new Date)}function i(e){if(1!=e.touches.length)return!1;var t=e.touches[0];return t.radiusX<=1&&t.radiusY<=1}function n(e,t){if(null==t.left)return!0;var i=t.left-e.left,n=t.top-e.top;return i*i+n*n>400}var r=e.display;Zs(r.scroller,"mousedown",pn(e,To)),Zs(r.scroller,"dblclick",fs&&ms<11?pn(e,function(t){if(!Ne(e,t)){var i=Ci(e,t);if(i&&!Mo(e,t)&&!Bt(e.display,t)){Ie(t);var n=e.findWordAt(i);pr(e.doc,n.anchor,n.head)}}}):function(t){return Ne(e,t)||Ie(t)}),Os||Zs(r.scroller,"contextmenu",function(t){return Po(e,t)});var o,s={end:0};Zs(r.scroller,"touchstart",function(t){if(!Ne(e,t)&&!i(t)){r.input.ensurePolled(),clearTimeout(o);var n=+new Date;r.activeTouch={start:n,moved:!1,prev:n-s.end<=300?s:null},1==t.touches.length&&(r.activeTouch.left=t.touches[0].pageX,r.activeTouch.top=t.touches[0].pageY)}}),Zs(r.scroller,"touchmove",function(){r.activeTouch&&(r.activeTouch.moved=!0)}),Zs(r.scroller,"touchend",function(i){var o=r.activeTouch;if(o&&!Bt(r,i)&&null!=o.left&&!o.moved&&new Date-o.start<300){var s,a=e.coordsChar(r.activeTouch,"page")
;s=!o.prev||n(o,o.prev)?new Sa(a,a):!o.prev.prev||n(o,o.prev.prev)?e.findWordAt(a):new Sa(I(a.line,0),W(e.doc,I(a.line+1,0))),e.setSelection(s.anchor,s.head),e.focus(),Ie(i)}t()}),Zs(r.scroller,"touchcancel",t),Zs(r.scroller,"scroll",function(){r.scroller.clientHeight&&(Xi(e,r.scroller.scrollTop),Zi(e,r.scroller.scrollLeft,!0),Le(e,"scroll",e))}),Zs(r.scroller,"mousewheel",function(t){return Dn(e,t)}),Zs(r.scroller,"DOMMouseScroll",function(t){return Dn(e,t)}),Zs(r.wrapper,"scroll",function(){return r.wrapper.scrollTop=r.wrapper.scrollLeft=0}),r.dragFunctions={enter:function(t){Ne(e,t)||Fe(t)},over:function(t){Ne(e,t)||(Qr(e,t),Fe(t))},start:function(t){return Xr(e,t)},drop:pn(e,Yr),leave:function(t){Ne(e,t)||Zr(e)}};var a=r.input.getField();Zs(a,"keyup",function(t){return xo.call(e,t)}),Zs(a,"keydown",pn(e,wo)),Zs(a,"keypress",pn(e,_o)),Zs(a,"focus",function(t){return Mi(e,t)}),Zs(a,"blur",function(t){return Pi(e,t)})}function Uo(e,t,i,n){var r,o=e.doc;null==i&&(i="add"),"smart"==i&&(o.mode.indent?r=et(e,t).state:i="prev");var s=e.options.tabSize,a=E(o,t),l=u(a.text,null,s);a.stateAfter&&(a.stateAfter=null);var c,d=a.text.match(/^\s*/)[0];if(n||/\S/.test(a.text)){if("smart"==i&&((c=o.mode.indent(r,a.text.slice(d.length),a.text))==Hs||c>150)){if(!n)return;i="prev"}}else c=0,i="not";"prev"==i?c=t>o.first?u(E(o,t-1).text,null,s):0:"add"==i?c=l+e.options.indentUnit:"subtract"==i?c=l-e.options.indentUnit:"number"==typeof i&&(c=l+i),c=Math.max(0,c);var h="",p=0;if(e.options.indentWithTabs)for(var m=Math.floor(c/s);m;--m)p+=s,h+="\t";if(p<c&&(h+=f(c-p)),h!=d)return Ir(o,h,I(t,0),I(t,d.length),"+input"),a.stateAfter=null,!0;for(var g=0;g<o.sel.ranges.length;g++){var v=o.sel.ranges[g];if(v.head.line==t&&v.head.ch<d.length){var b=I(t,d.length);mr(o,g,new Sa(b,b));break}}}function jo(e){Qa=e}function qo(e,t,i,n,r){var o=e.doc;e.display.shift=!1,n||(n=o.sel);var s,a=e.state.pasteIncoming||"paste"==r,l=ea(t),c=null;if(a&&n.ranges.length>1)if(Qa&&Qa.text.join("\n")==t){if(n.ranges.length%Qa.text.length==0){c=[];for(var d=0;d<Qa.text.length;d++)c.push(o.splitLines(Qa.text[d]))}}else l.length==n.ranges.length&&e.options.pasteLinesPerSelection&&(c=g(l,function(e){return[e]}));for(var u=n.ranges.length-1;u>=0;u--){var h=n.ranges[u],p=h.from(),f=h.to();h.empty()&&(i&&i>0?p=I(p.line,p.ch-i):e.state.overwrite&&!a?f=I(f.line,Math.min(E(o,f.line).text.length,f.ch+m(l).length)):Qa&&Qa.lineWise&&Qa.text.join("\n")==t&&(p=f=I(p.line,0))),s=e.curOp.updateInput;var v={from:p,to:f,text:c?c[u%c.length]:l,origin:r||(a?"paste":e.state.cutIncoming?"cut":"+input")};Ar(e.doc,v),Ct(e,"inputRead",e,v)}t&&!a&&Ko(e,t),qi(e),e.curOp.updateInput=s,e.curOp.typing=!0,e.state.pasteIncoming=e.state.cutIncoming=!1}function Go(e,t){var i=e.clipboardData&&e.clipboardData.getData("Text");if(i)return e.preventDefault(),t.isReadOnly()||t.options.disableInput||hn(t,function(){return qo(t,i,0,null,"paste")}),!0}function Ko(e,t){if(e.options.electricChars&&e.options.smartIndent)for(var i=e.doc.sel,n=i.ranges.length-1;n>=0;n--){var r=i.ranges[n];if(!(r.head.ch>100||n&&i.ranges[n-1].head.line==r.head.line)){var o=e.getModeAt(r.head),s=!1;if(o.electricChars){for(var a=0;a<o.electricChars.length;a++)if(t.indexOf(o.electricChars.charAt(a))>-1){s=Uo(e,r.head.line,"smart");break}}else o.electricInput&&o.electricInput.test(E(e.doc,r.head.line).text.slice(0,r.head.ch))&&(s=Uo(e,r.head.line,"smart"));s&&Ct(e,"electricInput",e,r.head.line)}}}function Vo(e){for(var t=[],i=[],n=0;n<e.doc.sel.ranges.length;n++){var r=e.doc.sel.ranges[n].head.line,o={anchor:I(r,0),head:I(r+1,0)};i.push(o),t.push(e.getRange(o.anchor,o.head))}return{text:t,ranges:i}}function Yo(e,t){e.setAttribute("autocorrect","off"),e.setAttribute("autocapitalize","off"),e.setAttribute("spellcheck",!!t)}function Xo(){var e=n("textarea",null,null,"position: absolute; bottom: -1em; padding: 0; width: 1px; height: 1em; outline: none"),t=n("div",[e],null,"overflow: hidden; position: relative; width: 3px; height: 0px;");return gs?e.style.width="1000px":e.setAttribute("wrap","off"),_s&&(e.style.border="1px solid black"),Yo(e),t}function Qo(e){var t=e.optionHandlers,i=e.helpers={};e.prototype={constructor:e,focus:function(){window.focus(),this.display.input.focus()},setOption:function(e,i){var n=this.options,r=n[e];n[e]==i&&"mode"!=e||(n[e]=i,t.hasOwnProperty(e)&&pn(this,t[e])(this,i,r),Le(this,"optionChange",this,e))},getOption:function(e){return this.options[e]},getDoc:function(){return this.doc},addKeyMap:function(e,t){this.state.keyMaps[t?"push":"unshift"](co(e))},removeKeyMap:function(e){for(var t=this.state.keyMaps,i=0;i<t.length;++i)if(t[i]==e||t[i].name==e)return t.splice(i,1),!0},addOverlay:fn(function(t,i){var n=t.token?t:e.getMode(this.options,t);if(n.startState)throw new Error("Overlays may not be stateful.");v(this.state.overlays,{mode:n,modeSpec:t,opaque:i&&i.opaque,priority:i&&i.priority||0},function(e){return e.priority}),this.state.modeGen++,gn(this)}),removeOverlay:fn(function(e){for(var t=this,i=this.state.overlays,n=0;n<i.length;++n){var r=i[n].modeSpec;if(r==e||"string"==typeof e&&r.name==e)return i.splice(n,1),t.state.modeGen++,void gn(t)}}),indentLine:fn(function(e,t,i){"string"!=typeof t&&"number"!=typeof t&&(t=null==t?this.options.smartIndent?"smart":"prev":t?"add":"subtract"),M(this.doc,e)&&Uo(this,e,t,i)}),indentSelection:fn(function(e){for(var t=this,i=this.doc.sel.ranges,n=-1,r=0;r<i.length;r++){var o=i[r];if(o.empty())o.head.line>n&&(Uo(t,o.head.line,e,!0),n=o.head.line,r==t.doc.sel.primIndex&&qi(t));else{var s=o.from(),a=o.to(),l=Math.max(n,s.line);n=Math.min(t.lastLine(),a.line-(a.ch?0:1))+1;for(var c=l;c<n;++c)Uo(t,c,e);var d=t.doc.sel.ranges;0==s.ch&&i.length==d.length&&d[r].from().ch>0&&mr(t.doc,r,new Sa(s,d[r].to()),zs)}}}),getTokenAt:function(e,t){return rt(this,e,t)},getLineTokens:function(e,t){return rt(this,I(e),t,!0)},getTokenTypeAt:function(e){e=W(this.doc,e);var t,i=Je(this,E(this.doc,e.line)),n=0,r=(i.length-1)/2,o=e.ch;if(0==o)t=i[2];else for(;;){var s=n+r>>1;if((s?i[2*s-1]:0)>=o)r=s;else{if(!(i[2*s+1]<o)){t=i[2*s+2];break}n=s+1}}var a=t?t.indexOf("overlay "):-1;return a<0?t:0==a?null:t.slice(0,a-1)},getModeAt:function(t){var i=this.doc.mode;return i.innerMode?e.innerMode(i,this.getTokenAt(t).state).mode:i},getHelper:function(e,t){return this.getHelpers(e,t)[0]},getHelpers:function(e,t){var n=this,r=[];if(!i.hasOwnProperty(t))return r;var o=i[t],s=this.getModeAt(e);if("string"==typeof s[t])o[s[t]]&&r.push(o[s[t]]);else if(s[t])for(var a=0;a<s[t].length;a++){var l=o[s[t][a]];l&&r.push(l)}else s.helperType&&o[s.helperType]?r.push(o[s.helperType]):o[s.name]&&r.push(o[s.name]);for(var c=0;c<o._global.length;c++){var d=o._global[c];d.pred(s,n)&&-1==h(r,d.val)&&r.push(d.val)}return r},getStateAfter:function(e,t){var i=this.doc;return et(this,(e=z(i,null==e?i.first+i.size-1:e))+1,t).state},cursorCoords:function(e,t){var i=this.doc.sel.primary();return ui(this,null==e?i.head:"object"==typeof e?W(this.doc,e):e?i.from():i.to(),t||"page")},charCoords:function(e,t){return di(this,W(this.doc,e),t||"page")},coordsChar:function(e,t){return fi(this,(e=ci(this,e,t||"page")).left,e.top)},lineAtHeight:function(e,t){return e=ci(this,{top:e,left:0},t||"page").top,O(this.doc,e+this.display.viewOffset)},heightAtLine:function(e,t,i){var n,r=!1;if("number"==typeof e){var o=this.doc.first+this.doc.size-1;e<this.doc.first?e=this.doc.first:e>o&&(e=o,r=!0),n=E(this.doc,e)}else n=e;return li(this,n,{top:0,left:0},t||"page",i||r).top+(r?this.doc.height-be(n):0)},defaultTextHeight:function(){return bi(this.display)},defaultCharWidth:function(){return yi(this.display)},getViewport:function(){return{from:this.display.viewFrom,to:this.display.viewTo}},addWidget:function(e,t,i,n,r){var o=this.display,s=(e=ui(this,W(this.doc,e))).bottom,a=e.left;if(t.style.position="absolute",t.setAttribute("cm-ignore-events","true"),this.display.input.setUneditable(t),o.sizer.appendChild(t),"over"==n)s=e.top;else if("above"==n||"near"==n){var l=Math.max(o.wrapper.clientHeight,this.doc.height),c=Math.max(o.sizer.clientWidth,o.lineSpace.clientWidth);("above"==n||e.bottom+t.offsetHeight>l)&&e.top>t.offsetHeight?s=e.top-t.offsetHeight:e.bottom+t.offsetHeight<=l&&(s=e.bottom),a+t.offsetWidth>c&&(a=c-t.offsetWidth)}t.style.top=s+"px",t.style.left=t.style.right="","right"==r?(a=o.sizer.clientWidth-t.offsetWidth,t.style.right="0px"):("left"==r?a=0:"middle"==r&&(a=(o.sizer.clientWidth-t.offsetWidth)/2),t.style.left=a+"px"),i&&Wi(this,{left:a,top:s,right:a+t.offsetWidth,bottom:s+t.offsetHeight})},triggerOnKeyDown:fn(wo),triggerOnKeyPress:fn(_o),triggerOnKeyUp:xo,triggerOnMouseDown:fn(To),execCommand:function(e){if(Wa.hasOwnProperty(e))return Wa[e].call(null,this)},triggerElectric:fn(function(e){Ko(this,e)}),findPosH:function(e,t,i,n){var r=this,o=1;t<0&&(o=-1,t=-t);for(var s=W(this.doc,e),a=0;a<t&&!(s=Zo(r.doc,s,o,i,n)).hitSide;++a);return s},moveH:fn(function(e,t){var i=this;this.extendSelectionsBy(function(n){return i.display.shift||i.doc.extend||n.empty()?Zo(i.doc,n.head,e,t,i.options.rtlMoveVisually):e<0?n.from():n.to()},Us)}),deleteH:fn(function(e,t){var i=this.doc.sel,n=this.doc;i.somethingSelected()?n.replaceSelection("",null,"+delete"):uo(this,function(i){var r=Zo(n,i.head,e,t,!1);return e<0?{from:r,to:i.head}:{from:i.head,to:r}})}),findPosV:function(e,t,i,n){var r=this,o=1,s=n;t<0&&(o=-1,t=-t);for(var a=W(this.doc,e),l=0;l<t;++l){var c=ui(r,a,"div");if(null==s?s=c.left:c.left=s,(a=Jo(r,c,o,i)).hitSide)break}return a},moveV:fn(function(e,t){var i=this,n=this.doc,r=[],o=!this.display.shift&&!n.extend&&n.sel.somethingSelected();if(n.extendSelectionsBy(function(s){if(o)return e<0?s.from():s.to();var a=ui(i,s.head,"div");null!=s.goalColumn&&(a.left=s.goalColumn),r.push(a.left);var l=Jo(i,a,e,t);return"page"==t&&s==n.sel.primary()&&ji(i,di(i,l,"div").top-a.top),l},Us),r.length)for(var s=0;s<n.sel.ranges.length;s++)n.sel.ranges[s].goalColumn=r[s]}),findWordAt:function(e){var t=E(this.doc,e.line).text,i=e.ch,n=e.ch;if(t){var r=this.getHelper(e,"wordChars");"before"!=e.sticky&&n!=t.length||!i?++n:--i;for(var o=t.charAt(i),s=k(o,r)?function(e){return k(e,r)}:/\s/.test(o)?function(e){return/\s/.test(e)}:function(e){return!/\s/.test(e)&&!k(e)};i>0&&s(t.charAt(i-1));)--i;for(;n<t.length&&s(t.charAt(n));)++n}return new Sa(I(e.line,i),I(e.line,n))},toggleOverwrite:function(e){null!=e&&e==this.state.overwrite||((this.state.overwrite=!this.state.overwrite)?a(this.display.cursorDiv,"CodeMirror-overwrite"):Ms(this.display.cursorDiv,"CodeMirror-overwrite"),Le(this,"overwriteToggle",this,this.state.overwrite))},hasFocus:function(){return this.display.input.getField()==s()},isReadOnly:function(){return!(!this.options.readOnly&&!this.doc.cantEdit)},scrollTo:fn(function(e,t){Gi(this,e,t)}),getScrollInfo:function(){var e=this.display.scroller;return{left:e.scrollLeft,top:e.scrollTop,height:e.scrollHeight-Ut(this)-this.display.barHeight,width:e.scrollWidth-Ut(this)-this.display.barWidth,clientHeight:qt(this),clientWidth:jt(this)}},scrollIntoView:fn(function(e,t){null==e?(e={from:this.doc.sel.primary().head,to:null},null==t&&(t=this.options.cursorScrollMargin)):"number"==typeof e?e={from:I(e,0),to:null}:null==e.from&&(e={from:e,to:null}),e.to||(e.to=e.from),e.margin=t||0,null!=e.from.line?Ki(this,e):Yi(this,e.from,e.to,e.margin)}),setSize:fn(function(e,t){var i=this,n=function(e){return"number"==typeof e||/^\d+$/.test(String(e))?e+"px":e};null!=e&&(this.display.wrapper.style.width=n(e)),null!=t&&(this.display.wrapper.style.height=n(t)),this.options.lineWrapping&&ri(this);var r=this.display.viewFrom;this.doc.iter(r,this.display.viewTo,function(e){if(e.widgets)for(var t=0;t<e.widgets.length;t++)if(e.widgets[t].noHScroll){vn(i,r,"widget");break}++r}),this.curOp.forceUpdate=!0,Le(this,"refresh",this)}),operation:function(e){return hn(this,e)},startOperation:function(){return rn(this)},endOperation:function(){return on(this)},refresh:fn(function(){var e=this.display.cachedTextHeight;gn(this),this.curOp.forceUpdate=!0,oi(this),Gi(this,this.doc.scrollLeft,this.doc.scrollTop),Nn(this),(null==e||Math.abs(e-bi(this.display))>.5)&&_i(this),Le(this,"refresh",this)}),swapDoc:fn(function(e){var t=this.doc;return t.cm=null,Xn(this,e),oi(this),this.display.input.reset(),Gi(this,e.scrollLeft,e.scrollTop),this.curOp.forceScroll=!0,Ct(this,"swapDoc",this,t),t}),getInputField:function(){return this.display.input.getField()},getWrapperElement:function(){return this.display.wrapper},getScrollerElement:function(){return this.display.scroller},getGutterElement:function(){return this.display.gutters}},Pe(e),e.registerHelper=function(t,n,r){i.hasOwnProperty(t)||(i[t]=e[t]={_global:[]}),i[t][n]=r},e.registerGlobalHelper=function(t,n,r,o){e.registerHelper(t,n,o),i[t]._global.push({pred:r,val:o})}}function Zo(e,t,i,n,r){function o(){var n=t.line+i;return!(n<e.first||n>=e.first+e.size)&&(t=new I(n,t.ch,t.sticky),c=E(e,n))}function s(n){var s;if(null==(s=r?Ee(e.cm,c,t,i):Te(c,t,i))){if(n||!o())return!1;t=Se(r,e.cm,c,t.line,i)}else t=s;return!0}var a=t,l=i,c=E(e,t.line);if("char"==n)s();else if("column"==n)s(!0);else if("word"==n||"group"==n)for(var d=null,u="group"==n,h=e.cm&&e.cm.getHelper(t,"wordChars"),p=!0;!(i<0)||s(!p);p=!1){var f=c.text.charAt(t.ch)||"\n",m=k(f,h)?"w":u&&"\n"==f?"n":!u||/\s/.test(f)?null:"p";if(!u||p||m||(m="s"),d&&d!=m){i<0&&(i=1,s(),t.sticky="after");break}if(m&&(d=m),i>0&&!s(!p))break}var g=Tr(e,t,a,l,!0);return D(a,g)&&(g.hitSide=!0),g}function Jo(e,t,i,n){var r,o,s=e.doc,a=t.left;if("page"==n){var l=Math.min(e.display.wrapper.clientHeight,window.innerHeight||document.documentElement.clientHeight),c=Math.max(l-.5*bi(e.display),3);r=(i>0?t.bottom:t.top)+i*c}else"line"==n&&(r=i>0?t.bottom+3:t.top-3);for(;(o=fi(e,a,r)).outside;){if(i<0?r<=0:r>=s.height){o.hitSide=!0;break}r+=5*i}return o}function es(e,t){var i=Xt(e,t.line);if(!i||i.hidden)return null;var n=E(e.doc,t.line),r=Kt(i,n,t.line),o=_e(n,e.doc.direction),s="left";o&&(s=xe(o,t.ch)%2?"right":"left");var a=Jt(r.map,t.ch,s);return a.offset="right"==a.collapse?a.end:a.start,a}function ts(e){for(var t=e;t;t=t.parentNode)if(/CodeMirror-gutter-wrapper/.test(t.className))return!0;return!1}function is(e,t){return t&&(e.bad=!0),e}function ns(e,t,i,n,r){function o(e){return function(t){return t.id==e}}function s(){d&&(c+=u,d=!1)}function a(e){e&&(s(),c+=e)}function l(t){if(1==t.nodeType){var i=t.getAttribute("cm-text");if(null!=i)return void a(i||t.textContent.replace(/\u200b/g,""));var c,h=t.getAttribute("cm-marker");if(h){var p=e.findMarks(I(n,0),I(r+1,0),o(+h));return void(p.length&&(c=p[0].find())&&a($(e.doc,c.from,c.to).join(u)))}if("false"==t.getAttribute("contenteditable"))return;var f=/^(pre|div|p)$/i.test(t.nodeName);f&&s();for(var m=0;m<t.childNodes.length;m++)l(t.childNodes[m]);f&&(d=!0)}else 3==t.nodeType&&a(t.nodeValue)}for(var c="",d=!1,u=e.doc.lineSeparator();l(t),t!=i;)t=t.nextSibling;return c}function rs(e,t,i){var n;if(t==e.display.lineDiv){if(!(n=e.display.lineDiv.childNodes[i]))return is(e.clipPos(I(e.display.viewTo-1)),!0);t=null,i=0}else for(n=t;;n=n.parentNode){if(!n||n==e.display.lineDiv)return null;if(n.parentNode&&n.parentNode==e.display.lineDiv)break}for(var r=0;r<e.display.view.length;r++){var o=e.display.view[r];if(o.node==n)return os(o,t,i)}}function os(e,t,i){function n(t,i,n){for(var r=-1;r<(u?u.length:0);r++)for(var o=r<0?d.map:u[r],s=0;s<o.length;s+=3){var a=o[s+2];if(a==t||a==i){var l=N(r<0?e.line:e.rest[r]),c=o[s]+n;return(n<0||a!=t)&&(c=o[s+(n?1:0)]),I(l,c)}}}var r=e.text.firstChild,s=!1;if(!t||!o(r,t))return is(I(N(e.line),0),!0);if(t==r&&(s=!0,t=r.childNodes[i],i=0,!t)){var a=e.rest?m(e.rest):e.line;return is(I(N(a),a.text.length),s)}var l=3==t.nodeType?t:null,c=t;for(l||1!=t.childNodes.length||3!=t.firstChild.nodeType||(l=t.firstChild,i&&(i=l.nodeValue.length));c.parentNode!=r;)c=c.parentNode;var d=e.measure,u=d.maps,h=n(l,c,i);if(h)return is(h,s);for(var p=c.nextSibling,f=l?l.nodeValue.length-i:0;p;p=p.nextSibling){if(h=n(p,p.firstChild,0))return is(I(h.line,h.ch-f),s);f+=p.textContent.length}for(var g=c.previousSibling,v=i;g;g=g.previousSibling){if(h=n(g,g.firstChild,-1))return is(I(h.line,h.ch+v),s);v+=g.textContent.length}}function ss(e,t){function i(){e.value=l.getValue()}if((t=t?d(t):{}).value=e.value,!t.tabindex&&e.tabIndex&&(t.tabindex=e.tabIndex),!t.placeholder&&e.placeholder&&(t.placeholder=e.placeholder),null==t.autofocus){var n=s();t.autofocus=n==e||null!=e.getAttribute("autofocus")&&n==document.body}var r;if(e.form&&(Zs(e.form,"submit",i),!t.leaveSubmitMethodAlone)){var o=e.form;r=o.submit;try{var a=o.submit=function(){i(),o.submit=r,o.submit(),o.submit=a}}catch(c){}}t.finishInit=function(t){t.save=i,t.getTextArea=function(){return e},t.toTextArea=function(){t.toTextArea=isNaN,i(),e.parentNode.removeChild(t.getWrapperElement()),e.style.display="",e.form&&(Ae(e.form,"submit",i),"function"==typeof e.form.submit&&(e.form.submit=r))}},e.style.display="none";var l=zo(function(t){return e.parentNode.insertBefore(t,e.nextSibling)},t);return l}function as(e){e.off=Ae,e.on=Zs,e.wheelEventPixels=Rn,e.Doc=Oa,e.splitLines=ea,e.countColumn=u,e.findColumn=p,e.isWordChar=w,e.Pass=Hs,e.signal=Le,e.Line=ua,e.changeEnd=Hn,e.scrollbarModel=wa,e.Pos=I,e.cmpPos=R,e.modes=ra,e.mimeModes=oa,e.resolveMode=Ge,e.getMode=Ke,e.modeExtensions=sa,e.extendMode=Ve,e.copyState=Ye,e.startState=Qe,e.innerMode=Xe,e.commands=Wa,e.keyMap=Ba,e.keyName=lo,e.isModifierKey=so,e.lookupKey=oo,e.normalizeKeyMap=ro,e.StringStream=aa,e.SharedTextMarker=La,e.TextMarker=Aa,e.LineWidget=Ea,e.e_preventDefault=Ie,e.e_stopPropagation=Re,e.e_stop=Fe,e.addClass=a,e.contains=o,e.rmClass=Ms,e.keyNames=Ia}var ls=navigator.userAgent,cs=navigator.platform,ds=/gecko\/\d/i.test(ls),us=/MSIE \d/.test(ls),hs=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(ls),ps=/Edge\/(\d+)/.exec(ls),fs=us||hs||ps,ms=fs&&(us?document.documentMode||6:+(ps||hs)[1]),gs=!ps&&/WebKit\//.test(ls),vs=gs&&/Qt\/\d+\.\d+/.test(ls),bs=!ps&&/Chrome\//.test(ls),ys=/Opera\//.test(ls),ws=/Apple Computer/.test(navigator.vendor),ks=/Mac OS X 1\d\D([8-9]|\d\d)\D/.test(ls),xs=/PhantomJS/.test(ls),_s=!ps&&/AppleWebKit/.test(ls)&&/Mobile\/\w+/.test(ls),Cs=/Android/.test(ls),Ts=_s||Cs||/webOS|BlackBerry|Opera Mini|Opera Mobi|IEMobile/i.test(ls),Ss=_s||/Mac/.test(cs),Es=/\bCrOS\b/.test(ls),$s=/win/i.test(cs),As=ys&&ls.match(/Version\/(\d*\.\d*)/);As&&(As=Number(As[1])),As&&As>=15&&(ys=!1,gs=!0);var Ls,Ns=Ss&&(vs||ys&&(null==As||As<12.11)),Os=ds||fs&&ms>=9,Ms=function(t,i){var n=t.className,r=e(i).exec(n);if(r){var o=n.slice(r.index+r[0].length);t.className=n.slice(0,r.index)+(o?r[1]+o:"")}};Ls=document.createRange?function(e,t,i,n){var r=document.createRange();return r.setEnd(n||e,i),r.setStart(e,t),r}:function(e,t,i){var n=document.body.createTextRange();try{n.moveToElementText(e.parentNode)}catch(r){return n}return n.collapse(!0),n.moveEnd("character",i),n.moveStart("character",t),n};var Ps=function(e){e.select()};_s?Ps=function(e){e.selectionStart=0,e.selectionEnd=e.value.length}:fs&&(Ps=function(e){try{e.select()}catch(t){}});var Is=function(){this.id=null};Is.prototype.set=function(e,t){clearTimeout(this.id),this.id=setTimeout(t,e)};var Rs,Ds,Fs,Bs=30,Hs={toString:function(){return"CodeMirror.Pass"}},zs={scroll:!1},Ws={origin:"*mouse"},Us={origin:"+move"},js=[""],qs=/[\u00df\u0587\u0590-\u05f4\u0600-\u06ff\u3040-\u309f\u30a0-\u30ff\u3400-\u4db5\u4e00-\u9fcc\uac00-\ud7af]/,Gs=/[\u0300-\u036f\u0483-\u0489\u0591-\u05bd\u05bf\u05c1\u05c2\u05c4\u05c5\u05c7\u0610-\u061a\u064b-\u065e\u0670\u06d6-\u06dc\u06de-\u06e4\u06e7\u06e8\u06ea-\u06ed\u0711\u0730-\u074a\u07a6-\u07b0\u07eb-\u07f3\u0816-\u0819\u081b-\u0823\u0825-\u0827\u0829-\u082d\u0900-\u0902\u093c\u0941-\u0948\u094d\u0951-\u0955\u0962\u0963\u0981\u09bc\u09be\u09c1-\u09c4\u09cd\u09d7\u09e2\u09e3\u0a01\u0a02\u0a3c\u0a41\u0a42\u0a47\u0a48\u0a4b-\u0a4d\u0a51\u0a70\u0a71\u0a75\u0a81\u0a82\u0abc\u0ac1-\u0ac5\u0ac7\u0ac8\u0acd\u0ae2\u0ae3\u0b01\u0b3c\u0b3e\u0b3f\u0b41-\u0b44\u0b4d\u0b56\u0b57\u0b62\u0b63\u0b82\u0bbe\u0bc0\u0bcd\u0bd7\u0c3e-\u0c40\u0c46-\u0c48\u0c4a-\u0c4d\u0c55\u0c56\u0c62\u0c63\u0cbc\u0cbf\u0cc2\u0cc6\u0ccc\u0ccd\u0cd5\u0cd6\u0ce2\u0ce3\u0d3e\u0d41-\u0d44\u0d4d\u0d57\u0d62\u0d63\u0dca\u0dcf\u0dd2-\u0dd4\u0dd6\u0ddf\u0e31\u0e34-\u0e3a\u0e47-\u0e4e\u0eb1\u0eb4-\u0eb9\u0ebb\u0ebc\u0ec8-\u0ecd\u0f18\u0f19\u0f35\u0f37\u0f39\u0f71-\u0f7e\u0f80-\u0f84\u0f86\u0f87\u0f90-\u0f97\u0f99-\u0fbc\u0fc6\u102d-\u1030\u1032-\u1037\u1039\u103a\u103d\u103e\u1058\u1059\u105e-\u1060\u1071-\u1074\u1082\u1085\u1086\u108d\u109d\u135f\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17b7-\u17bd\u17c6\u17c9-\u17d3\u17dd\u180b-\u180d\u18a9\u1920-\u1922\u1927\u1928\u1932\u1939-\u193b\u1a17\u1a18\u1a56\u1a58-\u1a5e\u1a60\u1a62\u1a65-\u1a6c\u1a73-\u1a7c\u1a7f\u1b00-\u1b03\u1b34\u1b36-\u1b3a\u1b3c\u1b42\u1b6b-\u1b73\u1b80\u1b81\u1ba2-\u1ba5\u1ba8\u1ba9\u1c2c-\u1c33\u1c36\u1c37\u1cd0-\u1cd2\u1cd4-\u1ce0\u1ce2-\u1ce8\u1ced\u1dc0-\u1de6\u1dfd-\u1dff\u200c\u200d\u20d0-\u20f0\u2cef-\u2cf1\u2de0-\u2dff\u302a-\u302f\u3099\u309a\ua66f-\ua672\ua67c\ua67d\ua6f0\ua6f1\ua802\ua806\ua80b\ua825\ua826\ua8c4\ua8e0-\ua8f1\ua926-\ua92d\ua947-\ua951\ua980-\ua982\ua9b3\ua9b6-\ua9b9\ua9bc\uaa29-\uaa2e\uaa31\uaa32\uaa35\uaa36\uaa43\uaa4c\uaab0\uaab2-\uaab4\uaab7\uaab8\uaabe\uaabf\uaac1\uabe5\uabe8\uabed\udc00-\udfff\ufb1e\ufe00-\ufe0f\ufe20-\ufe26\uff9e\uff9f]/,Ks=!1,Vs=!1,Ys=null,Xs=function(){function e(e){return e<=247?i.charAt(e):1424<=e&&e<=1524?"R":1536<=e&&e<=1785?n.charAt(e-1536):1774<=e&&e<=2220?"r":8192<=e&&e<=8203?"w":8204==e?"b":"L"}function t(e,t,i){this.level=e,this.from=t,this.to=i}var i="bbbbbbbbbtstwsbbbbbbbbbbbbbbssstwNN%%%NNNNNN,N,N1111111111NNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNbbbbbbsbbbbbbbbbbbbbbbbbbbbbbbbbb,N%%%%NNNNLNNNNN%%11NLNNN1LNNNNNLLLLLLLLLLLLLLLLLLLLLLLNLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLN",n="nnnnnnNNr%%r,rNNmmmmmmmmmmmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmmmmmmmmmmmmmmmnnnnnnnnnn%nnrrrmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmnNmmmmmmrrmmNmmmmrr1111111111",r=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/,o=/[stwN]/,s=/[LRr]/,a=/[Lb1n]/,l=/[1n]/;return function(i,n){var c="ltr"==n?"L":"R";if(0==i.length||"ltr"==n&&!r.test(i))return!1;for(var d=i.length,u=[],h=0;h<d;++h)u.push(e(i.charCodeAt(h)));for(var p=0,f=c;p<d;++p){var g=u[p];"m"==g?u[p]=f:f=g}for(var v=0,b=c;v<d;++v){var y=u[v];"1"==y&&"r"==b?u[v]="n":s.test(y)&&(b=y,"r"==y&&(u[v]="R"))}for(var w=1,k=u[0];w<d-1;++w){var x=u[w];"+"==x&&"1"==k&&"1"==u[w+1]?u[w]="1":","!=x||k!=u[w+1]||"1"!=k&&"n"!=k||(u[w]=k),k=x}for(var _=0;_<d;++_){var C=u[_];if(","==C)u[_]="N";else if("%"==C){var T=void 0;for(T=_+1;T<d&&"%"==u[T];++T);for(var S=_&&"!"==u[_-1]||T<d&&"1"==u[T]?"1":"N",E=_;E<T;++E)u[E]=S;_=T-1}}for(var $=0,A=c;$<d;++$){var L=u[$];"L"==A&&"1"==L?u[$]="L":s.test(L)&&(A=L)}for(var N=0;N<d;++N)if(o.test(u[N])){var O=void 0;for(O=N+1;O<d&&o.test(u[O]);++O);for(var M="L"==(N?u[N-1]:c),P=M==("L"==(O<d?u[O]:c))?M?"L":"R":c,I=N;I<O;++I)u[I]=P;N=O-1}for(var R,D=[],F=0;F<d;)if(a.test(u[F])){var B=F;for(++F;F<d&&a.test(u[F]);++F);D.push(new t(0,B,F))}else{var H=F,z=D.length;for(++F;F<d&&"L"!=u[F];++F);for(var W=H;W<F;)if(l.test(u[W])){H<W&&D.splice(z,0,new t(1,H,W));var U=W;for(++W;W<F&&l.test(u[W]);++W);D.splice(z,0,new t(2,U,W)),H=W}else++W;H<F&&D.splice(z,0,new t(1,H,F))}return 1==D[0].level&&(R=i.match(/^\s+/))&&(D[0].from=R[0].length,D.unshift(new t(0,0,R[0].length))),1==m(D).level&&(R=i.match(/\s+$/))&&(m(D).to-=R[0].length,D.push(new t(0,d-R[0].length,d))),"rtl"==n?D.reverse():D}}(),Qs=[],Zs=function(e,t,i){if(e.addEventListener)e.addEventListener(t,i,!1);else if(e.attachEvent)e.attachEvent("on"+t,i);else{var n=e._handlers||(e._handlers={});n[t]=(n[t]||Qs).concat(i)}},Js=function(){if(fs&&ms<9)return!1;var e=n("div");return"draggable"in e||"dragDrop"in e}(),ea=3!="\n\nb".split(/\n/).length?function(e){for(var t=0,i=[],n=e.length;t<=n;){var r=e.indexOf("\n",t);-1==r&&(r=e.length);var o=e.slice(t,"\r"==e.charAt(r-1)?r-1:r),s=o.indexOf("\r");-1!=s?(i.push(o.slice(0,s)),t+=s+1):(i.push(o),t=r+1)}return i}:function(e){return e.split(/\r\n?|\n/)},ta=window.getSelection?function(e){try{return e.selectionStart!=e.selectionEnd}catch(t){return!1}}:function(e){var t;try{t=e.ownerDocument.selection.createRange()}catch(i){}return!(!t||t.parentElement()!=e)&&0!=t.compareEndPoints("StartToEnd",t)},ia="oncopy"in(Fs=n("div"))||(Fs.setAttribute("oncopy","return;"),"function"==typeof Fs.oncopy),na=null,ra={},oa={},sa={},aa=function(e,t,i){this.pos=this.start=0,this.string=e,this.tabSize=t||8,this.lastColumnPos=this.lastColumnValue=0,this.lineStart=0,this.lineOracle=i};aa.prototype.eol=function(){return this.pos>=this.string.length},aa.prototype.sol=function(){return this.pos==this.lineStart},aa.prototype.peek=function(){return this.string.charAt(this.pos)||undefined},aa.prototype.next=function(){if(this.pos<this.string.length)return this.string.charAt(this.pos++)},aa.prototype.eat=function(e){var t=this.string.charAt(this.pos);if("string"==typeof e?t==e:t&&(e.test?e.test(t):e(t)))return++this.pos,t},aa.prototype.eatWhile=function(e){for(var t=this.pos;this.eat(e););return this.pos>t},aa.prototype.eatSpace=function(){for(var e=this,t=this.pos;/[\s\u00a0]/.test(this.string.charAt(this.pos));)++e.pos;return this.pos>t},aa.prototype.skipToEnd=function(){this.pos=this.string.length},aa.prototype.skipTo=function(e){var t=this.string.indexOf(e,this.pos);if(t>-1)return this.pos=t,!0},aa.prototype.backUp=function(e){this.pos-=e},aa.prototype.column=function(){return this.lastColumnPos<this.start&&(this.lastColumnValue=u(this.string,this.start,this.tabSize,this.lastColumnPos,this.lastColumnValue),this.lastColumnPos=this.start),this.lastColumnValue-(this.lineStart?u(this.string,this.lineStart,this.tabSize):0)},aa.prototype.indentation=function(){return u(this.string,null,this.tabSize)-(this.lineStart?u(this.string,this.lineStart,this.tabSize):0)},aa.prototype.match=function(e,t,i){if("string"!=typeof e){var n=this.string.slice(this.pos).match(e);return n&&n.index>0?null:(n&&!1!==t&&(this.pos+=n[0].length),n)}var r=function(e){return i?e.toLowerCase():e};if(r(this.string.substr(this.pos,e.length))==r(e))return!1!==t&&(this.pos+=e.length),!0},aa.prototype.current=function(){return this.string.slice(this.start,this.pos)},aa.prototype.hideFirstChars=function(e,t){this.lineStart+=e;try{return t()}finally{this.lineStart-=e}},aa.prototype.lookAhead=function(e){var t=this.lineOracle;return t&&t.lookAhead(e)};var la=function(e,t){this.state=e,this.lookAhead=t},ca=function(e,t,i,n){this.state=t,this.doc=e,this.line=i,this.maxLookAhead=n||0};ca.prototype.lookAhead=function(e){var t=this.doc.getLine(this.line+e);return null!=t&&e>this.maxLookAhead&&(this.maxLookAhead=e),t},ca.prototype.nextLine=function(){this.line++,this.maxLookAhead>0&&this.maxLookAhead--},ca.fromSaved=function(e,t,i){return t instanceof la?new ca(e,Ye(e.mode,t.state),i,t.lookAhead):new ca(e,Ye(e.mode,t),i)},ca.prototype.save=function(e){var t=!1!==e?Ye(this.doc.mode,this.state):this.state;return this.maxLookAhead>0?new la(t,this.maxLookAhead):t};var da=function(e,t,i){this.start=e.start,this.end=e.pos,this.string=e.current(),this.type=t||null,this.state=i},ua=function(e,t,i){this.text=e,ne(this,t),this.height=i?i(this):1};ua.prototype.lineNo=function(){return N(this)},Pe(ua);var ha,pa={},fa={},ma=null,ga=null,va={left:0,right:0,top:0,bottom:0},ba=function(e,t,i){this.cm=i;var r=this.vert=n("div",[n("div",null,null,"min-width: 1px")],"CodeMirror-vscrollbar"),o=this.horiz=n("div",[n("div",null,null,"height: 100%; min-height: 1px")],"CodeMirror-hscrollbar");e(r),e(o),Zs(r,"scroll",function(){r.clientHeight&&t(r.scrollTop,"vertical")}),Zs(o,"scroll",function(){o.clientWidth&&t(o.scrollLeft,"horizontal")}),this.checkedZeroWidth=!1,fs&&ms<8&&(this.horiz.style.minHeight=this.vert.style.minWidth="18px")};ba.prototype.update=function(e){var t=e.scrollWidth>e.clientWidth+1,i=e.scrollHeight>e.clientHeight+1,n=e.nativeBarWidth;if(i){this.vert.style.display="block",this.vert.style.bottom=t?n+"px":"0";var r=e.viewHeight-(t?n:0);this.vert.firstChild.style.height=Math.max(0,e.scrollHeight-e.clientHeight+r)+"px"}else this.vert.style.display="",this.vert.firstChild.style.height="0";if(t){this.horiz.style.display="block",this.horiz.style.right=i?n+"px":"0",this.horiz.style.left=e.barLeft+"px";var o=e.viewWidth-e.barLeft-(i?n:0);this.horiz.firstChild.style.width=Math.max(0,e.scrollWidth-e.clientWidth+o)+"px"}else this.horiz.style.display="",this.horiz.firstChild.style.width="0";return!this.checkedZeroWidth&&e.clientHeight>0&&(0==n&&this.zeroWidthHack(),this.checkedZeroWidth=!0),{right:i?n:0,bottom:t?n:0}},ba.prototype.setScrollLeft=function(e){this.horiz.scrollLeft!=e&&(this.horiz.scrollLeft=e),this.disableHoriz&&this.enableZeroWidthBar(this.horiz,this.disableHoriz,"horiz")},ba.prototype.setScrollTop=function(e){this.vert.scrollTop!=e&&(this.vert.scrollTop=e),this.disableVert&&this.enableZeroWidthBar(this.vert,this.disableVert,"vert")},ba.prototype.zeroWidthHack=function(){var e=Ss&&!ks?"12px":"18px";this.horiz.style.height=this.vert.style.width=e,this.horiz.style.pointerEvents=this.vert.style.pointerEvents="none",this.disableHoriz=new Is,this.disableVert=new Is},ba.prototype.enableZeroWidthBar=function(e,t,i){function n(){var r=e.getBoundingClientRect();("vert"==i?document.elementFromPoint(r.right-1,(r.top+r.bottom)/2):document.elementFromPoint((r.right+r.left)/2,r.bottom-1))!=e?e.style.pointerEvents="none":t.set(1e3,n)}e.style.pointerEvents="auto",t.set(1e3,n)},ba.prototype.clear=function(){var e=this.horiz.parentNode;e.removeChild(this.horiz),e.removeChild(this.vert)};var ya=function(){};ya.prototype.update=function(){return{bottom:0,right:0}},ya.prototype.setScrollLeft=function(){},ya.prototype.setScrollTop=function(){},ya.prototype.clear=function(){};var wa={"native":ba,"null":ya},ka=0,xa=function(e,t,i){var n=e.display;this.viewport=t,this.visible=Di(n,e.doc,t),this.editorIsHidden=!n.wrapper.offsetWidth,this.wrapperHeight=n.wrapper.clientHeight,this.wrapperWidth=n.wrapper.clientWidth,this.oldDisplayWidth=jt(e),this.force=i,this.dims=wi(e),this.events=[]};xa.prototype.signal=function(e,t){Me(e,t)&&this.events.push(arguments)},xa.prototype.finish=function(){for(var e=this,t=0;t<this.events.length;t++)Le.apply(null,e.events[t])};var _a=0,Ca=null;fs?Ca=-.53:ds?Ca=15:bs?Ca=-.7:ws&&(Ca=-1/3);var Ta=function(e,t){this.ranges=e,this.primIndex=t};Ta.prototype.primary=function(){return this.ranges[this.primIndex]},Ta.prototype.equals=function(e){var t=this;if(e==this)return!0;if(e.primIndex!=this.primIndex||e.ranges.length!=this.ranges.length)return!1;for(var i=0;i<this.ranges.length;i++){var n=t.ranges[i],r=e.ranges[i];if(!D(n.anchor,r.anchor)||!D(n.head,r.head))return!1}return!0},Ta.prototype.deepCopy=function(){for(var e=this,t=[],i=0;i<this.ranges.length;i++)t[i]=new Sa(F(e.ranges[i].anchor),F(e.ranges[i].head));return new Ta(t,this.primIndex)},Ta.prototype.somethingSelected=function(){for(var e=this,t=0;t<this.ranges.length;t++)if(!e.ranges[t].empty())return!0;return!1},Ta.prototype.contains=function(e,t){var i=this;t||(t=e);for(var n=0;n<this.ranges.length;n++){var r=i.ranges[n];if(R(t,r.from())>=0&&R(e,r.to())<=0)return n}return-1};var Sa=function(e,t){this.anchor=e,this.head=t};Sa.prototype.from=function(){return H(this.anchor,this.head)},Sa.prototype.to=function(){return B(this.anchor,this.head)},Sa.prototype.empty=function(){return this.head.line==this.anchor.line&&this.head.ch==this.anchor.ch},Hr.prototype={chunkSize:function(){return this.lines.length},removeInner:function(e,t){for(var i=this,n=e,r=e+t;n<r;++n){var o=i.lines[n];i.height-=o.height,dt(o),Ct(o,"delete")}this.lines.splice(e,t)},collapse:function(e){e.push.apply(e,this.lines)},insertInner:function(e,t,i){var n=this;this.height+=i,this.lines=this.lines.slice(0,e).concat(t).concat(this.lines.slice(e));for(var r=0;r<t.length;++r)t[r].parent=n},iterN:function(e,t,i){for(var n=this,r=e+t;e<r;++e)if(i(n.lines[e]))return!0}},zr.prototype={chunkSize:function(){return this.size},removeInner:function(e,t){var i=this;this.size-=t;for(var n=0;n<this.children.length;++n){var r=i.children[n],o=r.chunkSize();if(e<o){var s=Math.min(t,o-e),a=r.height;if(r.removeInner(e,s),i.height-=a-r.height,o==s&&(i.children.splice(n--,1),r.parent=null),0==(t-=s))break;e=0}else e-=o}if(this.size-t<25&&(this.children.length>1||!(this.children[0]instanceof Hr))){var l=[];this.collapse(l),this.children=[new Hr(l)],this.children[0].parent=this}},collapse:function(e){for(var t=this,i=0;i<this.children.length;++i)t.children[i].collapse(e)},insertInner:function(e,t,i){var n=this;this.size+=t.length,this.height+=i
;for(var r=0;r<this.children.length;++r){var o=n.children[r],s=o.chunkSize();if(e<=s){if(o.insertInner(e,t,i),o.lines&&o.lines.length>50){for(var a=o.lines.length%25+25,l=a;l<o.lines.length;){var c=new Hr(o.lines.slice(l,l+=25));o.height-=c.height,n.children.splice(++r,0,c),c.parent=n}o.lines=o.lines.slice(0,a),n.maybeSpill()}break}e-=s}},maybeSpill:function(){if(!(this.children.length<=10)){var e=this;do{var t=new zr(e.children.splice(e.children.length-5,5));if(e.parent){e.size-=t.size,e.height-=t.height;var i=h(e.parent.children,e);e.parent.children.splice(i+1,0,t)}else{var n=new zr(e.children);n.parent=e,e.children=[n,t],e=n}t.parent=e.parent}while(e.children.length>10);e.parent.maybeSpill()}},iterN:function(e,t,i){for(var n=this,r=0;r<this.children.length;++r){var o=n.children[r],s=o.chunkSize();if(e<s){var a=Math.min(t,s-e);if(o.iterN(e,a,i))return!0;if(0==(t-=a))break;e=0}else e-=s}}};var Ea=function(e,t,i){var n=this;if(i)for(var r in i)i.hasOwnProperty(r)&&(n[r]=i[r]);this.doc=e,this.node=t};Ea.prototype.clear=function(){var e=this,t=this.doc.cm,i=this.line.widgets,n=this.line,r=N(n);if(null!=r&&i){for(var o=0;o<i.length;++o)i[o]==e&&i.splice(o--,1);i.length||(n.widgets=null);var s=Ft(this);L(n,Math.max(0,n.height-s)),t&&(hn(t,function(){Wr(t,n,-s),vn(t,r,"widget")}),Ct(t,"lineWidgetCleared",t,this,r))}},Ea.prototype.changed=function(){var e=this,t=this.height,i=this.doc.cm,n=this.line;this.height=null;var r=Ft(this)-t;r&&(L(n,n.height+r),i&&hn(i,function(){i.curOp.forceUpdate=!0,Wr(i,n,r),Ct(i,"lineWidgetChanged",i,e,N(n))}))},Pe(Ea);var $a=0,Aa=function(e,t){this.lines=[],this.type=t,this.doc=e,this.id=++$a};Aa.prototype.clear=function(){var e=this;if(!this.explicitlyCleared){var t=this.doc.cm,i=t&&!t.curOp;if(i&&rn(t),Me(this,"clear")){var n=this.find();n&&Ct(this,"clear",n.from,n.to)}for(var r=null,o=null,s=0;s<this.lines.length;++s){var a=e.lines[s],l=V(a.markedSpans,e);t&&!e.collapsed?vn(t,N(a),"text"):t&&(null!=l.to&&(o=N(a)),null!=l.from&&(r=N(a))),a.markedSpans=Y(a.markedSpans,l),null==l.from&&e.collapsed&&!ge(e.doc,a)&&t&&L(a,bi(t.display))}if(t&&this.collapsed&&!t.options.lineWrapping)for(var c=0;c<this.lines.length;++c){var d=ue(e.lines[c]),u=ye(d);u>t.display.maxLineLength&&(t.display.maxLine=d,t.display.maxLineLength=u,t.display.maxLineChanged=!0)}null!=r&&t&&this.collapsed&&gn(t,r,o+1),this.lines.length=0,this.explicitlyCleared=!0,this.atomic&&this.doc.cantEdit&&(this.doc.cantEdit=!1,t&&xr(t.doc)),t&&Ct(t,"markerCleared",t,this,r,o),i&&on(t),this.parent&&this.parent.clear()}},Aa.prototype.find=function(e,t){var i,n,r=this;null==e&&"bookmark"==this.type&&(e=1);for(var o=0;o<this.lines.length;++o){var s=r.lines[o],a=V(s.markedSpans,r);if(null!=a.from&&(i=I(t?s:N(s),a.from),-1==e))return i;if(null!=a.to&&(n=I(t?s:N(s),a.to),1==e))return n}return i&&{from:i,to:n}},Aa.prototype.changed=function(){var e=this,t=this.find(-1,!0),i=this,n=this.doc.cm;t&&n&&hn(n,function(){var r=t.line,o=N(t.line),s=Xt(n,o);if(s&&(ni(s),n.curOp.selectionChanged=n.curOp.forceUpdate=!0),n.curOp.updateMaxLine=!0,!ge(i.doc,r)&&null!=i.height){var a=i.height;i.height=null;var l=Ft(i)-a;l&&L(r,r.height+l)}Ct(n,"markerChanged",n,e)})},Aa.prototype.attachLine=function(e){if(!this.lines.length&&this.doc.cm){var t=this.doc.cm.curOp;t.maybeHiddenMarkers&&-1!=h(t.maybeHiddenMarkers,this)||(t.maybeUnhiddenMarkers||(t.maybeUnhiddenMarkers=[])).push(this)}this.lines.push(e)},Aa.prototype.detachLine=function(e){if(this.lines.splice(h(this.lines,e),1),!this.lines.length&&this.doc.cm){var t=this.doc.cm.curOp;(t.maybeHiddenMarkers||(t.maybeHiddenMarkers=[])).push(this)}},Pe(Aa);var La=function(e,t){var i=this;this.markers=e,this.primary=t;for(var n=0;n<e.length;++n)e[n].parent=i};La.prototype.clear=function(){var e=this;if(!this.explicitlyCleared){this.explicitlyCleared=!0;for(var t=0;t<this.markers.length;++t)e.markers[t].clear();Ct(this,"clear")}},La.prototype.find=function(e,t){return this.primary.find(e,t)},Pe(La);var Na=0,Oa=function(e,t,i,n,r){if(!(this instanceof Oa))return new Oa(e,t,i,n,r);null==i&&(i=0),zr.call(this,[new Hr([new ua("",null)])]),this.first=i,this.scrollTop=this.scrollLeft=0,this.cantEdit=!1,this.cleanGeneration=1,this.modeFrontier=this.highlightFrontier=i;var o=I(i,0);this.sel=Bn(o),this.history=new Jn(null),this.id=++Na,this.modeOption=t,this.lineSep=n,this.direction="rtl"==r?"rtl":"ltr",this.extend=!1,"string"==typeof e&&(e=this.splitLines(e)),Vn(this,{from:o,to:o,text:e}),yr(this,Bn(o),zs)};Oa.prototype=y(zr.prototype,{constructor:Oa,iter:function(e,t,i){i?this.iterN(e-this.first,t-e,i):this.iterN(this.first,this.first+this.size,e)},insert:function(e,t){for(var i=0,n=0;n<t.length;++n)i+=t[n].height;this.insertInner(e-this.first,t,i)},remove:function(e,t){this.removeInner(e-this.first,t)},getValue:function(e){var t=A(this,this.first,this.first+this.size);return!1===e?t:t.join(e||this.lineSeparator())},setValue:mn(function(e){var t=I(this.first,0),i=this.first+this.size-1;Ar(this,{from:t,to:I(i,E(this,i).text.length),text:this.splitLines(e),origin:"setValue",full:!0},!0),this.cm&&Gi(this.cm,0,0),yr(this,Bn(t),zs)}),replaceRange:function(e,t,i,n){Ir(this,e,t=W(this,t),i=i?W(this,i):t,n)},getRange:function(e,t,i){var n=$(this,W(this,e),W(this,t));return!1===i?n:n.join(i||this.lineSeparator())},getLine:function(e){var t=this.getLineHandle(e);return t&&t.text},getLineHandle:function(e){if(M(this,e))return E(this,e)},getLineNumber:function(e){return N(e)},getLineHandleVisualStart:function(e){return"number"==typeof e&&(e=E(this,e)),ue(e)},lineCount:function(){return this.size},firstLine:function(){return this.first},lastLine:function(){return this.first+this.size-1},clipPos:function(e){return W(this,e)},getCursor:function(e){var t=this.sel.primary();return null==e||"head"==e?t.head:"anchor"==e?t.anchor:"end"==e||"to"==e||!1===e?t.to():t.from()},listSelections:function(){return this.sel.ranges},somethingSelected:function(){return this.sel.somethingSelected()},setCursor:mn(function(e,t,i){gr(this,W(this,"number"==typeof e?I(e,t||0):e),null,i)}),setSelection:mn(function(e,t,i){gr(this,W(this,e),W(this,t||e),i)}),extendSelection:mn(function(e,t,i){pr(this,W(this,e),t&&W(this,t),i)}),extendSelections:mn(function(e,t){fr(this,j(this,e),t)}),extendSelectionsBy:mn(function(e,t){fr(this,j(this,g(this.sel.ranges,e)),t)}),setSelections:mn(function(e,t,i){var n=this;if(e.length){for(var r=[],o=0;o<e.length;o++)r[o]=new Sa(W(n,e[o].anchor),W(n,e[o].head));null==t&&(t=Math.min(e.length-1,this.sel.primIndex)),yr(this,Fn(r,t),i)}}),addSelection:mn(function(e,t,i){var n=this.sel.ranges.slice(0);n.push(new Sa(W(this,e),W(this,t||e))),yr(this,Fn(n,n.length-1),i)}),getSelection:function(e){for(var t,i=this,n=this.sel.ranges,r=0;r<n.length;r++){var o=$(i,n[r].from(),n[r].to());t=t?t.concat(o):o}return!1===e?t:t.join(e||this.lineSeparator())},getSelections:function(e){for(var t=this,i=[],n=this.sel.ranges,r=0;r<n.length;r++){var o=$(t,n[r].from(),n[r].to());!1!==e&&(o=o.join(e||t.lineSeparator())),i[r]=o}return i},replaceSelection:function(e,t,i){for(var n=[],r=0;r<this.sel.ranges.length;r++)n[r]=e;this.replaceSelections(n,t,i||"+input")},replaceSelections:mn(function(e,t,i){for(var n=this,r=[],o=this.sel,s=0;s<o.ranges.length;s++){var a=o.ranges[s];r[s]={from:a.from(),to:a.to(),text:n.splitLines(e[s]),origin:i}}for(var l=t&&"end"!=t&&jn(this,r,t),c=r.length-1;c>=0;c--)Ar(n,r[c]);l?br(this,l):this.cm&&qi(this.cm)}),undo:mn(function(){Nr(this,"undo")}),redo:mn(function(){Nr(this,"redo")}),undoSelection:mn(function(){Nr(this,"undo",!0)}),redoSelection:mn(function(){Nr(this,"redo",!0)}),setExtending:function(e){this.extend=e},getExtending:function(){return this.extend},historySize:function(){for(var e=this.history,t=0,i=0,n=0;n<e.done.length;n++)e.done[n].ranges||++t;for(var r=0;r<e.undone.length;r++)e.undone[r].ranges||++i;return{undo:t,redo:i}},clearHistory:function(){this.history=new Jn(this.history.maxGeneration)},markClean:function(){this.cleanGeneration=this.changeGeneration(!0)},changeGeneration:function(e){return e&&(this.history.lastOp=this.history.lastSelOp=this.history.lastOrigin=null),this.history.generation},isClean:function(e){return this.history.generation==(e||this.cleanGeneration)},getHistory:function(){return{done:ur(this.history.done),undone:ur(this.history.undone)}},setHistory:function(e){var t=this.history=new Jn(this.history.maxGeneration);t.done=ur(e.done.slice(0),null,!0),t.undone=ur(e.undone.slice(0),null,!0)},setGutterMarker:mn(function(e,t,i){return Br(this,e,"gutter",function(e){var n=e.gutterMarkers||(e.gutterMarkers={});return n[t]=i,!i&&x(n)&&(e.gutterMarkers=null),!0})}),clearGutter:mn(function(e){var t=this;this.iter(function(i){i.gutterMarkers&&i.gutterMarkers[e]&&Br(t,i,"gutter",function(){return i.gutterMarkers[e]=null,x(i.gutterMarkers)&&(i.gutterMarkers=null),!0})})}),lineInfo:function(e){var t;if("number"==typeof e){if(!M(this,e))return null;if(t=e,!(e=E(this,e)))return null}else if(null==(t=N(e)))return null;return{line:t,handle:e,text:e.text,gutterMarkers:e.gutterMarkers,textClass:e.textClass,bgClass:e.bgClass,wrapClass:e.wrapClass,widgets:e.widgets}},addLineClass:mn(function(t,i,n){return Br(this,t,"gutter"==i?"gutter":"class",function(t){var r="text"==i?"textClass":"background"==i?"bgClass":"gutter"==i?"gutterClass":"wrapClass";if(t[r]){if(e(n).test(t[r]))return!1;t[r]+=" "+n}else t[r]=n;return!0})}),removeLineClass:mn(function(t,i,n){return Br(this,t,"gutter"==i?"gutter":"class",function(t){var r="text"==i?"textClass":"background"==i?"bgClass":"gutter"==i?"gutterClass":"wrapClass",o=t[r];if(!o)return!1;if(null==n)t[r]=null;else{var s=o.match(e(n));if(!s)return!1;var a=s.index+s[0].length;t[r]=o.slice(0,s.index)+(s.index&&a!=o.length?" ":"")+o.slice(a)||null}return!0})}),addLineWidget:mn(function(e,t,i){return Ur(this,e,t,i)}),removeLineWidget:function(e){e.clear()},markText:function(e,t,i){return jr(this,W(this,e),W(this,t),i,i&&i.type||"range")},setBookmark:function(e,t){var i={replacedWith:t&&(null==t.nodeType?t.widget:t),insertLeft:t&&t.insertLeft,clearWhenEmpty:!1,shared:t&&t.shared,handleMouseEvents:t&&t.handleMouseEvents};return jr(this,e=W(this,e),e,i,"bookmark")},findMarksAt:function(e){var t=[],i=E(this,(e=W(this,e)).line).markedSpans;if(i)for(var n=0;n<i.length;++n){var r=i[n];(null==r.from||r.from<=e.ch)&&(null==r.to||r.to>=e.ch)&&t.push(r.marker.parent||r.marker)}return t},findMarks:function(e,t,i){e=W(this,e),t=W(this,t);var n=[],r=e.line;return this.iter(e.line,t.line+1,function(o){var s=o.markedSpans;if(s)for(var a=0;a<s.length;a++){var l=s[a];null!=l.to&&r==e.line&&e.ch>=l.to||null==l.from&&r!=e.line||null!=l.from&&r==t.line&&l.from>=t.ch||i&&!i(l.marker)||n.push(l.marker.parent||l.marker)}++r}),n},getAllMarks:function(){var e=[];return this.iter(function(t){var i=t.markedSpans;if(i)for(var n=0;n<i.length;++n)null!=i[n].from&&e.push(i[n].marker)}),e},posFromIndex:function(e){var t,i=this.first,n=this.lineSeparator().length;return this.iter(function(r){var o=r.text.length+n;if(o>e)return t=e,!0;e-=o,++i}),W(this,I(i,t))},indexFromPos:function(e){var t=(e=W(this,e)).ch;if(e.line<this.first||e.ch<0)return 0;var i=this.lineSeparator().length;return this.iter(this.first,e.line,function(e){t+=e.text.length+i}),t},copy:function(e){var t=new Oa(A(this,this.first,this.first+this.size),this.modeOption,this.first,this.lineSep,this.direction);return t.scrollTop=this.scrollTop,t.scrollLeft=this.scrollLeft,t.sel=this.sel,t.extend=!1,e&&(t.history.undoDepth=this.history.undoDepth,t.setHistory(this.getHistory())),t},linkedDoc:function(e){e||(e={});var t=this.first,i=this.first+this.size;null!=e.from&&e.from>t&&(t=e.from),null!=e.to&&e.to<i&&(i=e.to);var n=new Oa(A(this,t,i),e.mode||this.modeOption,t,this.lineSep,this.direction);return e.sharedHist&&(n.history=this.history),(this.linked||(this.linked=[])).push({doc:n,sharedHist:e.sharedHist}),n.linked=[{doc:this,isParent:!0,sharedHist:e.sharedHist}],Kr(n,Gr(this)),n},unlinkDoc:function(e){var t=this;if(e instanceof zo&&(e=e.doc),this.linked)for(var i=0;i<this.linked.length;++i){if(t.linked[i].doc==e){t.linked.splice(i,1),e.unlinkDoc(t),Vr(Gr(t));break}}if(e.history==this.history){var n=[e.id];Yn(e,function(e){return n.push(e.id)},!0),e.history=new Jn(null),e.history.done=ur(this.history.done,n),e.history.undone=ur(this.history.undone,n)}},iterLinkedDocs:function(e){Yn(this,e)},getMode:function(){return this.mode},getEditor:function(){return this.cm},splitLines:function(e){return this.lineSep?e.split(this.lineSep):ea(e)},lineSeparator:function(){return this.lineSep||"\n"},setDirection:mn(function(e){"rtl"!=e&&(e="ltr"),e!=this.direction&&(this.direction=e,this.iter(function(e){return e.order=null}),this.cm&&Zn(this.cm))})}),Oa.prototype.eachLine=Oa.prototype.iter;for(var Ma=0,Pa=!1,Ia={3:"Enter",8:"Backspace",9:"Tab",13:"Enter",16:"Shift",17:"Ctrl",18:"Alt",19:"Pause",20:"CapsLock",27:"Esc",32:"Space",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"Left",38:"Up",39:"Right",40:"Down",44:"PrintScrn",45:"Insert",46:"Delete",59:";",61:"=",91:"Mod",92:"Mod",93:"Mod",106:"*",107:"=",109:"-",110:".",111:"/",127:"Delete",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'",63232:"Up",63233:"Down",63234:"Left",63235:"Right",63272:"Delete",63273:"Home",63275:"End",63276:"PageUp",63277:"PageDown",63302:"Insert"},Ra=0;Ra<10;Ra++)Ia[Ra+48]=Ia[Ra+96]=String(Ra);for(var Da=65;Da<=90;Da++)Ia[Da]=String.fromCharCode(Da);for(var Fa=1;Fa<=12;Fa++)Ia[Fa+111]=Ia[Fa+63235]="F"+Fa;var Ba={basic:{Left:"goCharLeft",Right:"goCharRight",Up:"goLineUp",Down:"goLineDown",End:"goLineEnd",Home:"goLineStartSmart",PageUp:"goPageUp",PageDown:"goPageDown",Delete:"delCharAfter",Backspace:"delCharBefore","Shift-Backspace":"delCharBefore",Tab:"defaultTab","Shift-Tab":"indentAuto",Enter:"newlineAndIndent",Insert:"toggleOverwrite",Esc:"singleSelection"},pcDefault:{"Ctrl-A":"selectAll","Ctrl-D":"deleteLine","Ctrl-Z":"undo","Shift-Ctrl-Z":"redo","Ctrl-Y":"redo","Ctrl-Home":"goDocStart","Ctrl-End":"goDocEnd","Ctrl-Up":"goLineUp","Ctrl-Down":"goLineDown","Ctrl-Left":"goGroupLeft","Ctrl-Right":"goGroupRight","Alt-Left":"goLineStart","Alt-Right":"goLineEnd","Ctrl-Backspace":"delGroupBefore","Ctrl-Delete":"delGroupAfter","Ctrl-S":"save","Ctrl-F":"find","Ctrl-G":"findNext","Shift-Ctrl-G":"findPrev","Shift-Ctrl-F":"replace","Shift-Ctrl-R":"replaceAll","Ctrl-[":"indentLess","Ctrl-]":"indentMore","Ctrl-U":"undoSelection","Shift-Ctrl-U":"redoSelection","Alt-U":"redoSelection",fallthrough:"basic"},emacsy:{"Ctrl-F":"goCharRight","Ctrl-B":"goCharLeft","Ctrl-P":"goLineUp","Ctrl-N":"goLineDown","Alt-F":"goWordRight","Alt-B":"goWordLeft","Ctrl-A":"goLineStart","Ctrl-E":"goLineEnd","Ctrl-V":"goPageDown","Shift-Ctrl-V":"goPageUp","Ctrl-D":"delCharAfter","Ctrl-H":"delCharBefore","Alt-D":"delWordAfter","Alt-Backspace":"delWordBefore","Ctrl-K":"killLine","Ctrl-T":"transposeChars","Ctrl-O":"openLine"},macDefault:{"Cmd-A":"selectAll","Cmd-D":"deleteLine","Cmd-Z":"undo","Shift-Cmd-Z":"redo","Cmd-Y":"redo","Cmd-Home":"goDocStart","Cmd-Up":"goDocStart","Cmd-End":"goDocEnd","Cmd-Down":"goDocEnd","Alt-Left":"goGroupLeft","Alt-Right":"goGroupRight","Cmd-Left":"goLineLeft","Cmd-Right":"goLineRight","Alt-Backspace":"delGroupBefore","Ctrl-Alt-Backspace":"delGroupAfter","Alt-Delete":"delGroupAfter","Cmd-S":"save","Cmd-F":"find","Cmd-G":"findNext","Shift-Cmd-G":"findPrev","Cmd-Alt-F":"replace","Shift-Cmd-Alt-F":"replaceAll","Cmd-[":"indentLess","Cmd-]":"indentMore","Cmd-Backspace":"delWrappedLineLeft","Cmd-Delete":"delWrappedLineRight","Cmd-U":"undoSelection","Shift-Cmd-U":"redoSelection","Ctrl-Up":"goDocStart","Ctrl-Down":"goDocEnd",fallthrough:["basic","emacsy"]}};Ba["default"]=Ss?Ba.macDefault:Ba.pcDefault;var Ha,za,Wa={selectAll:Er,singleSelection:function(e){return e.setSelection(e.getCursor("anchor"),e.getCursor("head"),zs)},killLine:function(e){return uo(e,function(t){if(t.empty()){var i=E(e.doc,t.head.line).text.length;return t.head.ch==i&&t.head.line<e.lastLine()?{from:t.head,to:I(t.head.line+1,0)}:{from:t.head,to:I(t.head.line,i)}}return{from:t.from(),to:t.to()}})},deleteLine:function(e){return uo(e,function(t){return{from:I(t.from().line,0),to:W(e.doc,I(t.to().line+1,0))}})},delLineLeft:function(e){return uo(e,function(e){return{from:I(e.from().line,0),to:e.from()}})},delWrappedLineLeft:function(e){return uo(e,function(t){var i=e.charCoords(t.head,"div").top+5;return{from:e.coordsChar({left:0,top:i},"div"),to:t.from()}})},delWrappedLineRight:function(e){return uo(e,function(t){var i=e.charCoords(t.head,"div").top+5,n=e.coordsChar({left:e.display.lineDiv.offsetWidth+100,top:i},"div");return{from:t.from(),to:n}})},undo:function(e){return e.undo()},redo:function(e){return e.redo()},undoSelection:function(e){return e.undoSelection()},redoSelection:function(e){return e.redoSelection()},goDocStart:function(e){return e.extendSelection(I(e.firstLine(),0))},goDocEnd:function(e){return e.extendSelection(I(e.lastLine()))},goLineStart:function(e){return e.extendSelectionsBy(function(t){return ho(e,t.head.line)},{origin:"+move",bias:1})},goLineStartSmart:function(e){return e.extendSelectionsBy(function(t){return fo(e,t.head)},{origin:"+move",bias:1})},goLineEnd:function(e){return e.extendSelectionsBy(function(t){return po(e,t.head.line)},{origin:"+move",bias:-1})},goLineRight:function(e){return e.extendSelectionsBy(function(t){var i=e.cursorCoords(t.head,"div").top+5;return e.coordsChar({left:e.display.lineDiv.offsetWidth+100,top:i},"div")},Us)},goLineLeft:function(e){return e.extendSelectionsBy(function(t){var i=e.cursorCoords(t.head,"div").top+5;return e.coordsChar({left:0,top:i},"div")},Us)},goLineLeftSmart:function(e){return e.extendSelectionsBy(function(t){var i=e.cursorCoords(t.head,"div").top+5,n=e.coordsChar({left:0,top:i},"div");return n.ch<e.getLine(n.line).search(/\S/)?fo(e,t.head):n},Us)},goLineUp:function(e){return e.moveV(-1,"line")},goLineDown:function(e){return e.moveV(1,"line")},goPageUp:function(e){return e.moveV(-1,"page")},goPageDown:function(e){return e.moveV(1,"page")},goCharLeft:function(e){return e.moveH(-1,"char")},goCharRight:function(e){return e.moveH(1,"char")},goColumnLeft:function(e){return e.moveH(-1,"column")},goColumnRight:function(e){return e.moveH(1,"column")},goWordLeft:function(e){return e.moveH(-1,"word")},goGroupRight:function(e){return e.moveH(1,"group")},goGroupLeft:function(e){return e.moveH(-1,"group")},goWordRight:function(e){return e.moveH(1,"word")},delCharBefore:function(e){return e.deleteH(-1,"char")},delCharAfter:function(e){return e.deleteH(1,"char")},delWordBefore:function(e){return e.deleteH(-1,"word")},delWordAfter:function(e){return e.deleteH(1,"word")},delGroupBefore:function(e){return e.deleteH(-1,"group")},delGroupAfter:function(e){return e.deleteH(1,"group")},indentAuto:function(e){return e.indentSelection("smart")},indentMore:function(e){return e.indentSelection("add")},indentLess:function(e){return e.indentSelection("subtract")},insertTab:function(e){return e.replaceSelection("\t")},insertSoftTab:function(e){for(var t=[],i=e.listSelections(),n=e.options.tabSize,r=0;r<i.length;r++){var o=i[r].from(),s=u(e.getLine(o.line),o.ch,n);t.push(f(n-s%n))}e.replaceSelections(t)},defaultTab:function(e){e.somethingSelected()?e.indentSelection("add"):e.execCommand("insertTab")},transposeChars:function(e){return hn(e,function(){for(var t=e.listSelections(),i=[],n=0;n<t.length;n++)if(t[n].empty()){var r=t[n].head,o=E(e.doc,r.line).text;if(o)if(r.ch==o.length&&(r=new I(r.line,r.ch-1)),r.ch>0)r=new I(r.line,r.ch+1),e.replaceRange(o.charAt(r.ch-1)+o.charAt(r.ch-2),I(r.line,r.ch-2),r,"+transpose");else if(r.line>e.doc.first){var s=E(e.doc,r.line-1).text;s&&(r=new I(r.line,1),e.replaceRange(o.charAt(0)+e.doc.lineSeparator()+s.charAt(s.length-1),I(r.line-1,s.length-1),r,"+transpose"))}i.push(new Sa(r,r))}e.setSelections(i)})},newlineAndIndent:function(e){return hn(e,function(){for(var t=e.listSelections(),i=t.length-1;i>=0;i--)e.replaceRange(e.doc.lineSeparator(),t[i].anchor,t[i].head,"+input");t=e.listSelections();for(var n=0;n<t.length;n++)e.indentLine(t[n].from().line,null,!0);qi(e)})},openLine:function(e){return e.replaceSelection("\n","start")},toggleOverwrite:function(e){return e.toggleOverwrite()}},Ua=new Is,ja=null,qa=400,Ga=function(e,t,i){this.time=e,this.pos=t,this.button=i};Ga.prototype.compare=function(e,t,i){return this.time+qa>e&&0==R(t,this.pos)&&i==this.button};var Ka={toString:function(){return"CodeMirror.Init"}},Va={},Ya={};zo.defaults=Va,zo.optionHandlers=Ya;var Xa=[];zo.defineInitHook=function(e){return Xa.push(e)};var Qa=null,Za=function(e){this.cm=e,this.lastAnchorNode=this.lastAnchorOffset=this.lastFocusNode=this.lastFocusOffset=null,this.polling=new Is,this.composing=null,this.gracePeriod=!1,this.readDOMTimeout=null};Za.prototype.init=function(e){function t(e){if(!Ne(r,e)){if(r.somethingSelected())jo({lineWise:!1,text:r.getSelections()}),"cut"==e.type&&r.replaceSelection("",null,"cut");else{if(!r.options.lineWiseCopyCut)return;var t=Vo(r);jo({lineWise:!0,text:t.text}),"cut"==e.type&&r.operation(function(){r.setSelections(t.ranges,0,zs),r.replaceSelection("",null,"cut")})}if(e.clipboardData){e.clipboardData.clearData();var i=Qa.text.join("\n");if(e.clipboardData.setData("Text",i),e.clipboardData.getData("Text")==i)return void e.preventDefault()}var s=Xo(),a=s.firstChild;r.display.lineSpace.insertBefore(s,r.display.lineSpace.firstChild),a.value=Qa.text.join("\n");var l=document.activeElement;Ps(a),setTimeout(function(){r.display.lineSpace.removeChild(s),l.focus(),l==o&&n.showPrimarySelection()},50)}}var i=this,n=this,r=n.cm,o=n.div=e.lineDiv;Yo(o,r.options.spellcheck),Zs(o,"paste",function(e){Ne(r,e)||Go(e,r)||ms<=11&&setTimeout(pn(r,function(){return i.updateFromDOM()}),20)}),Zs(o,"compositionstart",function(e){i.composing={data:e.data,done:!1}}),Zs(o,"compositionupdate",function(e){i.composing||(i.composing={data:e.data,done:!1})}),Zs(o,"compositionend",function(e){i.composing&&(e.data!=i.composing.data&&i.readFromDOMSoon(),i.composing.done=!0)}),Zs(o,"touchstart",function(){return n.forceCompositionEnd()}),Zs(o,"input",function(){i.composing||i.readFromDOMSoon()}),Zs(o,"copy",t),Zs(o,"cut",t)},Za.prototype.prepareSelection=function(){var e=Ei(this.cm,!1);return e.focus=this.cm.state.focused,e},Za.prototype.showSelection=function(e,t){e&&this.cm.display.view.length&&((e.focus||t)&&this.showPrimarySelection(),this.showMultipleSelections(e))},Za.prototype.showPrimarySelection=function(){var e=window.getSelection(),t=this.cm,i=t.doc.sel.primary(),n=i.from(),r=i.to();if(t.display.viewTo==t.display.viewFrom||n.line>=t.display.viewTo||r.line<t.display.viewFrom)e.removeAllRanges();else{var o=rs(t,e.anchorNode,e.anchorOffset),s=rs(t,e.focusNode,e.focusOffset);if(!o||o.bad||!s||s.bad||0!=R(H(o,s),n)||0!=R(B(o,s),r)){var a=t.display.view,l=n.line>=t.display.viewFrom&&es(t,n)||{node:a[0].measure.map[2],offset:0},c=r.line<t.display.viewTo&&es(t,r);if(!c){var d=a[a.length-1].measure,u=d.maps?d.maps[d.maps.length-1]:d.map;c={node:u[u.length-1],offset:u[u.length-2]-u[u.length-3]}}if(l&&c){var h,p=e.rangeCount&&e.getRangeAt(0);try{h=Ls(l.node,l.offset,c.offset,c.node)}catch(f){}h&&(!ds&&t.state.focused?(e.collapse(l.node,l.offset),h.collapsed||(e.removeAllRanges(),e.addRange(h))):(e.removeAllRanges(),e.addRange(h)),p&&null==e.anchorNode?e.addRange(p):ds&&this.startGracePeriod()),this.rememberSelection()}else e.removeAllRanges()}}},Za.prototype.startGracePeriod=function(){var e=this;clearTimeout(this.gracePeriod),this.gracePeriod=setTimeout(function(){e.gracePeriod=!1,e.selectionChanged()&&e.cm.operation(function(){return e.cm.curOp.selectionChanged=!0})},20)},Za.prototype.showMultipleSelections=function(e){i(this.cm.display.cursorDiv,e.cursors),i(this.cm.display.selectionDiv,e.selection)},Za.prototype.rememberSelection=function(){var e=window.getSelection();this.lastAnchorNode=e.anchorNode,this.lastAnchorOffset=e.anchorOffset,this.lastFocusNode=e.focusNode,this.lastFocusOffset=e.focusOffset},Za.prototype.selectionInEditor=function(){var e=window.getSelection();if(!e.rangeCount)return!1;var t=e.getRangeAt(0).commonAncestorContainer;return o(this.div,t)},Za.prototype.focus=function(){"nocursor"!=this.cm.options.readOnly&&(this.selectionInEditor()||this.showSelection(this.prepareSelection(),!0),this.div.focus())},Za.prototype.blur=function(){this.div.blur()},Za.prototype.getField=function(){return this.div},Za.prototype.supportsTouch=function(){return!0},Za.prototype.receivedFocus=function(){function e(){t.cm.state.focused&&(t.pollSelection(),t.polling.set(t.cm.options.pollInterval,e))}var t=this;this.selectionInEditor()?this.pollSelection():hn(this.cm,function(){return t.cm.curOp.selectionChanged=!0}),this.polling.set(this.cm.options.pollInterval,e)},Za.prototype.selectionChanged=function(){var e=window.getSelection();return e.anchorNode!=this.lastAnchorNode||e.anchorOffset!=this.lastAnchorOffset||e.focusNode!=this.lastFocusNode||e.focusOffset!=this.lastFocusOffset},Za.prototype.pollSelection=function(){if(null==this.readDOMTimeout&&!this.gracePeriod&&this.selectionChanged()){var e=window.getSelection(),t=this.cm;if(Cs&&bs&&this.cm.options.gutters.length&&ts(e.anchorNode))return this.cm.triggerOnKeyDown({type:"keydown",keyCode:8,preventDefault:Math.abs}),this.blur(),void this.focus();if(!this.composing){this.rememberSelection();var i=rs(t,e.anchorNode,e.anchorOffset),n=rs(t,e.focusNode,e.focusOffset);i&&n&&hn(t,function(){yr(t.doc,Bn(i,n),zs),(i.bad||n.bad)&&(t.curOp.selectionChanged=!0)})}}},Za.prototype.pollContent=function(){null!=this.readDOMTimeout&&(clearTimeout(this.readDOMTimeout),this.readDOMTimeout=null);var e,t,i,n=this.cm,r=n.display,o=n.doc.sel.primary(),s=o.from(),a=o.to();if(0==s.ch&&s.line>n.firstLine()&&(s=I(s.line-1,E(n.doc,s.line-1).length)),a.ch==E(n.doc,a.line).text.length&&a.line<n.lastLine()&&(a=I(a.line+1,0)),s.line<r.viewFrom||a.line>r.viewTo-1)return!1;s.line==r.viewFrom||0==(e=Ti(n,s.line))?(t=N(r.view[0].line),i=r.view[0].node):(t=N(r.view[e].line),i=r.view[e-1].node.nextSibling);var l,c,d=Ti(n,a.line);if(d==r.view.length-1?(l=r.viewTo-1,c=r.lineDiv.lastChild):(l=N(r.view[d+1].line)-1,c=r.view[d+1].node.previousSibling),!i)return!1;for(var u=n.doc.splitLines(ns(n,i,c,t,l)),h=$(n.doc,I(t,0),I(l,E(n.doc,l).text.length));u.length>1&&h.length>1;)if(m(u)==m(h))u.pop(),h.pop(),l--;else{if(u[0]!=h[0])break;u.shift(),h.shift(),t++}for(var p=0,f=0,g=u[0],v=h[0],b=Math.min(g.length,v.length);p<b&&g.charCodeAt(p)==v.charCodeAt(p);)++p;for(var y=m(u),w=m(h),k=Math.min(y.length-(1==u.length?p:0),w.length-(1==h.length?p:0));f<k&&y.charCodeAt(y.length-f-1)==w.charCodeAt(w.length-f-1);)++f;if(1==u.length&&1==h.length&&t==s.line)for(;p&&p>s.ch&&y.charCodeAt(y.length-f-1)==w.charCodeAt(w.length-f-1);)p--,f++;u[u.length-1]=y.slice(0,y.length-f).replace(/^\u200b+/,""),u[0]=u[0].slice(p).replace(/\u200b+$/,"");var x=I(t,p),_=I(l,h.length?m(h).length-f:0);return u.length>1||u[0]||R(x,_)?(Ir(n.doc,u,x,_,"+input"),!0):void 0},Za.prototype.ensurePolled=function(){this.forceCompositionEnd()},Za.prototype.reset=function(){this.forceCompositionEnd()},Za.prototype.forceCompositionEnd=function(){this.composing&&(clearTimeout(this.readDOMTimeout),this.composing=null,this.updateFromDOM(),this.div.blur(),this.div.focus())},Za.prototype.readFromDOMSoon=function(){var e=this;null==this.readDOMTimeout&&(this.readDOMTimeout=setTimeout(function(){if(e.readDOMTimeout=null,e.composing){if(!e.composing.done)return;e.composing=null}e.updateFromDOM()},80))},Za.prototype.updateFromDOM=function(){var e=this;!this.cm.isReadOnly()&&this.pollContent()||hn(this.cm,function(){return gn(e.cm)})},Za.prototype.setUneditable=function(e){e.contentEditable="false"},Za.prototype.onKeyPress=function(e){0!=e.charCode&&(e.preventDefault(),this.cm.isReadOnly()||pn(this.cm,qo)(this.cm,String.fromCharCode(null==e.charCode?e.keyCode:e.charCode),0))},Za.prototype.readOnlyChanged=function(e){this.div.contentEditable=String("nocursor"!=e)},Za.prototype.onContextMenu=function(){},Za.prototype.resetPosition=function(){},Za.prototype.needsContentAttribute=!0;var Ja=function(e){this.cm=e,this.prevInput="",this.pollingFast=!1,this.polling=new Is,this.hasSelection=!1,this.composing=null};Ja.prototype.init=function(e){function t(e){if(!Ne(r,e)){if(r.somethingSelected())jo({lineWise:!1,text:r.getSelections()});else{if(!r.options.lineWiseCopyCut)return;var t=Vo(r);jo({lineWise:!0,text:t.text}),"cut"==e.type?r.setSelections(t.ranges,null,zs):(n.prevInput="",s.value=t.text.join("\n"),Ps(s))}"cut"==e.type&&(r.state.cutIncoming=!0)}}var i=this,n=this,r=this.cm,o=this.wrapper=Xo(),s=this.textarea=o.firstChild;e.wrapper.insertBefore(o,e.wrapper.firstChild),_s&&(s.style.width="0px"),Zs(s,"input",function(){fs&&ms>=9&&i.hasSelection&&(i.hasSelection=null),n.poll()}),Zs(s,"paste",function(e){Ne(r,e)||Go(e,r)||(r.state.pasteIncoming=!0,n.fastPoll())}),Zs(s,"cut",t),Zs(s,"copy",t),Zs(e.scroller,"paste",function(t){Bt(e,t)||Ne(r,t)||(r.state.pasteIncoming=!0,n.focus())}),Zs(e.lineSpace,"selectstart",function(t){Bt(e,t)||Ie(t)}),Zs(s,"compositionstart",function(){var e=r.getCursor("from");n.composing&&n.composing.range.clear(),n.composing={start:e,range:r.markText(e,r.getCursor("to"),{className:"CodeMirror-composing"})}}),Zs(s,"compositionend",function(){n.composing&&(n.poll(),n.composing.range.clear(),n.composing=null)})},Ja.prototype.prepareSelection=function(){var e=this.cm,t=e.display,i=e.doc,n=Ei(e);if(e.options.moveInputWithCursor){var r=ui(e,i.sel.primary().head,"div"),o=t.wrapper.getBoundingClientRect(),s=t.lineDiv.getBoundingClientRect();n.teTop=Math.max(0,Math.min(t.wrapper.clientHeight-10,r.top+s.top-o.top)),n.teLeft=Math.max(0,Math.min(t.wrapper.clientWidth-10,r.left+s.left-o.left))}return n},Ja.prototype.showSelection=function(e){var t=this.cm.display;i(t.cursorDiv,e.cursors),i(t.selectionDiv,e.selection),null!=e.teTop&&(this.wrapper.style.top=e.teTop+"px",this.wrapper.style.left=e.teLeft+"px")},Ja.prototype.reset=function(e){if(!this.contextMenuPending&&!this.composing){var t=this.cm;if(t.somethingSelected()){this.prevInput="";var i=t.getSelection();this.textarea.value=i,t.state.focused&&Ps(this.textarea),fs&&ms>=9&&(this.hasSelection=i)}else e||(this.prevInput=this.textarea.value="",fs&&ms>=9&&(this.hasSelection=null))}},Ja.prototype.getField=function(){return this.textarea},Ja.prototype.supportsTouch=function(){return!1},Ja.prototype.focus=function(){if("nocursor"!=this.cm.options.readOnly&&(!Ts||s()!=this.textarea))try{this.textarea.focus()}catch(e){}},Ja.prototype.blur=function(){this.textarea.blur()},Ja.prototype.resetPosition=function(){this.wrapper.style.top=this.wrapper.style.left=0},Ja.prototype.receivedFocus=function(){this.slowPoll()},Ja.prototype.slowPoll=function(){var e=this;this.pollingFast||this.polling.set(this.cm.options.pollInterval,function(){e.poll(),e.cm.state.focused&&e.slowPoll()})},Ja.prototype.fastPoll=function(){function e(){i.poll()||t?(i.pollingFast=!1,i.slowPoll()):(t=!0,i.polling.set(60,e))}var t=!1,i=this;i.pollingFast=!0,i.polling.set(20,e)},Ja.prototype.poll=function(){var e=this,t=this.cm,i=this.textarea,n=this.prevInput;if(this.contextMenuPending||!t.state.focused||ta(i)&&!n&&!this.composing||t.isReadOnly()||t.options.disableInput||t.state.keySeq)return!1;var r=i.value;if(r==n&&!t.somethingSelected())return!1;if(fs&&ms>=9&&this.hasSelection===r||Ss&&/[\uf700-\uf7ff]/.test(r))return t.display.input.reset(),!1;if(t.doc.sel==t.display.selForContextMenu){var o=r.charCodeAt(0);if(8203!=o||n||(n="\u200b"),8666==o)return this.reset(),this.cm.execCommand("undo")}for(var s=0,a=Math.min(n.length,r.length);s<a&&n.charCodeAt(s)==r.charCodeAt(s);)++s;return hn(t,function(){qo(t,r.slice(s),n.length-s,null,e.composing?"*compose":null),r.length>1e3||r.indexOf("\n")>-1?i.value=e.prevInput="":e.prevInput=r,e.composing&&(e.composing.range.clear(),e.composing.range=t.markText(e.composing.start,t.getCursor("to"),{className:"CodeMirror-composing"}))}),!0},Ja.prototype.ensurePolled=function(){this.pollingFast&&this.poll()&&(this.pollingFast=!1)},Ja.prototype.onKeyPress=function(){fs&&ms>=9&&(this.hasSelection=null),this.fastPoll()},Ja.prototype.onContextMenu=function(e){function t(){if(null!=s.selectionStart){var e=r.somethingSelected(),t="\u200b"+(e?s.value:"");s.value="\u21da",s.value=t,n.prevInput=e?"":"\u200b",s.selectionStart=1,s.selectionEnd=t.length,o.selForContextMenu=r.doc.sel}}function i(){if(n.contextMenuPending=!1,n.wrapper.style.cssText=d,s.style.cssText=c,fs&&ms<9&&o.scrollbars.setScrollTop(o.scroller.scrollTop=l),null!=s.selectionStart){(!fs||fs&&ms<9)&&t();var e=0,i=function(){
o.selForContextMenu==r.doc.sel&&0==s.selectionStart&&s.selectionEnd>0&&"\u200b"==n.prevInput?pn(r,Er)(r):e++<10?o.detectingSelectAll=setTimeout(i,500):(o.selForContextMenu=null,o.input.reset())};o.detectingSelectAll=setTimeout(i,200)}}var n=this,r=n.cm,o=r.display,s=n.textarea,a=Ci(r,e),l=o.scroller.scrollTop;if(a&&!ys){r.options.resetSelectionOnContextMenu&&-1==r.doc.sel.contains(a)&&pn(r,yr)(r.doc,Bn(a),zs);var c=s.style.cssText,d=n.wrapper.style.cssText;n.wrapper.style.cssText="position: absolute";var u,h=n.wrapper.getBoundingClientRect();if(s.style.cssText="position: absolute; width: 30px; height: 30px;\n      top: "+(e.clientY-h.top-5)+"px; left: "+(e.clientX-h.left-5)+"px;\n      z-index: 1000; background: "+(fs?"rgba(255, 255, 255, .05)":"transparent")+";\n      outline: none; border-width: 0; outline: none; overflow: hidden; opacity: .05; filter: alpha(opacity=5);",gs&&(u=window.scrollY),o.input.focus(),gs&&window.scrollTo(null,u),o.input.reset(),r.somethingSelected()||(s.value=n.prevInput=" "),n.contextMenuPending=!0,o.selForContextMenu=r.doc.sel,clearTimeout(o.detectingSelectAll),fs&&ms>=9&&t(),Os){Fe(e);var p=function(){Ae(window,"mouseup",p),setTimeout(i,20)};Zs(window,"mouseup",p)}else setTimeout(i,50)}},Ja.prototype.readOnlyChanged=function(e){e||this.reset(),this.textarea.disabled="nocursor"==e},Ja.prototype.setUneditable=function(){},Ja.prototype.needsContentAttribute=!1,Do(zo),Qo(zo);var el="iter insert remove copy getEditor constructor".split(" ");for(var tl in Oa.prototype)Oa.prototype.hasOwnProperty(tl)&&h(el,tl)<0&&(zo.prototype[tl]=function(e){return function(){return e.apply(this.doc,arguments)}}(Oa.prototype[tl]));return Pe(Oa),zo.inputStyles={textarea:Ja,contenteditable:Za},zo.defineMode=function(e){zo.defaults.mode||"null"==e||(zo.defaults.mode=e),je.apply(this,arguments)},zo.defineMIME=qe,zo.defineMode("null",function(){return{token:function(e){return e.skipToEnd()}}}),zo.defineMIME("text/plain","null"),zo.defineExtension=function(e,t){zo.prototype[e]=t},zo.defineDocExtension=function(e,t){Oa.prototype[e]=t},zo.fromTextArea=ss,as(zo),zo.version="5.28.0",zo}),function(e){e.Redactor.prototype.fontcolor=function(){return{init:function(){var t=["#ffffff","#000000","#eeece1","#1f497d","#4f81bd","#c0504d","#9bbb59","#8064a2","#4bacc6","#f79646","#ffff00","#f2f2f2","#7f7f7f","#ddd9c3","#c6d9f0","#dbe5f1","#f2dcdb","#ebf1dd","#e5e0ec","#dbeef3","#fdeada","#fff2ca","#d8d8d8","#595959","#c4bd97","#8db3e2","#b8cce4","#e5b9b7","#d7e3bc","#ccc1d9","#b7dde8","#fbd5b5","#ffe694","#bfbfbf","#3f3f3f","#938953","#548dd4","#95b3d7","#d99694","#c3d69b","#b2a2c7","#b7dde8","#fac08f","#f2c314","#a5a5a5","#262626","#494429","#17365d","#366092","#953734","#76923c","#5f497a","#92cddc","#e36c09","#c09100","#7f7f7f","#0c0c0c","#1d1b10","#0f243e","#244061","#632423","#4f6128","#3f3151","#31859b","#974806","#7f6000"],i=this.button.add("fontcolor","Text Color");this.button.setIcon(i,'<i class="re-icon-fontcolor"></i>');var n=this.button.addDropdown(i);n.attr("rel","fontcolor"),n.width(242);var r=e('<div style="overflow: hidden; text-align: center;">'),o=e('<span rel="text" class="re-dropdown-box-selector-font" style="background: #eee; float: left; padding: 8px 0; cursor: pointer; font-size: 12px; width: 50%;">Text</span>'),s=e('<span rel="back" class="re-dropdown-box-selector-font" style="float: left; padding: 8px 0; cursor: pointer; font-size: 12px; width: 50%;">Highlight</span>');r.append(o),r.append(s),n.append(r),this.fontcolor.buildPicker(n,"textcolor",t),this.fontcolor.buildPicker(n,"backcolor",t),o.on("mousedown",function(t){t.preventDefault(),n.find(".re-dropdown-box-selector-font").css("background","none"),n.find(".re-dropdown-box-backcolor").hide(),n.find(".re-dropdown-box-textcolor").show(),e(this).css("background","#eee")}),s.on("mousedown",function(t){t.preventDefault(),n.find(".re-dropdown-box-selector-font").css("background","none"),n.find(".re-dropdown-box-textcolor").hide(),n.find(".re-dropdown-box-backcolor").show(),e(this).css("background","#eee")})},buildPicker:function(t,i,n){for(var r=e('<div class="re-dropdown-box-'+i+'">'),o="backcolor"==i?"background-color":"color",s=n.length,a=this,l=function(t){t.preventDefault(),a.fontcolor.set(e(this).data("rule"),e(this).attr("rel"))},c=0;c<s;c++){var d=n[c],u=e('<a rel="'+d+'" data-rule="'+o+'" href="#" style="float: left; box-sizing: border-box; font-size: 0; border: 2px solid #fff; padding: 0; margin: 0; width: 22px; height: 22px;"></a>');u.css("background-color",d),u.on("mousedown",l),r.append(u)}var h=e('<a href="#" style="display: block; clear: both; padding: 8px 5px; box-sizing: border-box; font-size: 12px; line-height: 1;"></a>').html(this.lang.get("none"));h.on("mousedown",e.proxy(function(e){e.preventDefault(),this.fontcolor.remove(o)},this)),r.append(h),t.append(r),"backcolor"==i&&r.hide()},set:function(e,t){console.log(this),this.inline.format("dfn","style",e+": "+t+";"),this.dropdown.hide()},remove:function(e){this.inline.removeStyleRule(e),this.dropdown.hide()}}}}(jQuery),function(e){e.Redactor.prototype.codemirror=function(){return{init:function(){var t=this.button.addFirst("html","HTML");this.button.setIcon(t,'<i class="re-icon-html"></i>'),this.button.addCallback(t,this.codemirror.toggle),this.codemirror.$textarea=e("<textarea />"),this.codemirror.$textarea.hide(),"textarea"===this.opts.type?this.core.box().append(this.codemirror.$textarea):this.core.box().after(this.codemirror.$textarea),this.core.element().on("destroy.callback.redactor",e.proxy(function(){this.codemirror.$textarea.remove()},this));var i="undefined"!=typeof this.opts.codemirror?this.opts.codemirror:{lineNumbers:!0};this.codemirror.editor=CodeMirror.fromTextArea(this.codemirror.$textarea[0],i),this.codemirror.$textarea.next(".CodeMirror").hide()},toggle:function(){this.codemirror.$textarea.hasClass("open")?this.codemirror.hide():(this.codemirror.show(),this.codemirror.$textarea.next(".CodeMirror").on("keyup.redactor-codemirror",e.proxy(function(){var e="";this.codemirror.$textarea.next(".CodeMirror").each(function(t,i){e=i.CodeMirror.getValue()}),this.core.callback("change",e)},this)))},setCaretOnShow:function(){this.codemirror.offset=this.offset.get();e(window).scrollTop(),this.core.editor().innerWidth(),this.core.editor().innerHeight();this.codemirror.start=0,this.codemirror.end=0;var t=e("<div/>").append(e.parseHTML(this.core.editor().html(),document,!0)),i=t.find(".redactor-selection-marker");if(i.length>0){var n=t.html().replace(/&amp;/g,"&");1===i.length?(this.codemirror.start=this.utils.strpos(n,t.find("#selection-marker-1").prop("outerHTML")),this.codemirror.end=this.codemirror.start):2===i.length&&(this.codemirror.start=this.utils.strpos(n,t.find("#selection-marker-1").prop("outerHTML")),this.codemirror.end=this.utils.strpos(n,t.find("#selection-marker-2").prop("outerHTML"))-t.find("#selection-marker-1").prop("outerHTML").toString().length)}},setCaretOnHide:function(){this.codemirror.start=0,this.codemirror.end=0;var e=this,t="";if(this.codemirror.$textarea.next(".CodeMirror").each(function(i,n){e.codemirror.selection=n.CodeMirror.listSelections(),e.codemirror.start=n.CodeMirror.indexFromPos(e.codemirror.selection[0].anchor),e.codemirror.end=n.CodeMirror.indexFromPos(e.codemirror.selection[0].head),t=n.CodeMirror.getValue()}),this.codemirror.start>this.codemirror.end&&this.codemirror.end>0){var i=this.codemirror.end,n=this.codemirror.start;this.codemirror.start=i,this.codemirror.end=n}if(this.codemirror.start=this.codemirror.enlargeOffset(t,this.codemirror.start),this.codemirror.end=this.codemirror.enlargeOffset(t,this.codemirror.end),t=t.substr(0,this.codemirror.start)+this.marker.html(1)+t.substr(this.codemirror.start),this.codemirror.end>this.codemirror.start){var r=this.marker.html(1).toString().length;t=t.substr(0,this.codemirror.end+r)+this.marker.html(2)+t.substr(this.codemirror.end+r)}return t},hide:function(){var e;this.codemirror.$textarea.removeClass("open").next(".CodeMirror").hide(),this.codemirror.$textarea.next(".CodeMirror").off(".redactor-codemirror"),e=this.codemirror.setCaretOnHide(e),e=(e=this.paragraphize.load(e)).replace('&amp;<span id="selection-marker-1" class="redactor-selection-marker">\u200b</span>','<span id="selection-marker-1" class="redactor-selection-marker">\u200b</span>&amp;'),this.code.start(e),this.button.enableAll(),this.core.editor().show().focus(),this.selection.restore(),this.placeholder.enable(),this.core.callback("visual")},show:function(){this.selection.save(),this.codemirror.setCaretOnShow();var t=this.core.editor().height(),i=this.code.get();i=this.core.callback("source",i),this.core.editor().hide(),this.button.disableAll("html"),this.marker.remove(),this.codemirror.$textarea.val(i).height(t).addClass("open"),this.codemirror.$textarea.next(".CodeMirror").on("keyup.redactor-codemirror",e.proxy(function(){"textarea"===this.opts.type&&this.codemirror.$textarea.next(".CodeMirror").each(e.proxy(function(e,t){this.core.textarea().val(t.CodeMirror.getValue())},this))},this));var n=this;this.codemirror.$textarea.next(".CodeMirror").each(function(r,o){e(o).show(),o.CodeMirror.setValue(i),o.CodeMirror.setSize("100%",t),o.CodeMirror.refresh(),n.codemirror.start===n.codemirror.end?o.CodeMirror.setCursor(o.CodeMirror.posFromIndex(n.codemirror.start).line,o.CodeMirror.posFromIndex(n.codemirror.end).ch):o.CodeMirror.setSelection({line:o.CodeMirror.posFromIndex(n.codemirror.start).line,ch:o.CodeMirror.posFromIndex(n.codemirror.start).ch},{line:o.CodeMirror.posFromIndex(n.codemirror.end).line,ch:o.CodeMirror.posFromIndex(n.codemirror.end).ch}),o.CodeMirror.focus()})},enlargeOffset:function(e,t){var i=e.length,n=0;if(">"===e[t])n++;else for(var r=t;r<=i&&(n++,">"!==e[r]);r++)if("<"===e[r]||r===i){n=0;break}return t+n}}}}(jQuery),function(e){"object"==typeof exports&&"object"==typeof module?e(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],e):e(CodeMirror)}(function(e){"use strict";var t={autoSelfClosers:{area:!0,base:!0,br:!0,col:!0,command:!0,embed:!0,frame:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0,menuitem:!0},implicitlyClosed:{dd:!0,li:!0,optgroup:!0,option:!0,p:!0,rp:!0,rt:!0,tbody:!0,td:!0,tfoot:!0,th:!0,tr:!0},contextGrabbers:{dd:{dd:!0,dt:!0},dt:{dd:!0,dt:!0},li:{li:!0},option:{option:!0,optgroup:!0},optgroup:{optgroup:!0},p:{address:!0,article:!0,aside:!0,blockquote:!0,dir:!0,div:!0,dl:!0,fieldset:!0,footer:!0,form:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,header:!0,hgroup:!0,hr:!0,menu:!0,nav:!0,ol:!0,p:!0,pre:!0,section:!0,table:!0,ul:!0},rp:{rp:!0,rt:!0},rt:{rp:!0,rt:!0},tbody:{tbody:!0,tfoot:!0},td:{td:!0,th:!0},tfoot:{tbody:!0},th:{td:!0,th:!0},thead:{tbody:!0,tfoot:!0},tr:{tr:!0}},doNotIndent:{pre:!0},allowUnquoted:!0,allowMissing:!0,caseFold:!0},i={autoSelfClosers:{},implicitlyClosed:{},contextGrabbers:{},doNotIndent:{},allowUnquoted:!1,allowMissing:!1,caseFold:!1};e.defineMode("xml",function(n,r){function o(e,t){function i(i){return t.tokenize=i,i(e,t)}var n=e.next();return"<"==n?e.eat("!")?e.eat("[")?e.match("CDATA[")?i(l("atom","]]>")):null:e.match("--")?i(l("comment","-->")):e.match("DOCTYPE",!0,!0)?(e.eatWhile(/[\w\._\-]/),i(c(1))):null:e.eat("?")?(e.eatWhile(/[\w\._\-]/),t.tokenize=l("meta","?>"),"meta"):(x=e.eat("/")?"closeTag":"openTag",t.tokenize=s,"tag bracket"):"&"==n?(e.eat("#")?e.eat("x")?e.eatWhile(/[a-fA-F\d]/)&&e.eat(";"):e.eatWhile(/[\d]/)&&e.eat(";"):e.eatWhile(/[\w\.\-:]/)&&e.eat(";"))?"atom":"error":(e.eatWhile(/[^&<]/),null)}function s(e,t){var i=e.next();if(">"==i||"/"==i&&e.eat(">"))return t.tokenize=o,x=">"==i?"endTag":"selfcloseTag","tag bracket";if("="==i)return x="equals",null;if("<"==i){t.tokenize=o,t.state=p,t.tagName=t.tagStart=null;var n=t.tokenize(e,t);return n?n+" tag error":"tag error"}return/[\'\"]/.test(i)?(t.tokenize=a(i),t.stringStartCol=e.column(),t.tokenize(e,t)):(e.match(/^[^\s\u00a0=<>\"\']*[^\s\u00a0=<>\"\'\/]/),"word")}function a(e){var t=function(t,i){for(;!t.eol();)if(t.next()==e){i.tokenize=s;break}return"string"};return t.isInAttribute=!0,t}function l(e,t){return function(i,n){for(;!i.eol();){if(i.match(t)){n.tokenize=o;break}i.next()}return e}}function c(e){return function(t,i){for(var n;null!=(n=t.next());){if("<"==n)return i.tokenize=c(e+1),i.tokenize(t,i);if(">"==n){if(1==e){i.tokenize=o;break}return i.tokenize=c(e-1),i.tokenize(t,i)}}return"meta"}}function d(e,t,i){this.prev=e.context,this.tagName=t,this.indent=e.indented,this.startOfLine=i,(T.doNotIndent.hasOwnProperty(t)||e.context&&e.context.noIndent)&&(this.noIndent=!0)}function u(e){e.context&&(e.context=e.context.prev)}function h(e,t){for(var i;;){if(!e.context)return;if(i=e.context.tagName,!T.contextGrabbers.hasOwnProperty(i)||!T.contextGrabbers[i].hasOwnProperty(t))return;u(e)}}function p(e,t,i){return"openTag"==e?(i.tagStart=t.column(),f):"closeTag"==e?m:p}function f(e,t,i){return"word"==e?(i.tagName=t.current(),_="tag",b):(_="error",f)}function m(e,t,i){if("word"==e){var n=t.current();return i.context&&i.context.tagName!=n&&T.implicitlyClosed.hasOwnProperty(i.context.tagName)&&u(i),i.context&&i.context.tagName==n||!1===T.matchClosing?(_="tag",g):(_="tag error",v)}return _="error",v}function g(e,t,i){return"endTag"!=e?(_="error",g):(u(i),p)}function v(e,t,i){return _="error",g(e,t,i)}function b(e,t,i){if("word"==e)return _="attribute",y;if("endTag"==e||"selfcloseTag"==e){var n=i.tagName,r=i.tagStart;return i.tagName=i.tagStart=null,"selfcloseTag"==e||T.autoSelfClosers.hasOwnProperty(n)?h(i,n):(h(i,n),i.context=new d(i,n,r==i.indented)),p}return _="error",b}function y(e,t,i){return"equals"==e?w:(T.allowMissing||(_="error"),b(e,t,i))}function w(e,t,i){return"string"==e?k:"word"==e&&T.allowUnquoted?(_="string",b):(_="error",b(e,t,i))}function k(e,t,i){return"string"==e?k:b(e,t,i)}var x,_,C=n.indentUnit,T={},S=r.htmlMode?t:i;for(var E in S)T[E]=S[E];for(var E in r)T[E]=r[E];return o.isInText=!0,{startState:function(e){var t={tokenize:o,state:p,indented:e||0,tagName:null,tagStart:null,context:null};return null!=e&&(t.baseIndent=e),t},token:function(e,t){if(!t.tagName&&e.sol()&&(t.indented=e.indentation()),e.eatSpace())return null;x=null;var i=t.tokenize(e,t);return(i||x)&&"comment"!=i&&(_=null,t.state=t.state(x||i,e,t),_&&(i="error"==_?i+" error":_)),i},indent:function(t,i,n){var r=t.context;if(t.tokenize.isInAttribute)return t.tagStart==t.indented?t.stringStartCol+1:t.indented+C;if(r&&r.noIndent)return e.Pass;if(t.tokenize!=s&&t.tokenize!=o)return n?n.match(/^(\s*)/)[0].length:0;if(t.tagName)return!1!==T.multilineTagIndentPastTag?t.tagStart+t.tagName.length+2:t.tagStart+C*(T.multilineTagIndentFactor||1);if(T.alignCDATA&&/<!\[CDATA\[/.test(i))return 0;var a=i&&/^<(\/)?([\w_:\.-]*)/.exec(i);if(a&&a[1])for(;r;){if(r.tagName==a[2]){r=r.prev;break}if(!T.implicitlyClosed.hasOwnProperty(r.tagName))break;r=r.prev}else if(a)for(;r;){var l=T.contextGrabbers[r.tagName];if(!l||!l.hasOwnProperty(a[2]))break;r=r.prev}for(;r&&r.prev&&!r.startOfLine;)r=r.prev;return r?r.indent+C:t.baseIndent||0},electricInput:/<\/[\s\w:]+>$/,blockCommentStart:"<!--",blockCommentEnd:"-->",configuration:T.htmlMode?"html":"xml",helperType:T.htmlMode?"html":"xml",skipAttribute:function(e){e.state==w&&(e.state=b)}}}),e.defineMIME("text/xml","xml"),e.defineMIME("application/xml","xml"),e.mimeModes.hasOwnProperty("text/html")||e.defineMIME("text/html",{name:"xml",htmlMode:!0})});var _self="undefined"!=typeof window?window:"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope?self:{},Prism=function(){var e=/\blang(?:uage)?-(\w+)\b/i,t=0,i=_self.Prism={util:{encode:function(e){return e instanceof n?new n(e.type,i.util.encode(e.content),e.alias):"Array"===i.util.type(e)?e.map(i.util.encode):e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/\u00a0/g," ")},type:function(e){return Object.prototype.toString.call(e).match(/\[object (\w+)\]/)[1]},objId:function(e){return e.__id||Object.defineProperty(e,"__id",{value:++t}),e.__id},clone:function(e){switch(i.util.type(e)){case"Object":var t={};for(var n in e)e.hasOwnProperty(n)&&(t[n]=i.util.clone(e[n]));return t;case"Array":return e.map&&e.map(function(e){return i.util.clone(e)})}return e}},languages:{extend:function(e,t){var n=i.util.clone(i.languages[e]);for(var r in t)n[r]=t[r];return n},insertBefore:function(e,t,n,r){var o=(r=r||i.languages)[e];if(2==arguments.length){for(var s in n=arguments[1])n.hasOwnProperty(s)&&(o[s]=n[s]);return o}var a={};for(var l in o)if(o.hasOwnProperty(l)){if(l==t)for(var s in n)n.hasOwnProperty(s)&&(a[s]=n[s]);a[l]=o[l]}return i.languages.DFS(i.languages,function(t,i){i===r[e]&&t!=e&&(this[t]=a)}),r[e]=a},DFS:function(e,t,n,r){for(var o in r=r||{},e)e.hasOwnProperty(o)&&(t.call(e,o,e[o],n||o),"Object"!==i.util.type(e[o])||r[i.util.objId(e[o])]?"Array"!==i.util.type(e[o])||r[i.util.objId(e[o])]||(r[i.util.objId(e[o])]=!0,i.languages.DFS(e[o],t,o,r)):(r[i.util.objId(e[o])]=!0,i.languages.DFS(e[o],t,null,r)))}},plugins:{},highlightAll:function(e,t){var n={callback:t,selector:'code[class*="language-"], [class*="language-"] code, code[class*="lang-"], [class*="lang-"] code'};i.hooks.run("before-highlightall",n);for(var r,o=n.elements||document.querySelectorAll(n.selector),s=0;r=o[s++];)i.highlightElement(r,!0===e,n.callback)},highlightElement:function(t,n,r){for(var o,s,a=t;a&&!e.test(a.className);)a=a.parentNode;a&&(o=(a.className.match(e)||[,""])[1].toLowerCase(),s=i.languages[o]),t.className=t.className.replace(e,"").replace(/\s+/g," ")+" language-"+o,a=t.parentNode,/pre/i.test(a.nodeName)&&(a.className=a.className.replace(e,"").replace(/\s+/g," ")+" language-"+o);var l={element:t,language:o,grammar:s,code:t.textContent};if(i.hooks.run("before-sanity-check",l),!l.code||!l.grammar)return l.code&&(l.element.textContent=l.code),void i.hooks.run("complete",l);if(i.hooks.run("before-highlight",l),n&&_self.Worker){var c=new Worker(i.filename);c.onmessage=function(e){l.highlightedCode=e.data,i.hooks.run("before-insert",l),l.element.innerHTML=l.highlightedCode,r&&r.call(l.element),i.hooks.run("after-highlight",l),i.hooks.run("complete",l)},c.postMessage(JSON.stringify({language:l.language,code:l.code,immediateClose:!0}))}else l.highlightedCode=i.highlight(l.code,l.grammar,l.language),i.hooks.run("before-insert",l),l.element.innerHTML=l.highlightedCode,r&&r.call(t),i.hooks.run("after-highlight",l),i.hooks.run("complete",l)},highlight:function(e,t,r){var o=i.tokenize(e,t);return n.stringify(i.util.encode(o),r)},tokenize:function(e,t){var n=i.Token,r=[e],o=t.rest;if(o){for(var s in o)t[s]=o[s];delete t.rest}e:for(var s in t)if(t.hasOwnProperty(s)&&t[s]){var a=t[s];a="Array"===i.util.type(a)?a:[a];for(var l=0;l<a.length;++l){var c=a[l],d=c.inside,u=!!c.lookbehind,h=!!c.greedy,p=0,f=c.alias;if(h&&!c.pattern.global){var m=c.pattern.toString().match(/[imuy]*$/)[0];c.pattern=RegExp(c.pattern.source,m+"g")}c=c.pattern||c;for(var g=0,v=0;g<r.length;v+=r[g].length,++g){var b=r[g];if(r.length>e.length)break e;if(!(b instanceof n)){c.lastIndex=0;var y=1;if(!(T=c.exec(b))&&h&&g!=r.length-1){if(c.lastIndex=v,!(T=c.exec(e)))break;for(var w=T.index+(u?T[1].length:0),k=T.index+T[0].length,x=g,_=v,C=r.length;x<C&&_<k;++x)w>=(_+=r[x].length)&&(++g,v=_);if(r[g]instanceof n||r[x-1].greedy)continue;y=x-g,b=e.slice(v,_),T.index-=v}if(T){u&&(p=T[1].length);k=(w=T.index+p)+(T=T[0].slice(p)).length;var T,S=b.slice(0,w),E=b.slice(k),$=[g,y];S&&$.push(S);var A=new n(s,d?i.tokenize(T,d):T,f,T,h);$.push(A),E&&$.push(E),Array.prototype.splice.apply(r,$)}}}}}return r},hooks:{all:{},add:function(e,t){var n=i.hooks.all;n[e]=n[e]||[],n[e].push(t)},run:function(e,t){var n=i.hooks.all[e];if(n&&n.length)for(var r,o=0;r=n[o++];)r(t)}}},n=i.Token=function(e,t,i,n,r){this.type=e,this.content=t,this.alias=i,this.length=0|(n||"").length,this.greedy=!!r};if(n.stringify=function(e,t,r){if("string"==typeof e)return e;if("Array"===i.util.type(e))return e.map(function(i){return n.stringify(i,t,e)}).join("");var o={type:e.type,content:n.stringify(e.content,t,r),tag:"span",classes:["token",e.type],attributes:{},language:t,parent:r};if("comment"==o.type&&(o.attributes.spellcheck="true"),e.alias){var s="Array"===i.util.type(e.alias)?e.alias:[e.alias];Array.prototype.push.apply(o.classes,s)}i.hooks.run("wrap",o);var a=Object.keys(o.attributes).map(function(e){return e+'="'+(o.attributes[e]||"").replace(/"/g,"&quot;")+'"'}).join(" ");return"<"+o.tag+' class="'+o.classes.join(" ")+'"'+(a?" "+a:"")+">"+o.content+"</"+o.tag+">"},!_self.document)return _self.addEventListener?(_self.addEventListener("message",function(e){var t=JSON.parse(e.data),n=t.language,r=t.code,o=t.immediateClose;_self.postMessage(i.highlight(r,i.languages[n],n)),o&&_self.close()},!1),_self.Prism):_self.Prism;var r=document.currentScript||[].slice.call(document.getElementsByTagName("script")).pop();return r&&(i.filename=r.src,document.addEventListener&&!r.hasAttribute("data-manual")&&("loading"!==document.readyState?window.requestAnimationFrame?window.requestAnimationFrame(i.highlightAll):window.setTimeout(i.highlightAll,16):document.addEventListener("DOMContentLoaded",i.highlightAll))),_self.Prism}();"undefined"!=typeof module&&module.exports&&(module.exports=Prism),"undefined"!=typeof global&&(global.Prism=Prism),Prism.languages.markup={comment:/<!--[\w\W]*?-->/,prolog:/<\?[\w\W]+?\?>/,doctype:/<!DOCTYPE[\w\W]+?>/i,cdata:/<!\[CDATA\[[\w\W]*?]]>/i,tag:{pattern:/<\/?(?!\d)[^\s>\/=$<]+(?:\s+[^\s>\/=]+(?:=(?:("|')(?:\\\1|\\?(?!\1)[\w\W])*\1|[^\s'">=]+))?)*\s*\/?>/i,inside:{tag:{pattern:/^<\/?[^\s>\/]+/i,inside:{punctuation:/^<\/?/,namespace:/^[^\s>\/:]+:/}},"attr-value":{pattern:/=(?:('|")[\w\W]*?(\1)|[^\s>]+)/i,inside:{punctuation:/[=>"']/}},punctuation:/\/?>/,"attr-name":{pattern:/[^\s>\/]+/,inside:{namespace:/^[^\s>\/:]+:/}}}},entity:/&#?[\da-z]{1,8};/i},Prism.hooks.add("wrap",function(e){"entity"===e.type&&(e.attributes.title=e.content.replace(/&amp;/,"&"))}),Prism.languages.xml=Prism.languages.markup,Prism.languages.html=Prism.languages.markup,Prism.languages.mathml=Prism.languages.markup,Prism.languages.svg=Prism.languages.markup,Prism.languages.css={comment:/\/\*[\w\W]*?\*\//,atrule:{pattern:/@[\w-]+?.*?(;|(?=\s*\{))/i,inside:{rule:/@[\w-]+/}},url:/url\((?:(["'])(\\(?:\r\n|[\w\W])|(?!\1)[^\\\r\n])*\1|.*?)\)/i,selector:/[^\{\}\s][^\{\};]*?(?=\s*\{)/,string:{pattern:/("|')(\\(?:\r\n|[\w\W])|(?!\1)[^\\\r\n])*\1/,greedy:!0},property:/(\b|\B)[\w-]+(?=\s*:)/i,important:/\B!important\b/i,"function":/[-a-z0-9]+(?=\()/i,punctuation:/[(){};:]/},Prism.languages.css.atrule.inside.rest=Prism.util.clone(Prism.languages.css),Prism.languages.markup&&(Prism.languages.insertBefore("markup","tag",{style:{pattern:/(<style[\w\W]*?>)[\w\W]*?(?=<\/style>)/i,lookbehind:!0,inside:Prism.languages.css,alias:"language-css"}}),Prism.languages.insertBefore("inside","attr-value",{"style-attr":{pattern:/\s*style=("|').*?\1/i,inside:{"attr-name":{pattern:/^\s*style/i,inside:Prism.languages.markup.tag.inside},punctuation:/^\s*=\s*['"]|['"]\s*$/,"attr-value":{pattern:/.+/i,inside:Prism.languages.css}},alias:"language-css"}},Prism.languages.markup.tag)),Prism.languages.clike={comment:[{pattern:/(^|[^\\])\/\*[\w\W]*?\*\//,lookbehind:!0},{pattern:/(^|[^\\:])\/\/.*/,lookbehind:!0}],string:{pattern:/(["'])(\\(?:\r\n|[\s\S])|(?!\1)[^\\\r\n])*\1/,greedy:!0},"class-name":{pattern:/((?:\b(?:class|interface|extends|implements|trait|instanceof|new)\s+)|(?:catch\s+\())[a-z0-9_\.\\]+/i,lookbehind:!0,inside:{punctuation:/(\.|\\)/}},keyword:/\b(if|else|while|do|for|return|in|instanceof|function|new|try|throw|catch|finally|null|break|continue)\b/,"boolean":/\b(true|false)\b/,"function":/[a-z0-9_]+(?=\()/i,number:/\b-?(?:0x[\da-f]+|\d*\.?\d+(?:e[+-]?\d+)?)\b/i,operator:/--?|\+\+?|!=?=?|<=?|>=?|==?=?|&&?|\|\|?|\?|\*|\/|~|\^|%/,punctuation:/[{}[\];(),.:]/},Prism.languages.javascript=Prism.languages.extend("clike",{keyword:/\b(as|async|await|break|case|catch|class|const|continue|debugger|default|delete|do|else|enum|export|extends|finally|for|from|function|get|if|implements|import|in|instanceof|interface|let|new|null|of|package|private|protected|public|return|set|static|super|switch|this|throw|try|typeof|var|void|while|with|yield)\b/,number:/\b-?(0x[\dA-Fa-f]+|0b[01]+|0o[0-7]+|\d*\.?\d+([Ee][+-]?\d+)?|NaN|Infinity)\b/,"function":/[_$a-zA-Z\xA0-\uFFFF][_$a-zA-Z0-9\xA0-\uFFFF]*(?=\()/i,operator:/--?|\+\+?|!=?=?|<=?|>=?|==?=?|&&?|\|\|?|\?|\*\*?|\/|~|\^|%|\.{3}/}),Prism.languages.insertBefore("javascript","keyword",{regex:{pattern:/(^|[^/])\/(?!\/)(\[.+?]|\\.|[^/\\\r\n])+\/[gimyu]{0,5}(?=\s*($|[\r\n,.;})]))/,lookbehind:!0,greedy:!0}}),Prism.languages.insertBefore("javascript","string",{"template-string":{pattern:/`(?:\\\\|\\?[^\\])*?`/,greedy:!0,inside:{interpolation:{pattern:/\$\{[^}]+\}/,inside:{"interpolation-punctuation":{pattern:/^\$\{|\}$/,alias:"punctuation"},rest:Prism.languages.javascript}},string:/[\s\S]+/}}}),Prism.languages.markup&&Prism.languages.insertBefore("markup","tag",{script:{pattern:/(<script[\w\W]*?>)[\w\W]*?(?=<\/script>)/i,lookbehind:!0,inside:Prism.languages.javascript,alias:"language-javascript"}}),Prism.languages.js=Prism.languages.javascript,Prism.languages.aspnet=Prism.languages.extend("markup",{"page-directive tag":{pattern:/<%\s*@.*%>/i,inside:{"page-directive tag":/<%\s*@\s*(?:Assembly|Control|Implements|Import|Master(?:Type)?|OutputCache|Page|PreviousPageType|Reference|Register)?|%>/i,rest:Prism.languages.markup.tag.inside}},"directive tag":{pattern:/<%.*%>/i,inside:{"directive tag":/<%\s*?[$=%#:]{0,2}|%>/i,rest:Prism.languages.csharp}}}),Prism.languages.aspnet.tag.pattern=/<(?!%)\/?[^\s>\/]+(?:\s+[^\s>\/=]+(?:=(?:("|')(?:\\\1|\\?(?!\1)[\w\W])*\1|[^\s'">=]+))?)*\s*\/?>/i,Prism.languages.insertBefore("inside","punctuation",{"directive tag":Prism.languages.aspnet["directive tag"]},Prism.languages.aspnet.tag.inside["attr-value"]),Prism.languages.insertBefore("aspnet","comment",{"asp comment":/<%--[\w\W]*?--%>/}),Prism.languages.insertBefore("aspnet",Prism.languages.javascript?"script":"tag",{"asp script":{pattern:/(<script(?=.*runat=['"]?server['"]?)[\w\W]*?>)[\w\W]*?(?=<\/script>)/i,lookbehind:!0,inside:Prism.languages.csharp||{}}}),function(e){var t={variable:[{pattern:/\$?\(\([\w\W]+?\)\)/,inside:{variable:[{pattern:/(^\$\(\([\w\W]+)\)\)/,lookbehind:!0},/^\$\(\(/],number:/\b-?(?:0x[\dA-Fa-f]+|\d*\.?\d+(?:[Ee]-?\d+)?)\b/,operator:/--?|-=|\+\+?|\+=|!=?|~|\*\*?|\*=|\/=?|%=?|<<=?|>>=?|<=?|>=?|==?|&&?|&=|\^=?|\|\|?|\|=|\?|:/,punctuation:/\(\(?|\)\)?|,|;/}},{pattern:/\$\([^)]+\)|`[^`]+`/,inside:{variable:/^\$\(|^`|\)$|`$/}},/\$(?:[a-z0-9_#\?\*!@]+|\{[^}]+\})/i]};e.languages.bash={shebang:{pattern:/^#!\s*\/bin\/bash|^#!\s*\/bin\/sh/,alias:"important"},comment:{pattern:/(^|[^"{\\])#.*/,lookbehind:!0},string:[{pattern:/((?:^|[^<])<<\s*)(?:"|')?(\w+?)(?:"|')?\s*\r?\n(?:[\s\S])*?\r?\n\2/g,lookbehind:!0,greedy:!0,inside:t},{pattern:/(["'])(?:\\\\|\\?[^\\])*?\1/g,greedy:!0,inside:t}],variable:t.variable,"function":{pattern:/(^|\s|;|\||&)(?:alias|apropos|apt-get|aptitude|aspell|awk|basename|bash|bc|bg|builtin|bzip2|cal|cat|cd|cfdisk|chgrp|chmod|chown|chroot|chkconfig|cksum|clear|cmp|comm|command|cp|cron|crontab|csplit|cut|date|dc|dd|ddrescue|df|diff|diff3|dig|dir|dircolors|dirname|dirs|dmesg|du|egrep|eject|enable|env|ethtool|eval|exec|expand|expect|export|expr|fdformat|fdisk|fg|fgrep|file|find|fmt|fold|format|free|fsck|ftp|fuser|gawk|getopts|git|grep|groupadd|groupdel|groupmod|groups|gzip|hash|head|help|hg|history|hostname|htop|iconv|id|ifconfig|ifdown|ifup|import|install|jobs|join|kill|killall|less|link|ln|locate|logname|logout|look|lpc|lpr|lprint|lprintd|lprintq|lprm|ls|lsof|make|man|mkdir|mkfifo|mkisofs|mknod|more|most|mount|mtools|mtr|mv|mmv|nano|netstat|nice|nl|nohup|notify-send|npm|nslookup|open|op|passwd|paste|pathchk|ping|pkill|popd|pr|printcap|printenv|printf|ps|pushd|pv|pwd|quota|quotacheck|quotactl|ram|rar|rcp|read|readarray|readonly|reboot|rename|renice|remsync|rev|rm|rmdir|rsync|screen|scp|sdiff|sed|seq|service|sftp|shift|shopt|shutdown|sleep|slocate|sort|source|split|ssh|stat|strace|su|sudo|sum|suspend|sync|tail|tar|tee|test|time|timeout|times|touch|top|traceroute|trap|tr|tsort|tty|type|ulimit|umask|umount|unalias|uname|unexpand|uniq|units|unrar|unshar|uptime|useradd|userdel|usermod|users|uuencode|uudecode|v|vdir|vi|vmstat|wait|watch|wc|wget|whereis|which|who|whoami|write|xargs|xdg-open|yes|zip)(?=$|\s|;|\||&)/,lookbehind:!0},keyword:{pattern:/(^|\s|;|\||&)(?:let|:|\.|if|then|else|elif|fi|for|break|continue|while|in|case|function|select|do|done|until|echo|exit|return|set|declare)(?=$|\s|;|\||&)/,lookbehind:!0},"boolean":{pattern:/(^|\s|;|\||&)(?:true|false)(?=$|\s|;|\||&)/,lookbehind:!0},operator:/&&?|\|\|?|==?|!=?|<<<?|>>|<=?|>=?|=~/,punctuation:/\$?\(\(?|\)\)?|\.\.|[{}[\];]/};var i=t.variable[1].inside;i["function"]=e.languages.bash["function"],i.keyword=e.languages.bash.keyword,i["boolean"]=e.languages.bash["boolean"],i.operator=e.languages.bash.operator,i.punctuation=e.languages.bash.punctuation}(Prism),Prism.languages.csharp=Prism.languages.extend("clike",{keyword:/\b(abstract|as|async|await|base|bool|break|byte|case|catch|char|checked|class|const|continue|decimal|default|delegate|do|double|else|enum|event|explicit|extern|false|finally|fixed|float|for|foreach|goto|if|implicit|in|int|interface|internal|is|lock|long|namespace|new|null|object|operator|out|override|params|private|protected|public|readonly|ref|return|sbyte|sealed|short|sizeof|stackalloc|static|string|struct|switch|this|throw|true|try|typeof|uint|ulong|unchecked|unsafe|ushort|using|virtual|void|volatile|while|add|alias|ascending|async|await|descending|dynamic|from|get|global|group|into|join|let|orderby|partial|remove|select|set|value|var|where|yield)\b/,string:[/@("|')(\1\1|\\\1|\\?(?!\1)[\s\S])*\1/,/("|')(\\?.)*?\1/],number:/\b-?(0x[\da-f]+|\d*\.?\d+f?)\b/i}),Prism.languages.insertBefore("csharp","keyword",{"generic-method":{pattern:/[a-z0-9_]+\s*<[^>\r\n]+?>\s*(?=\()/i,alias:"function",inside:{keyword:Prism.languages.csharp.keyword,punctuation:/[<>(),.:]/}},preprocessor:{pattern:/(^\s*)#.*/m,lookbehind:!0,alias:"property",inside:{directive:{pattern:/(\s*#)\b(define|elif|else|endif|endregion|error|if|line|pragma|region|undef|warning)\b/,lookbehind:!0,alias:"keyword"}}}}),function(e){e.languages.ruby=e.languages.extend("clike",{comment:/#(?!\{[^\r\n]*?\}).*/,keyword:/\b(alias|and|BEGIN|begin|break|case|class|def|define_method|defined|do|each|else|elsif|END|end|ensure|false|for|if|in|module|new|next|nil|not|or|raise|redo|require|rescue|retry|return|self|super|then|throw|true|undef|unless|until|when|while|yield)\b/});var t={pattern:/#\{[^}]+\}/,inside:{delimiter:{pattern:/^#\{|\}$/,alias:"tag"},rest:e.util.clone(e.languages.ruby)}};e.languages.insertBefore("ruby","keyword",{regex:[{pattern:/%r([^a-zA-Z0-9\s\{\(\[<])(?:[^\\]|\\[\s\S])*?\1[gim]{0,3}/,inside:{interpolation:t}},{pattern:/%r\((?:[^()\\]|\\[\s\S])*\)[gim]{0,3}/,inside:{interpolation:t}},{pattern:/%r\{(?:[^#{}\\]|#(?:\{[^}]+\})?|\\[\s\S])*\}[gim]{0,3}/,inside:{interpolation:t}},{pattern:/%r\[(?:[^\[\]\\]|\\[\s\S])*\][gim]{0,3}/,inside:{interpolation:t}},{pattern:/%r<(?:[^<>\\]|\\[\s\S])*>[gim]{0,3}/,inside:{interpolation:t}},{pattern:/(^|[^/])\/(?!\/)(\[.+?]|\\.|[^/\r\n])+\/[gim]{0,3}(?=\s*($|[\r\n,.;})]))/,lookbehind:!0}],variable:/[@$]+[a-zA-Z_][a-zA-Z_0-9]*(?:[?!]|\b)/,symbol:/:[a-zA-Z_][a-zA-Z_0-9]*(?:[?!]|\b)/}),e.languages.insertBefore("ruby","number",{builtin:/\b(Array|Bignum|Binding|Class|Continuation|Dir|Exception|FalseClass|File|Stat|File|Fixnum|Float|Hash|Integer|IO|MatchData|Method|Module|NilClass|Numeric|Object|Proc|Range|Regexp|String|Struct|TMS|Symbol|ThreadGroup|Thread|Time|TrueClass)\b/,constant:/\b[A-Z][a-zA-Z_0-9]*(?:[?!]|\b)/}),e.languages.ruby.string=[{pattern:/%[qQiIwWxs]?([^a-zA-Z0-9\s\{\(\[<])(?:[^\\]|\\[\s\S])*?\1/,greedy:!0,inside:{interpolation:t}},{pattern:/%[qQiIwWxs]?\((?:[^()\\]|\\[\s\S])*\)/,greedy:!0,inside:{interpolation:t}},{pattern:/%[qQiIwWxs]?\{(?:[^#{}\\]|#(?:\{[^}]+\})?|\\[\s\S])*\}/,greedy:!0,inside:{interpolation:t}},{pattern:/%[qQiIwWxs]?\[(?:[^\[\]\\]|\\[\s\S])*\]/,greedy:!0,inside:{interpolation:t}},{pattern:/%[qQiIwWxs]?<(?:[^<>\\]|\\[\s\S])*>/,greedy:!0,inside:{interpolation:t}},{pattern:/("|')(#\{[^}]+\}|\\(?:\r?\n|\r)|\\?.)*?\1/,greedy:!0,inside:{interpolation:t}}]}(Prism),Prism.languages.css.selector={pattern:/[^\{\}\s][^\{\}]*(?=\s*\{)/,inside:{"pseudo-element":/:(?:after|before|first-letter|first-line|selection)|::[-\w]+/,"pseudo-class":/:[-\w]+(?:\(.*\))?/,"class":/\.[-:\.\w]+/,id:/#[-:\.\w]+/,attribute:/\[[^\]]+\]/}},Prism.languages.insertBefore("css","function",{hexcode:/#[\da-f]{3,6}/i,entity:/\\[\da-f]{1,8}/i,number:/[\d%\.]+/}),Prism.languages.git={comment:/^#.*/m,deleted:/^[-\u2013].*/m,inserted:/^\+.*/m,
string:/("|')(\\?.)*?\1/m,command:{pattern:/^.*\$ git .*$/m,inside:{parameter:/\s(--|-)\w+/m}},coord:/^@@.*@@$/m,commit_sha1:/^commit \w{40}$/m},Prism.languages.http={"request-line":{pattern:/^(POST|GET|PUT|DELETE|OPTIONS|PATCH|TRACE|CONNECT)\b\shttps?:\/\/\S+\sHTTP\/[0-9.]+/m,inside:{property:/^(POST|GET|PUT|DELETE|OPTIONS|PATCH|TRACE|CONNECT)\b/,"attr-name":/:\w+/}},"response-status":{pattern:/^HTTP\/1.[01] [0-9]+.*/m,inside:{property:{pattern:/(^HTTP\/1.[01] )[0-9]+.*/i,lookbehind:!0}}},"header-name":{pattern:/^[\w-]+:(?=.)/m,alias:"keyword"}};var httpLanguages={"application/json":Prism.languages.javascript,"application/xml":Prism.languages.markup,"text/xml":Prism.languages.markup,"text/html":Prism.languages.markup};for(var contentType in httpLanguages)if(httpLanguages[contentType]){var options={};options[contentType]={pattern:new RegExp("(content-type:\\s*"+contentType+"[\\w\\W]*?)(?:\\r?\\n|\\r){2}[\\w\\W]*","i"),lookbehind:!0,inside:{rest:httpLanguages[contentType]}},Prism.languages.insertBefore("http","header-name",options)}!function(e){e.languages.jade={comment:{pattern:/(^([\t ]*))\/\/.*((?:\r?\n|\r)\2[\t ]+.+)*/m,lookbehind:!0},"multiline-script":{pattern:/(^([\t ]*)script\b.*\.[\t ]*)((?:\r?\n|\r(?!\n))(?:\2[\t ]+.+|\s*?(?=\r?\n|\r)))+/m,lookbehind:!0,inside:{rest:e.languages.javascript}},filter:{pattern:/(^([\t ]*)):.+((?:\r?\n|\r(?!\n))(?:\2[\t ]+.+|\s*?(?=\r?\n|\r)))+/m,lookbehind:!0,inside:{"filter-name":{pattern:/^:[\w-]+/,alias:"variable"}}},"multiline-plain-text":{pattern:/(^([\t ]*)[\w\-#.]+\.[\t ]*)((?:\r?\n|\r(?!\n))(?:\2[\t ]+.+|\s*?(?=\r?\n|\r)))+/m,lookbehind:!0},markup:{pattern:/(^[\t ]*)<.+/m,lookbehind:!0,inside:{rest:e.languages.markup}},doctype:{pattern:/((?:^|\n)[\t ]*)doctype(?: .+)?/,lookbehind:!0},"flow-control":{pattern:/(^[\t ]*)(?:if|unless|else|case|when|default|each|while)\b(?: .+)?/m,lookbehind:!0,inside:{each:{pattern:/^each .+? in\b/,inside:{keyword:/\b(?:each|in)\b/,punctuation:/,/}},branch:{pattern:/^(?:if|unless|else|case|when|default|while)\b/,alias:"keyword"},rest:e.languages.javascript}},keyword:{pattern:/(^[\t ]*)(?:block|extends|include|append|prepend)\b.+/m,lookbehind:!0},mixin:[{pattern:/(^[\t ]*)mixin .+/m,lookbehind:!0,inside:{keyword:/^mixin/,"function":/\w+(?=\s*\(|\s*$)/,punctuation:/[(),.]/}},{pattern:/(^[\t ]*)\+.+/m,lookbehind:!0,inside:{name:{pattern:/^\+\w+/,alias:"function"},rest:e.languages.javascript}}],script:{pattern:/(^[\t ]*script(?:(?:&[^(]+)?\([^)]+\))*[\t ]+).+/m,lookbehind:!0,inside:{rest:e.languages.javascript}},"plain-text":{pattern:/(^[\t ]*(?!-)[\w\-#.]*[\w\-](?:(?:&[^(]+)?\([^)]+\))*\/?[\t ]+).+/m,lookbehind:!0},tag:{pattern:/(^[\t ]*)(?!-)[\w\-#.]*[\w\-](?:(?:&[^(]+)?\([^)]+\))*\/?:?/m,lookbehind:!0,inside:{attributes:[{pattern:/&[^(]+\([^)]+\)/,inside:{rest:e.languages.javascript}},{pattern:/\([^)]+\)/,inside:{"attr-value":{pattern:/(=\s*)(?:\{[^}]*\}|[^,)\r\n]+)/,lookbehind:!0,inside:{rest:e.languages.javascript}},"attr-name":/[\w-]+(?=\s*!?=|\s*[,)])/,punctuation:/[!=(),]+/}}],punctuation:/:/}},code:[{pattern:/(^[\t ]*(?:-|!?=)).+/m,lookbehind:!0,inside:{rest:e.languages.javascript}}],punctuation:/[.\-!=|]+/};for(var t="(^([\\t ]*)):{{filter_name}}((?:\\r?\\n|\\r(?!\\n))(?:\\2[\\t ]+.+|\\s*?(?=\\r?\\n|\\r)))+",i=[{filter:"atpl",language:"twig"},{filter:"coffee",language:"coffeescript"},"ejs","handlebars","hogan","less","livescript","markdown","mustache","plates",{filter:"sass",language:"scss"},"stylus","swig"],n={},r=0,o=i.length;r<o;r++){var s=i[r];s="string"==typeof s?{filter:s,language:s}:s,e.languages[s.language]&&(n["filter-"+s.filter]={pattern:RegExp(t.replace("{{filter_name}}",s.filter),"m"),lookbehind:!0,inside:{"filter-name":{pattern:/^:[\w-]+/,alias:"variable"},rest:e.languages[s.language]}})}e.languages.insertBefore("jade","filter",n)}(Prism),Prism.languages.java=Prism.languages.extend("clike",{keyword:/\b(abstract|continue|for|new|switch|assert|default|goto|package|synchronized|boolean|do|if|private|this|break|double|implements|protected|throw|byte|else|import|public|throws|case|enum|instanceof|return|transient|catch|extends|int|short|try|char|final|interface|static|void|class|finally|long|strictfp|volatile|const|float|native|super|while)\b/,number:/\b0b[01]+\b|\b0x[\da-f]*\.?[\da-fp\-]+\b|\b\d*\.?\d+(?:e[+-]?\d+)?[df]?\b/i,operator:{pattern:/(^|[^.])(?:\+[+=]?|-[-=]?|!=?|<<?=?|>>?>?=?|==?|&[&=]?|\|[|=]?|\*=?|\/=?|%=?|\^=?|[?:~])/m,lookbehind:!0}}),Prism.languages.insertBefore("java","function",{annotation:{alias:"punctuation",pattern:/(^|[^.])@\w+/,lookbehind:!0}}),Prism.languages.json={property:/"(?:\\.|[^\\"])*"(?=\s*:)/gi,string:/"(?!:)(?:\\.|[^\\"])*"(?!:)/g,number:/\b-?(0x[\dA-Fa-f]+|\d*\.?\d+([Ee][+-]?\d+)?)\b/g,punctuation:/[{}[\]);,]/g,operator:/:/g,"boolean":/\b(true|false)\b/gi,"null":/\bnull\b/gi},Prism.languages.jsonp=Prism.languages.json,Prism.languages.less=Prism.languages.extend("css",{comment:[/\/\*[\w\W]*?\*\//,{pattern:/(^|[^\\])\/\/.*/,lookbehind:!0}],atrule:{pattern:/@[\w-]+?(?:\([^{}]+\)|[^(){};])*?(?=\s*\{)/i,inside:{punctuation:/[:()]/}},selector:{pattern:/(?:@\{[\w-]+\}|[^{};\s@])(?:@\{[\w-]+\}|\([^{}]*\)|[^{};@])*?(?=\s*\{)/,inside:{variable:/@+[\w-]+/}},property:/(?:@\{[\w-]+\}|[\w-])+(?:\+_?)?(?=\s*:)/i,punctuation:/[{}();:,]/,operator:/[+\-*\/]/}),Prism.languages.insertBefore("less","punctuation",{"function":Prism.languages.less["function"]}),Prism.languages.insertBefore("less","property",{variable:[{pattern:/@[\w-]+\s*:/,inside:{punctuation:/:/}},/@@?[\w-]+/],"mixin-usage":{pattern:/([{;]\s*)[.#](?!\d)[\w-]+.*?(?=[(;])/,lookbehind:!0,alias:"function"}}),Prism.languages.markdown=Prism.languages.extend("markup",{}),Prism.languages.insertBefore("markdown","prolog",{blockquote:{pattern:/^>(?:[\t ]*>)*/m,alias:"punctuation"},code:[{pattern:/^(?: {4}|\t).+/m,alias:"keyword"},{pattern:/``.+?``|`[^`\n]+`/,alias:"keyword"}],title:[{pattern:/\w+.*(?:\r?\n|\r)(?:==+|--+)/,alias:"important",inside:{punctuation:/==+$|--+$/}},{pattern:/(^\s*)#+.+/m,lookbehind:!0,alias:"important",inside:{punctuation:/^#+|#+$/}}],hr:{pattern:/(^\s*)([*-])([\t ]*\2){2,}(?=\s*$)/m,lookbehind:!0,alias:"punctuation"},list:{pattern:/(^\s*)(?:[*+-]|\d+\.)(?=[\t ].)/m,lookbehind:!0,alias:"punctuation"},"url-reference":{pattern:/!?\[[^\]]+\]:[\t ]+(?:\S+|<(?:\\.|[^>\\])+>)(?:[\t ]+(?:"(?:\\.|[^"\\])*"|'(?:\\.|[^'\\])*'|\((?:\\.|[^)\\])*\)))?/,inside:{variable:{pattern:/^(!?\[)[^\]]+/,lookbehind:!0},string:/(?:"(?:\\.|[^"\\])*"|'(?:\\.|[^'\\])*'|\((?:\\.|[^)\\])*\))$/,punctuation:/^[\[\]!:]|[<>]/},alias:"url"},bold:{pattern:/(^|[^\\])(\*\*|__)(?:(?:\r?\n|\r)(?!\r?\n|\r)|.)+?\2/,lookbehind:!0,inside:{punctuation:/^\*\*|^__|\*\*$|__$/}},italic:{pattern:/(^|[^\\])([*_])(?:(?:\r?\n|\r)(?!\r?\n|\r)|.)+?\2/,lookbehind:!0,inside:{punctuation:/^[*_]|[*_]$/}},url:{pattern:/!?\[[^\]]+\](?:\([^\s)]+(?:[\t ]+"(?:\\.|[^"\\])*")?\)| ?\[[^\]\n]*\])/,inside:{variable:{pattern:/(!?\[)[^\]]+(?=\]$)/,lookbehind:!0},string:{pattern:/"(?:\\.|[^"\\])*"(?=\)$)/}}}}),Prism.languages.markdown.bold.inside.url=Prism.util.clone(Prism.languages.markdown.url),Prism.languages.markdown.italic.inside.url=Prism.util.clone(Prism.languages.markdown.url),Prism.languages.markdown.bold.inside.italic=Prism.util.clone(Prism.languages.markdown.italic),Prism.languages.markdown.italic.inside.bold=Prism.util.clone(Prism.languages.markdown.bold),Prism.languages.nginx=Prism.languages.extend("clike",{comment:{pattern:/(^|[^"{\\])#.*/,lookbehind:!0},keyword:/\b(?:CONTENT_|DOCUMENT_|GATEWAY_|HTTP_|HTTPS|if_not_empty|PATH_|QUERY_|REDIRECT_|REMOTE_|REQUEST_|SCGI|SCRIPT_|SERVER_|http|server|events|location|include|accept_mutex|accept_mutex_delay|access_log|add_after_body|add_before_body|add_header|addition_types|aio|alias|allow|ancient_browser|ancient_browser_value|auth|auth_basic|auth_basic_user_file|auth_http|auth_http_header|auth_http_timeout|autoindex|autoindex_exact_size|autoindex_localtime|break|charset|charset_map|charset_types|chunked_transfer_encoding|client_body_buffer_size|client_body_in_file_only|client_body_in_single_buffer|client_body_temp_path|client_body_timeout|client_header_buffer_size|client_header_timeout|client_max_body_size|connection_pool_size|create_full_put_path|daemon|dav_access|dav_methods|debug_connection|debug_points|default_type|deny|devpoll_changes|devpoll_events|directio|directio_alignment|disable_symlinks|empty_gif|env|epoll_events|error_log|error_page|expires|fastcgi_buffer_size|fastcgi_buffers|fastcgi_busy_buffers_size|fastcgi_cache|fastcgi_cache_bypass|fastcgi_cache_key|fastcgi_cache_lock|fastcgi_cache_lock_timeout|fastcgi_cache_methods|fastcgi_cache_min_uses|fastcgi_cache_path|fastcgi_cache_purge|fastcgi_cache_use_stale|fastcgi_cache_valid|fastcgi_connect_timeout|fastcgi_hide_header|fastcgi_ignore_client_abort|fastcgi_ignore_headers|fastcgi_index|fastcgi_intercept_errors|fastcgi_keep_conn|fastcgi_max_temp_file_size|fastcgi_next_upstream|fastcgi_no_cache|fastcgi_param|fastcgi_pass|fastcgi_pass_header|fastcgi_read_timeout|fastcgi_redirect_errors|fastcgi_send_timeout|fastcgi_split_path_info|fastcgi_store|fastcgi_store_access|fastcgi_temp_file_write_size|fastcgi_temp_path|flv|geo|geoip_city|geoip_country|google_perftools_profiles|gzip|gzip_buffers|gzip_comp_level|gzip_disable|gzip_http_version|gzip_min_length|gzip_proxied|gzip_static|gzip_types|gzip_vary|if|if_modified_since|ignore_invalid_headers|image_filter|image_filter_buffer|image_filter_jpeg_quality|image_filter_sharpen|image_filter_transparency|imap_capabilities|imap_client_buffer|include|index|internal|ip_hash|keepalive|keepalive_disable|keepalive_requests|keepalive_timeout|kqueue_changes|kqueue_events|large_client_header_buffers|limit_conn|limit_conn_log_level|limit_conn_zone|limit_except|limit_rate|limit_rate_after|limit_req|limit_req_log_level|limit_req_zone|limit_zone|lingering_close|lingering_time|lingering_timeout|listen|location|lock_file|log_format|log_format_combined|log_not_found|log_subrequest|map|map_hash_bucket_size|map_hash_max_size|master_process|max_ranges|memcached_buffer_size|memcached_connect_timeout|memcached_next_upstream|memcached_pass|memcached_read_timeout|memcached_send_timeout|merge_slashes|min_delete_depth|modern_browser|modern_browser_value|mp4|mp4_buffer_size|mp4_max_buffer_size|msie_padding|msie_refresh|multi_accept|open_file_cache|open_file_cache_errors|open_file_cache_min_uses|open_file_cache_valid|open_log_file_cache|optimize_server_names|override_charset|pcre_jit|perl|perl_modules|perl_require|perl_set|pid|pop3_auth|pop3_capabilities|port_in_redirect|post_action|postpone_output|protocol|proxy|proxy_buffer|proxy_buffer_size|proxy_buffering|proxy_buffers|proxy_busy_buffers_size|proxy_cache|proxy_cache_bypass|proxy_cache_key|proxy_cache_lock|proxy_cache_lock_timeout|proxy_cache_methods|proxy_cache_min_uses|proxy_cache_path|proxy_cache_use_stale|proxy_cache_valid|proxy_connect_timeout|proxy_cookie_domain|proxy_cookie_path|proxy_headers_hash_bucket_size|proxy_headers_hash_max_size|proxy_hide_header|proxy_http_version|proxy_ignore_client_abort|proxy_ignore_headers|proxy_intercept_errors|proxy_max_temp_file_size|proxy_method|proxy_next_upstream|proxy_no_cache|proxy_pass|proxy_pass_error_message|proxy_pass_header|proxy_pass_request_body|proxy_pass_request_headers|proxy_read_timeout|proxy_redirect|proxy_redirect_errors|proxy_send_lowat|proxy_send_timeout|proxy_set_body|proxy_set_header|proxy_ssl_session_reuse|proxy_store|proxy_store_access|proxy_temp_file_write_size|proxy_temp_path|proxy_timeout|proxy_upstream_fail_timeout|proxy_upstream_max_fails|random_index|read_ahead|real_ip_header|recursive_error_pages|request_pool_size|reset_timedout_connection|resolver|resolver_timeout|return|rewrite|root|rtsig_overflow_events|rtsig_overflow_test|rtsig_overflow_threshold|rtsig_signo|satisfy|satisfy_any|secure_link_secret|send_lowat|send_timeout|sendfile|sendfile_max_chunk|server|server_name|server_name_in_redirect|server_names_hash_bucket_size|server_names_hash_max_size|server_tokens|set|set_real_ip_from|smtp_auth|smtp_capabilities|so_keepalive|source_charset|split_clients|ssi|ssi_silent_errors|ssi_types|ssi_value_length|ssl|ssl_certificate|ssl_certificate_key|ssl_ciphers|ssl_client_certificate|ssl_crl|ssl_dhparam|ssl_engine|ssl_prefer_server_ciphers|ssl_protocols|ssl_session_cache|ssl_session_timeout|ssl_verify_client|ssl_verify_depth|starttls|stub_status|sub_filter|sub_filter_once|sub_filter_types|tcp_nodelay|tcp_nopush|timeout|timer_resolution|try_files|types|types_hash_bucket_size|types_hash_max_size|underscores_in_headers|uninitialized_variable_warn|upstream|use|user|userid|userid_domain|userid_expires|userid_name|userid_p3p|userid_path|userid_service|valid_referers|variables_hash_bucket_size|variables_hash_max_size|worker_connections|worker_cpu_affinity|worker_priority|worker_processes|worker_rlimit_core|worker_rlimit_nofile|worker_rlimit_sigpending|working_directory|xclient|xml_entities|xslt_entities|xslt_stylesheet|xslt_types)\b/i}),Prism.languages.insertBefore("nginx","keyword",{variable:/\$[a-z_]+/i}),Prism.languages.php=Prism.languages.extend("clike",{keyword:/\b(and|or|xor|array|as|break|case|cfunction|class|const|continue|declare|default|die|do|else|elseif|enddeclare|endfor|endforeach|endif|endswitch|endwhile|extends|for|foreach|function|include|include_once|global|if|new|return|static|switch|use|require|require_once|var|while|abstract|interface|public|implements|private|protected|parent|throw|null|echo|print|trait|namespace|final|yield|goto|instanceof|finally|try|catch)\b/i,constant:/\b[A-Z0-9_]{2,}\b/,comment:{pattern:/(^|[^\\])(?:\/\*[\w\W]*?\*\/|\/\/.*)/,lookbehind:!0,greedy:!0}}),Prism.languages.insertBefore("php","class-name",{"shell-comment":{pattern:/(^|[^\\])#.*/,lookbehind:!0,alias:"comment"}}),Prism.languages.insertBefore("php","keyword",{delimiter:/\?>|<\?(?:php)?/i,variable:/\$\w+\b/i,"package":{pattern:/(\\|namespace\s+|use\s+)[\w\\]+/,lookbehind:!0,inside:{punctuation:/\\/}}}),Prism.languages.insertBefore("php","operator",{property:{pattern:/(->)[\w]+/,lookbehind:!0}}),Prism.languages.markup&&(Prism.hooks.add("before-highlight",function(e){"php"===e.language&&(e.tokenStack=[],e.backupCode=e.code,e.code=e.code.replace(/(?:<\?php|<\?)[\w\W]*?(?:\?>)/gi,function(t){return e.tokenStack.push(t),"{{{PHP"+e.tokenStack.length+"}}}"}))}),Prism.hooks.add("before-insert",function(e){"php"===e.language&&(e.code=e.backupCode,delete e.backupCode)}),Prism.hooks.add("after-highlight",function(e){if("php"===e.language){for(var t,i=0;t=e.tokenStack[i];i++)e.highlightedCode=e.highlightedCode.replace("{{{PHP"+(i+1)+"}}}",Prism.highlight(t,e.grammar,"php").replace(/\$/g,"$$$$"));e.element.innerHTML=e.highlightedCode}}),Prism.hooks.add("wrap",function(e){"php"===e.language&&"markup"===e.type&&(e.content=e.content.replace(/(\{\{\{PHP[0-9]+\}\}\})/g,'<span class="token php">$1</span>'))}),Prism.languages.insertBefore("php","comment",{markup:{pattern:/<[^?]\/?(.*?)>/,inside:Prism.languages.markup},php:/\{\{\{PHP[0-9]+\}\}\}/})),Prism.languages.insertBefore("php","variable",{"this":/\$this\b/,global:/\$(?:_(?:SERVER|GET|POST|FILES|REQUEST|SESSION|ENV|COOKIE)|GLOBALS|HTTP_RAW_POST_DATA|argc|argv|php_errormsg|http_response_header)/,scope:{pattern:/\b[\w\\]+::/,inside:{keyword:/(static|self|parent)/,punctuation:/(::|\\)/}}}),Prism.languages.python={"triple-quoted-string":{pattern:/"""[\s\S]+?"""|'''[\s\S]+?'''/,alias:"string"},comment:{pattern:/(^|[^\\])#.*/,lookbehind:!0},string:{pattern:/("|')(?:\\\\|\\?[^\\\r\n])*?\1/,greedy:!0},"function":{pattern:/((?:^|\s)def[ \t]+)[a-zA-Z_][a-zA-Z0-9_]*(?=\()/g,lookbehind:!0},"class-name":{pattern:/(\bclass\s+)[a-z0-9_]+/i,lookbehind:!0},keyword:/\b(?:as|assert|async|await|break|class|continue|def|del|elif|else|except|exec|finally|for|from|global|if|import|in|is|lambda|pass|print|raise|return|try|while|with|yield)\b/,"boolean":/\b(?:True|False)\b/,number:/\b-?(?:0[bo])?(?:(?:\d|0x[\da-f])[\da-f]*\.?\d*|\.\d+)(?:e[+-]?\d+)?j?\b/i,operator:/[-+%=]=?|!=|\*\*?=?|\/\/?=?|<[<=>]?|>[=>]?|[&|^~]|\b(?:or|and|not)\b/,punctuation:/[{}[\];(),.:]/},Prism.languages.r={comment:/#.*/,string:/(['"])(?:\\?.)*?\1/,"percent-operator":{pattern:/%[^%\s]*%/,alias:"operator"},"boolean":/\b(?:TRUE|FALSE)\b/,ellipsis:/\.\.(?:\.|\d+)/,number:[/\b(?:NaN|Inf)\b/,/\b(?:0x[\dA-Fa-f]+(?:\.\d*)?|\d*\.?\d+)(?:[EePp][+-]?\d+)?[iL]?\b/],keyword:/\b(?:if|else|repeat|while|function|for|in|next|break|NULL|NA|NA_integer_|NA_real_|NA_complex_|NA_character_)\b/,operator:/->?>?|<(?:=|<?-)?|[>=!]=?|::?|&&?|\|\|?|[+*\/^$@~]/,punctuation:/[(){}\[\],;]/},function(e){var t=e.util.clone(e.languages.javascript);e.languages.jsx=e.languages.extend("markup",t),e.languages.jsx.tag.pattern=/<\/?[\w\.:-]+\s*(?:\s+[\w\.:-]+(?:=(?:("|')(\\?[\w\W])*?\1|[^\s'">=]+|(\{[\w\W]*?\})))?\s*)*\/?>/i,e.languages.jsx.tag.inside["attr-value"].pattern=/=[^\{](?:('|")[\w\W]*?(\1)|[^\s>]+)/i;var i=e.util.clone(e.languages.jsx);delete i.punctuation,i=e.languages.insertBefore("jsx","operator",{punctuation:/=(?={)|[{}[\];(),.:]/},{jsx:i}),e.languages.insertBefore("inside","attr-value",{script:{pattern:/=(\{(?:\{[^}]*\}|[^}])+\})/i,inside:i,alias:"language-javascript"}},e.languages.jsx.tag)}(Prism),function(e){e.languages.sass=e.languages.extend("css",{comment:{pattern:/^([ \t]*)\/[\/*].*(?:(?:\r?\n|\r)\1[ \t]+.+)*/m,lookbehind:!0}}),e.languages.insertBefore("sass","atrule",{"atrule-line":{pattern:/^(?:[ \t]*)[@+=].+/m,inside:{atrule:/(?:@[\w-]+|[+=])/m}}}),delete e.languages.sass.atrule;var t=/((\$[-_\w]+)|(#\{\$[-_\w]+\}))/i,i=[/[+*\/%]|[=!]=|<=?|>=?|\b(?:and|or|not)\b/,{pattern:/(\s+)-(?=\s)/,lookbehind:!0}];e.languages.insertBefore("sass","property",{"variable-line":{pattern:/^[ \t]*\$.+/m,inside:{punctuation:/:/,variable:t,operator:i}},"property-line":{pattern:/^[ \t]*(?:[^:\s]+ *:.*|:[^:\s]+.*)/m,inside:{property:[/[^:\s]+(?=\s*:)/,{pattern:/(:)[^:\s]+/,lookbehind:!0}],punctuation:/:/,variable:t,operator:i,important:e.languages.sass.important}}}),delete e.languages.sass.property,delete e.languages.sass.important,delete e.languages.sass.selector,e.languages.insertBefore("sass","punctuation",{selector:{pattern:/([ \t]*)\S(?:,?[^,\r\n]+)*(?:,(?:\r?\n|\r)\1[ \t]+\S(?:,?[^,\r\n]+)*)*/,lookbehind:!0}})}(Prism),Prism.languages.scss=Prism.languages.extend("css",{comment:{pattern:/(^|[^\\])(?:\/\*[\w\W]*?\*\/|\/\/.*)/,lookbehind:!0},atrule:{pattern:/@[\w-]+(?:\([^()]+\)|[^(])*?(?=\s+[{;])/,inside:{rule:/@[\w-]+/}},url:/(?:[-a-z]+-)*url(?=\()/i,selector:{pattern:/(?=\S)[^@;\{\}\(\)]?([^@;\{\}\(\)]|&|#\{\$[-_\w]+\})+(?=\s*\{(\}|\s|[^\}]+(:|\{)[^\}]+))/m,inside:{parent:{pattern:/&/,alias:"important"},placeholder:/%[-_\w]+/,variable:/\$[-_\w]+|#\{\$[-_\w]+\}/}}}),Prism.languages.insertBefore("scss","atrule",{keyword:[/@(?:if|else(?: if)?|for|each|while|import|extend|debug|warn|mixin|include|function|return|content)/i,{pattern:/( +)(?:from|through)(?= )/,lookbehind:!0}]}),Prism.languages.scss.property={pattern:/(?:[\w-]|\$[-_\w]+|#\{\$[-_\w]+\})+(?=\s*:)/i,inside:{variable:/\$[-_\w]+|#\{\$[-_\w]+\}/}},Prism.languages.insertBefore("scss","important",{variable:/\$[-_\w]+|#\{\$[-_\w]+\}/}),Prism.languages.insertBefore("scss","function",{placeholder:{pattern:/%[-_\w]+/,alias:"selector"},statement:{pattern:/\B!(?:default|optional)\b/i,alias:"keyword"},"boolean":/\b(?:true|false)\b/,"null":/\bnull\b/,operator:{pattern:/(\s)(?:[-+*\/%]|[=!]=|<=?|>=?|and|or|not)(?=\s)/,lookbehind:!0}}),Prism.languages.scss.atrule.inside.rest=Prism.util.clone(Prism.languages.scss),Prism.languages.sql={comment:{pattern:/(^|[^\\])(?:\/\*[\w\W]*?\*\/|(?:--|\/\/|#).*)/,lookbehind:!0},string:{pattern:/(^|[^@\\])("|')(?:\\?[\s\S])*?\2/,lookbehind:!0},variable:/@[\w.$]+|@("|'|`)(?:\\?[\s\S])+?\1/,"function":/\b(?:COUNT|SUM|AVG|MIN|MAX|FIRST|LAST|UCASE|LCASE|MID|LEN|ROUND|NOW|FORMAT)(?=\s*\()/i,keyword:/\b(?:ACTION|ADD|AFTER|ALGORITHM|ALL|ALTER|ANALYZE|ANY|APPLY|AS|ASC|AUTHORIZATION|AUTO_INCREMENT|BACKUP|BDB|BEGIN|BERKELEYDB|BIGINT|BINARY|BIT|BLOB|BOOL|BOOLEAN|BREAK|BROWSE|BTREE|BULK|BY|CALL|CASCADED?|CASE|CHAIN|CHAR VARYING|CHARACTER (?:SET|VARYING)|CHARSET|CHECK|CHECKPOINT|CLOSE|CLUSTERED|COALESCE|COLLATE|COLUMN|COLUMNS|COMMENT|COMMIT|COMMITTED|COMPUTE|CONNECT|CONSISTENT|CONSTRAINT|CONTAINS|CONTAINSTABLE|CONTINUE|CONVERT|CREATE|CROSS|CURRENT(?:_DATE|_TIME|_TIMESTAMP|_USER)?|CURSOR|DATA(?:BASES?)?|DATE(?:TIME)?|DBCC|DEALLOCATE|DEC|DECIMAL|DECLARE|DEFAULT|DEFINER|DELAYED|DELETE|DELIMITER(?:S)?|DENY|DESC|DESCRIBE|DETERMINISTIC|DISABLE|DISCARD|DISK|DISTINCT|DISTINCTROW|DISTRIBUTED|DO|DOUBLE(?: PRECISION)?|DROP|DUMMY|DUMP(?:FILE)?|DUPLICATE KEY|ELSE|ENABLE|ENCLOSED BY|END|ENGINE|ENUM|ERRLVL|ERRORS|ESCAPE(?:D BY)?|EXCEPT|EXEC(?:UTE)?|EXISTS|EXIT|EXPLAIN|EXTENDED|FETCH|FIELDS|FILE|FILLFACTOR|FIRST|FIXED|FLOAT|FOLLOWING|FOR(?: EACH ROW)?|FORCE|FOREIGN|FREETEXT(?:TABLE)?|FROM|FULL|FUNCTION|GEOMETRY(?:COLLECTION)?|GLOBAL|GOTO|GRANT|GROUP|HANDLER|HASH|HAVING|HOLDLOCK|IDENTITY(?:_INSERT|COL)?|IF|IGNORE|IMPORT|INDEX|INFILE|INNER|INNODB|INOUT|INSERT|INT|INTEGER|INTERSECT|INTO|INVOKER|ISOLATION LEVEL|JOIN|KEYS?|KILL|LANGUAGE SQL|LAST|LEFT|LIMIT|LINENO|LINES|LINESTRING|LOAD|LOCAL|LOCK|LONG(?:BLOB|TEXT)|MATCH(?:ED)?|MEDIUM(?:BLOB|INT|TEXT)|MERGE|MIDDLEINT|MODIFIES SQL DATA|MODIFY|MULTI(?:LINESTRING|POINT|POLYGON)|NATIONAL(?: CHAR VARYING| CHARACTER(?: VARYING)?| VARCHAR)?|NATURAL|NCHAR(?: VARCHAR)?|NEXT|NO(?: SQL|CHECK|CYCLE)?|NONCLUSTERED|NULLIF|NUMERIC|OFF?|OFFSETS?|ON|OPEN(?:DATASOURCE|QUERY|ROWSET)?|OPTIMIZE|OPTION(?:ALLY)?|ORDER|OUT(?:ER|FILE)?|OVER|PARTIAL|PARTITION|PERCENT|PIVOT|PLAN|POINT|POLYGON|PRECEDING|PRECISION|PREV|PRIMARY|PRINT|PRIVILEGES|PROC(?:EDURE)?|PUBLIC|PURGE|QUICK|RAISERROR|READ(?:S SQL DATA|TEXT)?|REAL|RECONFIGURE|REFERENCES|RELEASE|RENAME|REPEATABLE|REPLICATION|REQUIRE|RESTORE|RESTRICT|RETURNS?|REVOKE|RIGHT|ROLLBACK|ROUTINE|ROW(?:COUNT|GUIDCOL|S)?|RTREE|RULE|SAVE(?:POINT)?|SCHEMA|SELECT|SERIAL(?:IZABLE)?|SESSION(?:_USER)?|SET(?:USER)?|SHARE MODE|SHOW|SHUTDOWN|SIMPLE|SMALLINT|SNAPSHOT|SOME|SONAME|START(?:ING BY)?|STATISTICS|STATUS|STRIPED|SYSTEM_USER|TABLES?|TABLESPACE|TEMP(?:ORARY|TABLE)?|TERMINATED BY|TEXT(?:SIZE)?|THEN|TIMESTAMP|TINY(?:BLOB|INT|TEXT)|TOP?|TRAN(?:SACTIONS?)?|TRIGGER|TRUNCATE|TSEQUAL|TYPES?|UNBOUNDED|UNCOMMITTED|UNDEFINED|UNION|UNIQUE|UNPIVOT|UPDATE(?:TEXT)?|USAGE|USE|USER|USING|VALUES?|VAR(?:BINARY|CHAR|CHARACTER|YING)|VIEW|WAITFOR|WARNINGS|WHEN|WHERE|WHILE|WITH(?: ROLLUP|IN)?|WORK|WRITE(?:TEXT)?)\b/i,"boolean":/\b(?:TRUE|FALSE|NULL)\b/i,number:/\b-?(?:0x)?\d*\.?[\da-f]+\b/,operator:/[-+*\/=%^~]|&&?|\|?\||!=?|<(?:=>?|<|>)?|>[>=]?|\b(?:AND|BETWEEN|IN|LIKE|NOT|OR|IS|DIV|REGEXP|RLIKE|SOUNDS LIKE|XOR)\b/i,punctuation:/[;[\]()`,.]/},Prism.languages.swift=Prism.languages.extend("clike",{string:{pattern:/("|')(\\(?:\((?:[^()]|\([^)]+\))+\)|\r\n|[\s\S])|(?!\1)[^\\\r\n])*\1/,greedy:!0,inside:{interpolation:{pattern:/\\\((?:[^()]|\([^)]+\))+\)/,inside:{delimiter:{pattern:/^\\\(|\)$/,alias:"variable"}}}}},keyword:/\b(as|associativity|break|case|catch|class|continue|convenience|default|defer|deinit|didSet|do|dynamic(?:Type)?|else|enum|extension|fallthrough|final|for|func|get|guard|if|import|in|infix|init|inout|internal|is|lazy|left|let|mutating|new|none|nonmutating|operator|optional|override|postfix|precedence|prefix|private|Protocol|public|repeat|required|rethrows|return|right|safe|self|Self|set|static|struct|subscript|super|switch|throws?|try|Type|typealias|unowned|unsafe|var|weak|where|while|willSet|__(?:COLUMN__|FILE__|FUNCTION__|LINE__))\b/,number:/\b([\d_]+(\.[\de_]+)?|0x[a-f0-9_]+(\.[a-f0-9p_]+)?|0b[01_]+|0o[0-7_]+)\b/i,constant:/\b(nil|[A-Z_]{2,}|k[A-Z][A-Za-z_]+)\b/,atrule:/@\b(IB(?:Outlet|Designable|Action|Inspectable)|class_protocol|exported|noreturn|NS(?:Copying|Managed)|objc|UIApplicationMain|auto_closure)\b/,builtin:/\b([A-Z]\S+|abs|advance|alignof(?:Value)?|assert|contains|count(?:Elements)?|debugPrint(?:ln)?|distance|drop(?:First|Last)|dump|enumerate|equal|filter|find|first|getVaList|indices|isEmpty|join|last|lexicographicalCompare|map|max(?:Element)?|min(?:Element)?|numericCast|overlaps|partition|print(?:ln)?|reduce|reflect|reverse|sizeof(?:Value)?|sort(?:ed)?|split|startsWith|stride(?:of(?:Value)?)?|suffix|swap|toDebugString|toString|transcode|underestimateCount|unsafeBitCast|with(?:ExtendedLifetime|Unsafe(?:MutablePointers?|Pointers?)|VaList))\b/}),Prism.languages.swift.string.inside.interpolation.inside.rest=Prism.util.clone(Prism.languages.swift),Prism.languages.typescript=Prism.languages.extend("javascript",{keyword:/\b(as|async|await|break|case|catch|class|const|continue|debugger|default|delete|do|else|enum|export|extends|finally|for|from|function|get|if|implements|import|in|instanceof|interface|let|new|null|of|package|private|protected|public|return|set|static|super|switch|this|throw|try|typeof|var|void|while|with|yield|false|true|module|declare|constructor|string|Function|any|number|boolean|Array|enum|symbol|namespace|abstract|require|type)\b/}),Prism.languages.ts=Prism.languages.typescript,Prism.languages.vim={string:/"(?:[^"\\\r\n]|\\.)*"|'(?:[^'\r\n]|'')*'/,comment:/".*/,"function":/\w+(?=\()/,keyword:/\b(?:ab|abbreviate|abc|abclear|abo|aboveleft|al|all|arga|argadd|argd|argdelete|argdo|arge|argedit|argg|argglobal|argl|arglocal|ar|args|argu|argument|as|ascii|bad|badd|ba|ball|bd|bdelete|be|bel|belowright|bf|bfirst|bl|blast|bm|bmodified|bn|bnext|bN|bNext|bo|botright|bp|bprevious|brea|break|breaka|breakadd|breakd|breakdel|breakl|breaklist|br|brewind|bro|browse|bufdo|b|buffer|buffers|bun|bunload|bw|bwipeout|ca|cabbrev|cabc|cabclear|caddb|caddbuffer|cad|caddexpr|caddf|caddfile|cal|call|cat|catch|cb|cbuffer|cc|ccl|cclose|cd|ce|center|cex|cexpr|cf|cfile|cfir|cfirst|cgetb|cgetbuffer|cgete|cgetexpr|cg|cgetfile|c|change|changes|chd|chdir|che|checkpath|checkt|checktime|cla|clast|cl|clist|clo|close|cmapc|cmapclear|cnew|cnewer|cn|cnext|cN|cNext|cnf|cnfile|cNfcNfile|cnorea|cnoreabbrev|col|colder|colo|colorscheme|comc|comclear|comp|compiler|conf|confirm|con|continue|cope|copen|co|copy|cpf|cpfile|cp|cprevious|cq|cquit|cr|crewind|cuna|cunabbrev|cu|cunmap|cw|cwindow|debugg|debuggreedy|delc|delcommand|d|delete|delf|delfunction|delm|delmarks|diffg|diffget|diffoff|diffpatch|diffpu|diffput|diffsplit|diffthis|diffu|diffupdate|dig|digraphs|di|display|dj|djump|dl|dlist|dr|drop|ds|dsearch|dsp|dsplit|earlier|echoe|echoerr|echom|echomsg|echon|e|edit|el|else|elsei|elseif|em|emenu|endfo|endfor|endf|endfunction|endfun|en|endif|endt|endtry|endw|endwhile|ene|enew|ex|exi|exit|exu|exusage|f|file|files|filetype|fina|finally|fin|find|fini|finish|fir|first|fix|fixdel|fo|fold|foldc|foldclose|folddoc|folddoclosed|foldd|folddoopen|foldo|foldopen|for|fu|fun|function|go|goto|gr|grep|grepa|grepadd|ha|hardcopy|h|help|helpf|helpfind|helpg|helpgrep|helpt|helptags|hid|hide|his|history|ia|iabbrev|iabc|iabclear|if|ij|ijump|il|ilist|imapc|imapclear|in|inorea|inoreabbrev|isearch|isp|isplit|iuna|iunabbrev|iu|iunmap|j|join|ju|jumps|k|keepalt|keepj|keepjumps|kee|keepmarks|laddb|laddbuffer|lad|laddexpr|laddf|laddfile|lan|language|la|last|later|lb|lbuffer|lc|lcd|lch|lchdir|lcl|lclose|let|left|lefta|leftabove|lex|lexpr|lf|lfile|lfir|lfirst|lgetb|lgetbuffer|lgete|lgetexpr|lg|lgetfile|lgr|lgrep|lgrepa|lgrepadd|lh|lhelpgrep|l|list|ll|lla|llast|lli|llist|lmak|lmake|lm|lmap|lmapc|lmapclear|lnew|lnewer|lne|lnext|lN|lNext|lnf|lnfile|lNf|lNfile|ln|lnoremap|lo|loadview|loc|lockmarks|lockv|lockvar|lol|lolder|lop|lopen|lpf|lpfile|lp|lprevious|lr|lrewind|ls|lt|ltag|lu|lunmap|lv|lvimgrep|lvimgrepa|lvimgrepadd|lw|lwindow|mak|make|ma|mark|marks|mat|match|menut|menutranslate|mk|mkexrc|mks|mksession|mksp|mkspell|mkvie|mkview|mkv|mkvimrc|mod|mode|m|move|mzf|mzfile|mz|mzscheme|nbkey|new|n|next|N|Next|nmapc|nmapclear|noh|nohlsearch|norea|noreabbrev|nu|number|nun|nunmap|omapc|omapclear|on|only|o|open|opt|options|ou|ounmap|pc|pclose|ped|pedit|pe|perl|perld|perldo|po|pop|popu|popu|popup|pp|ppop|pre|preserve|prev|previous|p|print|P|Print|profd|profdel|prof|profile|promptf|promptfind|promptr|promptrepl|ps|psearch|pta|ptag|ptf|ptfirst|ptj|ptjump|ptl|ptlast|ptn|ptnext|ptN|ptNext|ptp|ptprevious|ptr|ptrewind|pts|ptselect|pu|put|pw|pwd|pyf|pyfile|py|python|qa|qall|q|quit|quita|quitall|r|read|rec|recover|redi|redir|red|redo|redr|redraw|redraws|redrawstatus|reg|registers|res|resize|ret|retab|retu|return|rew|rewind|ri|right|rightb|rightbelow|rub|ruby|rubyd|rubydo|rubyf|rubyfile|ru|runtime|rv|rviminfo|sal|sall|san|sandbox|sa|sargument|sav|saveas|sba|sball|sbf|sbfirst|sbl|sblast|sbm|sbmodified|sbn|sbnext|sbN|sbNext|sbp|sbprevious|sbr|sbrewind|sb|sbuffer|scripte|scriptencoding|scrip|scriptnames|se|set|setf|setfiletype|setg|setglobal|setl|setlocal|sf|sfind|sfir|sfirst|sh|shell|sign|sil|silent|sim|simalt|sla|slast|sl|sleep|sm|smagic|sm|smap|smapc|smapclear|sme|smenu|sn|snext|sN|sNext|sni|sniff|sno|snomagic|snor|snoremap|snoreme|snoremenu|sor|sort|so|source|spelld|spelldump|spe|spellgood|spelli|spellinfo|spellr|spellrepall|spellu|spellundo|spellw|spellwrong|sp|split|spr|sprevious|sre|srewind|sta|stag|startg|startgreplace|star|startinsert|startr|startreplace|stj|stjump|st|stop|stopi|stopinsert|sts|stselect|sun|sunhide|sunm|sunmap|sus|suspend|sv|sview|syncbind|t|tab|tabc|tabclose|tabd|tabdo|tabe|tabedit|tabf|tabfind|tabfir|tabfirst|tabl|tablast|tabm|tabmove|tabnew|tabn|tabnext|tabN|tabNext|tabo|tabonly|tabp|tabprevious|tabr|tabrewind|tabs|ta|tag|tags|tc|tcl|tcld|tcldo|tclf|tclfile|te|tearoff|tf|tfirst|th|throw|tj|tjump|tl|tlast|tm|tm|tmenu|tn|tnext|tN|tNext|to|topleft|tp|tprevious|tr|trewind|try|ts|tselect|tu|tu|tunmenu|una|unabbreviate|u|undo|undoj|undojoin|undol|undolist|unh|unhide|unlet|unlo|unlockvar|unm|unmap|up|update|verb|verbose|ve|version|vert|vertical|vie|view|vim|vimgrep|vimgrepa|vimgrepadd|vi|visual|viu|viusage|vmapc|vmapclear|vne|vnew|vs|vsplit|vu|vunmap|wa|wall|wh|while|winc|wincmd|windo|winp|winpos|win|winsize|wn|wnext|wN|wNext|wp|wprevious|wq|wqa|wqall|w|write|ws|wsverb|wv|wviminfo|X|xa|xall|x|xit|xm|xmap|xmapc|xmapclear|xme|xmenu|XMLent|XMLns|xn|xnoremap|xnoreme|xnoremenu|xu|xunmap|y|yank)\b/,
builtin:/\b(?:autocmd|acd|ai|akm|aleph|allowrevins|altkeymap|ambiwidth|ambw|anti|antialias|arab|arabic|arabicshape|ari|arshape|autochdir|autoindent|autoread|autowrite|autowriteall|aw|awa|background|backspace|backup|backupcopy|backupdir|backupext|backupskip|balloondelay|ballooneval|balloonexpr|bdir|bdlay|beval|bex|bexpr|bg|bh|bin|binary|biosk|bioskey|bk|bkc|bomb|breakat|brk|browsedir|bs|bsdir|bsk|bt|bufhidden|buflisted|buftype|casemap|ccv|cdpath|cedit|cfu|ch|charconvert|ci|cin|cindent|cink|cinkeys|cino|cinoptions|cinw|cinwords|clipboard|cmdheight|cmdwinheight|cmp|cms|columns|com|comments|commentstring|compatible|complete|completefunc|completeopt|consk|conskey|copyindent|cot|cpo|cpoptions|cpt|cscopepathcomp|cscopeprg|cscopequickfix|cscopetag|cscopetagorder|cscopeverbose|cspc|csprg|csqf|cst|csto|csverb|cuc|cul|cursorcolumn|cursorline|cwh|debug|deco|def|define|delcombine|dex|dg|dict|dictionary|diff|diffexpr|diffopt|digraph|dip|dir|directory|dy|ea|ead|eadirection|eb|ed|edcompatible|ef|efm|ei|ek|enc|encoding|endofline|eol|ep|equalalways|equalprg|errorbells|errorfile|errorformat|esckeys|et|eventignore|expandtab|exrc|fcl|fcs|fdc|fde|fdi|fdl|fdls|fdm|fdn|fdo|fdt|fen|fenc|fencs|fex|ff|ffs|fileencoding|fileencodings|fileformat|fileformats|fillchars|fk|fkmap|flp|fml|fmr|foldcolumn|foldenable|foldexpr|foldignore|foldlevel|foldlevelstart|foldmarker|foldmethod|foldminlines|foldnestmax|foldtext|formatexpr|formatlistpat|formatoptions|formatprg|fp|fs|fsync|ft|gcr|gd|gdefault|gfm|gfn|gfs|gfw|ghr|gp|grepformat|grepprg|gtl|gtt|guicursor|guifont|guifontset|guifontwide|guiheadroom|guioptions|guipty|guitablabel|guitabtooltip|helpfile|helpheight|helplang|hf|hh|hi|hidden|highlight|hk|hkmap|hkmapp|hkp|hl|hlg|hls|hlsearch|ic|icon|iconstring|ignorecase|im|imactivatekey|imak|imc|imcmdline|imd|imdisable|imi|iminsert|ims|imsearch|inc|include|includeexpr|incsearch|inde|indentexpr|indentkeys|indk|inex|inf|infercase|insertmode|isf|isfname|isi|isident|isk|iskeyword|isprint|joinspaces|js|key|keymap|keymodel|keywordprg|km|kmp|kp|langmap|langmenu|laststatus|lazyredraw|lbr|lcs|linebreak|lines|linespace|lisp|lispwords|listchars|loadplugins|lpl|lsp|lz|macatsui|magic|makeef|makeprg|matchpairs|matchtime|maxcombine|maxfuncdepth|maxmapdepth|maxmem|maxmempattern|maxmemtot|mco|mef|menuitems|mfd|mh|mis|mkspellmem|ml|mls|mm|mmd|mmp|mmt|modeline|modelines|modifiable|modified|more|mouse|mousef|mousefocus|mousehide|mousem|mousemodel|mouses|mouseshape|mouset|mousetime|mp|mps|msm|mzq|mzquantum|nf|nrformats|numberwidth|nuw|odev|oft|ofu|omnifunc|opendevice|operatorfunc|opfunc|osfiletype|pa|para|paragraphs|paste|pastetoggle|patchexpr|patchmode|path|pdev|penc|pex|pexpr|pfn|ph|pheader|pi|pm|pmbcs|pmbfn|popt|preserveindent|previewheight|previewwindow|printdevice|printencoding|printexpr|printfont|printheader|printmbcharset|printmbfont|printoptions|prompt|pt|pumheight|pvh|pvw|qe|quoteescape|readonly|remap|report|restorescreen|revins|rightleft|rightleftcmd|rl|rlc|ro|rs|rtp|ruf|ruler|rulerformat|runtimepath|sbo|sc|scb|scr|scroll|scrollbind|scrolljump|scrolloff|scrollopt|scs|sect|sections|secure|sel|selection|selectmode|sessionoptions|sft|shcf|shellcmdflag|shellpipe|shellquote|shellredir|shellslash|shelltemp|shelltype|shellxquote|shiftround|shiftwidth|shm|shortmess|shortname|showbreak|showcmd|showfulltag|showmatch|showmode|showtabline|shq|si|sidescroll|sidescrolloff|siso|sj|slm|smartcase|smartindent|smarttab|smc|smd|softtabstop|sol|spc|spell|spellcapcheck|spellfile|spelllang|spellsuggest|spf|spl|splitbelow|splitright|sps|sr|srr|ss|ssl|ssop|stal|startofline|statusline|stl|stmp|su|sua|suffixes|suffixesadd|sw|swapfile|swapsync|swb|swf|switchbuf|sws|sxq|syn|synmaxcol|syntax|tabline|tabpagemax|tabstop|tagbsearch|taglength|tagrelative|tagstack|tal|tb|tbi|tbidi|tbis|tbs|tenc|term|termbidi|termencoding|terse|textauto|textmode|textwidth|tgst|thesaurus|tildeop|timeout|timeoutlen|title|titlelen|titleold|titlestring|toolbar|toolbariconsize|top|tpm|tsl|tsr|ttimeout|ttimeoutlen|ttm|tty|ttybuiltin|ttyfast|ttym|ttymouse|ttyscroll|ttytype|tw|tx|uc|ul|undolevels|updatecount|updatetime|ut|vb|vbs|vdir|verbosefile|vfile|viewdir|viewoptions|viminfo|virtualedit|visualbell|vop|wak|warn|wb|wc|wcm|wd|weirdinvert|wfh|wfw|whichwrap|wi|wig|wildchar|wildcharm|wildignore|wildmenu|wildmode|wildoptions|wim|winaltkeys|window|winfixheight|winfixwidth|winheight|winminheight|winminwidth|winwidth|wiv|wiw|wm|wmh|wmnu|wmw|wop|wrap|wrapmargin|wrapscan|writeany|writebackup|writedelay|ww|noacd|noai|noakm|noallowrevins|noaltkeymap|noanti|noantialias|noar|noarab|noarabic|noarabicshape|noari|noarshape|noautochdir|noautoindent|noautoread|noautowrite|noautowriteall|noaw|noawa|nobackup|noballooneval|nobeval|nobin|nobinary|nobiosk|nobioskey|nobk|nobl|nobomb|nobuflisted|nocf|noci|nocin|nocindent|nocompatible|noconfirm|noconsk|noconskey|nocopyindent|nocp|nocscopetag|nocscopeverbose|nocst|nocsverb|nocuc|nocul|nocursorcolumn|nocursorline|nodeco|nodelcombine|nodg|nodiff|nodigraph|nodisable|noea|noeb|noed|noedcompatible|noek|noendofline|noeol|noequalalways|noerrorbells|noesckeys|noet|noex|noexpandtab|noexrc|nofen|nofk|nofkmap|nofoldenable|nogd|nogdefault|noguipty|nohid|nohidden|nohk|nohkmap|nohkmapp|nohkp|nohls|noic|noicon|noignorecase|noim|noimc|noimcmdline|noimd|noincsearch|noinf|noinfercase|noinsertmode|nois|nojoinspaces|nojs|nolazyredraw|nolbr|nolinebreak|nolisp|nolist|noloadplugins|nolpl|nolz|noma|nomacatsui|nomagic|nomh|noml|nomod|nomodeline|nomodifiable|nomodified|nomore|nomousef|nomousefocus|nomousehide|nonu|nonumber|noodev|noopendevice|nopaste|nopi|nopreserveindent|nopreviewwindow|noprompt|nopvw|noreadonly|noremap|norestorescreen|norevins|nori|norightleft|norightleftcmd|norl|norlc|noro|nors|noru|noruler|nosb|nosc|noscb|noscrollbind|noscs|nosecure|nosft|noshellslash|noshelltemp|noshiftround|noshortname|noshowcmd|noshowfulltag|noshowmatch|noshowmode|nosi|nosm|nosmartcase|nosmartindent|nosmarttab|nosmd|nosn|nosol|nospell|nosplitbelow|nosplitright|nospr|nosr|nossl|nosta|nostartofline|nostmp|noswapfile|noswf|nota|notagbsearch|notagrelative|notagstack|notbi|notbidi|notbs|notermbidi|noterse|notextauto|notextmode|notf|notgst|notildeop|notimeout|notitle|noto|notop|notr|nottimeout|nottybuiltin|nottyfast|notx|novb|novisualbell|nowa|nowarn|nowb|noweirdinvert|nowfh|nowfw|nowildmenu|nowinfixheight|nowinfixwidth|nowiv|nowmnu|nowrap|nowrapscan|nowrite|nowriteany|nowritebackup|nows|invacd|invai|invakm|invallowrevins|invaltkeymap|invanti|invantialias|invar|invarab|invarabic|invarabicshape|invari|invarshape|invautochdir|invautoindent|invautoread|invautowrite|invautowriteall|invaw|invawa|invbackup|invballooneval|invbeval|invbin|invbinary|invbiosk|invbioskey|invbk|invbl|invbomb|invbuflisted|invcf|invci|invcin|invcindent|invcompatible|invconfirm|invconsk|invconskey|invcopyindent|invcp|invcscopetag|invcscopeverbose|invcst|invcsverb|invcuc|invcul|invcursorcolumn|invcursorline|invdeco|invdelcombine|invdg|invdiff|invdigraph|invdisable|invea|inveb|inved|invedcompatible|invek|invendofline|inveol|invequalalways|inverrorbells|invesckeys|invet|invex|invexpandtab|invexrc|invfen|invfk|invfkmap|invfoldenable|invgd|invgdefault|invguipty|invhid|invhidden|invhk|invhkmap|invhkmapp|invhkp|invhls|invhlsearch|invic|invicon|invignorecase|invim|invimc|invimcmdline|invimd|invincsearch|invinf|invinfercase|invinsertmode|invis|invjoinspaces|invjs|invlazyredraw|invlbr|invlinebreak|invlisp|invlist|invloadplugins|invlpl|invlz|invma|invmacatsui|invmagic|invmh|invml|invmod|invmodeline|invmodifiable|invmodified|invmore|invmousef|invmousefocus|invmousehide|invnu|invnumber|invodev|invopendevice|invpaste|invpi|invpreserveindent|invpreviewwindow|invprompt|invpvw|invreadonly|invremap|invrestorescreen|invrevins|invri|invrightleft|invrightleftcmd|invrl|invrlc|invro|invrs|invru|invruler|invsb|invsc|invscb|invscrollbind|invscs|invsecure|invsft|invshellslash|invshelltemp|invshiftround|invshortname|invshowcmd|invshowfulltag|invshowmatch|invshowmode|invsi|invsm|invsmartcase|invsmartindent|invsmarttab|invsmd|invsn|invsol|invspell|invsplitbelow|invsplitright|invspr|invsr|invssl|invsta|invstartofline|invstmp|invswapfile|invswf|invta|invtagbsearch|invtagrelative|invtagstack|invtbi|invtbidi|invtbs|invtermbidi|invterse|invtextauto|invtextmode|invtf|invtgst|invtildeop|invtimeout|invtitle|invto|invtop|invtr|invttimeout|invttybuiltin|invttyfast|invtx|invvb|invvisualbell|invwa|invwarn|invwb|invweirdinvert|invwfh|invwfw|invwildmenu|invwinfixheight|invwinfixwidth|invwiv|invwmnu|invwrap|invwrapscan|invwrite|invwriteany|invwritebackup|invws|t_AB|t_AF|t_al|t_AL|t_bc|t_cd|t_ce|t_Ce|t_cl|t_cm|t_Co|t_cs|t_Cs|t_CS|t_CV|t_da|t_db|t_dl|t_DL|t_EI|t_F1|t_F2|t_F3|t_F4|t_F5|t_F6|t_F7|t_F8|t_F9|t_fs|t_IE|t_IS|t_k1|t_K1|t_k2|t_k3|t_K3|t_k4|t_K4|t_k5|t_K5|t_k6|t_K6|t_k7|t_K7|t_k8|t_K8|t_k9|t_K9|t_KA|t_kb|t_kB|t_KB|t_KC|t_kd|t_kD|t_KD|t_ke|t_KE|t_KF|t_KG|t_kh|t_KH|t_kI|t_KI|t_KJ|t_KK|t_kl|t_KL|t_kN|t_kP|t_kr|t_ks|t_ku|t_le|t_mb|t_md|t_me|t_mr|t_ms|t_nd|t_op|t_RI|t_RV|t_Sb|t_se|t_Sf|t_SI|t_so|t_sr|t_te|t_ti|t_ts|t_ue|t_us|t_ut|t_vb|t_ve|t_vi|t_vs|t_WP|t_WS|t_xs|t_ZH|t_ZR)\b/,number:/\b(?:0x[\da-f]+|\d+(?:\.\d+)?)\b/i,operator:/\|\||&&|[-+.]=?|[=!](?:[=~][#?]?)?|[<>]=?[#?]?|[*\/%?]|\b(?:is(?:not)?)\b/,punctuation:/[{}[\](),;:]/},Prism.languages.yaml={scalar:{pattern:/([\-:]\s*(![^\s]+)?[ \t]*[|>])[ \t]*(?:((?:\r?\n|\r)[ \t]+)[^\r\n]+(?:\3[^\r\n]+)*)/,lookbehind:!0,alias:"string"},comment:/#.*/,key:{pattern:/(\s*(?:^|[:\-,[{\r\n?])[ \t]*(![^\s]+)?[ \t]*)[^\r\n{[\]},#\s]+?(?=\s*:\s)/,lookbehind:!0,alias:"atrule"},directive:{pattern:/(^[ \t]*)%.+/m,lookbehind:!0,alias:"important"},datetime:{pattern:/([:\-,[{]\s*(![^\s]+)?[ \t]*)(\d{4}-\d\d?-\d\d?([tT]|[ \t]+)\d\d?:\d{2}:\d{2}(\.\d*)?[ \t]*(Z|[-+]\d\d?(:\d{2})?)?|\d{4}-\d{2}-\d{2}|\d\d?:\d{2}(:\d{2}(\.\d*)?)?)(?=[ \t]*($|,|]|}))/m,lookbehind:!0,alias:"number"},"boolean":{pattern:/([:\-,[{]\s*(![^\s]+)?[ \t]*)(true|false)[ \t]*(?=$|,|]|})/im,lookbehind:!0,alias:"important"},"null":{pattern:/([:\-,[{]\s*(![^\s]+)?[ \t]*)(null|~)[ \t]*(?=$|,|]|})/im,lookbehind:!0,alias:"important"},string:{pattern:/([:\-,[{]\s*(![^\s]+)?[ \t]*)("(?:[^"\\]|\\.)*"|'(?:[^'\\]|\\.)*')(?=[ \t]*($|,|]|}))/m,lookbehind:!0},number:{pattern:/([:\-,[{]\s*(![^\s]+)?[ \t]*)[+\-]?(0x[\da-f]+|0o[0-7]+|(\d+\.?\d*|\.?\d+)(e[\+\-]?\d+)?|\.inf|\.nan)[ \t]*(?=$|,|]|})/im,lookbehind:!0},tag:/![^\s]+/,important:/[&*][\w]+/,punctuation:/---|[:[\]{}\-,|>?]|\.\.\./},"undefined"!=typeof self&&self.Prism&&self.document&&Prism.hooks.add("complete",function(e){if(e.code){var t=e.element.parentNode,i=/\s*\bline-numbers\b\s*/;if(t&&/pre/i.test(t.nodeName)&&(i.test(t.className)||i.test(e.element.className))&&!e.element.querySelector(".line-numbers-rows")){i.test(e.element.className)&&(e.element.className=e.element.className.replace(i,"")),i.test(t.className)||(t.className+=" line-numbers");var n,r=e.code.match(/\n(?!$)/g),o=r?r.length+1:1,s=new Array(o+1);s=s.join("<span></span>"),(n=document.createElement("span")).setAttribute("aria-hidden","true"),n.className="line-numbers-rows",n.innerHTML=s,t.hasAttribute("data-start")&&(t.style.counterReset="linenumber "+(parseInt(t.getAttribute("data-start"),10)-1)),e.element.appendChild(n)}}}),function(){if("undefined"!=typeof self&&self.Prism&&self.document){var e=[],t={},i=function(){};Prism.plugins.toolbar={};var n=Prism.plugins.toolbar.registerButton=function(i,n){var r;r="function"==typeof n?n:function(e){var t;return"function"==typeof n.onClick?((t=document.createElement("button")).type="button",t.addEventListener("click",function(){n.onClick.call(this,e)})):"string"==typeof n.url?(t=document.createElement("a")).href=n.url:t=document.createElement("span"),t.textContent=n.text,t},e.push(t[i]=r)},r=Prism.plugins.toolbar.hook=function(n){var r=n.element.parentNode;if(r&&/pre/i.test(r.nodeName)&&!r.classList.contains("code-toolbar")){r.classList.add("code-toolbar");var o=document.createElement("div");o.classList.add("toolbar"),document.body.hasAttribute("data-toolbar-order")&&(e=document.body.getAttribute("data-toolbar-order").split(",").map(function(e){return t[e]||i})),e.forEach(function(e){var t=e(n);if(t){var i=document.createElement("div");i.classList.add("toolbar-item"),i.appendChild(t),o.appendChild(i)}}),r.appendChild(o)}};n("label",function(e){var t=e.element.parentNode;if(t&&/pre/i.test(t.nodeName)&&t.hasAttribute("data-label")){var i,n,r=t.getAttribute("data-label");try{n=document.querySelector("template#"+r)}catch(o){}return n?i=n.content:(t.hasAttribute("data-url")?(i=document.createElement("a")).href=t.getAttribute("data-url"):i=document.createElement("span"),i.textContent=r),i}}),Prism.hooks.add("complete",r)}}(),"undefined"!=typeof self&&self.Prism&&self.document&&Prism.hooks.add("before-sanity-check",function(e){if(e.code){var t=e.element.parentNode,i=/\s*\bkeep-initial-line-feed\b\s*/;!t||"pre"!==t.nodeName.toLowerCase()||i.test(t.className)||i.test(e.element.className)||(e.code=e.code.replace(/^(?:\r?\n|\r)/,""))}}),"undefined"!=typeof self&&self.Prism&&self.document&&Prism.hooks.add("complete",function(e){if(e.code){var t=e.element.parentNode,i=/\s*\bcommand-line\b\s*/;if(t&&/pre/i.test(t.nodeName)&&(i.test(t.className)||i.test(e.element.className))&&!e.element.querySelector(".command-line-prompt")){i.test(e.element.className)&&(e.element.className=e.element.className.replace(i,"")),i.test(t.className)||(t.className+=" command-line");var n=function(e,i){return(t.getAttribute(e)||i).replace(/"/g,"&quot")},r=new Array(1+e.code.split("\n").length),o=n("data-prompt","");if(""!==o)r=r.join('<span data-prompt="'+o+'"></span>');else{var s=n("data-user","user"),a=n("data-host","localhost");r=r.join('<span data-user="'+s+'" data-host="'+a+'"></span>')}var l=document.createElement("span");l.className="command-line-prompt",l.innerHTML=r;var c=t.getAttribute("data-output")||"";c=c.split(",");for(var d=0;d<c.length;d++){var u=c[d].split("-"),h=parseInt(u[0]),p=h;if(2===u.length&&(p=parseInt(u[1])),!isNaN(h)&&!isNaN(p))for(var f=h;f<=p&&f<=l.children.length;f++){var m=l.children[f-1];m.removeAttribute("data-user"),m.removeAttribute("data-host"),m.removeAttribute("data-prompt")}}e.element.innerHTML=l.outerHTML+e.element.innerHTML}}});var is_rainbow=!1,search_module=sessionStorage.getItem("search");$(window).load(function(){setTimeout(function(){changePrism_to_Rainbow()},500)}),$(document).ready(function(){$("body").on("changed.bs.select",".lesson_assignment_select",function(e,t){var i=$(this);t==i[0].length-1?(i.selectpicker("val",null),i.selectpicker("val",0)):null!=i.val()&&i.selectpicker("val",_.without(i.val(),"0")),show_elaborate_textarea(i)}).on("hide.bs.select",".lesson_assignment_select",function(){save_survey_answer($(this))}).on("change",".rating_radio",function(){var e=$(this);e[0].checked&&(e.closest("#survey_effectivity_rating_container").find(".not_sure_checkbox").removeAttr("checked","checked"),save_survey_answer(e),show_elaborate_textarea(e))}).on("change",".not_sure_checkbox",function(){var e=$(this);e[0].checked&&(e.closest("#survey_effectivity_rating_container").find(".rating_radio").removeAttr("checked","checked"),save_survey_answer(e),show_elaborate_textarea(e))}).on("change",".smiley_face_radio",function(){save_survey_answer($(this)),show_elaborate_textarea($(this))}).on("focusout",".survey_textarea",function(){""!=$(this).val().replace(/\s/g,"")&&save_survey_answer($(this))}).on("click",".copy_url",function(e){var t=$(this),i=$("<textarea>"),n=$(e.target).siblings(".upload_url").attr("href"),r=!1;$("body").append(i),i.val(n).select(),r=document.execCommand("copy"),t.text("Link Copied!"),i.remove(),1==r&&setTimeout(function(){t.text("Copy Link")},1e3),e.preventDefault()}),$(document).on("change","input, select, textarea",triggerFormChange),$(".module-list-item").on("click",selectModuleByListItem),$("body").on("click",".save-module-button",handleEditModuleSubmit),$("body").on("click","#add-task",handleAddAssignmentTask),$("section.module-info").on("click","#add-task",handleAddAssignmentTask),$("span.chapter-delete").on("click",function(e){e.preventDefault(),$(".delete_chapter_modal").modal("show").find("input[name='chapter_id']").val($(this).attr("data-chapter-id"))}),$("body").on("click",".confirm_delete_chapter",confirmDeleteChapter),$("body").on("click",'div.add-new-choice input[type="submit"]',addChoiceToQuestion),$("body").on("click",'div.add-new-question input[type="submit"]',addQuestionToQuiz),$("body").on("keydown",'input[name="new-question"]',function(e){13==(e.keyCode||e.which)&&($(this).siblings("input[type='submit']").trigger("click"),$(this).focus())}),$("body").on("click","a.remove-question",removeQuestionFromQuiz),$("body").on("click","a.remove-choice",removeChoiceFromQuestion),$("body").on("click","a.remove-assignment",removeAssignmentTask),$(".module_description").on("mouseenter","pre",show_copy_to_clipboard),$(".module_description").on("mouseleave","pre",remove_copy_to_clipboard),$("body").on("click","#copy-toolbar",copy_to_clipboard),$("body").on("keydown",'fieldset.quiz-info input[type="text"]',invokeCorrectSubmitButton),$("body").on("click","#answersheet",change_solution_to_rainbow),$("#sidebar .tab_list").sortable({items:"li:not(.dropdown-menu li)",handle:".sort_tab_icon",axis:"y",tolerance:"pointer",cursor:"move",stop:handleDrop}),$(".tab_list").disableSelection(),$("body").on("click",".module-delete",function(e){e.preventDefault(),$(".delete_module_modal").modal("show").find("input[name='module_id']").val($(this).attr("data-module-id"))}),$("body").on("click",".confirm_delete_module",confirmDeleteModule),$("body").on("click",".edit_chapter_name",function(){$(".chapter_module_modal").modal("show").find(".modal_header h4").text("Edit Chapter Name").closest(".modal-content").find(".btn-primary").addClass("save_edit_chapter_btn").siblings("input[type='text']").attr("id","edit-chapter-name").val($(this).closest("li.active").find(".chapter-title").text()),$(".chapter_module_modal input[name='chapter_id']").val($(this).closest(".actions").data("chapter-id"))}),$("body").on("click",".save_edit_chapter_btn",updateChapterName),$("body").on("change","#upload_file",function(){var e=$(this);if(""==!e.val()){e.siblings(".upload_name").text("Choose another file?"),e.siblings("#uploaded_file_list").html("");for(var t=0;t<e.get(0).files.length;t++)$(this).siblings("#uploaded_file_list").append("<li>"+$(this).get(0).files[t].name+"</li>")}}),$("body").on("submit","#new_upload",function(e){""==document.getElementById("upload_file").value?alert("Please select a file to upload."):uploadFile($(this)),e.preventDefault()}),$("body").on("click",".add-chapter",function(){$(".chapter_module_modal").modal("show").find(".modal_header h4").text("New Chapter").closest(".modal-content").find(".btn-primary").addClass("save_new_chapter_btn").siblings("input[type='text']").attr("id","new-chapter-title").val("")}),$(".chapter_module_modal").on("shown.bs.modal",function(){$(this).find("input[type='text']").focus()}),$("body").on("click",".save_new_chapter_btn",createNewChapter),$("body").on("click",".add-module",function(){$(".cancel-module-create").removeClass("hidden"),applyRedactorToTextarea()}),$("body").on("keydown","input[name='new-choice']",function(e){13==(e.keyCode||e.which)&&$(this).siblings("input[type='submit']").trigger("click")}),$.each($("#chapter_list li.text"),function(){}),setTimeout(function(){$.each($("#chapter_list li.text"),function(){var e=$(this),t=e.find("h4").text();e.find("h4").text().length>28&&(e.addClass("is_ellipsis"),e.prop("data-toggle","tooltip"),e.prop("placement","right auto"),e.prop("title",t),e.prop("container","body"),e.tooltip({}))})},1200)}),window.addEventListener("beforeunload",checkBeforeUnload);var hasFormChanged,tiggerFormChangeIfNotFirstSync=function(){var e=!0;return function(){if(!e)return triggerFormChange();e=!1}}();!function(e){e.Redactor.prototype.custom_plugins_save_undo_redo=function(){return{init:function(){var t=this.button.add("custom_save","Save Module Changes");e(t[0]).closest("li").addClass("pull-right save-module-button");var i=this.button.add("redo","Redo"),n=this.button.add("undo","Undo");e(i[0]).closest("li").addClass("pull-right"),e(n[0]).closest("li").addClass("pull-right"),this.button.addCallback(n,this.buffer.undo),this.button.addCallback(i,this.buffer.redo)}}}}(jQuery);var is_horizontal_view=document.cookie.includes("horizontal_view"),is_module_edit=window.location.href.includes("modules/edit");$(window).load(function(){setTimeout(function(){$("body")[0].scrollTop=0,initialize_module_redactor(),is_horizontal_view&&is_module_edit&&horizontal_tab_view()},1)}),$(document).on("ready",function(){is_horizontal_view&&is_module_edit&&$(".switch_horizontal_tab_view").removeClass("switch_horizontal_tab_view").addClass("switch_vertical_tab_view"),"true"==$("li .current").attr("data-first_module")&&$(".manage_module_modal").modal("show"),$("body").on("click","button.cancel-module-create",handleNewModuleCancel).on("click",".save_module_btn",handleSaveModule).on("click",".add_new_module",function(){show_module_form("new")}).on("hidden.bs.modal",function(){var e=$(".manage_module_modal");e.find(".color_red").removeClass("color_red"),e.find(".border_red").removeClass("border_red")}).on("click",".edit_module_container .module_title, .link_title_container .module_title",function(){$(this).siblings(".edit_module_title").trigger("click")}).on("click",".edit_module_title",showing_edit_module_title).on("blur",".module_title_input",update_module_title).on("click",".module_type_btn",function(){$(this).addClass("active").siblings().removeClass("active")}).on("click",".edit_module",show_module_form).on("submit",".modal_edit_module_form",saving_edited_module).on("click",".duplicate_module",duplicate_module).on("click",".language_rainbow_option_list .language_rainbow_option_item",manage_language_settings).on("click",".switch_horizontal_tab_view",horizontal_tab_view).on("click",".switch_vertical_tab_view",vertical_tab_view).on("click",".move_to_next_chapter",move_next_prev_chapter).on("click",".move_to_previous_chapter",move_next_prev_chapter).on("click",".select_copy_to",show_confirm_modal).on("click",".confirm_copy_to_btn",function(){process_module($(this),"copy")}).on("click",".select_move_to",show_confirm_modal).on("click",".confirm_move_to_btn",function(){process_module($(this),"move")}).on("click",".remove_chapter_upload",remove_chapter_upload).on("submit",".add_new_module_form",function(e){e.preventDefault(),saving_new_module($(this))}).on("submit","#new_solution",function(e){e.preventDefault(),create_solution($(this))}).on("click",".delete_solution_btn",function(e){e.preventDefault(),delete_solution($(this))}).on("change",".program_type_checkbox",function(){$(this).siblings(".checkbox_marker").removeClass("border_red").siblings(".checkbox_label").removeClass("color_red").closest(".checkbox-inline").siblings(".checkbox-inline").find(".checkbox_marker").removeClass("border_red").siblings(".checkbox_label").removeClass("color_red")}),$("body").on("click",".dropdown-submenu a.dropdown-submenu-btn",function(e){if(e.preventDefault(),e.stopPropagation(),$(this).closest(".dropdown-menu-right").find(".dropdown-menu").hide(),$(this).offset().top+160>$(window).height()){var t=$(window).height()-$(this).offset().top;$(this).next("ul").toggle().css("bottom",t-30)}else $(this).next("ul").toggle().css("top",$(this).offset().top)}),$(".dropdown").on("hidden.bs.dropdown",function(){$(this).find(".copy_to_sub_menu, .move_to_sub_menu").hide(),$("html, body").css({overflow:"auto",height:"auto"})}),$(".dropdown").on("show.bs.dropdown",function(){$("html, body").css({overflow:"hidden",height:"100%"});var e=$(this);$(this).offset().top+160>$(window).height()&&e.find(".dropdown-menu.dropdown-menu-right").css({top:"-133px"})}),$("#sidebar.edit_mode").on("update",function(){$(".dropdown").removeClass("open"),$(".dropdown .dropdown-menu-right").find(".dropdown-menu").hide()}),$('[data-toggle="tooltip"]').tooltip(),$("#description").on("mouseenter","pre",init_language_settings),$(document).on("mousemove","body",function(e){0==($(e.target).closest("pre").length||$(e.target).closest(".language_rainbow_dropup").length)&&$(".language_rainbow_dropup").addClass("hidden")}),$(".horizontal_chapter_view_container").on("show.bs.dropdown",".dropdown",function(){var e=$(this).closest("li");$(this).children(".dropdown-menu").css({width:e.outerWidth(),left:e.offset().left,top:e.offset().top+e.outerHeight()-$(window).scrollTop()})}).on("click",".scroll_right_module",navigate_module_ui_adjustment).on("click",".scroll_left_module",navigate_module_ui_adjustment),$(window).scroll(function(){var e=$(".horizontal_chapter_list_view");if(e.length&&e.find(".dropdown.open").length){var t=e.find(".dropdown.open").closest("li");e.find(".dropdown.open .dropdown-menu").css({top:t.offset().top+t.outerHeight()-$(this).scrollTop()})}}),$(window).resize(function(){var e=$(".horizontal_chapter_list_view");if(e.length&&e.find(".dropdown.open").length){var t=e.find(".dropdown.open").closest("li");e.find(".dropdown.open .dropdown-menu").css({left:t.offset().left-$(this).scrollLeft()})}}),$(".questions").sortable({containment:"parent",handle:".drag_icon",placeholder:"ui-state-highlight",tolerance:"pointer"}),$(".choices").sortable({handle:".drag_icon",placeholder:"ui-state-highlight",containment:"parent",tolerance:"pointer"}),$(".tasks").sortable({handle:".glyphicon-th",placeholder:"ui-state-highlight",handle:".drag_icon",containment:"parent"})}),function(e){e.Redactor.prototype.custom_save=function(){return{init:function(){var t=this.button.add("custom_save","Save Module Changes");e(t[0]).closest("li").addClass("pull-right save_module_btn");var i=this.button.add("redo","Redo"),n=this.button.add("undo","Undo"),r=this.$toolbar;e(i[0]).closest("li").addClass("pull-right"),e(n[0]).closest("li").addClass("pull-right"),this.button.addCallback(n,this.buffer.undo),this.button.addCallback(i,this.buffer.redo),setTimeout(function(){e(r).css("visibility","visible","important")},200)}}}}(jQuery)
;var module_tab_template=_.template('<li class="<%- module_type %> completed_tab current" data-program-type="[<%- program_type %>]" data-module-type="<%- module_type %>" data-module-id="24777">                                             <a class="tab_title unload_link" href="/modules/edit/24777">                                                 <div class="tab_label"><span class="tab_icon sort_tab_icon ui-sortable-handle"></span></div>                                                 <span class="tab_details" id="quiz_id_24777">                                                     <h4><%= module_title %></h4>                                                 </span>                                             </a>                                             <div class="dropdown">                                                 <span class="glyphicon glyphicon-menu-down dropdown-toggle" data-toggle="dropdown"></span>                                                 <ul class="dropdown-menu dropdown-menu-right" aria-labelledby="">                                                     <li>                                                         <a href="#" data-toggle="modal" data-target=".manage_module_modal" class="edit_module">                                                             <div class="actions">                                                                 <span data-module-id="24777">                                                                     Edit</span>                                                             </div>                                                         </a>                                                     </li>                                                     <li>                                                         <a href="#" class="">                                                             <div class="actions">                                                                 <span data-module-id="24777" class="duplicate_module">                                                                     Duplicate</span>                                                             </div>                                                         </a>                                                     </li>                                                     <li>                                                         <a href="#" class="">                                                             <div class="actions">                                                                 <span data-module-id="24777" class="module-delete">                                                                     Delete</span>                                                             </div>                                                         </a>                                                     </li>                                                 </ul>                                             </div>                                     </li>'),module_info_template=_.template('<section class="module-info" data-module-type="<%= module_type %>">                                         <form class="module-edit">                                                     <input type="hidden" name="module_id" value="<%= module_id %>">                                             <input type="hidden" name="module_type" value="<%= module_type %>">                                             <div id="description" name="description" class="description"><h1><%= module_title %></h1></div>                                         </form>                                     </section>'),quiz_template=_.template('<div class="quiz_container">                                     <div class="quiz-info">                                         <h2>Quiz Questions</h2>                                         <div class="quiz-questions">                                             <ol class="questions list-unstyled">                                             </ol>                                             <div class="add-new-question">                                                 <input                                                      type="text"                                                      name="new-question"                                                      placeholder="New question"><!--                                               --><input type="submit" class="btn-sm btn btn-primary" value="Add question">                                             </div>                                         </div>                                     </div>                                 </div>'),to_do_template=_.template('<div class="assignment_container">                                           <h2>Assignment Tasks</h2>                                         <div class="module-list" id="assignment_tasks">                                             <ol class="tasks list-unstyled ui-sortable">                                             </ol>                                             <input type="text"  name="new-task" id="new-task"  placeholder="New Task"><!--                                           --><button class="btn btn-primary" id="add-task">Add</button>                                         </div>                                         <h2>Assignment Settings</h2>                                         <div class="assignment-settings">                                             <div class="assignment-settings-right-container">                                                 <ul class="unlock-times">                                                     <li class="module-setting">                                                         <label for="faq_unlock_time">FAQ</label>                                                         <input                                                              type="number"                                                              name="faq-unlock-time"                                                              id="faq_unlock_time"                                                              value=""                                                             placeholder="FAQ">                                                     </li>                                                      <li class="module-setting">                                                         <label for="answersheet_unlock_time">Answersheet</label>                                                         <input                                                              type="number"                                                              name="answersheet-unlock-time"                                                              id="answersheet_unlock_time"                                                              value=""                                                             placeholder="Answersheet">                                                     </li>                                                 </ul>                                             </div>                                         </div>                                     </div>'),assignment_solution_template=_.template('<div id="assignment-solutions">                                                     <section class="assignment-solutions">                                                         <h2>Assignment Solutions</h2>                                                         <p>This assignment needs its first solution! See below for directions.</p>                                                         <div class="create">                                                             <h3>Create Solution</h3>                                                             <form accept-charset="UTF-8" action="/solutions" class="create" data-remote="true" id="new_solution" method="post">                                                                 <div style="display:none">                                                                     <input name="utf8" type="hidden" value="\u2713">                                                                 </div>                                                                 <div>                                                                     <p>Solutions for this assignment live here:</p>                                                                     <p>                                                                         <a target="_blank" href=""></a>                                                                     </p>                                                                     <p>Please commit your solution code to a new directory within the <code>solutions</code> folder. The directory name, or <code>location slug</code>, is up to you -- just make sure you record it below. No spaces please!</p>                                                                 </div>                                                                 <ul class="list-unstyled">                                                                     <li style="display: inline-block;">                                                                         <label for="solution_location_slug">Location slug</label>                                                                         <span class="glyphicon glyphicon-info-sign" data-html="true" data-toggle="tooltip" data-placement="top" title="" data-original-title="This is the name of the directory you just created inside <code>solutions</code>"></span>                                                                         <input id="solution_location_slug" name="solution[location_slug]" type="text">                                                                     </li>                                                                     <li style="display: inline-block;">                                                                         <label for="solution_title">Title</label>                                                                         <input id="solution_title" name="solution[title]" type="text">                                                                     </li>                                                                     <li style="display: inline-block;">                                                                         <label for="solution_Vimeo ID">Vimeo id</label>                                                                         <span class="glyphicon glyphicon-info-sign" data-html="true" data-toggle="tooltip" data-placement="top" title="" data-original-title="We use Vimeo to store and host our videos. Please provide the ID for your walkthrough!"></span>                                                                         <input id="solution_vimeo_id" name="solution[vimeo_id]" type="text">                                                                     </li>                                                                 </ul>                                                                 <input id="solution_user_id" name="solution[user_id]" type="hidden" value="6146">                                                                 <input id="solution_chapter_module_id" name="solution[chapter_module_id]" type="hidden" value="24835">                                                                 <div class="actions">                                                                     <input class="btn btn-primary" name="commit" type="submit" value="Create Solution">                                                                 </div>                                                             </form>                                                         </div>                                                     </section>                                                 </div>'),uploads_template=_.template('<section class="uploads">                                         <h2>Chapter Uploads</h2>                                         <div class="uploads-table">                                             <table class="table table-striped">                                                 <thead>                                                     <tr>                                                         <th>Filename</th>                                                         <th>Uploaded by</th>                                                         <th>Course</th>                                                         <th>Chapter</th>                                                         <th>Actions</th>                                                     </tr>                                                 </thead>                                                 <tbody>                                                 </tbody>                                             </table>                                         </div>                                         <form accept-charset="UTF-8" action="/uploads" class="new_upload" enctype="multipart/form-data" id="new_upload" method="post">                                             <div style="display:none">                                                 <input name="utf8" type="hidden" value="\u2713">                                                 <input name="authenticity_token" type="hidden" value="MDoibt/EZt6jWvUbpgEtoHNmPUjbqGY1U3vOjKeHMLg=">                                             </div>                                             <input type="hidden" name="module_id" value="<%= module_id %>">                                             <label for="upload_file">                                                 <input class="btn hidden" id="upload_file" input_html="{:id=>&quot;upload_file&quot;}" name="upload[file]" type="file">                                                 <img src="/assets/add_file.png" alt="Upload icon">                                                 <span class="upload_name">No file chosen</span>                                             </label>                                             <div class="actions">                                                 <input class="btn" name="commit" type="submit" value="Create Upload">                                             </div>                                             <div class="field">                                                 <input id="upload_user_id" name="upload[user_id]" type="hidden" value="6146">                                             </div>                                             <div class="field">                                                 <input id="upload_course_id" name="upload[course_id]" type="hidden" value="1359">                                             </div>                                             <div class="field">                                                 <input id="upload_chapter_id" name="upload[chapter_id]" type="hidden" value="4089">                                             </div>                                         </form>                                     </section> ');